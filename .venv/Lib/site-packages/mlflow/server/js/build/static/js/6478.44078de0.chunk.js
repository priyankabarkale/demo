"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[6478],{27042:function(e,a,t){t.d(a,{Q:function(){return M}});var s=t(68248),l=t(76118),o=t(46709),n=t(27757),r=t(79081),i=t(82716),d=t(7655),c=t(40724),u=t(884),m=t(73408);var g={name:"4zleql",styles:"display:block"};function p(e){return a=>function(e,a){const t=(0,d.A)(),{theme:c}=(0,n.u)(),u=e.props.searchValue.toLowerCase();return(0,o.useMemo)(()=>{if(!u)return e;if((0,l.sortedIndexOf)(a,u)>=0)return e;const n=/^[^,.:/=\-\s]+$/.test(u);return o.cloneElement(e,{flattenOptions:[{data:{value:u,disabled:!n,style:{color:n?c.colors.actionTertiaryTextDefault:c.colors.actionDisabledText},children:(0,m.Y)(r.T,{content:n?void 0:t.formatMessage({id:"fWEvZL",defaultMessage:", . : / - = and blank spaces are not allowed"}),componentId:"mlflow.common.components.tag-select-dropdown.add-new-tag-tooltip",side:"right",children:(0,m.FD)("span",{css:g,children:[(0,m.Y)(i.PlusIcon,{css:(0,s.AH)({marginRight:c.spacing.sm},"")}),t.formatMessage({id:"IJbauF",defaultMessage:'Add tag "{tagKey}"'},{tagKey:u})]})})},key:u,groupOption:!1},...e.props.flattenOptions]})},[a,e,u,t,c])}(a,e)}var f={name:"1d3w5wq",styles:"width:100%"};function h({allAvailableTags:e,control:a,onKeyChangeCallback:t}){const s=(0,d.A)(),[l,n]=(0,o.useState)(!1),r=(0,o.useRef)(null),{field:c,fieldState:g}=(0,u.as)({control:a,name:"key",rules:{required:{message:s.formatMessage({id:"RlBbjb",defaultMessage:"A tag key is required"}),value:!0}}});return(0,m.Y)(i.LegacySelect,{allowClear:!0,ref:r,dangerouslySetAntdProps:{showSearch:!0,dropdownRender:p(e)},css:f,placeholder:s.formatMessage({id:"8ALhnh",defaultMessage:"Type a key"}),value:c.value,defaultValue:c.value,open:l,onDropdownVisibleChange:e=>{n(e)},filterOption:(e,a)=>null===a||void 0===a?void 0:a.value.toLowerCase().includes(e.toLowerCase()),onSelect:e=>{c.onChange(e),null===t||void 0===t||t(e)},onClear:()=>{c.onChange(void 0),null===t||void 0===t||t(void 0)},validationState:g.error?"error":void 0,children:e.map(e=>(0,m.Y)(i.LegacySelect.Option,{value:e,children:e},e))})}var v=t(59281),y=t(77153);function _(e){return new Map(e.map(e=>[e.key,e]))}var k={name:"82a6rk",styles:"flex:1"},w={name:"82a6rk",styles:"flex:1"};const M=({onSuccess:e,saveTagsHandler:a,allAvailableTags:t,valueRequired:g=!1,title:p})=>{const f=(0,o.useRef)(),[M,T]=(0,o.useState)(""),{theme:C}=(0,n.u)(),[x,I]=(0,o.useState)(new Map),[Y,A]=(0,o.useState)(new Map),[V,F]=(0,o.useState)(!1),S=(0,u.mN)({defaultValues:{key:void 0,value:""}}),H=()=>F(!1),L=(0,o.useCallback)(e=>{f.current=e,I(_(e.tags||[])),A(_(e.tags||[])),S.reset(),F(!0)},[S]),R=async()=>{f.current&&(T(""),K(!0),a(f.current,Array.from(x.values()),Array.from(Y.values())).then(()=>{H(),null===e||void 0===e||e(),K(!1)}).catch(e=>{var a;K(!1),T(e instanceof y.s?null===(a=e.getUserVisibleError())||void 0===a?void 0:a.message:e.message)}))},q=(0,d.A)(),D=S.watch(),[E,K]=(0,o.useState)(!1),B=(0,o.useMemo)(()=>!(0,l.isEqual)((0,l.sortBy)(Array.from(x.values()),"key"),(0,l.sortBy)(Array.from(Y.values()),"key")),[x,Y]),P=D.key||D.value,U=B&&P;return{EditTagsModal:(0,m.FD)(r.d,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_135",destroyOnClose:!0,visible:V,title:null!==p&&void 0!==p?p:(0,m.Y)(c.A,{id:"TBX+Gs",defaultMessage:"Add/Edit tags"}),onCancel:H,footer:(0,m.FD)(n.x,{children:[(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_147",dangerouslyUseFocusPseudoClass:!0,onClick:H,css:(0,s.AH)({marginRight:B?0:C.spacing.sm},""),children:q.formatMessage({id:"2a/rR8",defaultMessage:"Cancel"})}),U?(0,m.Y)(b,{formValues:D,isLoading:E,onSaveTask:R}):(0,m.Y)(r.T,{content:B?void 0:q.formatMessage({id:"16onEc",defaultMessage:"Please add or remove one or more tags before saving"}),componentId:"mlflow.common.hooks.useeditkeyvaluetagsmodal.tooltip",children:(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_174",dangerouslyUseFocusPseudoClass:!0,disabled:!B,loading:E,type:"primary",onClick:R,children:q.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})})]}),children:[(0,m.FD)("form",{onSubmit:S.handleSubmit(()=>{if(g&&!D.value.trim())return;const e=new Map(Y);e.set(D.key,D),A(e),S.reset()}),css:(0,s.AH)({display:"flex",alignItems:"flex-end",gap:C.spacing.md},""),children:[(0,m.FD)("div",{css:(0,s.AH)({minWidth:0,display:"flex",gap:C.spacing.md,flex:1},""),children:[(0,m.FD)("div",{css:k,children:[(0,m.Y)(i.FormUI.Label,{htmlFor:"key",children:q.formatMessage({id:"crTWax",defaultMessage:"Key"})}),(0,m.Y)(h,{allAvailableTags:t||[],control:S.control,onKeyChangeCallback:e=>{var a;const t=e?Y.get(e):void 0;S.setValue("value",null!==(a=null===t||void 0===t?void 0:t.value)&&void 0!==a?a:"")}})]}),(0,m.FD)("div",{css:w,children:[(0,m.Y)(i.FormUI.Label,{htmlFor:"value",children:g?q.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):q.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"})}),(0,m.Y)(i.RHFControlledComponents.Input,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_223",name:"value",control:S.control,"aria-label":g?q.formatMessage({id:"tHrp+A",defaultMessage:"Value"}):q.formatMessage({id:"4B8k46",defaultMessage:"Value (optional)"}),placeholder:q.formatMessage({id:"FFe+Ug",defaultMessage:"Type a value"})})]})]}),(0,m.Y)(r.T,{content:q.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),componentId:"mlflow.common.hooks.useeditkeyvaluetagsmodal.add-tag-tooltip",children:(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_248",htmlType:"submit","aria-label":q.formatMessage({id:"tx3aAM",defaultMessage:"Add tag"}),children:(0,m.Y)(i.PlusIcon,{})})})]}),M&&(0,m.Y)(i.FormUI.Message,{type:"error",message:M}),(0,m.Y)("div",{css:(0,s.AH)({display:"flex",rowGap:C.spacing.xs,flexWrap:"wrap",marginTop:C.spacing.sm},""),children:Array.from(Y.values()).map(e=>(0,m.Y)(v.t,{isClosable:!0,tag:e,onClose:()=>(({key:e})=>{A(a=>(a.delete(e),new Map(a)))})(e)},e.key))})]}),showEditTagsModal:L,isLoading:E}};var T={name:"1y0ex1",styles:"max-width:400px"};function b({isLoading:e,formValues:a,onSaveTask:t}){const o=(0,d.A)(),{theme:r}=(0,n.u)(),i=`${`${(0,l.truncate)(a.key,{length:20})||"_"}`}${a.value?`:${(0,l.truncate)(a.value,{length:20})}`:""}`,c=o.formatMessage({id:"wcSVYI",defaultMessage:'Are you sure you want to save and close without adding "{tag}"'},{tag:i});return(0,m.FD)(n.aw.Root,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_309",children:[(0,m.Y)(n.aw.Trigger,{asChild:!0,children:(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_306",dangerouslyUseFocusPseudoClass:!0,loading:e,type:"primary",children:o.formatMessage({id:"801Xh4",defaultMessage:"Save tags"})})}),(0,m.FD)(n.aw.Content,{align:"end","aria-label":c,children:[(0,m.Y)(n.T.Paragraph,{css:T,children:c}),(0,m.Y)(n.aw.Close,{asChild:!0,children:(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_316",onClick:t,children:o.formatMessage({id:"mv6CY3",defaultMessage:"Yes, save and close"})})}),(0,m.Y)(n.aw.Close,{asChild:!0,children:(0,m.Y)(n.B,{componentId:"codegen_mlflow_app_src_common_hooks_useeditkeyvaluetagsmodal.tsx_324",type:"primary",css:(0,s.AH)({marginLeft:r.spacing.sm},""),children:o.formatMessage({id:"geizp1",defaultMessage:"Cancel"})})}),(0,m.Y)(n.aw.Arrow,{})]})]})}},27462:function(e,a,t){t.d(a,{F:function(){return o}});var s=t(46709),l=t(40720);const o=({traceSearchLocations:e,reviewAppId:a,labelingSessionId:t,traceIdToItemIdMap:o})=>{const n=(0,l.C)();return(0,s.useMemo)(()=>({deleteTraces:async(e,a)=>n.mutateAsync({experimentId:e,traceRequestIds:a})}),[n])}},33656:function(e,a,t){t.d(a,{N9:function(){return m},NW:function(){return c},OT:function(){return i},Yc:function(){return u}});var s=t(46709),l=t(22141),o=t.n(l),n=t(76251);let r=null;const i=()=>r||(r=new n.Converter,r.setFlavor("github"),r),d={allowedTags:["h1","h2","h3","h4","h5","h6","h7","h8","blockquote","p","a","ul","ol","nl","li","ins","b","i","strong","em","strike","code","hr","br","div","table","thead","tbody","tr","th","td","pre","del","sup","sub","dl","dt","dd","kbd","q","samp","samp","var","hr","rt","rp","summary","iframe","img","caption","figure"],allowedAttributes:{a:["href","name","target"],img:["src","longdesc"],div:["itemscope","itemtype"]}},c=e=>o()(e,d),u=e=>e.replace(new RegExp("<a","g"),'<a target="_blank"'),m=()=>(0,s.useCallback)(e=>{const a=i().makeHtml(e);return c(a)},[])},40720:function(e,a,t){t.d(a,{C:function(){return r}});var s=t(39595),l=t(61060),o=t(12803),n=t(21723);const r=()=>{const e=(0,s.jE)();return(0,l.n)({mutationFn:async({experimentId:e,traceRequestIds:a})=>{const t=[];for(let l=0;l<a.length;l+=100)t.push(a.slice(l,l+100));const s=t.map(a=>o.x.deleteTracesV3(e,a));return{traces_deleted:(await Promise.all(s)).reduce((e,a)=>e+a.traces_deleted,0)}},onSuccess:()=>(0,n.BL)({queryClient:e})})}},59281:function(e,a,t){t.d(a,{t:function(){return h}});var s=t(68248),l=t(82716),o=t(79081),n=t(27757),r=t(46709),i=t(7655),d=t(91701),c=t(73408);const{Paragraph:u}=n.T;var m={name:"zjik7",styles:"display:flex"},g={name:"1ff36h2",styles:"flex-grow:1"};const p=r.memo(e=>{const{theme:a}=(0,n.u)();return(0,c.Y)(o.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,c.FD)("div",{css:m,children:[(0,c.Y)(u,{css:g,children:(0,c.Y)("pre",{css:(0,s.AH)({backgroundColor:a.colors.backgroundPrimary,marginTop:a.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,c.Y)("div",{css:(0,s.AH)({marginTop:a.spacing.sm},""),children:(0,c.Y)(d.i,{copyText:e.tagValue,showLabel:!1,icon:(0,c.Y)(l.CopyIcon,{}),"aria-label":"Copy"})})]})})});function f(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const h=({isClosable:e=!1,onClose:a,tag:t,enableFullViewModal:d=!1,charLimit:u=30,maxWidth:m=300,className:g})=>{const h=(0,i.A)(),[v,y]=(0,r.useState)(!1),{shouldTruncateKey:_,shouldTruncateValue:k}=function(e,a=30){const{key:t,value:s}=e,l=t.length+s.length,o=t.length>s.length,n=o?s.length:t.length;return l<=a?{shouldTruncateKey:!1,shouldTruncateValue:!1}:n>a/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:o,shouldTruncateValue:!o}}(t,u),w=d&&(_||k),M=h.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,c.FD)("div",{children:[(0,c.Y)(l.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:a,title:t.key,className:g,children:(0,c.Y)(o.T,{content:w?M:"",componentId:"mlflow.common.components.key-value-tag.tooltip",children:(0,c.FD)("span",{css:(0,s.AH)({maxWidth:m,display:"inline-flex"},""),onClick:()=>w?y(!0):void 0,children:[(0,c.Y)(n.T.Text,{bold:!0,title:t.key,css:f(_),children:t.key}),t.value&&(0,c.FD)(n.T.Text,{title:t.value,css:f(k),children:[": ",t.value]})]})})}),(0,c.Y)("div",{children:v&&(0,c.Y)(p,{tagKey:t.key,tagValue:t.value,isKeyValueTagFullViewModalVisible:v,setIsKeyValueTagFullViewModalVisible:y})})]})}},82636:function(e,a,t){t.d(a,{l:function(){return l}});var s=t(21723);const l=e=>{let a=!1,t=!1,l=!1;for(const r of e){var o,n;const e=r.traceInfo;e&&((0,s.h)(e)&&(t=!0),(0,s.Mq)(e)&&(a=!0),null!==(o=r.traceInfo)&&void 0!==o&&null!==(n=o.trace_metadata)&&void 0!==n&&n["mlflow.trace.tokenUsage"]&&(l=!0))}return{responseHasContent:a,inputHasContent:t,tokensHasContent:l}}},88525:function(e,a,t){t.d(a,{$:function(){return r}});var s=t(27042),l=t(12803),o=t(46709),n=t(181);const r=({onSuccess:e,existingTagKeys:a=[]})=>{const{showEditTagsModal:t,EditTagsModal:r}=(0,s.Q)({saveTagsHandler:async(e,a,t)=>{if(!e.traceRequestId)return;const s=e.traceRequestId,o=t.filter(({key:e,value:t})=>!a.some(({key:a,value:s})=>a===e&&t===s)),n=a.filter(({key:e})=>!t.some(({key:a})=>e===a));return Promise.all([...o.map(({key:e,value:a})=>l.x.setExperimentTraceTagV3(s,e,a)),...n.map(({key:e})=>l.x.deleteExperimentTraceTagV3(s,e))])},valueRequired:!0,allAvailableTags:a.filter(e=>e&&!e.startsWith(n.nt)),onSuccess:e});return{showEditTagsModalForTrace:(0,o.useCallback)(e=>{var a;if(!e.trace_id)return;const s=Object.entries(null!==(a=e.tags)&&void 0!==a?a:{}).map(([e,a])=>({key:e,value:a})).filter(({key:e})=>e&&!e.startsWith(n.nt))||[];t({traceRequestId:e.trace_id,tags:s||[]})},[t]),EditTagsModal:r}}}}]);