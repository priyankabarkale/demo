"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[2763],{3241:function(e,t,n){var s=n(68248),o=n(46709),r=n(27556),a=n(82716),i=n(27757),l=n(66916),d=n(73408);var c={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};t.A=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:u,handlePreviousSearchMatch:m})=>{const[p,g]=(0,o.useState)(e),f=(0,r.YQ)(t,350),{theme:v}=(0,i.u)();return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:v.spacing.sm},""),children:[(0,d.Y)(l.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:p,onClear:()=>{t(""),g("")},onChange:e=>{g(e.target.value),f(e.target.value.toLowerCase())},prefix:(0,d.Y)(l.S,{}),css:c}),n.match&&(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:v.spacing.xs,marginRight:v.spacing.sm,alignItems:"center"},""),children:[(0,d.FD)(i.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:v.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,d.Y)(i.B,{"data-testid":"prev-search-match",icon:(0,d.Y)(a.ChevronUpIcon,{}),onClick:m,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,d.Y)(i.B,{"data-testid":"next-search-match",icon:(0,d.Y)(a.ChevronDownIcon,{}),onClick:u,componentId:"shared.model-trace-explorer.next-search-match"})]})]})}},4947:function(e,t,n){n.d(t,{$W:function(){return f},A5:function(){return R},Al:function(){return M},FW:function(){return v},Gq:function(){return Y},LV:function(){return y},My:function(){return E},Pn:function(){return h},Rb:function(){return I},Rl:function(){return u},Te:function(){return p},VC:function(){return C},XQ:function(){return m},XS:function(){return D},YO:function(){return A},d6:function(){return x},im:function(){return S},k0:function(){return T},li:function(){return b},rc:function(){return w},tP:function(){return d},tj:function(){return g},yX:function(){return c}});var s=n(76118),o=n(46709),r=n(33481),a=n(64667),i=n(93241),l=n(71540);const d="user",c="session",u="response",m="trace_id",p="request_time",g="execution_duration",f="state",v="source",h="tags",y="trace_name",x="request",b="run_name",S="logged_model",A="tokens",w="custom_metadata",Y="span.name",I="span.type",T="span.content",C="prompt",E=[g,p,c],M=[g,p],N=[r._1.CHUNK_RELEVANCE,r._1.TOTAL_INPUT_TOKEN_COUNT,r._1.TOTAL_OUTPUT_TOKEN_COUNT,r._1.TOTAL_TOKEN_COUNT,r._1.DOCUMENT_RECALL,r._1.DOCUMENT_RATINGS],_="_assessment_column";function R(e){return e+_}function k(e){return e+"_expectation_column"}const D=(e,t,n,r,w,Y)=>(0,o.useMemo)(()=>{const o=null!==Y&&void 0!==Y?Y:(0,l.ZS)(t);let I=[];if(o)I=[{id:x,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:a.$6.INPUT,group:a.w8.INFO,filterOrder:0}];else{let e=new Set,n=new Set;t.forEach(t=>{const{inputs:s}=t;e=new Set([...e,...Object.keys(s||{})]),n=new Set([...n,...Object.keys(t.traceInfo||{})])}),I=[...e].map(e=>({id:e,label:e,type:a.$6.INPUT}))}const T=n.map(e=>({id:R(e.name),label:e.displayName,type:a.$6.ASSESSMENT,assessmentInfo:e,group:a.w8.ASSESSMENT})).filter(e=>!e.assessmentInfo.isRetrievalAssessment&&!N.includes(e.assessmentInfo.name));let E;const M={};if(o){E=[{id:m,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:y,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:u,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:a.$6.TRACE_INFO,group:a.w8.INFO,filterOrder:0},{id:d,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:c,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:g,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),filterLabel:e.formatMessage({id:"rRhMQt",defaultMessage:"Execution time (ms)"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:f,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:v,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:S,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:C,label:e.formatMessage({id:"LOJumx",defaultMessage:"Prompt"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},{id:A,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},(0,s.isNil)(r)&&{id:b,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:a.$6.TRACE_INFO,group:a.w8.INFO},!(0,i.ij)()&&{id:h,label:e.formatMessage({id:"M3c7bs",defaultMessage:"Tags"}),type:a.$6.TRACE_INFO,group:a.w8.TAG}];const n=[...t,...w||[]],o={};if(n.forEach(e=>{var t;const n=null===(t=e.traceInfo)||void 0===t?void 0:t.trace_metadata;n&&Object.keys(n).forEach(e=>{e.startsWith(l.nt)||o[e]||(o[e]={id:(0,l.c7)(e),label:e,type:a.$6.TRACE_INFO,group:a.w8.INFO})});const s=e.targets;s&&Object.keys(s).forEach(e=>{M[e]||(M[e]={id:k(e),label:e,type:a.$6.EXPECTATION,group:a.w8.EXPECTATION,expectationName:e})})}),E=[...E,...Object.values(o)],(0,i.ij)()){const e={};n.map(e=>{var t;return null===(t=e.traceInfo)||void 0===t?void 0:t.tags}).forEach(t=>{Object.keys(t||{}).forEach(t=>{t.startsWith(l.nt)||e[t]||(e[t]={id:(0,l.kZ)(t),label:t,type:a.$6.TRACE_INFO,group:a.w8.TAG})})});const t=Object.values(e);E=[...E,...t]}}else E=t.some(e=>!(0,s.isNil)(e.requestTime))?[{id:p,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:a.$6.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...I,...E,...T,...Object.values(M)].filter(e=>Boolean(e))},[t,e,n,r,w,Y])},5075:function(e,t,n){n.d(t,{Q:function(){return u}});var s=n(68248),o=(n(46709),n(82716)),r=n(27757),a=n(79081),i=n(42747),l=n(73408);const d={user_frustration:{none:{color:"lime",icon:o.CheckCircleIcon,label:(0,l.Y)(i.sA,{id:"Sm0bXt",defaultMessage:"None"})},resolved:{color:"lemon",icon:o.CheckCircleIcon,label:(0,l.Y)(i.sA,{id:"q90WPh",defaultMessage:"Resolved"})},unresolved:{color:"coral",icon:o.XCircleIcon,label:(0,l.Y)(i.sA,{id:"OcYzCN",defaultMessage:"Unresolved"})}}};var c={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const u=({jsonValue:e,className:t,prefix:n,skipIcons:u=!1,overrideColor:m,assessmentName:p})=>{const{theme:g}=(0,r.u)();if(!e||'""'===e)return null;let f;try{f=JSON.parse(e)}catch(x){f=e}let v="default",h=JSON.stringify(f,null,2);const y=((e,t,n,o)=>{if(!e)return;const r=d[e];if(!r)return;const a=r[String(null!==t&&void 0!==t?t:"")];if(!a)return;const i=a.icon;return{color:a.color,children:(0,l.FD)(l.FK,{children:[!o&&(0,l.Y)(i,{css:(0,s.AH)({marginRight:n.spacing.xs},"")}),a.label]})}})(p,f,g,u);return y?(v=y.color,h=y.children):"yes"===f?(v="lime",h=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===f?(v="coral",h=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof f?h=f:null===f?(v="coral",h=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(r.k,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===f?(v="lime",h=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.CheckCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===f&&(v="coral",h=(0,l.FD)(l.FK,{children:[!u&&(0,l.Y)(o.XCircleIcon,{css:(0,s.AH)({marginRight:g.spacing.xs},"")}),(0,l.Y)(i.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,l.Y)(a.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:h,children:(0,l.Y)(o.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:g.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:null!==m&&void 0!==m?m:v,className:t,children:(0,l.FD)("span",{css:c,children:[n,h]})})})}},8531:function(e,t,n){n.d(t,{a:function(){return B}});var s=n(68248),o=n(46709),r=n(27757),a=n(42747),i=n(81390),l=n(82716),d=n(79081),c=n(86125),u=n(51847),m=n(73408);const p=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,r.u)();return(0,m.FD)(r.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,m.Y)(r.aw.Trigger,{asChild:!0,children:(0,m.Y)(r.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,m.Y)(l.FilterIcon,{}),size:"small",children:(0,m.Y)(a.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,m.Y)(r.aw.Content,{align:"start",children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,m.Y)(r.T.Text,{bold:!0,children:(0,m.Y)(a.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)(a.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map(([o,a])=>{const i=(0,m.Y)(u.P,{type:(0,c.tC)(o)});return(0,m.FD)(l.Checkbox,{componentId:"shared.model-trace-explorer.toggle-span-filter",style:{width:"100%"},isChecked:a,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[o]:!a}}),children:[i,(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,c.LS)(o)})]},o)}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)(a.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,m.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_83",style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(a.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,m.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,m.Y)(a.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,m.FD)(l.Checkbox,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_timeline_tree_timelinetreefilterbutton_111",style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,m.Y)(a.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,m.Y)(l.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,m.Y)(a.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},g=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:o})=>{const{theme:i}=(0,r.u)();return(0,m.FD)("div",{css:(0,s.AH)({padding:`${i.spacing.xs}px ${i.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${i.colors.border}`,boxSizing:"border-box",paddingLeft:i.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,m.Y)(r.T.Text,{bold:!0,children:(0,m.Y)(a.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[(0,m.Y)(p,{spanFilterState:n,setSpanFilterState:o}),(0,m.FD)(l.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,m.Y)(l.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,m.Y)(a.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,m.Y)(l.ListBorderIcon,{})}),value:!1}),(0,m.Y)(l.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,m.Y)(a.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,m.Y)(l.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},f=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:i.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:i.u4.LOW},"")})},v=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:i.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?i.u4.NORMAL:i.u4.LOW},"")})},h=({active:e})=>{const{theme:t}=(0,r.u)(),n=e?t.colors.blue500:t.colors.border;return(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",width:i.De/2,left:"50%",height:i.QJ,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?i.u4.NORMAL:i.u4.LOW},"")})},y=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:o,isExpanded:r})=>0===n.length?(0,m.Y)("div",{css:(0,s.AH)({width:0,height:i.QJ,boxSizing:"border-box",position:"relative"},""),children:o&&(0,m.Y)(f,{active:t&&!e})}):(0,m.Y)(m.FK,{children:n.map(({shouldRender:a,isActive:l},d)=>(0,m.FD)("div",{css:(0,s.AH)({width:i.De,height:i.QJ,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,m.Y)(h,{active:l}),d===n.length-1&&(0,m.FD)(m.FK,{children:[(0,m.Y)(v,{active:t}),o&&r&&(0,m.Y)(f,{active:t&&!e})]})]},d))});var x=n(94664);var b={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const S=({span:e,children:t})=>{var n;const{theme:o}=(0,r.u)(),l=(0,c.tC)(null!==(n=e.type)&&void 0!==n?n:x.UG.UNKNOWN),p=o.isDarkMode?o.colors.grey800:o.colors.grey100,g=o.isDarkMode?o.colors.grey500:o.colors.grey350;return(0,m.Y)(d.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,m.FD)("div",{css:b,children:[(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,m.Y)(u.P,{type:l,isInTooltip:!0}),(0,m.Y)("span",{css:(0,s.AH)({color:p},""),children:e.title}),(0,m.Y)("span",{css:(0,s.AH)({marginLeft:o.spacing.xs,color:g,fontSize:o.typography.fontSizeSm},""),children:(0,i.X6)(e.end-e.start)})]}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:p},""),children:[(0,m.Y)(a.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,i.X6)(e.start)," | ",(0,m.Y)(a.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,i.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var A=n(53915);var w={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},Y={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const I=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:o,traceStartTime:a,traceEndTime:d,onSelect:u,linesToRender:p})=>{var g,f;const v=n.has(e.key),{theme:h}=(0,r.u)(),x=(null!==(g=e.children)&&void 0!==g?g:[]).length>0,{setAssessmentsPaneExpanded:b}=(0,A.nJ)(),T=t===e.key,C=(0,i.VD)(e,String(t)),E=C>-1,M=(0,c.N7)(e)>0,N=T?h.colors.actionDefaultBackgroundHover:"transparent";return(0,m.FD)(m.FK,{children:[(0,m.Y)(S,{span:e,children:(0,m.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:N,":hover":{backgroundColor:h.colors.actionDefaultBackgroundHover},":active":{backgroundColor:h.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===u||void 0===u||u(e)},children:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${h.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,m.FD)("div",{css:w,children:[x?(0,m.Y)(r.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:h.spacing.xs},""),icon:v?(0,m.Y)(l.ChevronDownIcon,{}):(0,m.Y)(r.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);v?s.delete(e.key):s.add(e.key),o(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:24,marginRight:h.spacing.xs},"")}),(0,m.Y)(y,{isActiveSpan:T,isInActiveChain:E,linesToRender:p,hasChildren:x,isExpanded:v}),(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:h.spacing.xs,borderRadius:h.borders.borderRadiusSm,border:`1px solid ${C>-1?h.colors.blue500:h.colors.backgroundSecondary}`,zIndex:i.u4.NORMAL},""),children:e.icon}),(0,m.Y)(r.T.Text,{color:M?"error":"primary",css:Y,children:e.title}),e.assessments.length>0&&(0,m.FD)(l.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:h.borders.borderRadiusSm},""),onClick:()=>null===b||void 0===b?void 0:b(!0),children:[(0,m.Y)(l.GavelIcon,{}),(0,m.Y)(r.T.Text,{css:(0,s.AH)({marginLeft:h.spacing.xs},""),children:e.assessments.length})]})]})})})}),v&&(null===(f=e.children)||void 0===f?void 0:f.map((s,r)=>{var i,l;return(0,m.Y)(I,{node:s,expandedKeys:n,setExpandedKeys:o,selectedKey:t,traceStartTime:a,traceEndTime:d,onSelect:u,linesToRender:p.concat({shouldRender:r<(null!==(i=null===(l=e.children)||void 0===l?void 0:l.length)&&void 0!==i?i:0)-1,isActive:r<C})},s.key)}))]})};var T=n(49633);var C={name:"s5xdrg",styles:"display:flex;align-items:center"},E={name:"1aunqn6",styles:"display:none;align-items:center"},M={name:"s5xdrg",styles:"display:flex;align-items:center"},N={name:"1aunqn6",styles:"display:none;align-items:center"};const _=({node:e,selectedKey:t,leftOffset:n,width:a,onSelect:d,expandedKeys:c,setExpandedKeys:u})=>{var p;const{theme:g}=(0,r.u)(),f=(0,o.useRef)(null),v=(0,o.useRef)(null),h=t===e.key?g.colors.actionDefaultBackgroundHover:"transparent",y=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,x=c.has(e.key);return(0,o.useLayoutEffect)(()=>{const e=f.current,t=v.current;if(!e||!t)return;e.style.display="inline-flex",t.style.display="inline-flex";const n=Math.max(e.offsetWidth,t.offsetWidth)<a-2*g.spacing.sm;var s;s=n,e.style.display=s?"inline-flex":"none",t.style.display=s?"none":"inline-flex"},[g.spacing.sm,a,x,e.title,e.icon]),(0,m.Y)(S,{span:e,children:(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:g.spacing.xs,paddingRight:g.spacing.sm,paddingTop:g.spacing.xs,paddingBottom:g.spacing.xs,backgroundColor:h,alignItems:"center",":hover":{backgroundColor:g.colors.actionDefaultBackgroundHover},":active":{backgroundColor:g.colors.actionDefaultBackgroundPress},zIndex:i.u4.NORMAL},""),onClick:()=>null===d||void 0===d?void 0:d(e),children:[y?(0,m.Y)(r.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:g.spacing.xs},""),icon:x?(0,m.Y)(l.ChevronDownIcon,{}):(0,m.Y)(r.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(c);x?n.delete(e.key):n.add(e.key),u(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,m.Y)("div",{css:(0,s.AH)({width:g.spacing.lg,marginRight:g.spacing.xs},"")}),(0,m.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,m.Y)("div",{css:(0,s.AH)({position:"relative",width:a,height:g.typography.lineHeightLg,backgroundColor:g.isDarkMode?g.colors.blue600:g.colors.blue300,border:`1px solid ${g.isDarkMode?g.colors.blue400:g.colors.blue500}`,borderRadius:g.borders.borderRadiusSm,flexShrink:0,display:"flex",alignItems:"center"},""),children:(0,m.Y)(r.T.Text,{color:"primary",css:C,children:(0,m.FD)("span",{ref:f,css:E,children:[e.icon&&(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,m.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs,color:g.colors.textPrimary},""),children:e.title})]})})}),(0,m.Y)("div",{css:(0,s.AH)({flex:1,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",display:"inline-flex",alignItems:"center",gap:g.spacing.xs,marginLeft:g.spacing.sm},""),children:(0,m.FD)("div",{css:(0,s.AH)({display:"inline-flex",alignItems:"center",backgroundColor:g.colors.backgroundSecondary,border:`1px solid ${g.colors.border}`,borderRadius:g.borders.borderRadiusSm,paddingRight:g.spacing.xs},""),children:[(0,m.Y)(r.T.Text,{color:"primary",css:M,children:(0,m.FD)("span",{ref:v,css:N,children:[e.icon&&(0,m.Y)("span",{css:(0,s.AH)({flexShrink:0,marginLeft:0,borderRight:`1px solid ${g.colors.border}`,"& > div":{height:g.general.buttonInnerHeight,borderTopRightRadius:0,borderBottomRightRadius:0}},""),children:e.icon}),(0,m.Y)("span",{css:(0,s.AH)({color:g.colors.textPrimary,marginLeft:g.spacing.xs},""),children:e.title})]})}),(0,m.Y)(r.T.Text,{color:"secondary",children:(0,m.Y)("span",{css:(0,s.AH)({marginLeft:g.spacing.xs},""),children:(0,i.X6)(e.end-e.start)})})]})})]},e.key)})};var R={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},k={name:"bjn8wh",styles:"position:relative"},D={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const F=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:a,traceEndTime:l,expandedKeys:d,setExpandedKeys:c})=>{var u,p;const{theme:g}=(0,r.u)(),f=(0,o.useRef)(null),v=null!==(u=null===(p=(0,T.wY)({ref:f}))||void 0===p?void 0:p.width)&&void 0!==u?u:0,h=(0,o.useMemo)(()=>function(e,t,n,s=60){const o=t-e;if(o<=0||n<=0)return[];const r=Math.floor(n/s);if(r<1)return[];const a=o/r,i=Math.pow(10,Math.floor(Math.log10(a))),l=a/i;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*i,u=t+2*c,m=[];for(let p=Math.ceil(e/c)*c;p<=u;p+=c)m.push(Number(p.toFixed(10)));return m}(a,l,v),[l,a,v]),y=Math.min(...h),x=(h[h.length-1]+h[h.length-2])/2,b=h.slice(0,-1),S=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,y,x,v);return(0,m.FD)("div",{css:R,children:[(0,m.Y)("div",{ref:f,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:g.typography.lineHeightBase,paddingLeft:32,paddingRight:g.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:g.colors.backgroundPrimary,zIndex:i.u4.HIGH},""),children:(0,m.Y)("div",{"data-testid":"time-marker-area",css:k,children:b.map(e=>(0,m.Y)(r.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:S(e),whiteSpace:"nowrap"},""),children:(0,i.X6)(e)},e))})}),(0,m.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:i.u4.LOW},""),children:(0,m.Y)("div",{css:D,children:b.map(e=>(0,m.Y)("div",{css:(0,s.AH)({position:"absolute",left:S(e)+32,borderRight:`1px solid ${g.colors.border}`,height:"100%"},"")},e))})}),e.map(e=>{const s=S(e.start),o=S(e.end)-s;return(0,m.Y)(_,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:o,expandedKeys:d,setExpandedKeys:c},e.key)})]})};var O={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},L={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},H={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},V={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const B=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:l,traceEndTime:d,expandedKeys:c,setExpandedKeys:u,spanFilterState:p,setSpanFilterState:f,className:v})=>{const{theme:h}=(0,r.u)(),y=(0,o.useCallback)(e=>{null===n||void 0===n||n(e)},[n]),{showTimelineTreeGantt:x,setShowTimelineTreeGantt:b}=(0,A.nJ)(),S=(0,o.useMemo)(()=>(0,i.os)(e,c),[e,c]),w=(0,o.useMemo)(()=>{var n;return(0,m.Y)("div",{css:O,children:x?(0,m.Y)(F,{nodes:S,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:y,traceStartTime:l,traceEndTime:d,expandedKeys:c,setExpandedKeys:u}):e.map(e=>{var n;return(0,m.Y)(I,{node:e,expandedKeys:c,setExpandedKeys:u,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:l,traceEndTime:d,onSelect:y,linesToRender:[]},e.key)})})},[x,S,null===t||void 0===t?void 0:t.key,y,l,d,e,c,u]);return(0,m.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:h.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:v,children:(0,m.Y)("div",{css:L,children:(0,m.FD)("div",{css:H,children:[(0,m.Y)(g,{showTimelineInfo:x,setShowTimelineInfo:b,spanFilterState:p,setSpanFilterState:f}),e.length>0?(0,m.Y)("div",{css:V,children:w}):(0,m.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:h.spacing.md,paddingTop:h.spacing.lg},""),children:(0,m.Y)(a.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})}},9858:function(e,t,n){n.d(t,{CY:function(){return g},G8:function(){return a},IX:function(){return i},OV:function(){return l},QO:function(){return h},YH:function(){return r},wG:function(){return v},x2:function(){return f}});var s=n(76118),o=n(90448);const r={up:"#02B30214",down:"#F000400F"},a="#64172B",i="#077A9D",l="#FFAB00",d="#99DDB4",c="#FCA4A1",u="#02B30214",m={user_frustration:{name:"user_frustration",valueColors:{none:{bar:d,tag:u,icon:e=>e.isDarkMode?e.colors.green400:e.colors.green600,text:e=>e.isDarkMode?e.colors.green400:e.colors.green600},resolved:{bar:e=>e.colors.yellow400,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.yellow800,.6):e.colors.yellow200,icon:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600,text:e=>e.isDarkMode?e.colors.yellow400:e.colors.yellow600},unresolved:{bar:c,tag:e=>e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200,icon:e=>e.isDarkMode?e.colors.red400:e.colors.red600,text:e=>e.isDarkMode?e.colors.red400:e.colors.red600}}}},p=(e,t,n)=>{const s=m[e.name];if(!s)return;const o=String(null!==t&&void 0!==t?t:""),r=s.valueColors[o];return r?{bar:"function"===typeof r.bar?r.bar(n):r.bar,tag:"function"===typeof r.tag?r.tag(n):r.tag,icon:"function"===typeof r.icon?r.icon(n):r.icon,text:"function"===typeof r.text?r.text(n):r.text}:void 0},g=(e,t,n)=>{const s=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==s&&void 0!==s&&s.icon)return s.icon;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return e.isDarkMode?e.colors.green400:e.colors.green600;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?e.colors.red400:e.colors.red600}return null!==n&&void 0!==n&&n.errorMessage?e.colors.textValidationWarning:e.colors.grey400},f=(e,t,n,r=!1)=>{const a=p(t,null===n||void 0===n?void 0:n.stringValue,e);if(null!==a&&void 0!==a&&a.tag)return a.tag;if("pass-fail"===t.dtype){if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES)return u;if((null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO)return e.isDarkMode?(0,o.fu)(e.colors.red800,.6):e.colors.red200;if(!r&&null!==n&&void 0!==n&&n.errorMessage)return""}else if("boolean"===t.dtype)return(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?"":n.booleanValue?u:e.isDarkMode?e.colors.red800:e.colors.red200;return""},v=(e,t,n)=>{if(null!==n&&void 0!==n&&n.errorMessage)return e.colors.textValidationWarning;const r=p(t,null===n||void 0===n?void 0:n.stringValue,e);return null!==r&&void 0!==r&&r.text?r.text:"pass-fail"===t.dtype?(null===n||void 0===n?void 0:n.stringValue)===o.gZ.YES?e.isDarkMode?e.colors.green400:e.colors.green600:(null===n||void 0===n?void 0:n.stringValue)===o.gZ.NO?e.isDarkMode?e.colors.red400:e.colors.red600:e.colors.textSecondary:"boolean"===t.dtype?(0,s.isNil)(null===n||void 0===n?void 0:n.booleanValue)?e.colors.textSecondary:e.colors.textPrimary:"unknown"===t.dtype?e.colors.textSecondary:e.colors.textPrimary},h=(e,t,n,r)=>{if(r)return"#f09065";const a=p(t,n,e);return null!==a&&void 0!==a&&a.bar?a.bar:"pass-fail"===t.dtype?n===o.gZ.YES?d:n===o.gZ.NO?c:e.isDarkMode?e.colors.grey800:e.colors.grey200:"boolean"===t.dtype?(0,s.isNil)(n)?e.isDarkMode?e.colors.grey800:e.colors.grey200:n?d:c:e.isDarkMode?e.colors.grey800:e.colors.grey200}},12129:function(e,t,n){n.d(t,{$U:function(){return o},fi:function(){return r},ko:function(){return a}});var s=n(58663);const o=e=>({type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}}),r=e=>{const[t,n]=e.split(".");return{type:"UC_SCHEMA",uc_schema:{catalog_name:t,schema_name:n}}},a=e=>{var t;return Boolean(e&&(0,s.gD)(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))}},13433:function(e,t,n){n.d(t,{G3:function(){return u},N5:function(){return c},TJ:function(){return h},UA:function(){return p},_A:function(){return v},aG:function(){return l},bU:function(){return d}});var s=n(59930),o=n.n(s),r=n(76118),a=n(33120),i=n(86125);const l=({traceId:e,assessmentId:t})=>(0,a.ff)((0,a.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"DELETE"),d=({payload:e})=>(0,a.ff)((0,a.we)(`ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`),"POST",e),c=({traceId:e})=>(0,a.ff)((0,a.we)(`ajax-api/3.0/mlflow/traces/${e}`)),u=({traceId:e,assessmentId:t,payload:n})=>(0,a.ff)((0,a.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"PATCH",n),m=async({traceIds:e,traceLocation:t})=>{const n=(0,r.isString)(t)?t:(0,i.nr)(t),s=(0,a.we)(`ajax-api/4.0/mlflow/traces/${n}/batchGet`),o=new URLSearchParams;for(const r of e)o.append("trace_ids",r);const l=`${s}?${o.toString()}`;return await(0,a.ff)(l,"GET")},p=({traceId:e})=>{const t=(0,a.we)("ajax-api/3.0/mlflow/traces/get"),n=new URLSearchParams;n.append("trace_id",e),n.append("allow_partial","true");const s=`${t}?${n.toString()}`;return(0,a.ff)(s,"GET")},g=e=>{const t=(0,a.we)("ajax-api/3.0/mlflow/get-trace-artifact"),n=new URLSearchParams;n.append("request_id",e);const s=`${t}?${n.toString()}`;return(0,a.ff)(s,"GET")},f=e=>{const t=(0,a.we)(`ajax-api/3.0/mlflow/traces/${e}`);return(0,a.ff)(t,"GET")},v={searchTracesV4:async({signal:e,orderBy:t,locations:n,filter:s,pageSize:o})=>{var r;const i={locations:n,filter:s,max_results:null!==o&&void 0!==o?o:1e3,order_by:t},l=await(0,a.ff)((0,a.we)("ajax-api/4.0/mlflow/traces/search"),"POST",i,e);return null!==(r=null===l||void 0===l?void 0:l.trace_infos)&&void 0!==r?r:[]},getBatchTracesV4:m,getTraceV4:async(e,t)=>{let n,s;if("string"===typeof e){const t=(0,i.iZ)(e);o()(null===t||void 0===t?void 0:t.trace_id,"Could not parse trace ID from serialized trace identifier"),o()(null===t||void 0===t?void 0:t.trace_location,"Could not parse trace location from serialized trace identifier"),n=t.trace_id,s=(0,i.M2)(t.trace_location)}else o()(e.trace_id,"Trace ID is required"),o()(e.trace_location,"Trace location is required"),n=e.trace_id,s=e.trace_location;const a=await m({traceIds:[n],traceLocation:s}),l=(0,r.first)(a.traces.map(e=>({info:e.trace_info,data:{spans:e.spans}})));return o()(l,"No trace found in response"),l},getTraceInfoV4:({traceId:e,traceLocation:t})=>{const n=(0,r.isString)(t)?t:(0,i.nr)(t),s=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${n}/${e}/info`)}?${(new URLSearchParams).toString()}`;return(0,a.ff)(s)},createAssessmentV4:({payload:{assessment:e},traceLocation:t})=>{o()(t,"Trace location is required for creating assessment via V4 API");const n=(0,r.isString)(t)?t:(0,i.nr)(t);o()(n,"Trace location could not be resolved");const s=e,l=new URLSearchParams,d=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${n}/${e.trace_id}/assessments`)}?${l.toString()}`;return(0,a.ff)(d,"POST",s)},updateAssessmentV4:({traceId:e,assessmentId:t,payload:n,traceLocation:s})=>{const{assessment:l,update_mask:d}=n;o()(s,"Trace location is required for updating assessment via V4 API");const c=(0,r.isString)(s)?s:(0,i.nr)(s);o()(c,"Trace location could not be resolved");const u=new URLSearchParams;u.append("update_mask",d);const m=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${c}/${e}/assessments/${t}`)}?${u.toString()}`;return(0,a.ff)(m,"PATCH",l)},deleteAssessmentV4:({traceId:e,sqlWarehouseId:t,assessmentId:n,traceLocation:s})=>{const l=new URLSearchParams;o()(s,"Trace location is required for deleting assessment via V4 API");const d=(0,r.isString)(s)?s:(0,i.nr)(s);o()(d,"Trace location could not be resolved");const c=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${d}/${e}/assessments/${n}`)}?${l.toString()}`;return(0,a.ff)(c,"DELETE")},setTraceTagV4:async({traceLocation:e,tag:t,traceId:n})=>{const s=(0,i.nr)(e),o=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${s}/${n}/tags`)}?${(new URLSearchParams).toString()}`;return(0,a.ff)(o,"PATCH",t)},deleteTraceTagV4:async({tagKey:e,traceId:t,traceLocation:n})=>{const s=(0,i.nr)(n),o=`${(0,a.we)(`ajax-api/4.0/mlflow/traces/${s}/${t}/tags/${encodeURIComponent(e)}`)}?${(new URLSearchParams).toString()}`;return(0,a.ff)(o,"DELETE")}},h={setTraceTagV3:async({tag:e,traceId:t})=>{const n=(0,a.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`);return(0,a.ff)(n,"PATCH",e)},deleteTraceTagV3:async({tagKey:e,traceId:t})=>{const n=(0,a.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`),s=new URLSearchParams;s.append("key",e);const o=`${n}?${s.toString()}`;return(0,a.ff)(o,"DELETE")},getTraceV3Info:f,getTraceV3Data:g,getTraceV3:async e=>{var t;const[n,s]=await Promise.all([f(e),g(e)]);return{info:null===n||void 0===n||null===(t=n.trace)||void 0===t?void 0:t.trace_info,data:s}}}},19926:function(e,t,n){var s=n(12608),o=n.n(s),r=n(73408);class a{static getEntryPointName(e){const t=e[a.entryPointTag];return t?t.value:""}static getSourceType(e){const t=e[a.sourceTypeTag];return t?t.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const t=e.split("/");return t[t.length-1]}static formatSource(e){const t=a.getSourceName(e),n=a.getSourceType(e),s=a.getEntryPointName(e);if("PROJECT"===n){let e=a.dropExtension(a.baseName(t));return s&&"main"!==s&&(e+=":"+s),e}if("JOB"===n){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,r=e&&e[s]&&e[s].value;return o&&r?a.getDefaultJobRunName(o,r):t}return a.baseName(t)}static getDefaultJobRunName(e,t,n=null){if(!e)return"-";let s=`job ${e}`;return t&&(s=`run ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static getSourceName(e){const t=e[a.sourceNameTag];return t?t.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getExperimentChatSessionPageRoute(e,t){return`/experiments/${e}/chat-sessions/${t}`}static getRunPageRoute(e,t){return`/experiments/${e}/runs/${t}`}static getLoggedModelPageRoute(e,t){return`/experiments/${e}/models/${t}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,t="master"){const n=e.match(a.getGitHubRegex()),s=e.match(a.getGitLabRegex()),o=e.match(a.getBitbucketRegex()),r=e.match(a.getGitRegex());let i=null;if(n)i=`https://github.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(i+=`/tree/${t}/${n[3]}`);else if(s)i=`https://gitlab.com/${s[1]}/${s[2].replace(/.git/,"")}`,s[3]&&(i+=`/-/tree/${t}/${s[3]}`);else if(o)i=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(i+=`/src/${t}/${o[3]}`);else if(r){const[,e,n,s]=r;i=e.replace(/git@/,"https://")+"/"+n.replace(/.git/,""),s&&(i+=`/tree/${t}/${s}`)}return i}static getNotebookRevisionId(e){const t="mlflow.databricks.notebookRevisionID";return e&&e[t]&&e[t].value}static getNotebookId(e){const t="mlflow.databricks.notebookID";return e&&e[t]&&e[t].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,t,n=null){if(!e)return"-";let s=`notebook ${e}`;return t&&(s=`revision ${t} of `+s),n&&(s=`workspace ${n}: `+s),s}static ensureUrlScheme(e,t="https"){return e?e.match(/^:\/\//i)?`${t}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${t}://${e}`:e}static setQueryParams(e,t){const n=new URL(a.ensureUrlScheme(e));return n.search=t||"",n.toString()}static getNotebookSourceUrl(e,t,n,s,o=null){let r=a.setQueryParams(o||window.location.origin,e);return r+=`#notebook/${t}`,n&&(r+=`/revision/${n}`,s&&(r+=`/mlflow/run/${s}`)),r}static renderNotebookSource(e,t,n,s,o,i=null,l=null){const d=o?a.baseName(o):a.getDefaultNotebookRevisionName(t,n),c=l||d;if(t){const l=a.getNotebookSourceUrl(e,t,n,s,i);return(0,r.Y)("a",{title:o||a.getDefaultNotebookRevisionName(t,n),href:l,target:"_top",onClick:e=>{e.stopPropagation()},children:c})}return c}static addQueryParams(e,t){if(!t||0===Object.keys(t).length)return e;const n=new URLSearchParams(e);Object.entries(t).forEach(([e,t])=>Boolean(e)&&Boolean(t)&&n.set(e,t));const s=n.toString();return""===s||s.includes("?")?s:`?${s}`}static getJobSourceUrl(e,t,n,s=null){let o=a.setQueryParams(s||window.location.origin,e);return o+=`#job/${t}`,n&&(o+=`/run/${n}`),o}static renderJobSource(e,t,n,s,o=null,i=null){const l=s||a.getDefaultJobRunName(t,n),d=i||l;if(t){const s=a.getJobSourceUrl(e,t,n,o);return(0,r.Y)("a",{title:l,href:s,target:"_top",onClick:e=>{e.stopPropagation()},children:d})}return d}static renderSource(e,t,n,s="master"){const o=a.getSourceName(e);let i=a.formatSource(e);const l=a.getGitRepoUrl(o,s);l&&(i=(0,r.Y)("a",{target:"_top",href:l,onClick:e=>{e.stopPropagation()},children:i}));const d=a.getSourceType(e);if("NOTEBOOK"===d){const s=a.getNotebookRevisionId(e),r=a.getNotebookId(e),i="mlflow.databricks.workspaceID",l=e&&e[i]&&e[i].value;if(a.isCurrentWorkspace(l))return a.renderNotebookSource(t,r,s,n,o,null);{const i="mlflow.databricks.workspaceURL",d=e&&e[i]&&e[i].value,c=a.addQueryParams(t,{o:l});return a.renderNotebookSource(c,r,s,n,o,d)}}if("JOB"===d){const n="mlflow.databricks.jobID",s="mlflow.databricks.jobRunID",o=e&&e[n]&&e[n].value,r=e&&e[s]&&e[s].value,l="mlflow.databricks.workspaceID",d=e&&e[l]&&e[l].value;if(a.isCurrentWorkspace(d))return a.renderJobSource(t,o,r,i,null);{const n="mlflow.databricks.workspaceURL",s=e&&e[n]&&e[n].value,l=a.addQueryParams(t,{o:d});return a.renderJobSource(l,o,r,i,s)}}return i}static renderSourceFromMetadata(e){var t,n,s,o,i;const l=null===(t=e.trace_metadata)||void 0===t?void 0:t[a.sourceNameTag],d=null===(n=e.trace_metadata)||void 0===n?void 0:n[a.sourceTypeTag];let c=l?a.baseName(l):"";const u=null===(s=e.trace_metadata)||void 0===s?void 0:s["mlflow.source.git.repoURL"],m=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],p=null===(i=e.trace_metadata)||void 0===i?void 0:i["mlflow.source.git.commit"];if(u){const e=u.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),t=p||m||"master",n=l?`/${l}`:"";let s=e;s=e.includes("github.com")?`${e}/tree/${t}${n}`:e.includes("gitlab.com")?`${e}/-/tree/${t}${n}`:e.includes("bitbucket.org")?`${e}/src/${t}${n}`:`${e}/tree/${t}${n}`,c=(0,r.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:s,onClick:e=>{e.stopPropagation()},children:c})}if("NOTEBOOK"===d){var g,f,v;const t=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.notebookRevisionID"],n=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.notebookID"],s=null===(v=e.trace_metadata)||void 0===v?void 0:v["mlflow.databricks.workspaceID"];if(a.isCurrentWorkspace(s))return a.renderNotebookSource(null,n,t,null,l,null);{var h;const o="mlflow.databricks.workspaceURL",r=(null===(h=e.trace_metadata)||void 0===h?void 0:h[o])||void 0,i=a.addQueryParams(null,{o:s});return a.renderNotebookSource(i,n,t,null,l,r)}}if("JOB"===d){var y,x,b;const t=null===(y=e.trace_metadata)||void 0===y?void 0:y["mlflow.databricks.jobID"],n=null===(x=e.trace_metadata)||void 0===x?void 0:x["mlflow.databricks.jobRunID"],s=null===(b=e.trace_metadata)||void 0===b?void 0:b["mlflow.databricks.workspaceID"];if(a.isCurrentWorkspace(s))return a.renderJobSource(null,t,n,c,null);{var S;const o="mlflow.databricks.workspaceURL",r=(null===(S=e.trace_metadata)||void 0===S?void 0:S[o])||void 0,i=a.addQueryParams(null,{o:s});return a.renderJobSource(i,t,n,c,r)}}return c}static formatDuration(e){return e<500?e+"ms":e<6e4?(e/1e3).toFixed(1)+"s":e<36e5?(e/1e3/60).toFixed(1)+"min":e<864e5?(e/1e3/60/60).toFixed(1)+"h":(e/1e3/60/60/24).toFixed(1)+"d"}static formatTimestamp(e,t){const n=new Date(0);return n.setUTCMilliseconds(e),t?t.formatDate(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):o()(n).format("YYYY-MM-DD HH:mm:ss")}}a.runNameTag="mlflow.runName",a.sourceNameTag="mlflow.source.name",a.sourceTypeTag="mlflow.source.type",a.entryPointTag="mlflow.project.entryPoint",t.A=a},21209:function(e,t,n){n.d(t,{p:function(){return d}});var s=n(68248),o=n(46709),r=n(82716),a=n(27757),i=n(73408);var l={name:"1d3w5wq",styles:"width:100%"};const d=({sectionKey:e,title:t,children:n,withBorder:d=!1,isExceptionSection:c=!1,className:u})=>{const[m,p]=(0,o.useState)(!0),{theme:g}=(0,a.u)(),f=c?g.colors.actionDangerPrimaryBackgroundDefault:g.colors.border,v=c?`${g.colors.actionDangerPrimaryBackgroundDefault}15`:g.colors.backgroundSecondary,h=c?g.colors.backgroundPrimary:void 0;return(0,i.FD)("div",{className:u,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:g.borders.borderRadiusMd},""),children:[(0,i.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:g.spacing.xs,padding:d?g.spacing.sm:0,background:d?v:void 0,borderTopLeftRadius:g.borders.borderRadiusMd,borderTopRightRadius:g.borders.borderRadiusMd,borderBottomLeftRadius:m?0:g.borders.borderRadiusMd,borderBottomRightRadius:m?0:g.borders.borderRadiusMd,border:d?`1px solid ${f}`:void 0,marginBottom:d?0:g.spacing.sm},""),children:[(0,i.Y)(a.B,{size:"small",componentId:"shared.model-trace-explorer.expand",type:"tertiary",icon:m?(0,i.Y)(r.ChevronDownIcon,{}):(0,i.Y)(a.o,{}),onClick:()=>p(!m)}),(0,i.Y)(a.T.Title,{withoutMargins:!0,level:4,css:l,children:t})]}),m&&(0,i.Y)("div",{css:(0,s.AH)({border:d?`1px solid ${f}`:void 0,borderTop:"none",borderBottomLeftRadius:d?g.borders.borderRadiusMd:void 0,borderBottomRightRadius:d?g.borders.borderRadiusMd:void 0,padding:d?g.spacing.sm:0,background:h},""),children:n})]})}},21636:function(e,t,n){n.d(t,{Bt:function(){return o},E3:function(){return u},Ex:function(){return r},K6:function(){return p},Uu:function(){return c},Vg:function(){return a},gK:function(){return i},hb:function(){return m},kj:function(){return s},n2:function(){return d},zZ:function(){return l}});const s="yellow500",o="yellow200",r="mlflow.trace.sourceScorer",a="mlflow.assessment.sourceRunId",i="mlflow.assessment.scorerTraceId",l="mlflow.assessment.judgeCost",d="mlflow.trace.session",c="mlflow.trace.tokenUsage",u="mlflow.trace.user",m="selectedTraceId",p="mlflow.trace.session"},21723:function(e,t,n){n.d(t,{rc:function(){return j.rc},tj:function(){return j.tj},tl:function(){return P.tl},sp:function(){return zr},_p:function(){return Yr},sG:function(){return O},w_:function(){return br},o8:function(){return o.o8},tU:function(){return Tt},js:function(){return Fo},Te:function(){return j.Te},Rl:function(){return j.Rl},TH:function(){return zo},$W:function(){return j.$W},Pn:function(){return j.Pn},YO:function(){return j.YO},XQ:function(){return j.XQ},$6:function(){return P.$6},$U:function(){return Xs.$U},pR:function(){return B.pR},zl:function(){return $.zl},h:function(){return $.h},Mq:function(){return $.Mq},d9:function(){return $.d9},BL:function(){return jo},kO:function(){return qo},R7:function(){return Tr},Xz:function(){return Lo},Ie:function(){return Uo},Wx:function(){return Kr},KW:function(){return Ko},Zn:function(){return Wo},K0:function(){return To},GY:function(){return T}});var s=n(76118),o=n(33481);const r=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.IS_OVERALL_ASSESSMENT])},a=e=>{var t;return(0,s.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[o.bz.CHUNK_INDEX])},i=e=>Array.isArray(e)&&e.every(e=>(0,s.isPlainObject)(e)&&"doc_uri"in e&&"content"in e),l=e=>Object.values(e||{}).find(i),d=(e,t,n)=>{const r=l(e)||[],a=l(t);return r.map((e,t)=>{const r=null===a||void 0===a?void 0:a[t],i=(n||[]).filter(e=>(e.metadata||{})[o.bz.CHUNK_INDEX]===t),l=(0,s.groupBy)(i,"name");return Object.keys(l).forEach(e=>{l[e]=(0,s.orderBy)(l[e],"timestamp","desc")}),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:l,target:null===r||void 0===r?void 0:r.content}})};function c(e){if(!e)return;const{columns:t,data:n,filename:o}=e;if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!n||!Array.isArray(n))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const r=t.map((e,t)=>null!==e&&void 0!==e?e:`column_${t}`);return n.map(e=>(0,s.zipObject)(r,e))}var u=n(9858),m=n(46709),p=n(58024),g=n(27637);const f=p.zy,v=g.ok,h=g.N_,y="assessmentFilter";function x(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function b(e,t){if("pass-fail"===e.dtype){if("undefined"===t)return;return t}return"boolean"===e.dtype?"true"===t||"false"!==t&&void 0:t}function S(e){return void 0===e||null===e?"undefined":`${e}`}var A=n(90448);const w="sort",Y=()=>{const[e,t]=v();return[(0,m.useMemo)(()=>{const t=e.get(w);if(!t)return;const[n,s,o]=t.split("::");return n&&s&&o?{key:n,type:s,asc:"true"===o}:void 0},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(w),e&&t.set(w,[e.key,e.type,e.asc].join("::")),t),{replace:n})},[t])]};var I=n(27882);const T=(e,t)=>{const n=(0,I.GK)(),[s,o]=Y(),[r,a]=(0,m.useState)(t&&e.find(e=>e.id===t.key)?t:void 0);return[(0,m.useMemo)(()=>{let o;if(o=n?s&&e.find(e=>e.id===s.key)?s:t:r,o&&e.find(e=>e.id===o.key))return o},[n,s,t,r,e]),(0,m.useCallback)(e=>{n?o(e,!1):a(e)},[n,o,a])]};var C=n(68248),E=n(27757),M=n(82716),N=n(66916),_=n(79081),R=n(42747),k=n(58663),D=n(73408);const F=(0,m.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),O=({children:e,experimentId:t})=>{const[n,o]=(0,m.useState)(),[r,a]=(0,m.useState)([]),[i,l]=(0,m.useState)(!1),[d,c]=(0,m.useState)(void 0),{renderExportTracesToDatasetsModal:u}=(0,k.SO)(),p=(0,m.useCallback)(e=>{c(e),l(!(0,s.isUndefined)(e))},[]),g=(0,m.useMemo)(()=>({table:n,setTable:o,selectedRowIds:r,setSelectedRowIds:a,showAddToEvaluationDatasetModal:p}),[n,r,p]);return(0,D.FD)(F.Provider,{value:g,children:[e,null===u||void 0===u?void 0:u({selectedTraceInfos:d?(0,s.compact)(d.map(e=>e.traceInfo)):[],experimentId:null!==t&&void 0!==t?t:"",visible:i,setVisible:l})]})};var L=n(25862);const H=({traceIds:e,onClose:t})=>{const{theme:n}=(0,E.u)(),{data:o,isLoading:r}=(0,k.y5)(e,undefined),a=(0,m.useMemo)(()=>(0,s.compact)(o),[o]);return(0,D.Y)(L.q.Root,{open:!0,modal:!0,onOpenChange:e=>{e||null===t||void 0===t||t()},children:(0,D.Y)(L.q.Content,{componentId:"mlflow.evaluations_review.modal",width:"90vw",title:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:(0,D.Y)(E.T.Title,{level:2,withoutMargins:!0,children:(0,D.Y)(R.sA,{id:"FbFEvH",defaultMessage:"Comparing {count} traces",values:{count:e.length}})})}),expandContentToFullHeight:!0,css:[{"&>div":{overflow:"hidden"},"&>div:first-of-type":{paddingLeft:n.spacing.md}},""],children:r||!a||0===a.length?(0,D.Y)(k.Fn,{}):(0,D.Y)(k.rH,{modelTraces:a,css:(0,C.AH)({marginLeft:-n.spacing.lg,marginRight:-n.spacing.lg},"")})})})},V=({experimentIds:e,visible:t,selectedTraces:n,handleClose:s,deleteTraces:o})=>{const r=(0,R.tz)(),[a,i]=(0,m.useState)(""),[l,d]=(0,m.useState)(!1),c=n.map(e=>e.evaluationId);return(0,D.FD)(_.d,{componentId:"eval-tab.delete_traces-modal",title:(0,D.Y)(R.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:t,onCancel:s,okText:(0,D.Y)(R.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var t;await o(null!==(t=e[0])&&void 0!==t?t:"",c),s()}catch(n){i(r.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:l,danger:!0},children:[a&&(0,D.Y)(E.T.Paragraph,{color:"error",children:a}),(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)(R.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})};var B=n(93241),$=n(71540);const U=e=>{const{traceActions:t,experimentId:n,selectedTraces:o,traceInfos:r,setRowSelection:a,sqlWarehouseId:i}=e,{table:l,selectedRowIds:d}=(0,m.useContext)(F),c=(0,m.useMemo)(()=>(0,$.Co)(d.map(e=>{const t=null===r||void 0===r?void 0:r.find(t=>(0,$.h2)(t)===e);if(t)return{evaluationId:t.trace_id,requestId:t.client_request_id||t.trace_id,inputsId:t.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:t}}).filter(e=>!(0,s.isNil)(e))),[d,r]),u=o||c;return(0,D.Y)(z,{experimentId:n,selectedTraces:u,traceActions:t,setRowSelection:null!==a&&void 0!==a?a:null===l||void 0===l?void 0:l.setRowSelection,sqlWarehouseId:i})},z=e=>{var t,n,o;const{experimentId:r,selectedTraces:a,traceActions:i,setRowSelection:l,sqlWarehouseId:d}=e,c=(0,R.tz)(),[u,p]=(0,m.useState)(!1),[g,f]=(0,m.useState)(!1),v=(0,k.eA)(),{showAddToEvaluationDatasetModal:h}=(0,m.useContext)(F),y=(0,m.useCallback)(()=>{1===a.length&&a[0].traceInfo&&null!==i&&void 0!==i&&i.editTags&&i.editTags.showEditTagsModalForTrace(a[0].traceInfo)},[a,i]),x=(0,m.useCallback)(()=>{p(!0)},[]),b=(0,m.useCallback)(()=>{f(!0)},[]),S=(0,m.useCallback)(()=>{f(!1)},[]),A=(0,m.useCallback)(async(e,t)=>{var n,s;await(null===i||void 0===i||null===(n=i.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===l||void 0===l||l({})},[l,i]),w=Boolean(null===i||void 0===i?void 0:i.exportToEvals),Y=(0,B.ij)()&&Boolean(null===i||void 0===i?void 0:i.editTags),I=Boolean(null===i||void 0===i?void 0:i.deleteTracesAction),T=a.length>1,C=0===a.length,N=!w&&!Y&&!I,O=a.length>=2&&a.length<4;if(N)return null;const L=(0,D.Y)(E.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:C,type:"primary",endIcon:(0,D.Y)(M.ChevronDownIcon,{}),children:c.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:C?"":` (${a.length})`})});return(0,D.FD)(D.FK,{children:[(0,D.FD)(M.DropdownMenu.Root,{children:[C?(0,D.Y)(_.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:c.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,D.Y)("div",{children:(0,D.Y)(M.DropdownMenu.Trigger,{asChild:!0,children:L})})}):(0,D.Y)(M.DropdownMenu.Trigger,{asChild:!0,children:L}),(0,D.FD)(M.DropdownMenu.Content,{children:[v&&(0,D.FD)(D.FK,{children:[(0,D.Y)(M.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.compare-traces",onClick:b,disabled:!O,children:c.formatMessage({id:"HrDWRj",defaultMessage:"Compare"})}),(0,D.Y)(M.DropdownMenu.Separator,{})]}),w&&(0,D.Y)(D.FK,{children:(0,D.FD)(M.DropdownMenu.Group,{children:[(0,D.Y)(M.DropdownMenu.Label,{children:c.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,D.Y)(M.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:()=>{null===h||void 0===h||h(a)},children:c.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(Y||I)&&(0,D.FD)(D.FK,{children:[w&&(0,D.Y)(M.DropdownMenu.Separator,{}),(0,D.FD)(M.DropdownMenu.Group,{children:[(0,D.Y)(M.DropdownMenu.Label,{children:c.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),Y&&(0,D.Y)(M.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:y,disabled:T,children:c.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),I&&(0,D.Y)(M.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:x,disabled:null===i||void 0===i||null===(t=i.deleteTracesAction)||void 0===t?void 0:t.isDisabled,disabledReason:null===i||void 0===i||null===(n=i.deleteTracesAction)||void 0===n?void 0:n.disabledReason,children:c.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===i||void 0===i||null===(o=i.editTags)||void 0===o?void 0:o.EditTagsModal,u&&(null===i||void 0===i?void 0:i.deleteTracesAction)&&(0,D.Y)(V,{experimentIds:[r],visible:u,selectedTraces:a,handleClose:()=>p(!1),deleteTraces:A}),g&&(0,D.Y)(H,{traceIds:(0,s.compact)(a.map(e=>{var t,n;return null!==(t=e.fullTraceId)&&void 0!==t?t:null===(n=e.traceInfo)||void 0===n?void 0:n.trace_id})),onClose:S})]})};var j=n(4947),P=n(64667);const K=[P.w8.INFO,P.w8.ASSESSMENT,P.w8.EXPECTATION,P.w8.TAG],W=[j.XQ,j.d6,j.Rl,j.yX,j.tP,j.LV,j.im,j.YO],q=[o._1.OVERALL_ASSESSMENT],G=Object.fromEntries(K.map((e,t)=>[e,t])),J=Object.fromEntries(W.map((e,t)=>[e,t])),Q=Object.fromEntries(q.map((e,t)=>[e,t]));function Z(e,t){return[...e].sort((e,n)=>{var s,o;if(t){if(e.id===j.d6)return-1;if(n.id===j.d6)return 1}const r=null!==(s=e.group)&&void 0!==s?s:P.w8.INFO,a=null!==(o=n.group)&&void 0!==o?o:P.w8.INFO,i=G[r]-G[a];if(0!==i)return i;if(r===P.w8.INFO){var l,d;const t=null!==(l=J[e.id])&&void 0!==l?l:1/0,s=null!==(d=J[n.id])&&void 0!==d?d:1/0;return t!==s?t-s:e.label.localeCompare(n.label)}if(r===P.w8.ASSESSMENT){var c,u;const t=null!==(c=Q[e.id])&&void 0!==c?c:1/0,s=null!==(u=Q[n.id])&&void 0!==u?u:1/0;return t!==s?t-s:e.label.localeCompare(n.label)}return P.w8.EXPECTATION,e.label.localeCompare(n.label)})}const X=(e,t)=>e.sort((e,n)=>{const s=e=>{var n;const s=null===(n=t.find(t=>t.id===e.id))||void 0===n?void 0:n.type;return s===P.$6.INPUT?1:e.id===j.LV?2:s===P.$6.TRACE_INFO?3:s===P.$6.INTERNAL_MONITOR_REQUEST_TIME?4:s===P.$6.ASSESSMENT?5:999},r=s(e)-s(n);if(0!==r)return r;const a=t.find(t=>t.id===e.id),i=t.find(e=>e.id===n.id);return(null===a||void 0===a?void 0:a.type)===P.$6.ASSESSMENT&&(null===i||void 0===i?void 0:i.type)===P.$6.ASSESSMENT?a.id===o._1.OVERALL_ASSESSMENT?-1:i.id===o._1.OVERALL_ASSESSMENT?1:(a.label||"").localeCompare(i.label||""):0}),ee=(e,t)=>{var n,s;switch(t){case j.Te:case j.tj:case j.Pn:case j.$W:return e[t];case j.FW:return e.tags;case j.XQ:return e.trace_id;case j.yX:return null===(n=e.tags)||void 0===n?void 0:n["mlflow.trace.session"];case j.VC:return null===(s=e.tags)||void 0===s?void 0:s["mlflow.linkedPrompts"];default:throw new Error(`Unknown column id: ${t}`)}};function te(e){const t=new Map,n=new Map;return null===e||void 0===e||e.forEach(e=>{let s=(0,$.ZS)([e])?(0,$.h)(e.traceInfo):e.inputsId;if(t.has(s)){const t=(n.get(e.inputsId)||0)+1;n.set(e.inputsId,t),s=`${e.inputsId}_${t}`}t.set(s,e)}),t}function ne(e,t){if((0,s.isNil)(t))return e.map(e=>({currentRunValue:e}));const n=te(t),o=te(e),r=new Set([...o.keys(),...n.keys()]);return Array.from(r).map(e=>({currentRunValue:o.get(e),otherRunValue:n.get(e)}))}var se=n(90061),oe=n(49460),re=n(76256),ae=n(49708);const ie=()=>{const{theme:e}=(0,E.u)();return(0,D.FD)("span",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,D.Y)(E.k,{css:(0,C.AH)({color:e.colors.textValidationWarning},"")}),(0,D.Y)(R.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var le={name:"rhxkjj",styles:"height:20px"};const de=({isComparing:e})=>{const{theme:t}=(0,E.u)();return(0,D.Y)("span",{css:le,children:e&&(0,D.Y)("span",{css:(0,C.AH)({fontStyle:"italic",color:t.colors.textSecondary},""),children:"null"})})},ce=e=>{const{first:t,second:n,gap:s,borderRadius:o,marginY:r}=e,{theme:a}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:s||a.spacing.sm,borderRadius:o||a.legacyBorders.borderRadiusMd,marginTop:r||"auto",marginBottom:r||"auto"},""),children:[t,n]})};var ue=n(36476);const me=fetch,pe=async(e,t,n,s)=>{const o={method:t,signal:s,headers:{...n?{"Content-Type":"application/json"}:{},...ve(document.cookie)}};n&&(o.body=JSON.stringify(n));const r=await me(e,o);if(!r.ok){const e=(0,ue.a$)(r);try{const t=await(await r.json()).message;t&&(e.message=t)}catch{}throw e}return r.json()},ge=e=>e;const fe=e=>{const t="mlflow-request-header-",n=function(e=document.cookie){return e.split(";").reduce((e,t)=>{const[n,s]=t.trim().split("=");return e[n]=decodeURIComponent(s||""),e},{})}(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter(e=>e.startsWith(t)).reduce((e,t)=>({...e,[t.substring(22)]:n[t]}),{}):{}},ve=e=>({...fe(e)});var he=n(19926);const ye=e=>{var t,n;const{experimentId:s,currentTraceInfo:o,otherTraceInfo:r,isComparing:a}=e,i=null===o||void 0===o||null===(t=o.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"],l=null===r||void 0===r||null===(n=r.trace_metadata)||void 0===n?void 0:n["mlflow.modelId"];return(0,D.Y)(ce,{first:i?(0,D.Y)(Ae,{experimentId:s,modelId:i,isComparing:a}):(0,D.Y)(de,{isComparing:a}),second:a&&(l?(0,D.Y)(Ae,{experimentId:s,modelId:l,isComparing:a}):(0,D.Y)(de,{isComparing:a}))})};var xe={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},be={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Se={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const Ae=e=>{var t;const{experimentId:n,modelId:s,isComparing:o}=e,{theme:r}=(0,E.u)(),{data:a,isLoading:i,error:l}=we({loggedModelId:s}),d=null===a||void 0===a||null===(t=a.info)||void 0===t?void 0:t.name;return i?(0,D.Y)(M.ParagraphSkeleton,{}):l?(0,D.Y)(ie,{}):d?(0,D.Y)(_.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,D.Y)(M.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:xe,children:(0,D.Y)(h,{to:he.A.getLoggedModelPageRoute(n,s),target:"_blank",css:be,title:d,children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs,maxWidth:"100%"},""),children:[(0,D.Y)(M.ModelsIcon,{css:(0,C.AH)({color:r.colors.textPrimary,fontSize:16},"")}),(0,D.Y)(E.T.Text,{css:Se,children:d})]})})})}):(0,D.Y)(de,{isComparing:o})},we=({loggedModelId:e})=>{const{data:t,isLoading:n,isFetching:o,refetch:r,error:a}=(0,ae.I)({queryKey:["loggedModelName",e],queryFn:async()=>await pe(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,s.isNil)(e)});return{isLoading:n,isFetching:o,data:null===t||void 0===t?void 0:t.model,refetch:r,error:a}};var Ye={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const Ie=e=>{var t,n,s;const{experimentId:o,runUuid:r}=e,{data:a,isLoading:i,error:l}=Te(o,r),d=null===a||void 0===a||null===(t=a.runs)||void 0===t||null===(n=t[0])||void 0===n||null===(s=n.info)||void 0===s?void 0:s.run_name;return i?(0,D.Y)(M.ParagraphSkeleton,{}):l?(0,D.Y)(ie,{}):d?(0,D.Y)(h,{css:Ye,to:he.A.getRunPageRoute(o,r),title:d,children:d}):(0,D.Y)(de,{})},Te=(e,t)=>(0,ae.I)({queryKey:["runName",e,t],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const n=`run_id IN ('${t}')`;return await pe("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:n})}}),Ce=({sessionId:e,experimentId:t,traceId:n,children:s})=>{const o=he.A.getExperimentChatSessionPageRoute(t,e),r=n?`${o}?${new URLSearchParams({[k.hb]:n}).toString()}`:o;return(0,D.Y)(h,{to:r,children:s})};var Ee=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(Ee||{});const Me=({sourceType:e,className:t})=>e===Ee.NOTEBOOK?(0,D.Y)(M.NotebookIcon,{className:t}):e===Ee.LOCAL?(0,D.Y)(M.HomeIcon,{className:t}):e===Ee.PROJECT?(0,D.Y)(M.FolderBranchIcon,{className:t}):e===Ee.JOB?(0,D.Y)(M.WorkflowsIcon,{className:t}):null;var Ne={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const _e=e=>{var t;const n=e.traceInfo.tags,{theme:s}=(0,E.u)();if(!n)return(0,D.Y)(de,{isComparing:e.isComparing});const o=null===(t=e.traceInfo.trace_metadata)||void 0===t?void 0:t[he.A.sourceTypeTag],r=he.A.renderSourceFromMetadata(e.traceInfo);return r&&o?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:s.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,D.Y)(Me,{sourceType:o,css:(0,C.AH)({color:s.colors.textSecondary},"")}),(0,D.Y)("span",{css:Ne,children:r})]}):(0,D.Y)(de,{isComparing:e.isComparing})},Re={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,R.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,R.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,R.zR)({id:"igK5Su",defaultMessage:"Error"})},ke=(e,t)=>"IN_PROGRESS"===e?(0,D.Y)(N.C,{css:(0,C.AH)({color:t.colors.textValidationWarning},"")}):"OK"===e?(0,D.Y)(M.CheckCircleIcon,{css:(0,C.AH)({color:t.colors.textValidationSuccess},"")}):"ERROR"===e?(0,D.Y)(M.XCircleIcon,{css:(0,C.AH)({color:t.colors.textValidationDanger},"")}):null,De=({original:e,isComparing:t})=>{const{theme:n}=(0,E.u)(),s=(0,R.tz)(),o=Re[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[ke((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",n),o?s.formatMessage(o):""]}):(0,D.Y)(de,{isComparing:t})};var Fe=n(12998);const{Paragraph:Oe}=E.T;var Le={name:"s5xdrg",styles:"display:flex;align-items:center"},He={name:"1ff36h2",styles:"flex-grow:1"};const Ve=m.memo(e=>{const{theme:t}=(0,E.u)();return(0,D.Y)(_.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,D.FD)("div",{css:Le,children:[(0,D.Y)(Oe,{css:He,children:(0,D.Y)("pre",{css:(0,C.AH)({backgroundColor:t.colors.backgroundPrimary,marginTop:t.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,D.Y)("div",{css:(0,C.AH)({marginBottom:t.spacing.md},""),children:(0,D.Y)(Fe.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})});function Be(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const $e=({isClosable:e=!1,onClose:t,tag:n,enableFullViewModal:s=!1,charLimit:o=30,maxWidth:r=300,className:a})=>{const i=(0,R.tz)(),[l,d]=(0,m.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,t=30){const{key:n,value:s}=e,o=n.length+s.length,r=n.length>s.length,a=r?s.length:n.length;return o<=t?{shouldTruncateKey:!1,shouldTruncateValue:!1}:a>t/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(n,o),p=s&&(c||u),g=i.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,D.FD)("div",{children:[(0,D.Y)(M.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:t,title:n.key,className:a,children:(0,D.Y)(_.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:p?(0,D.Y)("span",{children:g}):void 0,children:(0,D.FD)("span",{css:(0,C.AH)({maxWidth:r,display:"inline-flex"},""),onClick:()=>p?d(!0):void 0,children:[(0,D.Y)(E.T.Text,{bold:!0,title:n.key,css:Be(c),children:n.key}),n.value&&(0,D.FD)(E.T.Text,{title:n.value,css:Be(u),children:[": ",n.value]})]})})}),(0,D.Y)("div",{children:l&&(0,D.Y)(Ve,{tagKey:n.key,tagValue:n.value,isKeyValueTagFullViewModalVisible:l,setIsKeyValueTagFullViewModalVisible:d})})]})};var Ue={name:"1wcfv52",styles:"margin-right:0"},ze={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const je=({onAddEditTags:e,tags:t,baseComponentId:n})=>{const{theme:s}=(0,E.u)(),o=(null===t||void 0===t?void 0:t.filter(({key:e})=>e&&!e.startsWith($.nt)))||[],r=o.length>0;return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:s.spacing.xs,rowGap:s.spacing.xs},""),children:[o.map(e=>(0,D.Y)($e,{tag:e,css:Ue,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key)),e&&(0,D.Y)(E.B,{componentId:"mlflow.tags_cell_renderer.traces_table.edit_tag",size:"small",icon:r?(0,D.Y)(M.PencilIcon,{}):void 0,onClick:e,children:r?void 0:(0,D.Y)(R.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:ze,type:"tertiary"})]})};const Pe=e=>{const{currentTraceInfo:t,otherTraceInfo:n,isComparing:s}=e;return(0,D.Y)(ce,{first:(0,D.Y)(tt,{traceInfo:t,isComparing:s}),second:s&&(0,D.Y)(tt,{traceInfo:n,isComparing:s})})};var Ke={name:"58t467",styles:"width:fit-content;max-width:100%"},We={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},qe={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Ge={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Je={name:"i9sky5",styles:"width:35%"},Qe={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Ze={name:"i9sky5",styles:"width:35%"},Xe={name:"ho1qnd",styles:"display:flex;flex-direction:row"},et={name:"i9sky5",styles:"width:35%"};const tt=e=>{var t;const{traceInfo:n,isComparing:s}=e,o=null===n||void 0===n||null===(t=n.trace_metadata)||void 0===t?void 0:t[k.Uu],r=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),a=r.total_tokens,i=r.input_tokens,l=r.output_tokens,d=(0,R.tz)();return a?(0,D.Y)(M.HoverCard,{trigger:(0,D.Y)(M.Tag,{css:Ke,componentId:"mlflow.genai-traces-table.tokens",children:(0,D.Y)("span",{css:We,children:a})}),content:(0,D.FD)("div",{css:qe,children:[a&&(0,D.FD)("div",{css:Ge,children:[(0,D.Y)("div",{css:Je,children:(0,D.Y)(E.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Text,{color:"secondary",children:a})})]}),i&&(0,D.FD)("div",{css:Qe,children:[(0,D.Y)("div",{css:Ze,children:(0,D.Y)(E.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Text,{color:"secondary",children:i})})]}),l&&(0,D.FD)("div",{css:Xe,children:[(0,D.Y)("div",{css:et,children:(0,D.Y)(E.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Text,{color:"secondary",children:l})})]})]})}):(0,D.Y)(de,{isComparing:s})},nt="Error";function st(e){return Boolean((null===e||void 0===e?void 0:e.errorCode)||(null===e||void 0===e?void 0:e.errorMessage))}function ot(e){const t=e.split("/");return 1===t.length?{metricName:e,assessmentName:e}:2===t.length?{metricName:t[0],assessmentName:t[1]}:{metricName:t[1],assessmentName:t.slice(2).join("/")}}const rt=[A.gZ.YES,A.gZ.NO];function at(e,t,n){var o;const r={},a={[A._1.OVERALL_ASSESSMENT]:"pass-fail"},i=new Set;[...t,...n||[]].forEach(e=>{var t;const n=Object.entries(e.responseAssessmentsByName||{}),o=e.overallAssessments.map(e=>[A._1.OVERALL_ASSESSMENT,[e]]),r=[];null===(t=e.retrievalChunks)||void 0===t||t.forEach(e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))r.push([t,n])});for(const[l,d]of[...n,...o,...r]){let e;i.add(l);for(const t of d)if(e=(0,s.isNil)(t.stringValue)?(0,s.isNil)(t.numericValue)?(0,s.isNil)(t.booleanValue)?void 0:"boolean":"numeric":"pass-fail",void 0!==e)break;a[l]||(l in A.c9&&(e="pass-fail"),a[l]=e);for(const t of d)if("pass-fail"===e&&!(0,s.isNil)(t.stringValue)&&!rt.includes(t.stringValue)){a[l]="string";break}void 0!==e&&e!==a[l]&&(a[l]="string")}});for(const s of i)a[s]||(a[s]="unknown");[...t,...n||[]].forEach(t=>{var n;const o=Object.entries(t.responseAssessmentsByName||{}),i=t.overallAssessments.map(e=>[A._1.OVERALL_ASSESSMENT,[e]]),l=[];null===(n=t.retrievalChunks)||void 0===n||n.forEach(e=>{for(const[t,n]of Object.entries(e.retrievalAssessmentsByName||{}))l.push([t,n])});const d=Object.keys(a);for(const v of d){const t=[...o.filter(([e])=>e===v),...i.filter(([e])=>e===v),...l.filter(([e])=>e===v)].flatMap(([e,t])=>t),n=t[0],d=st(n);if((0,s.isNil)(r[v])){var c,u,m;let s,o,i=!1;const g=void 0!==A.c9[v];if(g)s=e.formatMessage(A.c9[v]),o=v,i=!1;else{var p;const{metricName:e,assessmentName:t}=ot(v);s=t||"-",o=e,"CODE"===(null===n||void 0===n||null===(p=n.source)||void 0===p?void 0:p.sourceType)&&(i=!0)}const f=a[v]||"string",h=(0,A.FN)(A.pZ[v]),y=v in A.jr?e.formatMessage(A.jr[v]):"",x=v in A.mS?e.formatMessage(A.mS[v]):"HUMAN"===(null===n||void 0===n||null===(c=n.source)||void 0===c?void 0:c.sourceType)?e.formatMessage({id:"z94r4F",defaultMessage:"This assessment is produced by a human judge."}):e.formatMessage({id:"lQ2nDn",defaultMessage:"This assessment is produced by a custom metric."}),b=new Set;0===t.length&&b.add(void 0);for(const e of t){let t=e?(0,A.Zh)(e):void 0;null===t&&(t=void 0),b.add(t)}r[v]={name:v,displayName:s,isKnown:g,metricName:o,isCustomMetric:i,source:null===n||void 0===n?void 0:n.source,dtype:f,uniqueValues:b,isOverall:v===A._1.OVERALL_ASSESSMENT,docsLink:h,missingTooltip:y,description:x,isEditable:"AI_JUDGE"===(null===n||void 0===n||null===(u=n.source)||void 0===u?void 0:u.sourceType)||"HUMAN"===(null===n||void 0===n||null===(m=n.source)||void 0===m?void 0:m.sourceType),isRetrievalAssessment:l.some(([e])=>e===v),containsErrors:d}}else{const e=r[v];0===t.length&&e.uniqueValues.add(void 0);for(const n of t){let t=n?(0,A.Zh)(n):void 0;(0,s.isNil)(t)&&(t=void 0),e.uniqueValues.add(t)}var g,f;if(!e.isEditable)e.isEditable="AI_JUDGE"===(null===n||void 0===n||null===(g=n.source)||void 0===g?void 0:g.sourceType)||"HUMAN"===(null===n||void 0===n||null===(f=n.source)||void 0===f?void 0:f.sourceType);e.isRetrievalAssessment=e.isRetrievalAssessment||l.some(([e])=>e===v),e.containsErrors=e.containsErrors||d}}});const l=(null===(o=r[A._1.OVERALL_ASSESSMENT])||void 0===o?void 0:o.uniqueValues)||new Set;return l.has(A.gZ.YES)||l.has(A.gZ.NO)||delete r[A._1.OVERALL_ASSESSMENT],it(Object.values(r))}function it(e){return e.sort((e,t)=>{const n=A.kp.indexOf(e.name),s=A.kp.indexOf(t.name);return-1!==n&&-1!==s?n-s:-1!==n?-1:-1!==s?1:e.name.localeCompare(t.name)})}function lt(e,t){if("numeric"!==e.dtype)return;return function(e){if(0===e.length)return;const t=[],n=Math.min(...e),s=Math.max(...e),o=Math.max(.01,(s-n)/10);let r=0;if(n===s)t.push({lower:n,upper:s,count:e.length});else for(let a=n;a<s;a+=o)t.push({lower:a,upper:Math.min(a+o,s),count:0});t.sort((e,t)=>e.lower-t.lower);for(const a of e){const e=t.find(e=>a>=e.lower&&(a<e.upper||a===e.upper&&a===s));e&&(e.count++,r=Math.max(r,e.count))}return{min:n,max:s,maxCount:r,counts:t}}(t.flatMap(t=>{const n=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name];return null===n||void 0===n?void 0:n.map(e=>(0,A.Zh)(e)).filter(e=>void 0!==e&&"number"===typeof e)}).filter(e=>!(0,s.isNil)(e)))}function dt(e,t){if("numeric"===e.dtype)return;const n=new Map;return t.forEach(t=>{const s=e.isOverall?t.overallAssessments:t.responseAssessmentsByName[e.name],o=s&&s.length>0?ht(e,s):[{value:void 0,count:1}],r=e.containsErrors?[nt,...e.uniqueValues]:e.uniqueValues;for(const e of r){const t=o.find(t=>t.value===e),s=t?t.count:0;n.set(e,(n.get(e)||0)+s)}}),n}function ct(e,t){if("numeric"!==e.dtype)return;const n=[];return t.forEach(t=>{const o=e.isOverall?(0,s.first)(t.overallAssessments):(0,s.first)(t.responseAssessmentsByName[e.name]);if(o){const e=(0,A.Zh)(o);(0,s.isNil)(e)||n.push(Number(e))}}),n}function ut(e,t){let n=0;return t.forEach(t=>{var o;if((0,s.isNil)(t))return;const r=(0,s.first)(t.overallAssessments);(null===r||void 0===r||null===(o=r.rootCauseAssessment)||void 0===o?void 0:o.assessmentName)===e.name&&n++}),n}function mt(e,t,n){const o=t.map(e=>e.currentRunValue).filter(e=>!(0,s.isNil)(e)),r=t.map(e=>e.otherRunValue).filter(e=>!(0,s.isNil)(e)),a=dt(e,o),i=dt(e,r),l=lt(e,o),d=n.filter(t=>t.assessmentName===e.name);return{assessmentInfo:e,currentCounts:a,otherCounts:i,currentNumericValues:ct(e,o),otherNumericValues:ct(e,r),currentNumericAggregate:l,currentNumRootCause:ut(e,o),otherNumRootCause:ut(e,r),assessmentFilters:d}}function pt(e,t=new Map){if("pass-fail"===e.dtype||"boolean"===e.dtype){let n=0,o=0;for(const[r,a]of t)Et(e,r)&&(o+=a),(0,s.isNil)(r)||r===nt||(n+=a);return n>0?o/n:0}return 0}function gt(e,t,n,s,o,r,a){let i=0;const l=s===nt||void 0===s;for(const[u,m]of o)void 0!==u&&u!==nt&&(i+=m);const d=o.get(s)||0,c=!l&&i>0?d/i:0;return{value:o.get(s)||0,fraction:c,isSelected:n.some(e=>e.filterValue===s&&e.assessmentName===t.name&&e.run===r),toggleFilter:()=>a(t.name,s,r,undefined),tooltip:l?e.formatMessage({id:"joh88n",defaultMessage:'{numValue} for run "{runName}"'},{numValue:d,runName:r}):e.formatMessage({id:"jjidVr",defaultMessage:'{numValue}/{numEvals} for run "{runName}"'},{numValue:d,numEvals:i,runName:r})}}function ft(e){const t=function(e){const t=Array.from(e.uniqueValues);if("pass-fail"===e.dtype){t.includes(A.gZ.YES)||t.push(A.gZ.YES),t.includes(A.gZ.NO)||t.push(A.gZ.NO);const e=[A.gZ.YES,A.gZ.NO];return t.sort((t,n)=>e.indexOf(t)-e.indexOf(n))}if("boolean"===e.dtype)return t.sort((e,t)=>!0===e?-1:1);return t.sort()}(e);return e.containsErrors&&t.push(nt),t}function vt(e,t,n,o){return"pass-fail"===n.dtype?o===A.gZ.YES?e.formatMessage({id:"nDVJ/n",defaultMessage:"Pass"}):o===A.gZ.NO?e.formatMessage({id:"7Dhfxy",defaultMessage:"Fail"}):o===nt?e.formatMessage({id:"gPWxlB",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):"boolean"===n.dtype?!0===o?e.formatMessage({id:"1Ujhc3",defaultMessage:"True"}):!1===o?e.formatMessage({id:"nvjkTA",defaultMessage:"False"}):o===nt?e.formatMessage({id:"oM11pD",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):(0,s.isNil)(o)?"null":`${o}`}function ht(e,t){const n=t.filter(t=>t.name===e.name);let s=new Set;for(const i of n){const e=(0,A.Zh)(i);s.add(e)}n.sort((e,t)=>(t.timestamp||0)-(e.timestamp||0));const o=n.filter(e=>st(e)),r=n.filter(e=>!st(e));s=new Set;for(const i of r){const e=(0,A.Zh)(i);s.add(e)}const a=[];for(const i of s){const e=n.filter(e=>(0,A.Zh)(e)===i),t=e.length;a.push({value:i,count:t,latestAssessment:e[0]})}return o.length>0&&a.push({value:nt,count:o.length,latestAssessment:o[0]}),a}function yt(e,t=1){return Number((100*e).toFixed(t)).toString()}function xt(e,t=3){if((0,s.isNil)(e))return"null";const n=Math.pow(10,t);return(Math.round(e*n)/n).toString()}function bt(e,t,n=!0){if("numeric"===e.dtype){return"up"===(t>0?"up":"down")?`+${xt(t,2)}`:`-${xt(t,2)}`}{const e=t>=0?"up":"down";return n?"up"===e?`+${yt(t,0)}%`:`-${yt(-1*t,0)}%`:"up"===e?`+${t}`:`-${t}`}}function St(e,t=new Date){const n=Math.max(0,Math.floor((t-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,D.Y)(R.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,D.Y)(R.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,D.Y)(R.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,D.Y)(R.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,D.Y)(R.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,D.Y)(R.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))}function At(e){return e.replace(/([!"#$%&'()*+,\.\/:;\s<=>?@[\\\]^`{|}~])/g,"\\$1")}function wt(e,t){return function(e,t,n=[],s){let o=Number(e);if(isNaN(o)||!isFinite(o))return{value:"",numericValue:void 0,unit:"",divisor:1};let r=0,a=1;for(;o>=t&&r<n.length-1;)o/=t,a*=t,r+=1;return{value:Yt(o,s),numericValue:o,unit:n[r],divisor:a}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function Yt(e,t=3){return Math.round(e)!==e?e.toFixed(t):e.toString()}const It=m.createContext({makeHTML:e=>e}),Tt=({children:e,makeHtml:t})=>(0,D.Y)(It.Provider,{value:{makeHTML:t},children:e}),Ct=()=>m.useContext(It);const Et=(e,t)=>{if(!(0,s.isNil)(t))if("pass-fail"===e.dtype){if(t===A.gZ.YES)return!0;if(t===A.gZ.NO)return!1}else if("boolean"===e.dtype)return!0===t};var Mt={name:"1jwcxx3",styles:"font-style:italic"},Nt={name:"1jwcxx3",styles:"font-style:italic"};var _t={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Rt={name:"1ykowef",styles:"margin-bottom:0"},kt={name:"6jwybp",styles:"height:16px"},Dt={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Ft=({assessment:e,onEdit:t,active:n=!1,disableJudgeTypeIcon:o,showRationaleInTooltip:r=!1,showPassFailText:a=!1,hideAssessmentName:i=!1,iconOnly:l=!1,disableTooltip:d=!1,isRootCauseAssessment:c,assessmentInfo:p,type:g,count:f})=>{var v,h;const{theme:y}=(0,E.u)(),x=(0,R.tz)(),b=e?(0,A.Zh)(e):void 0,S=(0,m.useMemo)(()=>Et(p,b),[b,p]),w=(0,u.CY)(y,p,e),Y=(0,u.wG)(y,p,e);let I;(null!==e&&void 0!==e&&e.errorMessage||void 0===S&&e&&A.jr[e.name])&&(I=e.errorMessage||x.formatMessage(A.jr[e.name]));const T=e?A.c9[e.name]:void 0,k=(0,m.useMemo)(()=>T?x.formatMessage(T):null===e||void 0===e?void 0:e.name,[e,T,x]),F=(0,m.useMemo)(()=>e?(0,A.FN)(A.pZ[e.name]):void 0,[e]),{makeHTML:O}=Ct(),L=(0,m.useMemo)(()=>{const t=null===e||void 0===e?void 0:e.rationale;return(0,s.isString)(t)?O(t):void 0},[e,O]),H=(0,m.useMemo)(()=>!(0,s.isNil)(e)&&(0,A.w_)(e),[e]),{tagText:V,icon:B,fullTagText:$}=(0,m.useMemo)(()=>function(e,t,n,o,r,a,i){let l,d="",c=(0,D.Y)(D.FK,{});const m={tagText:(0,D.Y)(R.sA,{id:"AX7L9r",defaultMessage:"Error"}),icon:(0,D.Y)(E.k,{css:(0,C.AH)({color:e.colors.textValidationWarning},"")})},p={tagText:(0,D.Y)("span",{css:Mt,children:(0,D.Y)(R.sA,{id:"H2UIIZ",defaultMessage:"null"})}),icon:(0,D.Y)(E.W,{css:(0,C.AH)({color:e.colors.grey400},"")})},g=a?(0,A.Zh)(a):void 0;if(Boolean(null===a||void 0===a?void 0:a.errorMessage))return m;if("pass-fail"===o.dtype||"boolean"===o.dtype){const r=Et(o,g);let l="";if("pass-fail"===o.dtype)if(!0===r)l=t.formatMessage({id:"Kya8N3",defaultMessage:"Pass"});else{if(!1!==r)return p;l=t.formatMessage({id:"bz4brG",defaultMessage:"Fail"})}else if(!0===r)l=t.formatMessage({id:"lo5Me/",defaultMessage:"True"});else{if(!1!==r)return p;l=t.formatMessage({id:"OZXWas",defaultMessage:"False"})}const m=(0,u.CY)(e,o,a);if(c=!0===r?(0,D.Y)(M.CheckCircleIcon,{css:(0,C.AH)({color:m},"")}):!1===r?i?(0,D.Y)(N.X,{css:(0,C.AH)({color:m},"")}):(0,D.Y)(M.XCircleIcon,{css:(0,C.AH)({color:m},"")}):(0,D.Y)(E.W,{css:(0,C.AH)({color:m},"")}),"assessment-value"===n){const e=A.yQ[o.name];if(e){var f;const t=g&&null!==(f=e[g.toString()])&&void 0!==f?f:e[A.gZ.YES];t&&(d=(0,D.Y)(R.sA,{...t,values:{value:g}}))}else d=(0,D.FD)(D.FK,{children:[o.displayName,": ",g]})}else"value"===n&&(d=(0,s.isNil)(r)?(0,D.Y)("span",{css:Nt,children:l}):l)}else if("numeric"===o.dtype){const e=(0,s.isNil)(g)?g:xt(g);if("assessment-value"===n)d=(0,D.FD)(D.FK,{children:[o.displayName,": ",e]}),l=(0,D.FD)(D.FK,{children:[o.displayName,": ",g]});else{if((0,s.isNil)(e))return p;d=`${e}`,l=`${g}`}}else{if((0,s.isNil)(g))return p;const e=(0,D.Y)(D.FK,{children:String(g)});d="assessment-value"===n?(0,s.isNil)(g)?(0,D.Y)(D.FK,{children:o.displayName}):(0,D.FD)(D.FK,{children:[o.displayName,": ",e]}):e}return{tagText:d,icon:c,fullTagText:l}}(y,x,g,p,0,e,c),[y,x,g,p,e,c,H]),U=(0,D.FD)(D.FK,{children:[V,f&&f>1?` (${f})`:""]});if("HUMAN"===(null===(v=p.source)||void 0===v?void 0:v.sourceType)&&!(null!==e&&void 0!==e&&null!==(h=e.source)&&void 0!==h&&h.sourceId))return(0,D.Y)(D.FK,{});const z=(0,D.Y)("div",{children:(0,D.Y)(Ot,{iconOnly:l,hideAssessmentName:i,tagContent:U,active:n,icon:B,iconColor:w,textColor:Y,sourceIcon:p.isCustomMetric?(0,D.Y)(M.BracketsXIcon,{}):e&&H?(0,D.Y)(M.UserIcon,{}):(0,D.Y)(M.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(y,p,e),disableSourceTypeIcon:o&&!H,hasBeenEditedByHuman:H,onEdit:t})});return(0,D.Y)(D.FK,{children:d?z:(0,D.Y)(M.HoverCard,{side:"bottom",content:(0,D.FD)("div",{css:(0,C.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:y.spacing.sm},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs},""),children:[(0,D.FD)("div",{css:_t,children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:y.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(E.T.Title,{css:Rt,children:k}),(0,D.Y)(Ot,{iconOnly:l,hideAssessmentName:i,tagContent:$||U,active:n,icon:B,iconColor:w,textColor:Y,sourceIcon:p.isCustomMetric?(0,D.Y)(M.BracketsXIcon,{}):e&&(0,A.w_)(e)?(0,D.Y)(M.UserIcon,{}):(0,D.Y)(M.SparkleDoubleIcon,{}),backgroundColor:(0,u.x2)(y,p,e),disableSourceTypeIcon:o,hasBeenEditedByHuman:H})]}),F&&(0,D.Y)("a",{href:F,target:"_blank",rel:"noreferrer",css:kt,children:(0,D.Y)(_.I,{})})]}),c&&(0,D.Y)(E.T.Hint,{children:x.formatMessage({id:"QEL+JO",defaultMessage:"This assessment is the root cause of the overall evaluation failure."})})]}),r&&e&&L&&(0,D.Y)("div",{children:(0,D.Y)(D.FK,{children:(0,D.Y)("span",{css:Dt,dangerouslySetInnerHTML:{__html:L}})})}),I&&(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs},""),children:(0,D.Y)("span",{css:(0,C.AH)({color:y.colors.textValidationWarning,fontStyle:"italic"},""),children:I})})]}),trigger:z})})},Ot=({iconOnly:e,hideAssessmentName:t,tagContent:n,active:s,sourceIcon:o,icon:r,iconColor:a,textColor:i,backgroundColor:l,disableSourceTypeIcon:d,hasBeenEditedByHuman:c,onEdit:u})=>{const{theme:m}=(0,E.u)(),p=e?18:12;return(0,D.FD)("div",{css:(0,C.AH)({display:"inline-flex",height:e?p:20,width:e?p:t?"fit-content":"",justifyContent:"space-between",alignItems:"center",padding:e?"0":u?"0 0 0 8px":"0 8px",gap:m.spacing.sm,borderRadius:e?"50%":m.legacyBorders.borderRadiusMd,backgroundColor:l,boxShadow:`inset 0 0 1px 1px ${s?m.colors.borderAccessible:"transparent"}`,fontSize:m.typography.fontSizeSm,svg:{width:p,height:p},whiteSpace:"nowrap"},""),children:[r,n&&(0,D.Y)("span",{css:(0,C.AH)({color:i},""),children:n}),!0!==d?(0,D.Y)("span",{css:(0,C.AH)({color:a},""),children:o}):(0,D.Y)(D.FK,{}),u&&(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.edit_assessment_button",onClick:u,size:"small",icon:(0,D.Y)(M.PencilIcon,{css:(0,C.AH)({":hover":{color:m.colors.actionDefaultTextHover}},"")})})]})};var Lt={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},Ht={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const Vt=m.memo(({color:e,hidden:t})=>(0,D.Y)("label",{css:Lt,style:{backgroundColor:e,display:t?"none":""},children:(0,D.Y)("span",{css:Ht,children:e})}));function Bt(e,t,n){return e?t.formatDate(e,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",...n}):""}var $t={name:"6dhm9o",styles:"visibility:hidden"};const Ut=(e,t,n,o,r)=>{var a,i,l,d,c,u,m,p,g,f,v,h,y,x;const b=o.name,S={currentValue:(0,s.first)(null===(a=r.currentRunValue)||void 0===a?void 0:a.responseAssessmentsByName[b]),otherValue:(0,s.first)(null===(i=r.otherRunValue)||void 0===i?void 0:i.responseAssessmentsByName[b])},w=ht(o,(null===(l=r.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[b])||[]),Y=(null===(d=r.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===b,I=(null===(m=r.otherRunValue)||void 0===m||null===(p=m.overallAssessments[0])||void 0===p||null===(g=p.rootCauseAssessment)||void 0===g?void 0:g.assessmentName)===b,T=S.currentValue?(0,A.Zh)(S.currentValue):void 0,E=S.otherValue?(0,A.Zh)(S.otherValue):void 0,N=function(e,t,n){if("pass-fail"===e.dtype)return t===n?"equal":t===A.gZ.YES?"greater":t===A.gZ.NO?"less":(0,s.isNil)(n)?"equal":"less";if("boolean"===e.dtype)return t===n?"equal":!0===t?"greater":!1===t?"less":(0,s.isNil)(n)?"equal":"less";if("string"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";const e=t,o=n;return(0,s.isNil)(e)?"less":(0,s.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(t===n)return"equal";if(null===t)return"less";if(null===n)return"greater";return t>n?"greater":"less"}return"equal"}(o,(0,s.isNil)(T)?void 0:T,(0,s.isNil)(E)?void 0:E),_=E!==T,R=A.jr[b];return(0,D.Y)("div",{css:(0,C.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:n?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(Ft,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.currentValue,isRootCauseAssessment:Y,assessmentInfo:o,type:"value"},`tag_${null===(f=r.currentRunValue)||void 0===f?void 0:f.evaluationId}_${null===(v=S.currentValue)||void 0===v?void 0:v.name}`),_&&(0,D.Y)(M.ArrowRightIcon,{css:(0,C.AH)({transform:"greater"===N?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(Ft,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:S.otherValue,isRootCauseAssessment:I,assessmentInfo:o,type:"value"},`tag_${null===(h=r.otherRunValue)||void 0===h?void 0:h.evaluationId}_${null===(y=S.currentValue)||void 0===y?void 0:y.name}`),_&&(0,D.Y)(M.ArrowRightIcon,{css:$t})]})]}):S.currentValue?(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:w.map(e=>{const t=e.latestAssessment,n=e.count;return(0,D.Y)(Ft,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:t,isRootCauseAssessment:Y,assessmentInfo:o,type:"value",count:n},`tag_${e.latestAssessment.name}_${e.value}`)})}):(0,D.Y)(Ft,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:Y,assessmentInfo:o,assessment:{name:b,rationale:R?t.formatMessage(R):t.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${b}_${null===(x=r.currentRunValue)||void 0===x?void 0:x.evaluationId}`)})};var zt={name:"36bnqj",styles:"display:flex;flex:1"},jt={name:"36bnqj",styles:"display:flex;flex:1"};var Pt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Kt={name:"1jwcxx3",styles:"font-style:italic"},Wt={name:"zjik7",styles:"display:flex"},qt={name:"1suksrg",styles:"width:12px;height:12px"},Gt={name:"zjik7",styles:"display:flex"},Jt={name:"1suksrg",styles:"width:12px;height:12px"};var Qt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Zt={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Xt={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},en={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},tn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},nn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},sn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},on={name:"58t467",styles:"width:fit-content;max-width:100%"},rn={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},an={name:"58t467",styles:"width:fit-content;max-width:100%"},ln={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},dn={name:"58t467",styles:"width:fit-content;max-width:100%"},cn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},un={name:"58t467",styles:"width:fit-content;max-width:100%"},mn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},pn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},gn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},fn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},vn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},hn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},yn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},xn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},bn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Sn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},An={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const wn=120,Yn=120;const In=e=>{let t=e;try{var n,o;const i=JSON.parse(e).response.choices;var r,a;if(Array.isArray(i)&&!(0,s.isNil)(null===(n=i[0])||void 0===n||null===(o=n.message)||void 0===o?void 0:o.content))t=null===(r=i[0])||void 0===r||null===(a=r.message)||void 0===a?void 0:a.content;else t=(0,A.ng)(e)}catch{t=(0,A.ng)(e)}return t},Tn=(e,{evaluationInputs:t,isComparing:n,theme:o,intl:r,experimentId:a,onChangeEvaluationId:i,onTraceTagsEdit:l})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case P.$6.INPUT:return{...d,sortingFn:(t,n)=>{var s,o,r,a,i,l,d,c;const u=t.getValue(e.id),m=n.getValue(e.id),p={request:(null===(s=u.currentRunValue)||void 0===s?void 0:s.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(r=u.currentRunValue)||void 0===r?void 0:r.evaluationId)||(null===(a=u.otherRunValue)||void 0===a?void 0:a.evaluationId)||""},g={request:(null===(i=m.currentRunValue)||void 0===i?void 0:i.inputs[e.id])||(null===(l=m.otherRunValue)||void 0===l?void 0:l.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/t.length,minSize:120,cell:t=>{var s,r,a;return((e,t,n,s,o,r)=>{var a,i,l,d,c,m,p,g;const f=t.getValue(),v=(null===(a=f.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(i=f.otherRunValue)||void 0===i?void 0:i.evaluationId),h=null===(l=f.currentRunValue)||void 0===l||null===(d=l.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[$.kQ],y=null===(m=f.otherRunValue)||void 0===m||null===(p=m.traceInfo)||void 0===p||null===(g=p.trace_metadata)||void 0===g?void 0:g[$.kQ],x=r&&h?r(h):u.IX,b=r&&y?r(y):u.OV,S=f.currentRunValue?(0,A.Qq)(f.currentRunValue,o):void 0,w=f.otherRunValue?(0,A.Qq)(f.otherRunValue,o):void 0,Y=S||w;return(0,D.FD)("div",{css:(0,C.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:s.spacing.sm},""),children:[(0,D.Y)(E.T.Link,{css:Pt,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>{var t;return e(v,null===(t=f.currentRunValue)||void 0===t?void 0:t.traceInfo)},children:Y||(0,D.Y)("span",{css:Kt,children:"null"})}),n&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:s.spacing.md},""),children:[(0,D.Y)("div",{css:Wt,children:h?(0,D.Y)(Vt,{color:x}):(0,D.Y)("div",{css:qt})}),(0,D.Y)("div",{css:Gt,children:y?(0,D.Y)(Vt,{color:b}):(0,D.Y)("div",{css:Jt})})]})]})})(i,t,n,o,e.id,null===t||void 0===t||null===(s=t.table)||void 0===s||null===(r=s.options)||void 0===r||null===(a=r.meta)||void 0===a?void 0:a.getRunColor)}};case P.$6.ASSESSMENT:return{...d,accessorFn:t=>({isComparing:n,assessmentInfo:e.assessmentInfo,comparisonEntry:t}),sortingFn:(t,n)=>{const{comparisonEntry:o}=t.getValue(e.id),{comparisonEntry:r}=n.getValue(e.id);if(e.assessmentInfo){var a,i,l,d,c,u,m,p;const t={currentValue:null===(a=o.currentRunValue)||void 0===a||null===(i=a.responseAssessmentsByName[e.assessmentInfo.name])||void 0===i?void 0:i[0],otherValue:null===(l=o.otherRunValue)||void 0===l||null===(d=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},n={currentValue:null===(c=r.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=r.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,t,n){const o=t.currentValue?(0,A.Zh)(t.currentValue):void 0,r=n.currentValue?(0,A.Zh)(n.currentValue):void 0,a=t.otherValue?(0,A.Zh)(t.otherValue):void 0,i=n.otherValue?(0,A.Zh)(n.otherValue):void 0;if("pass-fail"===e.dtype){const e=a===A.gZ.YES&&o===A.gZ.NO,s=i===A.gZ.YES&&r===A.gZ.NO,l=a===A.gZ.NO&&o===A.gZ.YES,d=i===A.gZ.NO&&r===A.gZ.YES,c=a===A.gZ.NO&&o===A.gZ.NO,u=i===A.gZ.NO&&r===A.gZ.NO,m=a===A.gZ.YES&&o===A.gZ.YES,p=i===A.gZ.YES&&r===A.gZ.YES;return e&&!s?-1:!e&&s?1:c&&!u?-1:!c&&u?1:l&&!d?-1:!l&&d?1:m&&!p?-1:!m&&p?1:function(e,t){if(!e&&t)return 1;if(e&&!t)return-1;if(!e||!t)return 0;const n=e.stringValue===A.gZ.YES||e.stringValue!==A.gZ.NO&&void 0,s=t.stringValue===A.gZ.YES||t.stringValue!==A.gZ.NO&&void 0;if(n===s)return 0;if(void 0===n)return 1;if(void 0===s)return-1;return n?1:-1}(t.currentValue,n.currentValue)}return o===r?0:(0,s.isNil)(o)||(0,s.isNil)(r)?(0,s.isNil)(o)?-1:1:o>r?1:-1}(e.assessmentInfo,t,n)}return 0},maxSize:200,size:n?Yn:wn,minSize:n?Yn:wn,cell:e=>{const{isComparing:t,assessmentInfo:n,comparisonEntry:s}=e.getValue();return Ut(o,r,t,n,s)}};case P.$6.EXPECTATION:return{...d,accessorFn:t=>({isComparing:n,expectationName:e.expectationName,comparisonEntry:t}),maxSize:200,size:n?Yn:wn,minSize:n?Yn:wn,cell:e=>{const{isComparing:t,expectationName:n,comparisonEntry:s}=e.getValue();return((e,t,n,s,o)=>{var r,a,i,l;const d=null===(r=o.currentRunValue)||void 0===r||null===(a=r.targets)||void 0===a?void 0:a[s],c=null===(i=o.otherRunValue)||void 0===i||null===(l=i.targets)||void 0===l?void 0:l[s],u=d?(0,D.Y)(k.SH,{parsedValue:d,singleLine:!0}):(0,D.Y)(de,{isComparing:n}),m=c?(0,D.Y)(k.SH,{parsedValue:c,singleLine:!0}):(0,D.Y)(de,{isComparing:n});return n?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,D.Y)("div",{css:zt,children:u}),(0,D.Y)("div",{css:jt,children:m})]}):u})(o,0,t,n,s)}};case P.$6.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:n,comparisonEntry:e}),sortingFn:(t,n)=>{var s,o;const{comparisonEntry:r}=t.getValue(e.id),{comparisonEntry:a}=n.getValue(e.id);return((e,t,n)=>{var s,o;if(!j.My.includes(n))return 0;const r=String(null!==(s=ee(e,n))&&void 0!==s?s:""),a=String(null!==(o=ee(t,n))&&void 0!==o?o:"");return r.localeCompare(a,void 0,{numeric:!0})})(null===r||void 0===r||null===(s=r.currentRunValue)||void 0===s?void 0:s.traceInfo,null===a||void 0===a||null===(o=a.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===j.Rl?300:100,minSize:e.id===j.Rl?120:100,cell:t=>{const{isComparing:n,comparisonEntry:d}=t.getValue();return((e,t,n,o,r,a,i,l)=>{var d,c;const u=null===(d=o.currentRunValue)||void 0===d?void 0:d.traceInfo,m=t?null===(c=o.otherRunValue)||void 0===c?void 0:c.traceInfo:void 0;if(n===j.Te){const e=null!==u&&void 0!==u&&u.request_time?new Date(u.request_time):void 0,n=null!==m&&void 0!==m&&m.request_time?new Date(m.request_time):void 0;return(0,D.Y)(ce,{first:e?(0,D.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,D.Y)("span",{css:Qt,children:Bt(e,a,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})})}):(0,D.Y)(de,{isComparing:t}),second:t&&(n?(0,D.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,D.Y)("span",{css:Zt,children:St(n)})}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.$W)return(0,D.Y)(ce,{first:(0,D.Y)(De,{original:u,isComparing:t}),second:t&&(m?(0,D.Y)(De,{original:m,isComparing:t}):(0,D.Y)(de,{isComparing:t}))});if(n===j.FW)return(0,D.Y)(ce,{first:u?(0,D.Y)(_e,{traceInfo:u,isComparing:t}):(0,D.Y)(de,{isComparing:t}),second:t&&(m?(0,D.Y)(_e,{traceInfo:m,isComparing:t}):(0,D.Y)(de,{isComparing:t}))});if(n===j.Pn){const e=Object.entries((null===u||void 0===u?void 0:u.tags)||{}).map(([e,t])=>({key:e,value:t})),n=Object.entries((null===m||void 0===m?void 0:m.tags)||{}).map(([e,t])=>({key:e,value:t})),s=!m&&u?()=>null===l||void 0===l?void 0:l(u):void 0;return(0,D.Y)(ce,{first:(0,D.Y)(je,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:s}),second:t&&(m?(0,D.Y)(je,{baseComponentId:"tags-cell-renderer-other",tags:n}):(0,D.Y)(de,{isComparing:t}))})}if((0,B.ij)()&&n.startsWith(j.Pn)){var p,g;const e=(0,$.PO)(n);if(!e)return(0,D.Y)(de,{isComparing:t});const s=null===u||void 0===u||null===(p=u.tags)||void 0===p?void 0:p[e],o=null===m||void 0===m||null===(g=m.tags)||void 0===g?void 0:g[e];return(0,D.Y)(ce,{first:s?(0,D.Y)("span",{title:s,css:Xt,children:s}):(0,D.Y)(de,{isComparing:t}),second:t&&(o?(0,D.Y)("span",{title:s,css:en,children:o}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.LV){var f,v,h,y,x;const e=null===(f=o.currentRunValue)||void 0===f?void 0:f.evaluationId,n=null===u||void 0===u||null===(v=u.tags)||void 0===v?void 0:v["mlflow.traceName"],s=null===m||void 0===m||null===(h=m.tags)||void 0===h?void 0:h["mlflow.traceName"];return(0,D.Y)(ce,{first:n?t?(0,D.Y)("div",{children:null===u||void 0===u||null===(x=u.tags)||void 0===x?void 0:x["mlflow.traceName"]}):(0,D.Y)(E.T.Link,{css:tn,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>{var t;return e&&r(e,null===(t=o.currentRunValue)||void 0===t?void 0:t.traceInfo)},children:null===u||void 0===u||null===(y=u.tags)||void 0===y?void 0:y["mlflow.traceName"]}):(0,D.Y)(de,{isComparing:t}),second:t&&(s?(0,D.Y)("div",{children:s}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.li){var b;const t=null===u||void 0===u||null===(b=u.trace_metadata)||void 0===b?void 0:b[$.kQ];return t?(0,D.Y)(Ie,{experimentId:e,runUuid:t}):(0,D.Y)(de,{})}if(n===j.tP){var S,w,Y,I;const e=(null===u||void 0===u||null===(S=u.trace_metadata)||void 0===S?void 0:S["mlflow.trace.user"])||(null===u||void 0===u||null===(w=u.tags)||void 0===w?void 0:w["mlflow.user"]),n=(null===m||void 0===m||null===(Y=m.trace_metadata)||void 0===Y?void 0:Y["mlflow.trace.user"])||(null===m||void 0===m||null===(I=m.tags)||void 0===I?void 0:I["mlflow.user"]);return(0,D.Y)(ce,{first:e?(0,D.FD)("span",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs},""),title:e,children:[(0,D.Y)(M.UserIcon,{css:(0,C.AH)({color:i.colors.textSecondary,fontSize:16},"")}),(0,D.Y)("span",{css:nn,children:e})]}):(0,D.Y)(de,{isComparing:t}),second:t&&(n?(0,D.FD)("span",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs},""),title:n,children:[(0,D.Y)(M.UserIcon,{css:(0,C.AH)({color:i.colors.textSecondary,fontSize:16},"")}),(0,D.Y)("span",{css:sn,children:n})]}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.XQ){const e=null===u||void 0===u?void 0:u.trace_id,n=null===m||void 0===m?void 0:m.trace_id;return(0,D.Y)(ce,{first:e?(0,D.Y)(M.Tag,{css:on,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",onClick:()=>r(e,u),children:(0,D.Y)("span",{css:rn,children:e})}):(0,D.Y)(de,{isComparing:t}),second:t&&(n?(0,D.Y)(M.Tag,{css:an,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:n,onClick:()=>r(n,m),children:(0,D.Y)("span",{css:ln,children:n})}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.yX){var T,N;const n=null===u||void 0===u||null===(T=u.trace_metadata)||void 0===T?void 0:T["mlflow.trace.session"],s=null===m||void 0===m||null===(N=m.trace_metadata)||void 0===N?void 0:N["mlflow.trace.session"],o=null===u||void 0===u?void 0:u.trace_id,r=null===m||void 0===m?void 0:m.trace_id;return(0,D.Y)(ce,{first:n?(0,D.Y)(Ce,{sessionId:n,experimentId:e,traceId:o,children:(0,D.Y)(M.Tag,{css:dn,componentId:"mlflow.genai-traces-table.session",title:n,children:(0,D.Y)("span",{css:cn,children:n})})}):(0,D.Y)(de,{isComparing:t}),second:t&&(s?(0,D.Y)(Ce,{sessionId:s,experimentId:e,traceId:r,children:(0,D.Y)(M.Tag,{css:un,componentId:"mlflow.genai-traces-table.session",title:s,children:(0,D.Y)("span",{css:mn,children:s})})}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.Rl){const e=u?In((0,$.Mq)(u)):"",n=m?In((0,$.Mq)(m)):"";return(0,D.Y)(ce,{first:e?(0,D.Y)("div",{css:pn,title:e,children:e}):(0,D.Y)(de,{isComparing:t}),second:t&&(n?(0,D.Y)("div",{css:gn,title:n,children:n}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.im)return(0,D.Y)(ye,{experimentId:e,currentTraceInfo:u,otherTraceInfo:m,isComparing:t});if(n===j.YO)return(0,D.Y)(Pe,{currentTraceInfo:u,otherTraceInfo:m,isComparing:t});if(n.startsWith(j.rc)){var R,k;const e=(0,$.v8)(n);if(!e)return(0,D.Y)(de,{isComparing:t});const s=null===u||void 0===u||null===(R=u.trace_metadata)||void 0===R?void 0:R[e],o=null===m||void 0===m||null===(k=m.trace_metadata)||void 0===k?void 0:k[e];return(0,D.Y)(ce,{first:s?(0,D.Y)("div",{css:fn,title:s,children:s}):(0,D.Y)(de,{isComparing:t}),second:t&&(o?(0,D.Y)("div",{css:vn,title:o,children:o}):(0,D.Y)(de,{isComparing:t}))})}if(n===j.tj){const e=e=>{var t;if(void 0===e)return;const n=parseFloat(e),o=null===e||void 0===e||null===(t=e.replace)||void 0===t?void 0:t.call(e,/[0-9.]/g,"").trim().toLowerCase();return(0,s.isNil)(n)||isNaN(n)?void 0:[n.toFixed(3).replace(/\.?0+$/,""),o].filter(Boolean).join("")},n=e(null===u||void 0===u?void 0:u[j.tj]),o=e(null===m||void 0===m?void 0:m[j.tj]);return(0,D.Y)(ce,{first:(0,s.isNil)(n)?(0,D.Y)(de,{isComparing:t}):(0,D.Y)("div",{css:hn,title:n,children:n}),second:t&&((0,s.isNil)(o)?(0,D.Y)(de,{isComparing:t}):(0,D.Y)("div",{css:yn,title:o,children:o}))})}if(n===j.VC){var F,O;const e=e=>{if(!e)return null;try{const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0)return t.map(e=>`${e.name}/${e.version}`).join(", ")}catch(t){return e}return null},n=null===u||void 0===u||null===(F=u.tags)||void 0===F?void 0:F["mlflow.linkedPrompts"],s=null===m||void 0===m||null===(O=m.tags)||void 0===O?void 0:O["mlflow.linkedPrompts"],o=e(n),r=e(s);return(0,D.Y)(ce,{first:o?(0,D.Y)("div",{css:xn,title:o,children:o}):(0,D.Y)(de,{isComparing:t}),second:t&&(r?(0,D.Y)("div",{css:bn,title:r,children:r}):(0,D.Y)(de,{isComparing:t}))})}const L=u?(0,A.ng)(ee(u,n)):"",H=m?(0,A.ng)(ee(m,n)):"";return(0,D.Y)(ce,{first:L?(0,D.Y)("div",{css:Sn,title:L,children:L}):(0,D.Y)(de,{isComparing:t}),second:t&&(H?(0,D.Y)("div",{css:An,title:H,children:H}):(0,D.Y)(de,{isComparing:t}))})})(a,n,e.id,d,i,r,o,l)}};case P.$6.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var t;return null===(t=e.currentRunValue)||void 0===t?void 0:t.requestTime},sortingFn:(t,n)=>{const s=t.getValue(e.id),o=n.getValue(e.id);return JSON.stringify(s).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const t=e.getValue();if(!t)return null;const n=new Date(t);return(0,D.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:n.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,D.Y)("span",{children:St(n)})})}};default:return d}};var Cn=n(43617);const En=m.memo(({rows:e,isComparing:t,enableRowSelection:n,virtualItems:s,virtualizerTotalSize:o,virtualizerMeasureElement:r,selectedColumns:a,rowSelectionChangeHandler:i})=>(0,D.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:s.map(s=>{const o=e[s.index],l=o.original.currentRunValue&&!t;return(0,D.Y)("div",{"data-index":s.index,ref:e=>r(e),style:{position:"absolute",transform:`translate3d(0, ${s.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,D.Y)(_n,{row:o,exportableTrace:l,enableRowSelection:n,isSelected:n?o.getIsSelected():void 0,isComparing:t,selectedColumns:a,rowSelectionChangeHandler:i})},s.key)})})),Mn=m.memo(En);var Nn={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const _n=m.memo(({row:e,exportableTrace:t,enableRowSelection:n,isComparing:s,isSelected:o,selectedColumns:r,rowSelectionChangeHandler:a})=>{const i=e.getVisibleCells(),l=(0,R.tz)(),d=a?t=>a(e,t):e.getToggleSelectedHandler();return(0,D.Y)(D.FK,{children:(0,D.FD)(M.TableRow,{children:[(0,D.Y)("div",{css:Nn,children:n&&(0,D.Y)(_.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:s?l.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):t?null:l.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,D.Y)(M.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&t,onChange:d,isDisabled:s||!t})})}),i.map(e=>(0,D.Y)(Rn,{cell:e},e.id))]})})}),Rn=m.memo(({cell:e})=>{const{theme:t}=(0,E.u)();return(0,D.Y)(M.TableCell,{style:{flex:`1 1 var(--col-${At(e.column.id)}-size)`},css:(0,C.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${t.spacing.xs}px 0px`,width:"100%"}},""),children:(0,Cn.Kv)(e.column.columnDef.cell,e.getContext())},e.id)});const kn=({overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:o,compareToRunUuid:r})=>{const a=(0,R.tz)(),{theme:i}=(0,E.u)(),l=(0,m.useMemo)(()=>function(e,t,n,s,o,r,a){var i,l;if(Object.values(t).every(e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0)))return[];const d=Object.values(t).filter(e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0).sort((e,t)=>t.currentNumRootCause-e.currentNumRootCause),c=Math.max((null===(i=d[0])||void 0===i?void 0:i.currentNumRootCause)||0,(null===(l=d[0])||void 0===l?void 0:l.otherNumRootCause)||0);return d.map(t=>{var i;const l=null===(i=A.yQ[t.assessmentInfo.name])||void 0===i?void 0:i[A.gZ.NO],d=l?e.formatMessage(l):t.assessmentInfo.name,u=t.currentCounts,m=(null===u||void 0===u?void 0:u.get(A.gZ.YES))||0,p=(null===u||void 0===u?void 0:u.get(A.gZ.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,f=t.currentNumRootCause,v=m+p+g,h=t.otherCounts;let y;if(void 0!==t.otherCounts){y=((null===h||void 0===h?void 0:h.get(A.gZ.YES))||0)+((null===h||void 0===h?void 0:h.get(A.gZ.NO))||0)+((null===h||void 0===h?void 0:h.get(void 0))||0)}const x=t.otherNumRootCause||0,b=x/(y||1),S=yt(f/v),w=yt(b);return{assessment:t.assessmentInfo.name,title:d,currentInfo:{count:f,fraction:f/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:f,numEvals:v,percentage:S,assessment:t.assessmentInfo.name,currentRun:r}),toggleFilter:()=>s(t.assessmentInfo.name,"failing_root_cause","current"),isSelected:n.some(e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===t.assessmentInfo.name),percentage:S},otherInfo:o?{count:x,fraction:x/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:x,numEvals:y,percentage:w,assessment:t.assessmentInfo.name,otherRunDisplayName:a}),toggleFilter:()=>s(t.assessmentInfo.name,"rca","other"),isSelected:n.some(e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===t.assessmentInfo.name),percentage:w}:void 0,icon:(0,D.Y)(N.X,{})}})}(a,t,n,s,Boolean(r),o,r),[a,t,n,s,r,o]);return 0===l.length?(0,D.Y)(D.FK,{}):(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:[(0,D.Y)("div",{css:(0,C.AH)({fontWeight:i.typography.typographyBoldFontWeight},""),children:a.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:(0,D.Y)(Fn,{overallAssessmentInfo:e,rcaData:l,run:"current",runColor:r?u.IX:void 0})}),r&&(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:(0,D.Y)(Fn,{overallAssessmentInfo:e,rcaData:l,run:"other",runColor:u.OV})})]})};var Dn={name:"zjik7",styles:"display:flex"};const Fn=({rcaData:e,run:t,runColor:n,overallAssessmentInfo:s})=>{const{theme:o}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[n&&(0,D.Y)("div",{css:Dn,children:(0,D.Y)(Vt,{color:n})}),(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map((e,n)=>{const r="current"===t?e.currentInfo:e.otherInfo;if(!r)return(0,D.Y)(D.FK,{});const a=(0,u.x2)(o,s,{stringValue:"no"});return(0,D.Y)(_.T,{content:r.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,D.Y)(D.FK,{children:(0,D.FD)("div",{style:{border:r.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,C.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:r.isSelected?(0,A.fu)(a,1):(0,A.fu)(a,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[r.count,(0,D.Y)("div",{children:e.title.toLocaleLowerCase()})]},n)})},n)})})]})};var On={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const Ln=({assessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:r,compareToRunUuid:a})=>{var i,l;const{theme:d}=(0,E.u)(),c=(0,R.tz)();return(0,D.Y)(D.FK,{children:(0,D.FD)("div",{css:(0,C.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,D.Y)(M.NumbersIcon,{}):"boolean"===e.dtype?(0,D.Y)(M.BinaryIcon,{}):(0,D.Y)(D.FK,{}),(0,D.Y)(E.T.Title,{level:4,css:(0,C.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(i=e.source)||void 0===i?void 0:i.sourceType)&&(0,D.Y)(M.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,D.Y)(M.SparkleDoubleIcon,{css:(0,C.AH)({color:d.colors.textSecondary},"")}),(0,D.Y)(E.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(l=e.source)||void 0===l?void 0:l.sourceType)&&(0,D.Y)(M.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,D.Y)(M.UserIcon,{}),(0,D.Y)(E.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,D.Y)(M.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,D.Y)(E.T.Hint,{children:(0,D.Y)(M.BracketsXIcon,{})}),(0,D.Y)(E.T.Hint,{children:e.metricName})]})})]}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Hint,{children:e.name})})]})}),(0,D.Y)("div",{children:(0,D.Y)("span",{css:On,children:e.description})}),e.name===o._1.OVERALL_ASSESSMENT&&r?(0,D.Y)("div",{children:(0,D.Y)(kn,{overallAssessmentInfo:e,assessmentNameToAggregates:t,allAssessmentFilters:n,toggleAssessmentFilter:s,runUuid:r,compareToRunUuid:a})}):(0,D.Y)(D.FK,{})]})})};var Hn={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const Vn=m.memo(({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:s,allAssessmentFilters:o,toggleAssessmentFilter:r,currentRunDisplayName:a,compareToRunDisplayName:i})=>{const l=(0,m.useMemo)(()=>function(e,t,n,s,o,r,a,i){const l=void 0!==r.otherCounts,d=[];for(const c of ft(n)){const m=r.currentCounts?gt(e,n,s,c,r.currentCounts,a||$.kf,o):void 0,p=l&&i?gt(e,n,s,c,r.otherCounts||new Map,i,o):void 0,g=c===nt||void 0===c,f=l&&m&&p?g?m.value-((null===p||void 0===p?void 0:p.value)||0):m.fraction-((null===p||void 0===p?void 0:p.fraction)||0):void 0;m&&(!g||0!==m.value||f&&0!==f)&&d.push({name:vt(e,0,n,c),current:m,other:p,backgroundColor:(0,u.QO)(t,n,c,c===nt),scoreChange:f})}return d}(t,e,n,o,r,s,a,i),[t,e,n,o,r,s,a,i]),d=(0,m.useMemo)(()=>"pass-fail"===n.dtype||"boolean"===n.dtype?l:l.map((e,t)=>({...e,originalIndex:t})).sort((e,t)=>{const n="null"===e.name||e.name===nt,s="null"===t.name||t.name===nt;if(n&&!s)return 1;if(s&&!n)return-1;if(!n&&!s){var o,r;const n=((null===(o=t.current)||void 0===o?void 0:o.value)||0)-((null===(r=e.current)||void 0===r?void 0:r.value)||0);if(0!==n)return n}return e.originalIndex-t.originalIndex}),[l,n]),c=d.length>4?d.slice(0,3):d,p=d.length>4?d.slice(3):[],g=p.length>0,f=e.colors.actionDefaultBackgroundHover,v=e.colors.actionDefaultBackgroundPress;return(0,D.Y)("table",{children:(0,D.FD)("tbody",{children:[c.map(t=>(0,D.Y)(Un,{barData:t,theme:e,hoverBarColor:f,selectedBarColor:v,assessmentInfo:n},t.name)),g&&(0,D.Y)("tr",{children:(0,D.Y)("td",{colSpan:2,children:(0,D.FD)(E.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,D.Y)(E.aw.Trigger,{asChild:!0,children:(0,D.Y)("div",{css:(0,C.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:f},borderRadius:e.general.borderRadiusBase},""),children:t.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:p.length})})}),(0,D.Y)(E.aw.Content,{align:"start",side:"bottom",css:Hn,children:(0,D.Y)("table",{children:(0,D.Y)("tbody",{children:p.map(t=>(0,D.Y)(Un,{barData:t,theme:e,hoverBarColor:f,selectedBarColor:v,assessmentInfo:n},t.name))})})})]})})})]})})});var Bn={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},$n={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const Un=({barData:e,theme:t,hoverBarColor:n,selectedBarColor:o,assessmentInfo:r})=>{const a=e.name===nt,i="null"===e.name;return a||i?(0,D.FD)("tr",{css:(0,C.AH)({cursor:"pointer",":hover":{backgroundColor:n},color:a?t.colors.textValidationWarning:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm},""),onClick:e.current.toggleFilter,children:[(0,D.Y)("td",{css:(0,C.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:e.name===nt?"normal":"italic"},""),children:(0,D.Y)("span",{css:(0,C.AH)({lineHeight:`${t.typography.fontSizeSm}px`},""),children:e.name})}),(0,D.Y)("td",{css:(0,C.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs,fontStyle:"normal"},""),children:(0,D.Y)("span",{css:(0,C.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?e.current.value:bt(r,e.scoreChange,!1)})})]},e.name):(0,D.FD)("tr",{css:(0,C.AH)({cursor:"pointer",":hover":{backgroundColor:n}},""),onClick:e.current.toggleFilter,children:[(0,D.Y)("td",{css:(0,C.AH)({width:"100%",borderTopLeftRadius:t.general.borderRadiusBase,borderBottomLeftRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,D.FD)("div",{css:Bn,children:[(0,D.Y)("span",{css:(0,C.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:t.colors.textSecondary},""),children:e.name}),(0,D.Y)("div",{css:$n,children:(0,D.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,C.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,D.Y)("td",{css:(0,C.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:t.general.borderRadiusBase,borderBottomRightRadius:t.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:t.spacing.xs,paddingTop:t.spacing.xs,paddingBottom:t.spacing.xs},""),children:(0,D.Y)("span",{css:(0,C.AH)({color:t.colors.textSecondary,fontWeight:"normal",fontSize:t.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${t.typography.fontSizeSm}px`},""),children:(0,s.isNil)(e.scoreChange)?(l=e.current.fraction,yt(l,0)+"%"):bt(r,e.scoreChange)})})]},e.name);var l};var zn={name:"1fttcpj",styles:"display:flex;flex-direction:column"},jn={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},Pn={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Kn={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Wn={name:"18ubt2d",styles:"width:25%"},qn={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Gn={name:"18ubt2d",styles:"width:25%"};const Jn=m.memo(({numericAggregate:e})=>{const{theme:t}=(0,E.u)(),n=(0,R.tz)();return(0,D.FD)("div",{css:zn,children:[(0,D.Y)("div",{css:jn,children:e.counts.map((s,o)=>(0,D.Y)(M.HoverCard,{content:(0,D.FD)("div",{css:Pn,children:[(0,D.FD)("div",{css:Kn,children:[(0,D.Y)("div",{css:Wn,children:(0,D.Y)(E.T.Text,{children:n.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Text,{color:"secondary",children:xt(s.lower,2)===xt(s.upper,2)?xt(s.lower,2):`${xt(s.lower,2)} - ${xt(s.upper,2)}`})})]}),(0,D.FD)("div",{css:qn,children:[(0,D.Y)("div",{css:Gn,children:(0,D.Y)(E.T.Text,{children:n.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,D.Y)("div",{children:(0,D.Y)(E.T.Text,{color:"secondary",children:s.count})})]})]}),trigger:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:(0,D.Y)("div",{css:(0,C.AH)({height:s.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:t.colors.blue400,borderTopRightRadius:t.general.borderRadiusBase,borderTopLeftRadius:t.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o))}),e.min===e.max?(0,D.Y)("div",{css:(0,C.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:xt(e.min,2)}):(0,D.FD)("div",{css:(0,C.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[(0,D.Y)("div",{children:xt(e.min,2)}),(0,D.Y)("div",{children:xt(e.max,2)})]})]})}),Qn=m.memo(({theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:a,currentRunDisplayName:i,compareToRunDisplayName:l,collapsedHeader:d})=>{const c=(0,m.useMemo)(()=>"pass-fail"===n.dtype?t.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===n.dtype?t.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===n.dtype?t.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===n.dtype?t.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0,[n,t]),{displayScore:p,displayScoreChange:g,changeDirection:f}=(0,m.useMemo)(()=>function(e,t,n){if("numeric"===t.dtype){const e=n.currentNumericValues,t=n.otherNumericValues;let s=NaN,o=NaN;e&&(s=e.reduce((e,t)=>e+t,0)/e.length),t&&(o=t.reduce((e,t)=>e+t,0)/t.length);const r=t?s-o:void 0,a=r?r>0?"up":"down":"none";return{displayScore:xt(s,2),displayScoreChange:r?"up"===a?`+${xt(Math.abs(r),2)}`:"down"===a?`-${xt(Math.abs(r),2)}`:"+0":void 0,changeDirection:a,aggregateType:"average"}}if("pass-fail"===t.dtype||"boolean"===t.dtype){const e=0,s=pt(t,n.currentCounts),o=yt(s,e)+"%",r=n.otherCounts?s-pt(t,n.otherCounts):void 0,a=r?r>0?"up":"down":"none";return{displayScore:o,displayScoreChange:r?("up"===a||"none"===a?"+":"")+yt(r,e)+"%":void 0,changeDirection:a,aggregateType:"percentage-true"}}if("string"===t.dtype){const n=t.uniqueValues.size;return{displayScore:1!==n?e.formatMessage({id:"+dbgRR",defaultMessage:"{numUniqueValues} values"},{numUniqueValues:n}):e.formatMessage({id:"lKyc9r",defaultMessage:"1 value"}),displayScoreChange:"",changeDirection:"none",aggregateType:"categorical"}}return{displayScore:"N/A",displayScoreChange:"N/A",changeDirection:"none",aggregateType:"categorical"}}(t,n,o),[t,n,o]);return"unknown"===n.dtype?null:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,D.Y)("div",{css:(0,C.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,D.Y)("div",{css:(0,C.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:p}),!(0,s.isNil)(g)&&l&&(0,D.Y)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:u.G8,backgroundColor:"none"===f?"":"up"===f?u.YH.up:"down"===f?u.YH.down:(0,A.fu)(e.colors.textSecondary,.1)},""),children:g})]})]}),!d&&((0,s.isNil)(o.currentNumericAggregate)?(0,D.Y)(Vn,{theme:e,intl:t,assessmentInfo:n,assessmentAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:a,currentRunDisplayName:i,compareToRunDisplayName:l}):(0,D.Y)(Jn,{numericAggregate:o.currentNumericAggregate}))]})});var Zn={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},Xn={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},es={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const ts=m.memo(({enableRowSelection:e,enableGrouping:t,selectedAssessmentInfos:n,assessmentNameToAggregates:o,assessmentFilters:r,toggleAssessmentFilter:a,runDisplayName:i,compareToRunUuid:l,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:p,isComparing:g,headerGroups:f,allRowSelected:v,someRowSelected:h,toggleAllRowsSelectedHandler:y,setColumnSizing:x})=>{const{theme:b}=(0,E.u)(),S=(0,R.tz)(),[A,w]=(0,m.useState)(!1),Y=t?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${b.colors.border}`}}:{};return(0,D.Y)(D.FK,{children:f.map((m,I)=>(0,D.FD)(M.TableRow,{isHeader:!0,css:(0,C.AH)({position:"sticky",top:40*I,zIndex:100,...t&&{"& > *":{borderBottom:0===I?"none":void 0}},...I===f.length-1&&{borderBottom:`1px solid ${A?b.colors.blue500:b.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,D.Y)("div",{css:0===n.length&&1===I?{}:Y,children:(0,D.Y)(M.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:v,indeterminate:h,onChange:y(),checkboxLabel:S.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===I,isDisabled:g})}),m.headers.map(e=>{if(e.isPlaceholder)return null;const m=n.find(t=>(0,j.A5)(t.name)===e.id),p=e.isPlaceholder?null:(0,D.Y)("div",{css:Zn,title:String((0,Cn.Kv)(e.column.columnDef.header,e.getContext())),children:(0,Cn.Kv)(e.column.columnDef.header,e.getContext())}),g=m&&!c?(0,D.Y)(M.HoverCard,{content:(0,D.Y)(D.FK,{children:(0,D.Y)(Ln,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:r,toggleAssessmentFilter:a,runUuid:i,compareToRunUuid:l?d:void 0})}),trigger:p},e.id):(0,s.isNil)(p)?null:p;return(0,D.Y)(M.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,C.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===n.length&&1===I?{}:Y},""),style:{flex:`${e.colSpan} 1 var(--header-${At(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:x,children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs},""),children:[g,(0,D.Y)("div",{css:(0,C.AH)({borderTop:!t&&n.length>0?`1px solid ${b.colors.border}`:"",width:"100%"},""),children:m&&(0,D.Y)(Qn,{theme:b,intl:S,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:r,toggleAssessmentFilter:a,currentRunDisplayName:i,compareToRunDisplayName:l?d:void 0,collapsedHeader:u})})]})},e.column.id)}),I===f.length-1&&(0,D.FD)("div",{css:Xn,children:[(0,D.Y)("div",{css:(0,C.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:b.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,D.Y)("div",{css:es,onClick:()=>p(!u),onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:(0,D.Y)("div",{css:(0,C.AH)({width:"22px",height:"22px",borderRadius:"50%",background:b.colors.backgroundPrimary,border:`2px solid ${b.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:b.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:A?1:.5},""),children:(0,D.Y)(M.ChevronDownIcon,{css:(0,C.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:b.colors.textSecondary},"")})})})]})]},m.id))})}),ns=e=>{const{theme:t}=(0,E.u)(),n=(0,R.tz)(),{groupId:s,visibleCount:o,totalCount:r,enableGrouping:a}=e.column.columnDef.meta;if(!a)return P.RF[s];const i=P.RF[s];return(0,D.FD)("div",{css:(0,C.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:t.spacing.sm},""),children:[(0,D.Y)("div",{children:i}),s===P.w8.INFO?null:o===r?(0,D.FD)("div",{css:(0,C.AH)({color:t.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",r,")"]}):(0,D.Y)(M.HoverCard,{trigger:(0,D.FD)("div",{css:(0,C.AH)({color:t.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",r,")"]}),content:n.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:r,groupName:i}),align:"start"})]})};var ss={name:"49aokf",styles:"display:contents"};const os=({history:e,alwaysExpanded:t=!1})=>{const{theme:n}=(0,E.u)(),o=(0,R.tz)(),[r,a]=(0,m.useState)(new Date);(0,m.useEffect)(()=>{const e=setInterval(()=>{a(new Date)},5e3);return()=>{clearInterval(e)}},[]);const i=(0,m.useMemo)(()=>e.reduce((t,n,s)=>{const o=e[s+1];return o?[...t,[n,o]]:t},[]),[e]),{makeHTML:l}=Ct(),d=(0,m.useMemo)(()=>{var t;const n=null===(t=(0,s.first)(e))||void 0===t?void 0:t.rationale;return(0,s.isString)(n)?l(n):null},[e,l]);var c,u,p;if(!i.length)return null!==(c=(0,s.first)(e))&&void 0!==c&&c.rationale?(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:(0,D.Y)("span",{css:ss,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,s.first)(e))&&void 0!==u&&u.errorMessage?(0,D.Y)(D.FK,{children:(0,D.Y)(E.T.Text,{color:"error",children:null===(p=(0,s.first)(e))||void 0===p?void 0:p.errorMessage})}):(0,D.Y)(D.FK,{children:!t&&(0,D.FD)("div",{children:[(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)(E.T.Hint,{children:(0,D.Y)(R.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const t=(0,A.Zh)(e),n=A.yQ[e.name];if(n&&!(0,s.isNil)(t)){var o;const e=null!==(o=n[t.toString()])&&void 0!==o?o:n.default;if(e)return(0,D.Y)(R.sA,{...e,values:{value:t}})}return t};return(0,D.FD)(D.FK,{children:[(0,D.Y)(_.S,{size:"sm"}),i.map(([e,s],a)=>{var i,l;const d=g(s),c=g(e),u=d===c,m=(0,A.CH)(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):St(e.timestamp,r);return(0,D.FD)("div",{css:(0,C.AH)({marginBottom:t?void 0:n.spacing.md},""),children:[(0,D.FD)(E.T.Hint,{css:(0,C.AH)({marginBottom:n.spacing.xs},""),children:[d&&c&&(0,D.FD)(D.FK,{children:[(0,D.Y)("code",{children:g(s)})," \u2192 ",(0,D.Y)("code",{children:g(e)})," "]}),u?(0,D.Y)(R.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(i=e.source)||void 0===i?void 0:i.sourceId}}):(0,D.Y)(R.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(l=e.source)||void 0===l?void 0:l.sourceId}})]}),e.rationale&&(0,D.Y)(E.T.Text,{children:e.rationale})]},`${e.timestamp}-${a}`)})]})},rs=({assessmentHistory:e,children:t,disable:n=!1})=>{const o=(0,R.tz)(),r=(0,m.useMemo)(()=>e.some(A.hG),[e]),[a,i]=(0,m.useState)(new Date);(0,m.useEffect)(()=>{const e=setInterval(()=>{i(new Date)},5e3);return()=>{clearInterval(e)}},[]);return(0,D.Y)(_.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:n?void 0:(0,D.Y)("span",{children:(()=>{const t=(0,s.first)(e);if(!t)return;if((0,A.w_)(t)){var n,i;const s=e[1],r=s?null===(n=(0,A.Zh)(s))||void 0===n?void 0:n.toString():void 0,c=(0,A.CH)(t)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):St(t.timestamp,a);if(r){var l,d;const e=null===(l=A.yQ[t.name])||void 0===l?void 0:l[r],n=e?o.formatMessage(e):r;return(0,D.Y)(R.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===t||void 0===t||null===(d=t.source)||void 0===d?void 0:d.sourceId,value:n}})}return(0,D.Y)(R.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===t||void 0===t||null===(i=t.source)||void 0===i?void 0:i.sourceId}})}return r?(0,D.Y)(R.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==t&&void 0!==t&&t.errorMessage?null===t||void 0===t?void 0:t.errorMessage:(0,D.Y)(R.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:t})},as=({editedAssessment:e,valueSuggestions:t,onSave:n,onCancel:s,readOnly:o=!1})=>{var r;const{theme:a}=(0,E.u)(),i=(0,R.tz)(),[l,d]=(0,m.useState)(()=>(null===e||void 0===e?void 0:e.rationale)||void 0),[c,u]=(0,m.useState)(""),[p,g]=(0,m.useState)(()=>{if(e){var n;const o=null===(n=(0,A.Zh)(e))||void 0===n?void 0:n.toString();var s;return o?null!==(s=t.find(e=>e.key===o))&&void 0!==s?s:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}}),[f,v]=(0,m.useState)(!1),h=(0,m.useMemo)(()=>t.filter(e=>e.label.toLowerCase().includes(c.toLowerCase())),[c,t]),y=f?t:h,x=c||y.length>0,b=(0,M.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:t,items:y,setItems:()=>{},setInputValue:e=>{v(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:p,initialSelectedItem:p,initialInputValue:null!==(r=null===p||void 0===p?void 0:p.label)&&void 0!==r?r:"",formOnChange:e=>{(null===p||void 0===p?void 0:p.label)!==e&&g("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&v(!0)}}),S=i.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,D.FD)("div",{children:[(0,D.FD)(M.TypeaheadComboboxRoot,{comboboxState:b,children:[(0,D.Y)(M.TypeaheadComboboxInput,{readOnly:o,css:(0,C.AH)({width:300,backgroundColor:a.colors.backgroundPrimary},""),placeholder:i.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===b.highlightedIndex&&"Enter"===e.key&&b.closeMenu()},comboboxState:b,formOnChange:e=>{g(e)}}),x&&(0,D.Y)(M.TypeaheadComboboxMenu,{comboboxState:b,emptyText:S,matchTriggerWidth:!0,children:y.map((e,t)=>(0,D.Y)(M.TypeaheadComboboxMenuItem,{item:e,index:t,comboboxState:b,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${t}`))})]}),(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)("div",{css:(0,C.AH)({backgroundColor:a.colors.backgroundPrimary,borderRadius:a.general.borderRadiusBase},""),children:(0,D.Y)(N.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==l&&void 0!==l?l:"",onChange:e=>d(e.target.value),placeholder:i.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,D.Y)(_.S,{size:"sm"}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:a.spacing.xs},""),children:[(0,D.Y)(E.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var t,s;if(!p)return;const o=null!==(t=null!==(s=p.rootAssessmentName)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==t?t:p.key,r=o===p.key||p.key;n({value:r,rationale:l,assessmentName:o})},disabled:!(null!==p&&void 0!==p&&p.key),children:(0,D.Y)(R.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,D.Y)(E.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:s,children:(0,D.Y)(R.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},is=(e,t)=>{const n=(0,R.tz)(),[s,o]=(0,m.useState)(void 0),[r,a]=(0,m.useState)(!1),[i,l]=(0,m.useState)([]),d=(0,m.useCallback)((s,r)=>{o(r),a(s),l((0,A.rU)(n,r,e,t))},[n,t,e]),c=(0,m.useCallback)(e=>d(!0,e),[d]);return{suggestions:i,editingAssessment:s,showUpsertForm:r,addAssessment:(0,m.useCallback)(()=>d(!0,void 0),[d]),editAssessment:c,closeForm:(0,m.useCallback)(()=>{o(void 0),a(!1)},[])}};var ls={name:"49aokf",styles:"display:contents"};const ds=({assessmentsType:e,assessmentName:t,assessmentHistory:n,rootCauseAssessment:o,onUpsertAssessment:r,allowEditing:a=!1,options:i,inputs:l,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,E.u)(),p=(0,R.tz)(),g="overall"===e,{suggestions:f,editingAssessment:v,showUpsertForm:h,editAssessment:y,closeForm:x}=is(n,c);(0,m.useEffect)(()=>{x()},[l,x]);const b=(0,s.first)(n),S=A.c9[t],w=S?p.formatMessage(S):t,Y=Boolean(b&&(0,A.Zh)(b)),I=Boolean(b&&(0,A.CH)(b)),T=a&&(Y||I),{makeHTML:N}=Ct(),_=(0,m.useMemo)(()=>{var e;const t=null===b||void 0===b||null===(e=b.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,s.isString)(t)?N(t):null},[b,N]);return(0,D.FD)("div",{css:(0,C.AH)({display:"block",marginBottom:g?void 0:u.spacing.md},""),children:[!h&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[t!==A._1.OVERALL_ASSESSMENT&&(0,D.Y)("div",{css:(0,C.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,D.Y)(Ft,{assessment:b,"aria-label":w,disableJudgeTypeIcon:(0,A.xO)(b),onEdit:T?()=>{const e=(0,s.first)(n);e&&y(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,D.Y)(os,{history:n,alwaysExpanded:g}),o&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.BugIcon,{color:"danger"}),(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,D.Y)(Ft,{assessment:o,isRootCauseAssessment:!0,"aria-label":w,assessmentInfo:d,type:"assessment-value"})]}),(0,D.Y)(os,{history:[o],alwaysExpanded:g}),_&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.AssistantIcon,{color:"ai"}),(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,D.Y)("span",{css:ls,dangerouslySetInnerHTML:{__html:_}})]})]})]}),h&&(0,D.Y)(D.FK,{children:(0,D.Y)(as,{editedAssessment:v,valueSuggestions:f,onCancel:x,onSave:({value:e,rationale:t,assessmentName:n})=>{var s;const o=g?A._1.OVERALL_ASSESSMENT:"",a=(0,A.aj)({name:null!==(s=null!==n&&void 0!==n?n:null===v||void 0===v?void 0:v.name)&&void 0!==s?s:o,isOverallAssessment:g,value:e,rationale:t});r(a),x()}},null===v||void 0===v?void 0:v.name)})]},t)};var cs={name:"eivff4",styles:"display:none"};const us=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:r=!1,options:a,inputs:i,assessmentInfos:l})=>{const{theme:d}=(0,E.u)(),c="overall"===e,u=t.filter(([e,t])=>t.length>0),{suggestions:p,editingAssessment:g,showUpsertForm:f,addAssessment:v,closeForm:h}=is(u.flatMap(([e,t])=>t),l);(0,m.useEffect)(()=>{h()},[i,h]);const y=Object.keys(u).length>0,x=o&&(r||!y);return(0,D.FD)(D.FK,{children:[(0,D.FD)("div",{css:(0,C.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map(([t,r])=>{const d=l.find(e=>e.name===t);return d?(0,D.Y)(ds,{assessmentsType:e,assessmentName:t,assessmentHistory:r,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,options:a,inputs:i,assessmentInfo:d,assessmentInfos:l},t):(0,D.Y)("div",{css:cs},t)}),x&&(0,D.Y)(E.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:v,icon:(0,D.Y)(M.PlusIcon,{}),size:"small",children:(0,D.Y)(R.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),f&&(0,D.FD)(D.FK,{children:[(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)(as,{valueSuggestions:p,onCancel:h,onSave:({value:e,rationale:t,assessmentName:n})=>{var o;const r=c?A._1.OVERALL_ASSESSMENT:n||"",a=(0,A.aj)({name:null!==(o=null!==n&&void 0!==n?n:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:r,isOverallAssessment:c,value:e,rationale:t});s(a),h()}})]})]})};var ms={name:"49aokf",styles:"display:contents"};const ps=({assessmentsType:e,assessmentsByName:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:r=!1,options:a,inputs:i,assessmentInfos:l})=>{const{theme:d}=(0,E.u)(),c=(0,R.tz)(),u="overall"===e,{suggestions:p,editingAssessment:g,showUpsertForm:f,addAssessment:v,editAssessment:h,closeForm:y}=is(t.flatMap(([e,t])=>t),l);(0,m.useEffect)(()=>{y()},[i,y]);const x=t.filter(([e,t])=>t.length>0),b=Object.keys(x).length>0,S=o&&(r||!b);return(0,D.FD)(D.FK,{children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[x.map(([e,t])=>{const n=(0,s.first)(t),r=l.find(t=>t.name===e);if(!r)return(0,D.Y)(D.FK,{});const a=A.c9[e],i=a?c.formatMessage(a):e,d=Boolean(n&&(0,A.Zh)(n)),u=Boolean(n&&(0,A.CH)(n)),m=o&&(d||u)&&r.isEditable;return(0,D.Y)("div",{css:ms,children:(0,D.Y)(rs,{assessmentHistory:t,children:(0,D.Y)(Ft,{assessment:n,"aria-label":i,active:(null===g||void 0===g?void 0:g.name)===e&&f,disableJudgeTypeIcon:(0,A.xO)(n),onEdit:m?()=>{const e=(0,s.first)(t);e&&h(e)}:void 0,assessmentInfo:r,type:"assessment-value"})})},e)}),S&&(0,D.Y)(E.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:v,icon:(0,D.Y)(M.PlusIcon,{}),size:"small",children:(0,D.Y)(R.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),f&&(0,D.FD)(D.FK,{children:[(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)(as,{editedAssessment:g,valueSuggestions:p,onCancel:y,onSave:({value:e,rationale:t,assessmentName:s})=>{var o;const r=u?A._1.OVERALL_ASSESSMENT:s||"",a=(0,A.aj)({name:null!==(o=null!==s&&void 0!==s?s:null===g||void 0===g?void 0:g.name)&&void 0!==o?o:r,isOverallAssessment:u,value:e,rationale:t});n(a),y()}},null===g||void 0===g?void 0:g.name)]})]})},gs=({assessmentsType:e,assessmentsByName:t,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o=!1,allowMoreThanOne:r=!1,alwaysExpanded:a=!1,options:i,inputs:l,assessmentInfos:d})=>{const[c,u]=(0,m.useState)(!1),p=a||c,g=t.filter(([e,t])=>t.length>0);let f=t;"overall"!==e&&(f=t.filter(([e,t])=>e!==A._1.OVERALL_ASSESSMENT));const v=Object.keys(g).length>0;return(0,D.FD)(D.FK,{children:[p&&(0,D.Y)(us,{assessmentsType:e,assessmentsByName:f,rootCauseAssessment:n,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:r,options:i,inputs:l,assessmentInfos:d}),!p&&(0,D.Y)(ps,{assessmentsType:e,assessmentsByName:f,onUpsertAssessment:s,allowEditing:o,allowMoreThanOne:r,options:i,inputs:l,assessmentInfos:d}),v&&!a&&(0,D.FD)(D.FK,{children:[(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)(E.B,{size:"small",type:"tertiary",componentId:"overall"===e?"mlflow.evaluations_review.see_assessment_details_overall_button":"response"===e?"mlflow.evaluations_review.see_assessment_details_response_button":"mlflow.evaluations_review.see_assessment_details_retrieval_button",icon:p?(0,D.Y)(M.ChevronUpIcon,{}):(0,D.Y)(E.o,{}),onClick:()=>u(e=>!e),children:p?(0,D.Y)(R.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,D.Y)(R.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},fs=({toBeReviewed:e,containsOverallAssessment:t,isNextResultAvailable:n,overridingExistingReview:s,hasPendingAssessments:o,onClickNext:r,onSave:a,onCancelOverride:i})=>e?o?(0,D.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:a,children:(0,D.Y)(R.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):s?(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:i,children:(0,D.Y)(R.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,D.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:a,disabled:!t,children:(0,D.Y)(R.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,D.Y)(E.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:r,endIcon:(0,D.Y)(E.o,{}),disabled:!n,children:(0,D.Y)(R.sA,{id:"CBnbqy",defaultMessage:"Next"})}),vs=()=>{const{theme:e}=(0,E.u)();return(0,D.Y)("div",{css:(0,C.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var hs={name:"82a6rk",styles:"flex:1"},ys={name:"82a6rk",styles:"flex:1"};const xs=({evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:a,overridingExistingReview:i=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:p}=(0,E.u)(),g=(0,R.tz)();if(!e)return null;const f=(0,s.first)(e.overallAssessments),v=null===f||void 0===f||null===(m=f.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,h=v?(0,s.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[v]):void 0,y=!c&&(!(0,A.vP)(e)||i),x=g.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),b=[[A._1.OVERALL_ASSESSMENT,e.overallAssessments]],S=u.find(e=>e.name===A._1.OVERALL_ASSESSMENT);return(0,D.FD)("div",{css:hs,children:[(0,D.FD)("div",{css:(0,C.AH)({paddingLeft:p.spacing.md,paddingRight:p.spacing.md},""),children:[(0,D.FD)("div",{css:(0,C.AH)({backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:p.spacing.sm},""),children:[S&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:p.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.SparkleDoubleIcon,{color:"ai"}),(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,D.Y)(Ft,{assessment:f,"aria-label":A._1.OVERALL_ASSESSMENT,disableJudgeTypeIcon:(0,A.xO)(f),assessmentInfo:S,type:"assessment-value"})]}),(0,D.Y)(gs,{assessmentsType:"overall",assessmentsByName:b,rootCauseAssessment:h,onUpsertAssessment:t,allowEditing:y,alwaysExpanded:!0,options:[A._1.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,D.FD)("div",{css:(0,C.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,padding:p.spacing.sm},""),children:[(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,D.Y)(_.S,{size:"sm"}),(0,D.Y)(gs,{assessmentsType:"response",assessmentsByName:(0,A.Xe)(e.responseAssessmentsByName),onUpsertAssessment:t,allowEditing:y,allowMoreThanOne:!0,options:A.PB,assessmentInfos:u})]})]}),(0,D.FD)("div",{css:(0,C.AH)({position:"sticky",backgroundColor:p.colors.backgroundSecondary,padding:p.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:p.spacing.sm,zIndex:p.options.zIndexBase},""),children:[(0,D.Y)("div",{children:!y&&!c&&(0,D.FD)("div",{css:(0,C.AH)({border:`1px solid ${p.colors.border}`,borderRadius:p.general.borderRadiusBase,display:"flex",alignItems:"center",gap:p.spacing.sm,padding:`${p.spacing.xs}px ${p.spacing.sm}px`},""),children:[(0,D.Y)(M.CheckCircleIcon,{css:(0,C.AH)({color:p.colors.textValidationSuccess},"")}),(0,D.Y)(E.T.Hint,{children:(0,D.Y)(R.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,D.Y)(_.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:x,children:(0,D.Y)(E.B,{"aria-label":x,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,D.Y)(M.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,D.Y)("div",{css:ys}),l.length>0&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:p.spacing.sm},""),children:[(0,D.Y)(R.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:l.length}}),(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:r,children:(0,D.Y)(R.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,D.Y)(fs,{onSave:async()=>{await n(),d(!1)},containsOverallAssessment:Boolean(f),isNextResultAvailable:Boolean(a),onClickNext:o,toBeReviewed:y,hasPendingAssessments:l.length>0,overridingExistingReview:i,onCancelOverride:()=>d(!1)})]})]}),(0,D.Y)(_.S,{size:"md"})]})},bs=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:a,overridingExistingReview:i=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,D.Y)(xs,{evaluationResult:e,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:a,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:c,assessmentInfos:u}),t&&(0,D.FD)(D.FK,{children:[(0,D.Y)(vs,{}),(0,D.Y)(xs,{evaluationResult:t,onUpsertAssessment:n,onSavePendingAssessments:s,onClickNext:o,onResetPendingAssessments:r,isNextAvailable:a,overridingExistingReview:i,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:!0,assessmentInfos:u})]})]})},Ss=({requestId:e,onClose:t,trace:n})=>{const{theme:o}=(0,E.u)(),r=(0,D.Y)(E.T.Title,{level:2,withoutMargins:!0,children:e});return(0,D.Y)(M.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||t()},children:(0,D.Y)(M.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:r,expandContentToFullHeight:!0,children:(()=>{const e=n.data.spans.length>0;return(0,s.isNil)(n)||!e?(0,D.FD)(D.FK,{children:[(0,D.Y)(_.S,{size:"lg"}),(0,D.Y)(M.Empty,{description:null,title:(0,D.Y)(R.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,D.Y)("div",{css:(0,C.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,D.Y)(k.a8,{modelTrace:n})})})()})})};var As={name:"82a6rk",styles:"flex:1"};const ws=({experimentId:e,runDisplayName:t,evaluationResult:n,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:r,getTrace:a})=>{var i,l;const d=(0,R.tz)(),{theme:c}=(0,E.u)(),[u,p]=(0,m.useState)(null),g=null===(i=n.traceInfo)||void 0===i||null===(l=i.trace_metadata)||void 0===l?void 0:l["databricks.tracingserver.dropped_spans_size_bytes"];let f;if(!(0,s.isNil)(g)){const e=2,t=wt(Number(g),e);f=`${t.value} ${t.unit}`}return(0,D.FD)("div",{css:As,children:[(0,D.FD)("div",{css:(0,C.AH)({paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,D.Y)(E.T.Title,{level:4,children:t}),n.requestId&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&a&&(0,D.Y)(U,{experimentId:e,selectedTraces:[n],traceInfos:void 0}),(0,D.Y)(_.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${f}`:void 0,side:"left",children:(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>p(n.requestId),loading:r.isLoading,disabled:!(0,s.isNil)(g),children:(0,D.Y)(R.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,s.isNil)(r.data)?(0,D.Y)(D.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,D.Y)(Ss,{onClose:()=>{p(null)},requestId:u,trace:r.data}))]}),(0,D.Y)(_.S,{size:"md"})]})},Ys=({experimentId:e,runDisplayName:t,otherRunDisplayName:n,evaluationResult:s,otherEvaluationResult:o,exportToEvalsInstanceEnabled:r=!1,traceQueryResult:a,compareToTraceQueryResult:i})=>{const{theme:l}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[(0,D.Y)(ws,{experimentId:e,runDisplayName:t,evaluationResult:s,exportToEvalsInstanceEnabled:r,traceQueryResult:a}),n&&o&&(0,D.FD)(D.FK,{children:[(0,D.Y)(vs,{}),(0,D.Y)(ws,{experimentId:e,runDisplayName:n,evaluationResult:o,exportToEvalsInstanceEnabled:r,traceQueryResult:i})]})]})},Is=({value:e})=>{const t=(0,m.useMemo)(()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return null}return null},[e]);return(0,D.Y)("div",{css:(0,C.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:t?"monospace":void 0},""),children:t||String(e)})};var Ts={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},Cs={name:"1nko30q",styles:"margin-bottom:0 !important"},Es={name:"49aokf",styles:"display:contents"};const Ms=({fieldName:e,title:t,value:n,showCopyIcon:o})=>{const{theme:r}=(0,E.u)(),{makeHTML:a}=Ct(),i=(0,m.useMemo)(()=>(0,s.isString)(n)?a(n):null,[n,a]),l=(0,m.useMemo)(()=>(0,s.isString)(n)?null:(0,A.ng)(n),[n]);return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,flex:1,border:`1px solid ${r.colors.border}`,padding:r.spacing.md,borderRadius:r.general.borderRadiusBase,marginBottom:r.spacing.md},""),children:[(0,D.FD)("div",{css:Ts,children:[(0,D.Y)(E.T.Text,{bold:!0,children:t}),o&&(0,D.Y)(Fe.ad,{copyText:(0,A.ng)(n),componentId:"mlflow.evaluations_review.textbox.copy"})]}),(0,D.Y)(E.T.Paragraph,{css:Cs,children:(0,s.isString)(n)?(0,D.Y)("span",{css:Es,dangerouslySetInnerHTML:{__html:null!==i&&void 0!==i?i:""}}):e===A.UN&&Array.isArray(n)?(0,D.Y)("ul",{children:n.map((e,t)=>(0,D.Y)("li",{children:(0,D.Y)(Is,{value:e},t)},t))}):(0,D.Y)(Is,{value:l})})]})},Ns=({evaluationResult:e})=>{const{theme:t}=(0,E.u)(),{inputs:n}=e,s=Object.entries(n),o=0===s.length;return(0,D.FD)("div",{css:(0,C.AH)({width:"100%",paddingLeft:t.spacing.md,paddingRight:t.spacing.md},""),children:[(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:s.length}})}),(0,D.Y)(_.S,{size:"sm"}),o&&(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)(R.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),s.map(([e,t])=>(0,D.Y)(Ms,{fieldName:e,title:e,value:t},e))]})},_s=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,E.u)(),s=(null===e||void 0===e?void 0:e.inputsId)===(null===t||void 0===t?void 0:t.inputsId);return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,D.Y)(Ns,{evaluationResult:e}),!s&&t&&(0,D.Y)(Ns,{evaluationResult:t})]})};var Rs={name:"82a6rk",styles:"flex:1"},ks={name:"82a6rk",styles:"flex:1"};const Ds=({evaluationResult:e})=>{const{theme:t}=(0,E.u)(),{outputs:n,targets:s}=e,o=Object.entries(n).filter(([,e])=>!(0,A.Wp)(e)),r=Object.entries(s).filter(([,e])=>!(0,A.Wp)(e)),a=0===o.length&&0===r.length;return(0,D.FD)("div",{css:(0,C.AH)({paddingLeft:t.spacing.md,paddingRight:t.spacing.md,width:"100%"},""),children:[(0,D.Y)(E.T.Text,{bold:!0,children:(0,D.Y)(R.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,D.Y)(_.S,{size:"sm"}),a&&(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)(R.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:t.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,D.Y)("div",{css:Rs,children:o.map(([e,t])=>{const n=A.eB[e],s=n?(0,D.Y)(R.sA,{...n}):e;return(0,D.Y)(Ms,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)})}),r.length>0&&(0,D.Y)("div",{css:ks,children:r.map(([e,t])=>{const n=A.Au[e],s=n?(0,D.Y)(R.sA,{...n}):e;return(0,D.Y)(Ms,{fieldName:e,title:s,value:t,showCopyIcon:!0},e)})})]})]})},Fs=({evaluationResult:e,otherEvaluationResult:t})=>{const{theme:n}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",gap:n.spacing.sm},""),children:[e&&(0,D.Y)(Ds,{evaluationResult:e}),t&&(0,D.FD)(D.FK,{children:[(0,D.Y)(vs,{}),(0,D.Y)(Ds,{evaluationResult:t})]})]})},Os=({assessment:e,chunkRelevanceAssessmentInfo:t})=>{const{theme:n}=(0,E.u)();return e||t?(0,D.Y)("div",{css:(0,C.AH)({paddingLeft:n.spacing.sm,paddingRight:n.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:t?(0,u.x2)(n,t,e):"",borderRadius:n.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,D.Y)(D.FK,{children:(0,A.w_)(e)?(0,D.Y)(M.UserIcon,{}):(0,D.Y)(M.SparkleDoubleIcon,{})}):(0,D.Y)(M.QuestionMarkIcon,{})}):(0,D.Y)(D.FK,{})};function Ls(e){try{const t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(t){return!1}}var Hs={name:"s5xdrg",styles:"display:flex;align-items:center"};const Vs=({chunk:e,index:t})=>(0,D.FD)("div",{css:Hs,children:[(0,D.FD)(M.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",t+1]}),Ls(e.docUrl)?(0,D.Y)(E.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,D.Y)(E.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var Bs={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},$s={name:"49aokf",styles:"display:contents"};const Us=({evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:r,traceQueryResult:a})=>{const{theme:i}=(0,E.u)(),l=(0,R.tz)(),[d,c]=(0,m.useState)(0),{makeHTML:u}=Ct(),p=(0,m.useMemo)(()=>!(0,s.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:(0,$.nr)(e.responseAssessmentsByName,a.data),[e.responseAssessmentsByName,e.retrievalChunks,a.data]),g=(0,m.useMemo)(()=>{var e;return u(null===p||void 0===p||null===(e=p[d])||void 0===e?void 0:e.content)},[p,d,u]),f=0===(p||[]).length,v=!o&&(!(0,A.vP)(e)||n),h=null===p||void 0===p?void 0:p[d],y=l.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,D.FD)("div",{css:(0,C.AH)({paddingLeft:i.spacing.md,paddingRight:i.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":y,children:[(0,D.Y)(E.T.Text,{bold:!0,children:y}),(0,s.isNil)(p)&&a.isFetching?(0,D.Y)(M.TableSkeleton,{lines:3}):f?(0,D.Y)(E.T.Text,{children:(0,D.Y)("i",{children:(0,D.Y)(R.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,D.FD)("div",{css:(0,C.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:i.spacing.sm,border:`1px solid ${i.colors.border}`,borderRadius:i.general.borderRadiusBase},""),children:[(0,D.FD)("div",{css:(0,C.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:i.spacing.sm,borderRight:`1px solid ${i.colors.border}`},""),role:"listbox",children:[f&&(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)(R.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(p||[]).map((e,t)=>{var n,o;const a=r.find(e=>e.name===A._1.CHUNK_RELEVANCE);return(0,D.FD)("div",{role:"option","aria-label":null===(n=e.content)||void 0===n?void 0:n.slice(0,255),"aria-selected":t===d,css:(0,C.AH)({backgroundColor:t===d?i.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:i.colors.actionIconBackgroundHover},padding:`${i.spacing.sm}px ${i.spacing.md}px`,overflow:"hidden",display:"flex",gap:i.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(t)},children:[(0,D.Y)(Os,{chunkRelevanceAssessmentInfo:a,assessment:(0,s.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[A._1.CHUNK_RELEVANCE])}),(0,D.Y)(E.T.Text,{ellipsis:!0,css:(0,C.AH)({flex:1,lineHeight:i.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,t].join("-"))})]}),h&&(0,D.FD)("div",{css:Bs,children:[(0,D.FD)("div",{css:(0,C.AH)({padding:i.spacing.md,borderBottom:`1px solid ${i.colors.border}`},""),children:[(0,D.Y)(Vs,{chunk:h,index:d}),(0,D.Y)(_.S,{size:"md"}),(0,D.Y)(gs,{assessmentsType:"retrieval",assessmentsByName:(0,A.Xe)(h.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[A.bz.CHUNK_INDEX]=d,t(e)},allowEditing:v,allowMoreThanOne:!0,options:A.ER,inputs:[d],assessmentInfos:r})]}),(0,D.Y)("div",{css:(0,C.AH)({padding:i.spacing.md,overflow:"auto"},""),children:(0,D.Y)(E.T.Paragraph,{children:(0,D.Y)("span",{css:$s,dangerouslySetInnerHTML:{__html:null!==g&&void 0!==g?g:""}})})})]})]})]})},zs=({evaluationResult:e,otherEvaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s=!1,isReadOnly:o=!1,assessmentInfos:r,traceQueryResult:a,compareToTraceQueryResult:i})=>{const{theme:l}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[e&&(0,D.Y)(Us,{evaluationResult:e,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:r,traceQueryResult:a}),t&&(0,D.FD)(D.FK,{children:[(0,D.Y)(vs,{}),(0,D.Y)(Us,{evaluationResult:t,onUpsertAssessment:n,overridingExistingReview:s,isReadOnly:o,assessmentInfos:r,traceQueryResult:i})]})]})};var js={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const Ps=({evaluationResult:e})=>{const{theme:t}=(0,E.u)();return(0,D.Y)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,overflow:"hidden"},""),children:(0,D.Y)(E.T.Title,{level:2,withoutMargins:!0,css:js,children:(0,A.sw)(e)})})},Ks=({experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:o,onClickNext:r,runDisplayName:a,compareToRunDisplayName:i,isNextAvailable:l=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g})=>{(0,R.tz)();const{pendingAssessments:f,draftEvaluationResult:v,upsertAssessment:h,resetPendingAssessments:y}=(e=>{const[t,n]=(0,m.useReducer)((e,t)=>{switch(t.type){case"resetPendingAssessments":return[];case"upsertAssessment":const n=e.find(e=>e.name===t.payload.name&&(0,A.Pp)(e)===(0,A.Pp)(t.payload));return n?e.map(e=>e===n?""===(0,A.Zh)(e)&&t.payload.stringValue?{...t.payload,stringValue:"",name:t.payload.stringValue}:t.payload:e):[t.payload,...e]}},[]),o=(0,m.useMemo)(()=>{if(!e)return[];const n=t.find(A.hG);return n?[n,...e.overallAssessments]:e.overallAssessments},[e,t]),r=(0,m.useMemo)(()=>{if(!e)return{};const n=(0,s.uniq)([...Object.keys(e.responseAssessmentsByName),...t.filter(e=>!(0,A.hG)(e)&&!(0,A.II)(e)).map(e=>e.name)]);return Object.fromEntries(n.map(n=>{const s=t.filter(e=>e.name===n);return[n,[...s,...e.responseAssessmentsByName[n]||[]]]}))},[e,t]),a=(0,m.useMemo)(()=>{var n;const o=t.filter(A.II);return null===(n=e.retrievalChunks)||void 0===n?void 0:n.map((e,t)=>{var n;const r=o.filter(e=>{var n;return(null===(n=e.metadata)||void 0===n?void 0:n[A.bz.CHUNK_INDEX])===t}),a=(0,s.flatMap)(null!==(n=e.retrievalAssessmentsByName)&&void 0!==n?n:{}),i=(0,s.groupBy)([...r,...a],"name");return Object.keys(i).forEach(e=>{i[e]=(0,s.orderBy)(i[e],"timestamp","desc")}),{...e,retrievalAssessmentsByName:i}})},[t,e]),i=(0,m.useMemo)(()=>({...e,overallAssessments:o,responseAssessmentsByName:r,retrievalChunks:a}),[e,o,r,a]),l=(0,m.useCallback)(e=>n({type:"upsertAssessment",payload:e}),[]),d=(0,m.useCallback)(()=>n({type:"resetPendingAssessments"}),[]);return{pendingAssessments:t,draftEvaluationResult:i,upsertAssessment:l,resetPendingAssessments:d}})(t),[x,b]=(f.length,(0,m.useState)(!1)),S=Boolean(t.errorCode),w=Boolean(t.errorMessage),Y=S||w,[I,T]=(0,m.useState)(!1);return(0,D.FD)(D.FK,{children:[Y?(0,D.FD)(D.FK,{children:[(0,D.Y)(M.Alert,{action:w&&(0,D.Y)(E.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${I?"less":"more"}_button`,onClick:()=>T(e=>!e),children:I?(0,D.Y)(R.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,D.Y)(R.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:S?`${t.errorCode}`:"UNKNOWN_ERROR",description:I&&`${t.errorMessage}`,type:"error"}),(0,D.Y)(_.S,{size:"md"})]}):null,(0,D.Y)(Ys,{experimentId:e,runDisplayName:a,otherRunDisplayName:i,evaluationResult:t,otherEvaluationResult:n,exportToEvalsInstanceEnabled:c,traceQueryResult:p,compareToTraceQueryResult:g}),(0,D.Y)(bs,{evaluationResult:v,otherEvaluationResult:n,onUpsertAssessment:h,onClickNext:r,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(t,f)),y()},isNextAvailable:l,overridingExistingReview:x,setOverridingExistingReview:b,pendingAssessments:f,onResetPendingAssessments:y,isReadOnly:d,assessmentInfos:u}),(0,D.Y)(_s,{evaluationResult:t,otherEvaluationResult:n}),(0,D.Y)(Fs,{evaluationResult:t,otherEvaluationResult:n}),(0,D.Y)(zs,{evaluationResult:v,otherEvaluationResult:n,onUpsertAssessment:h,overridingExistingReview:x,isReadOnly:d,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g}),(0,D.Y)(_.S,{size:"lg"})]})};var Ws={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},qs={name:"1tc6xju",styles:"flex:1;overflow:auto"};const Gs=({experimentId:e,evaluation:t,otherEvaluation:n,className:s,runUuid:o,isReadOnly:r=!1,selectNextEval:a,isNextAvailable:i,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g,saveAssessmentsQuery:f})=>{const{theme:v}=(0,E.u)(),h=(0,m.useCallback)(async(e,t)=>{if(!e||r||!o||!f)return;const n=t.slice();if((0,A.ik)(e,t)){const t=(0,A.YZ)(e);t&&n.unshift(t)}return f.savePendingAssessments(o,e.evaluationId,n)},[o,r,f]),y=(0,m.useRef)(null);return(0,m.useEffect)(()=>{var e;null===(e=y.current)||void 0===e||e.scrollTo(0,0)},[t.evaluationId]),(0,D.FD)("div",{css:Ws,className:s,children:[(0,D.Y)("div",{css:qs,ref:y,children:(0,D.Y)(Ks,{experimentId:e,evaluationResult:t,otherEvaluationResult:n,onSavePendingAssessments:h,onClickNext:a,isNextAvailable:i,isReadOnly:r||!o,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:p,compareToTraceQueryResult:g},t.evaluationId)}),(null===f||void 0===f?void 0:f.isSaving)&&(0,D.Y)("div",{css:(0,C.AH)({inset:0,position:"absolute",backgroundColor:v.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:v.options.zIndexBase+1},""),children:(0,D.Y)(E.S,{size:"large",inheritColor:!0,css:(0,C.AH)({color:v.colors.backgroundPrimary},"")})})]})},Js=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=(0,B.UK)())&&void 0!==e&&e}},Qs=(0,m.createContext)(Js()),Zs=({config:e={},children:t})=>{const n=Js(),o=(0,s.merge)({},n,e);return(0,D.Y)(Qs.Provider,{value:o,children:t})};var Xs=n(12129);function eo(e,t,n){const o=(0,m.useMemo)(()=>{var e;if(t)return(0,k.gD)(t)?(0,$.mF)(t):null!==(e=t.request_id)&&void 0!==e?e:""},[t]),r=(0,m.useCallback)(t=>!e||(0,s.isNil)(o)?Promise.resolve(void 0):e(o,t),[e,o]);return(0,ae.I)({queryKey:["getTrace",o],queryFn:()=>r(t),enabled:!(0,s.isNil)(e)&&!(0,s.isNil)(o),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0,refetchInterval:!!n&&(e=>{var t,n,s,o;const r=e&&(0,k.gD)(e.info)?e.info:void 0;if("ERROR"===(null===r||void 0===r?void 0:r.state))return!1;if(!r||"IN_PROGRESS"===r.state)return 1e3;const a=null===(t=r.trace_metadata)||void 0===t?void 0:t["mlflow.trace.sizeStats"];if(!a)return!1;return JSON.parse(a).num_spans!==(null!==(n=null===e||void 0===e||null===(s=e.data)||void 0===s||null===(o=s.spans)||void 0===o?void 0:o.length)&&void 0!==n?n:0)&&1e3})})}const to=(e,t)=>!(!(0,k.ho)(e)||(null===t||void 0===t?void 0:t.fullTraceId)!==e)||(null===t||void 0===t?void 0:t.evaluationId)===e;var no={name:"inxa61",styles:"flex:1;overflow:hidden"};const so=m.memo(({experimentId:e,runUuid:t,evaluations:n,selectedEvaluationId:o,onChangeEvaluationId:r,runDisplayName:a,otherRunDisplayName:i,exportToEvalsInstanceEnabled:l=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var p,g,f,v,h,y,x;const{theme:b}=(0,E.u)(),[S,A]=(0,m.useState)(!1),w=(0,m.useCallback)(()=>{r(void 0)},[r]),Y=(0,m.useCallback)(e=>to(o,e.currentRunValue)||to(o,e.otherRunValue),[o]),I=(0,m.useMemo)(()=>n?(null===n||void 0===n?void 0:n.findIndex(Y))-1:void 0,[n,Y]),T=(0,m.useMemo)(()=>void 0!==I&&I>=0,[I]),N=(0,m.useMemo)(()=>n?(null===n||void 0===n?void 0:n.findIndex(Y))+1:void 0,[n,Y]),_=(0,m.useMemo)(()=>void 0!==N&&N<n.length,[N,n]),R=(0,m.useCallback)(()=>{var e,t,s,o;if(null===n||void 0===I)return;const a=(null===(e=n[I])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[I])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);r(a)},[n,I,r]),{renderExportTracesToDatasetsModal:F}=(0,k.SO)(),O=(0,m.useCallback)(()=>{var e,t,s,o;if(null===n||void 0===N)return;const a=(null===(e=n[N])||void 0===e||null===(t=e.currentRunValue)||void 0===t?void 0:t.evaluationId)||(null===(s=n[N])||void 0===s||null===(o=s.otherRunValue)||void 0===o?void 0:o.evaluationId);r(a)},[n,N,r]),L=(0,m.useMemo)(()=>null===n||void 0===n?void 0:n.find(Y),[n,Y]),H=(0,m.useMemo)(()=>N&&n?null===n||void 0===n?void 0:n[N]:void 0,[n,N]),V=(0,m.useMemo)(()=>I&&n?null===n||void 0===n?void 0:n[I]:void 0,[n,I]),B=(0,m.useContext)(Qs)||Js(),U=(0,$.ZZ)(null===L||void 0===L||null===(p=L.currentRunValue)||void 0===p?void 0:p.traceInfo)===$.Cf,z=eo(c,null===L||void 0===L||null===(g=L.currentRunValue)||void 0===g?void 0:g.traceInfo,U),j=eo(c,null===L||void 0===L||null===(f=L.otherRunValue)||void 0===f?void 0:f.traceInfo,U),P=(0,m.useMemo)(()=>Boolean(n)&&!L&&Boolean(o),[n,L,o]),K=((e,t)=>{const n=(0,m.useMemo)(()=>{if(t)return(e=>{if(!(0,k.ho)(e))return;const[,t,n]=e.split("/");return{trace_id:n,trace_location:t.includes(".")?(0,Xs.fi)(t):(0,Xs.$U)(t)}})(t)},[t]);return(0,ae.I)({queryKey:["getTrace",t],queryFn:()=>null===e||void 0===e?void 0:e(t,n),enabled:!(0,s.isNil)(e)&&!(0,s.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})})(c,P?o:void 0);eo(c,null===H||void 0===H||null===(v=H.currentRunValue)||void 0===v?void 0:v.traceInfo),eo(c,null===V||void 0===V||null===(h=V.currentRunValue)||void 0===h?void 0:h.traceInfo);const W=Boolean(null===L||void 0===L?void 0:L.currentRunValue)!==Boolean(null===L||void 0===L?void 0:L.otherRunValue),q=P?K:to(o,null===L||void 0===L?void 0:L.currentRunValue)?z:j;if((0,s.isNil)(L)&&!P)return(0,D.Y)(D.FK,{});const G=()=>{if(P){var e,t;if(K.isLoading)return(0,D.Y)(M.GenericSkeleton,{css:(0,C.AH)({width:200,height:b.general.heightBase},"")});if(null!==(e=K.data)&&void 0!==e&&e.info&&(0,k.gD)(null===(t=K.data)||void 0===t?void 0:t.info)){var n;const e=(0,$.ih)(null===(n=K.data)||void 0===n?void 0:n.info);return(0,D.Y)(Ps,{evaluationResult:e})}}return null!==L&&void 0!==L&&L.currentRunValue?(0,D.Y)(Ps,{evaluationResult:L.currentRunValue}):null!==L&&void 0!==L&&L.otherRunValue?(0,D.Y)(Ps,{evaluationResult:L.otherRunValue}):null},J=null===L||void 0===L||null===(y=L.currentRunValue)||void 0===y?void 0:y.traceInfo,Q=(0,D.FD)(D.FK,{children:[!(0,k.Z9)()&&!q.data&&q.isFetching&&(0,D.Y)(M.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:b.colors.backgroundPrimary}}),(P&&null!==K&&void 0!==K&&K.data||W)&&!(0,s.isNil)(q.data)?(0,D.Y)("div",{css:(0,C.AH)({height:"calc(100% - 34px)",marginLeft:-b.spacing.lg,marginRight:-b.spacing.lg},""),children:(0,D.Y)(ro,{traceData:q.data,showLoadingState:(0,k.Z9)()&&q.isFetching})}):(null===L||void 0===L?void 0:L.currentRunValue)&&((0,k.Z9)()&&q.isFetching?(0,D.Y)("div",{css:(0,C.AH)({marginLeft:-b.spacing.lg,marginRight:-b.spacing.lg},""),children:(0,D.Y)(k.Fn,{})}):(0,D.Y)("div",{css:(0,k.Z9)()?{overflow:"auto",height:"100%"}:{display:"contents"},children:(0,D.Y)(Gs,{experimentId:e,evaluation:L.currentRunValue,otherEvaluation:L.otherRunValue,selectNextEval:O,isNextAvailable:_,css:no,runUuid:t,isReadOnly:!B.enableRunEvaluationWriteFeatures,runDisplayName:a,compareToRunDisplayName:i,exportToEvalsInstanceEnabled:l,assessmentInfos:d,traceQueryResult:z,compareToTraceQueryResult:j,saveAssessmentsQuery:u})}))]});return(0,k.Z9)()?(0,D.Y)(k.RI,{handleClose:w,isNextAvailable:_,isPreviousAvailable:T,selectNextEval:O,selectPreviousEval:R,renderModalTitle:G,isLoading:q.isFetching,experimentId:e,traceInfo:J,children:Q}):(0,D.FD)(oo,{handleClose:w,isNextAvailable:_,isPreviousAvailable:T,selectNextEval:O,selectPreviousEval:R,renderModalTitle:G,isLoading:q.isFetching,children:[Q,null===F||void 0===F?void 0:F({experimentId:e,visible:S,setVisible:A,selectedTraceInfos:null!==L&&void 0!==L&&null!==(x=L.currentRunValue)&&void 0!==x&&x.traceInfo?[L.currentRunValue.traceInfo]:[]})]})}),oo=({selectPreviousEval:e,selectNextEval:t,isPreviousAvailable:n,isNextAvailable:s,renderModalTitle:o,handleClose:r,children:a,isLoading:i})=>{const{theme:l,classNamePrefix:d}=(0,E.u)();return(0,D.Y)("div",{onKeyDown:n=>{"ArrowLeft"===n.key?e():"ArrowRight"===n.key&&t()},children:(0,D.FD)(_.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:o(),onCancel:r,size:"wide",verticalSizing:"maxed_out",css:(0,C.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${d}-modal-body`]:{flex:1,paddingTop:0},[`& .${d}-modal-header`]:{paddingBottom:l.spacing.sm}},""),footer:null,children:[a,(0,D.Y)("div",{css:(0,C.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,D.Y)("div",{css:(0,C.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.legacyBorders.borderRadiusMd,marginRight:l.spacing.sm},""),children:(0,D.Y)(E.B,{disabled:!n,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,D.Y)(E.n,{}),onClick:()=>e()})})}),(0,D.Y)("div",{css:(0,C.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,D.Y)("div",{css:(0,C.AH)({backgroundColor:l.colors.backgroundPrimary,borderRadius:l.legacyBorders.borderRadiusMd,marginLeft:l.spacing.sm},""),children:(0,D.Y)(E.B,{disabled:!s,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,D.Y)(E.o,{}),onClick:e=>t()})})})]})})},ro=({traceData:e,showLoadingState:t})=>(0,D.Y)(k.a8,{modelTrace:e}),ao=m.memo(({experimentId:e,selectedColumns:t,evaluations:n,selectedEvaluationId:o,selectedAssessmentInfos:r,assessmentInfos:a,assessmentFilters:i,tableSort:l,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:f,rowSelection:v,setRowSelection:h,exportToEvalsInstanceEnabled:y=!1,getTrace:x,toggleAssessmentFilter:b,saveAssessmentsQuery:S,disableAssessmentTooltips:A,onTraceTagsEdit:w,enableRowSelection:Y,enableGrouping:I=!1,allColumns:T,displayLoadingOverlay:_})=>{const O=(0,R.tz)(),{theme:L}=(0,E.u)(),[V,B]=(0,m.useState)(!1),U=(0,m.useRef)(null),z=!(0,s.isNil)(g),K=t.filter(e=>e.type===P.$6.INPUT),{columns:W}=(0,m.useMemo)(()=>{if(!I){const n=t.map(t=>Tn(t,{evaluationInputs:K,isComparing:z,theme:L,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:w}));return{columns:X(n,t)}}const n=new Map;Z(t,z).forEach(t=>{const s=t.group||P.w8.INFO;n.has(s)||n.set(s,[]),(n.get(s)||[]).push(Tn(t,{evaluationInputs:K,isComparing:z,theme:L,intl:O,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:w}))});const s=Array.from(n.entries()).map(([e,t])=>({header:ns,meta:{groupId:e,visibleCount:t.length,totalCount:T.filter(t=>t.group===e).length,enableGrouping:I},id:`${e}-group`,columns:t}));return{columns:s}},[t,K,z,d,L,O,e,w,I,T]),{setTable:q,setSelectedRowIds:G}=m.useContext(F),J=(0,re.L)("js/packages/web-shared/src/genai-traces-table/GenAiTracesTableBody.tsx",{data:n,columns:W,getCoreRowModel:(0,se.HT)(),getSortedRowModel:(0,se.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:Y,enableMultiSort:!0,state:{rowSelection:v},meta:{getRunColor:c},onRowSelectionChange:h,getRowId:e=>(0,$.On)(e.currentRunValue)}),Q=(0,m.useCallback)((e,t)=>{var n;const s=e.getToggleSelectedHandler(),o=Boolean(null===t||void 0===t?void 0:t.shiftKey),r=null!==(n=J.getState().rowSelection)&&void 0!==n?n:{},a=e.getIsSelected(),i=a&&1===Object.keys(r).length&&r[e.id];if(!o||!U.current)return s(t),void(U.current=i?null:e.id);const l=J.getRowModel().rows,d=l.findIndex(e=>e.id===U.current),c=l.findIndex(t=>t.id===e.id);if(-1===d||-1===c)return s(t),void(U.current=i?null:e.id);const[u,m]=d<=c?[d,c]:[c,d],p={...r};for(let g=u;g<=m;g+=1){const e=l[g];e.getCanSelect()&&(a?delete p[e.id]:p[e.id]=!0)}J.setRowSelection(p),U.current=0===Object.keys(p).length?null:e.id},[J]),ee=void 0!==v&&J.getIsAllRowsSelected(),te=J.getIsSomeRowsSelected();(0,m.useEffect)(()=>(q(J),()=>q(void 0)),[J,q]),(0,m.useEffect)(()=>{Y&&G(J.getSelectedRowModel().rows.map(e=>e.id))},[J,v,G,Y]);const ne=O.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),ae=(0,D.Y)(M.Empty,{description:ne,image:(0,D.Y)(N.S,{})});(0,m.useEffect)(()=>{l&&!j.Al.includes(l.key)?l.key===j.yX?J.setSorting([{id:l.key,desc:!l.asc},{id:j.Te,desc:!1}]):J.setSorting([{id:l.key,desc:!l.asc}]):J.setSorting([])},[l,J]);const{rows:ie}=J.getRowModel(),le=m.useRef(null),de=(0,oe.Te)({count:ie.length,estimateSize:()=>120,getScrollElement:()=>le.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),ce=de.getVirtualItems(),ue=J.getHeaderGroups(),{columnSizeVars:me,tableWidth:pe}=(0,m.useMemo)(()=>{const e={};ue.forEach(t=>{t.headers.forEach(t=>{e[`--header-${At(t.column.id)}-size`]=t.getSize()+"px"})});let t=0;if(ie.length>0){ie[0].getVisibleCells().forEach(n=>{e[`--col-${At(n.column.id)}-size`]=n.column.getSize()+"px",t+=n.column.getSize()})}return{columnSizeVars:e,tableWidth:t+"px"}},[ue,ie]),ge=(0,m.useMemo)(()=>{const e={};for(const t of r)e[t.name]=mt(t,n,i);return e},[r,n,i]),fe=(0,m.useMemo)(()=>{if(!(0,k.eA)())return null;const e=(e,t)=>!(!(0,k.ho)(e)||(null===t||void 0===t?void 0:t.fullTraceId)!==e)||(null===t||void 0===t?void 0:t.evaluationId)===e;if(o){var t,s;const r=n.find(t=>e(o,t.currentRunValue)||e(o,t.otherRunValue));if(null!==r&&void 0!==r&&null!==(t=r.otherRunValue)&&void 0!==t&&t.fullTraceId&&null!==r&&void 0!==r&&null!==(s=r.currentRunValue)&&void 0!==s&&s.fullTraceId)return[r.currentRunValue.fullTraceId,r.otherRunValue.fullTraceId]}return null},[o,n]);return(0,D.FD)(D.FK,{children:[(0,D.Y)("div",{className:"container",ref:le,css:(0,C.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:pe},""),children:(0,D.FD)(M.Table,{css:(0,C.AH)({width:"100%",...me},""),empty:0===J.getRowModel().rows.length?ae:void 0,someRowsSelected:Y?te||ee:void 0,children:[(0,D.Y)(ts,{headerGroups:J.getHeaderGroups(),enableRowSelection:Y,enableGrouping:I,selectedAssessmentInfos:r,assessmentNameToAggregates:ge,assessmentFilters:i,toggleAssessmentFilter:b,runDisplayName:p,compareToRunUuid:g,compareToRunDisplayName:f,disableAssessmentTooltips:A,collapsedHeader:V,setCollapsedHeader:B,isComparing:z,allRowSelected:ee,someRowSelected:te,toggleAllRowsSelectedHandler:J.getToggleAllRowsSelectedHandler,setColumnSizing:J.setColumnSizing}),(0,D.Y)(Mn,{rows:ie,isComparing:z,enableRowSelection:Y,virtualItems:ce,virtualizerTotalSize:de.getTotalSize(),virtualizerMeasureElement:de.measureElement,rowSelectionState:v,selectedColumns:t,rowSelectionChangeHandler:Q})]})}),_&&(0,D.Y)("div",{css:(0,C.AH)({position:"absolute",inset:0,backgroundColor:L.colors.backgroundPrimary,opacity:.75,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,D.Y)(E.S,{size:"large"})}),fe&&(0,k.eA)()?(0,D.Y)(H,{traceIds:fe,onClose:()=>d(void 0)}):o&&(0,D.Y)(so,{experimentId:e,runUuid:u,runDisplayName:p,otherRunDisplayName:f,evaluations:ie.map(e=>e.original),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:y,assessmentInfos:a,getTrace:x,saveAssessmentsQuery:S})]})});function io({searchQuery:e,setSearchQuery:t,placeholder:n}){const s=(0,R.tz)(),[o,r]=(0,m.useState)(e);return(0,m.useEffect)(()=>{r(e)},[e]),(0,m.useEffect)(()=>{const e=setTimeout(()=>{t(o)},400);return()=>clearTimeout(e)},[o,t]),(0,D.Y)(M.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:null!==n&&void 0!==n?n:s.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:o,onChange:e=>r(e.target.value)})}const lo=({columns:e,selectedColumns:t,setSelectedColumns:n,setSelectedColumnsWithHiddenColumns:s})=>{const o=(0,R.tz)(),{theme:r}=(0,E.u)();return(0,D.FD)(M.DialogCombobox,{componentId:"mlflow.evaluations_overview.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,D.Y)(M.DialogComboboxCustomButtonTriggerWrapper,{children:(0,D.Y)(E.B,{endIcon:(0,D.Y)(M.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,D.Y)(M.DialogComboboxContent,{children:(0,D.Y)(M.DialogComboboxOptionList,{children:e.map(e=>(0,D.Y)(M.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some(t=>t.id===e.id),onChange:()=>(e=>{if(s)return s([e]);n&&n(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e)},e.id))})})]})};var co={name:"9q39xd",styles:"min-width:32px"};const uo=m.memo(({tableSort:e,columns:t=[],onChange:n,enableGrouping:s,isMetadataLoading:o,metadataError:r})=>{const a=(0,R.tz)(),{theme:i}=(0,E.u)(),[l,d]=(0,m.useState)(!1),c=(0,m.useMemo)(()=>{const e=[],n=a.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(s){const n=Z(t);for(const t of n)if(t.type===P.$6.ASSESSMENT){const n=t.assessmentInfo.displayName;e.push({label:n,key:t.id,type:P.$6.ASSESSMENT,group:P.w8.ASSESSMENT})}else if(t.type===P.$6.INPUT)e.push({label:t.label,key:t.id,type:P.$6.INPUT,group:P.w8.INFO});else if(t.type===P.$6.TRACE_INFO){const n=t.id===j.yX?a.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):t.label;j.My.includes(t.id)&&e.push({label:n,key:t.id,type:P.$6.TRACE_INFO,group:P.w8.INFO})}return e}for(const s of t.filter(e=>e.type===P.$6.ASSESSMENT)){const t=s.assessmentInfo.displayName;e.push({label:`${n} \ufe65 ${t}`,key:s.id,type:P.$6.ASSESSMENT})}const o=a.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const s of t.filter(e=>e.type===P.$6.INPUT))e.push({label:`${o} \ufe65 ${s.label}`,key:s.id,type:P.$6.INPUT});for(const s of t.filter(e=>(e.type===P.$6.TRACE_INFO||e.type===P.$6.INTERNAL_MONITOR_REQUEST_TIME)&&j.My.includes(e.id)))e.push({label:s.label,key:s.id,type:P.$6.TRACE_INFO});return e},[t,a,s]),u=(0,m.useMemo)(()=>{const t=c.find(t=>t.key===(null===e||void 0===e?void 0:e.key));let n=null===t||void 0===t?void 0:t.label;if(!n){var s;const t=null===e||void 0===e||null===(s=e.key)||void 0===s?void 0:s.match(/^.+\.`(.+)`$/);t&&(n=t[1])}const o=a.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return n?`${o}: ${n}`:o},[c,a,e]);return(0,D.FD)(M.DropdownMenu.Root,{open:l,onOpenChange:d,modal:!1,children:[(0,D.Y)(M.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,D.Y)(E.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,D.Y)(M.SortAscendingIcon,{}):(0,D.Y)(M.SortDescendingIcon,{}):(0,D.Y)(M.SortUnsortedIcon,{}),css:co,"aria-label":u,endIcon:(0,D.Y)(M.ChevronDownIcon,{}),children:u})}),(0,D.Y)(M.DropdownMenu.Content,{minWidth:250,children:r?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,D.Y)(E.k,{}),(0,D.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,D.Y)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.lg}px`,color:i.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,D.Y)(E.S,{size:"small"})}):s?(0,D.Y)(po,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}}):(0,D.Y)(vo,{sortOptions:c,tableSort:e,onOptionSelected:(e,t)=>{n(e,t),d(!1)}})})]})});var mo={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const po=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,E.u)(),o=(0,m.useRef)(null),r=(0,m.useRef)(null),[a,i]=(0,m.useState)(""),l=(0,m.useMemo)(()=>e.filter(e=>e.label.toLowerCase().includes(a.toLowerCase())),[e,a]),d=(0,m.useMemo)(()=>{const e={};return l.forEach(t=>{var n;const s=null!==(n=t.group)&&void 0!==n?n:P.w8.INFO;e[s]||(e[s]=[]),e[s].push(t)}),e},[l]),c=(0,m.useCallback)(s=>{var o;const r=e.find(e=>e.key===s);r&&n(r,null===(o=null===t||void 0===t?void 0:t.asc)||void 0===o||o)},[n,e,null===t||void 0===t?void 0:t.asc]),u=(0,m.useCallback)(s=>{var o;const r=null!==(o=e.find(e=>e.key===(null===t||void 0===t?void 0:t.key)))&&void 0!==o?o:e[0];n(r,s)},[n,e,null===t||void 0===t?void 0:t.key]);return(0,m.useEffect)(()=>{requestAnimationFrame(()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()})},[]),(0,D.FD)(D.FK,{children:[(0,D.FD)("div",{css:(0,C.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px`,display:"flex",gap:s.spacing.xs},""),children:[(0,D.Y)(N.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,D.Y)(N.S,{}),placeholder:"Search",value:a,onChange:e=>i(e.target.value),type:"search",onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(t=r.current)||void 0===t||t.focus(),e.preventDefault())}}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,D.Y)(M.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,D.Y)(M.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,D.Y)(M.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,D.Y)(M.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,D.FD)("div",{css:(0,C.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${s.spacing.sm}px`},""),children:[Object.entries(d).map(([e,n],s)=>(0,D.Y)(m.Fragment,{children:(0,D.FD)(M.DropdownMenu.Group,{children:[(0,D.Y)(M.DropdownMenu.Label,{children:e===P.w8.INFO?"Attributes":P.RF[e]}),n.map((e,n)=>(0,D.FD)(M.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===t||void 0===t?void 0:t.key),onClick:()=>c(e.key),ref:0===s&&0===n?r:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,D.Y)(M.DropdownMenu.ItemIndicator,{}),(0,D.Y)("span",{css:mo,children:e.label})]},e.key))]})},e)),0===l.length&&(0,D.Y)(M.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,D.Y)(R.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var go={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},fo={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const vo=({sortOptions:e,tableSort:t,onOptionSelected:n})=>{const{theme:s}=(0,E.u)(),o=(0,m.useRef)(null),[r,a]=(0,m.useState)(""),i=(0,m.useRef)(null),l=(0,m.useMemo)(()=>e.filter(e=>e.label.toLowerCase().includes(r.toLowerCase())),[e,r]),d=(0,m.useCallback)(s=>{const o=e.find(e=>e.key===s);n(o,(null===t||void 0===t?void 0:t.asc)||!0)},[n,t,e]),c=(0,m.useCallback)(s=>{const o=e.find(e=>e.key===(null===t||void 0===t?void 0:t.key));n(o||e[0],s)},[n,e,t]);return(0,m.useEffect)(()=>{requestAnimationFrame(()=>{var e;null===(e=o.current)||void 0===e||e.focus()})},[]),(0,D.FD)(D.FK,{children:[(0,D.FD)("div",{css:(0,C.AH)({padding:`${s.spacing.sm}px ${s.spacing.lg/2}px ${s.spacing.sm}px`,width:"100%",display:"flex",gap:s.spacing.xs},""),children:[(0,D.Y)(N.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,D.Y)(N.S,{}),value:r,type:"search",onChange:e=>a(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var t;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(t=i.current)||void 0===t||t.focus()}}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:s.spacing.xs},""),children:[(0,D.Y)(M.ToggleButton,{pressed:!1===(null===t||void 0===t?void 0:t.asc),icon:(0,D.Y)(M.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,D.Y)(M.ToggleButton,{pressed:!0===(null===t||void 0===t?void 0:t.asc),icon:(0,D.Y)(M.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,D.FD)(M.DropdownMenu.Group,{css:go,children:[l.map((e,n)=>(0,D.FD)(M.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===t||void 0===t?void 0:t.key),"data-testid":`sort-select-${e.label}`,ref:0===n?i:void 0,children:[(0,D.Y)(M.DropdownMenu.ItemIndicator,{}),(0,D.Y)("span",{css:fo,children:e.label})]},e.key)),!l.length&&(0,D.Y)(M.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,D.Y)(R.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},ho=({backgroundColor:e,icon:t,children:n})=>{const{theme:s}=(0,E.u)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:s.spacing.xs,borderRadius:s.borders.borderRadiusMd,color:s.colors.textSecondary,backgroundColor:e||s.colors.backgroundSecondary,fontSize:s.typography.fontSizeSm},""),children:[t||null,n?(0,D.Y)("span",{children:n}):null]})},yo="selectedEvaluationId",xo=()=>{var e;const[t,n]=v(),s=null!==(e=t.get(yo))&&void 0!==e?e:void 0,o=(0,m.useCallback)((e,t)=>{n(n=>{if(void 0===e)return n.delete(yo),n;if(t&&(0,Xs.ko)(t)){const e=(0,k.vX)(t);return n.set(yo,e),n}return n.set(yo,e),n})},[n]);return[s,o]},bo="searchQuery";var So=n(49633);const Ao="selectedColumns",wo=(e,t)=>t.filter(t=>!e.includes(t)).map(e=>e.id),Yo=(e,t)=>{let n=((e,t)=>t.filter(t=>!e.includes(t.id)))(e,t);if(n.length>10){const e=n.filter(e=>e.type===P.$6.ASSESSMENT),t=n.filter(e=>e.type!==P.$6.ASSESSMENT),s=n.length-10,o=Math.max(0,e.length-s);n=[...t,...e.slice(0,o)]}return wo(n,t)},Io=(e,t,n,s)=>{const o=(0,I.GK)(),[r,a]=(0,So.Mj)({key:`genaiTracesUIState-columns-${e}-${s}`,version:1,initialValue:void 0}),[i,l]=(()=>{const[e,t]=v();return[(0,m.useMemo)(()=>{const t=e.get(Ao);if(t)return t.split(",").filter(Boolean)},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(Ao),e&&e.length>0&&t.set(Ao,e.join(",")),t),{replace:n})},[t])]})(),d=(0,m.useMemo)(()=>((e,t)=>Yo(t?wo(t(e),e):[j.LV,j.FW,j.tj,j.$W],e))(t,n),[t,n]),c=(0,m.useMemo)(()=>{if(o&&i&&i.length>0){const e=new Set(i);return t.filter(t=>!e.has(t.id)).map(e=>e.id)}const e=new Set(d);return null!==r&&void 0!==r&&r.columnOverrides?(Object.entries(r.columnOverrides).forEach(([t,n])=>{n?e.delete(t):e.add(t)}),[...e]):d},[o,r,d,i,t]),u=(0,m.useCallback)(e=>{if(e.length&&(a(t=>{var n;const s={...null!==(n=null===t||void 0===t?void 0:t.columnOverrides)&&void 0!==n?n:{}};let o=!1;return e.forEach(e=>{const t=c.includes(e.id);s[e.id]!==t&&(s[e.id]=t,o=!0)}),o?{...t,columnOverrides:s}:t}),o)){const n=new Set(c);e.forEach(e=>{n.has(e.id)?n.delete(e.id):n.add(e.id)});const s=t.filter(e=>!n.has(e.id)).map(e=>e.id);l(s,!0)}},[o,a,c,t,l]),p=(0,m.useRef)(!1);return(0,m.useEffect)(()=>{if(o&&!p.current&&(!i||0===i.length)&&t.length>0){p.current=!0;const e=t.filter(e=>!c.includes(e.id)).map(e=>e.id);e.length>0&&l(e,!0)}},[o,i,c,t,l]),{hiddenColumns:c,toggleColumns:u}},To=(e,t,n,o)=>{const{hiddenColumns:r,toggleColumns:a}=Io(e,t,n,o),i=(0,m.useMemo)(()=>t.filter(e=>!r.includes(e.id)),[t,r]),l=(0,m.useCallback)(e=>{if((0,s.isNil)(e))return;const n=new Set(e.map(e=>e.id)),o=[];t.forEach(e=>{!r.includes(e.id)!==n.has(e.id)&&o.push(e)}),o.length&&a(o)},[t,r,a]);return{selectedColumns:i,toggleColumns:a,setSelectedColumns:l}};function Co(e,t,n,o,r){return e.filter(e=>function(e,t,n,s){const o=null===e||void 0===e?void 0:e.currentRunValue,r=null===e||void 0===e?void 0:e.otherRunValue;let a=!0;for(const u of t){var i,l;const e=u.assessmentName,t=u.filterValue,m=u.run,p=m===n?o:m===s?r:void 0;if(void 0===p)continue;const g=e===A._1.OVERALL_ASSESSMENT?null!==(i=p.overallAssessments)&&void 0!==i?i:[]:null!==(l=p.responseAssessmentsByName[e])&&void 0!==l?l:[];if("rca"===u.filterType){var d,c;const t=(null===p||void 0===p||null===(d=p.overallAssessments[0])||void 0===d||null===(c=d.rootCauseAssessment)||void 0===c?void 0:c.assessmentName)===e;a=a&&t}else{const e=void 0===t?0===g.length:t===nt?g.some(e=>Boolean(e.errorMessage)):g.some(e=>{var n;return(null!==(n=(0,A.Zh)(e))&&void 0!==n?n:void 0)===t});a=a&&e}}return a}(e,t,o,r)).filter(e=>{var t,o;if((0,s.isNil)(n)||""===n)return!0;const r=n.toLowerCase(),a=JSON.stringify(null===(t=e.currentRunValue)||void 0===t?void 0:t.inputs).toLowerCase().includes(r),i=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===r;return a||i})}var Eo={name:"1ykowef",styles:"margin-bottom:0"},Mo={name:"f3vz0n",styles:"font-weight:500"},No={name:"969shj",styles:"display:flex;flex:1;overflow-y:hidden;position:relative"};const _o=e=>{const{totalRowCount:t,sampledInfo:n}=e,o=(0,R.tz)();return n?n.maxAllowedCount?t>=n.maxAllowedCount?(0,D.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t}),children:(0,D.Y)(E.W,{color:"warning"})}):null:n.logCountLoading||(0,s.isNil)(n.sampledCount)||(0,s.isNil)(n.totalCount)?(0,D.Y)(E.S,{}):(0,D.Y)(ho,{children:(0,D.FD)(_.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:n.sampledCount,totalCount:n.totalCount,percentage:yt(n.sampledCount/n.totalCount)}),children:["Sampled ",yt(n.sampledCount/n.totalCount),"%"]})}):null},Ro="__any_value__";var ko={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const Do=m.memo(({assessmentName:e,assessmentInfo:t,assessmentLabel:n,assessmentFilter:s,updateAssessmentFilter:o,removeAssessmentFilter:r,run:a})=>{const i=(0,R.tz)(),{theme:l}=(0,E.u)(),d=s?S(s.filterValue):Ro;return(0,D.Y)("div",{css:ko,children:(0,D.FD)(M.SegmentedControlGroup,{name:"size-story",value:d,onChange:n=>{if(n.target.value===Ro)return void r(e,a);const s=b(t,n.target.value);o(e,s,a)},size:"middle",componentId:"mlflow.evaluations_review.table_ui.filter_control",children:[(0,D.Y)(M.SegmentedControlButton,{value:Ro,children:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:i.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(t.uniqueValues.values()).map(e=>{const{content:n,icon:s}=(0,A.uU)(i,l,t,e);return(0,D.Y)(M.SegmentedControlButton,{value:S(e),children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:[n,s]})},S(e))})]})})}),Fo=function({experimentId:e,currentEvaluationResults:t,compareToEvaluationResults:n,currentRunDisplayName:s,runUuid:o,compareToRunUuid:r,compareToRunDisplayName:a,compareToRunLoading:i,sampledInfo:l,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:p,defaultSortOption:g,disableAssessmentTooltips:f,onTraceTagsEdit:h,traceActions:x,initialSelectedColumns:w}){const{theme:I}=(0,E.u)(),T=(0,R.tz)(),_=(0,$.Co)(t),k=(0,$.Co)(n||[]),F=Object.keys(null!==x&&void 0!==x?x:{}).length>0,[O,L]=xo(),H=(0,m.useMemo)(()=>ne(_,k),[_,k]),[V,B]=(()=>{var e;const[t,n]=v();return[null!==(e=t.get(bo))&&void 0!==e?e:"",(0,m.useCallback)(e=>{n(t=>void 0===e||""===e?(t.delete(bo),t):(t.set(bo,e),t))},[n])]})(),z=(0,m.useMemo)(()=>at(T,_,k),[T,_,k]),K=(0,j.XS)(T,_,z,o),[W,q]=(e=>{const[t,n]=v();return[(0,m.useMemo)(()=>{var n;return(null!==(n=t.getAll(y))&&void 0!==n?n:[]).reduce((t,n)=>{const[s,o,r,a]=n.split("::"),i=null===e||void 0===e?void 0:e.find(e=>e.name===o);if(i){const e=b(i,r);t.push({run:s,assessmentName:o,filterValue:e,filterType:""===a?void 0:a})}return t},[])},[e,t]),(0,m.useCallback)((e,t=!1)=>{n(t=>(t.delete(y),e&&e.forEach(e=>{t.append(y,[e.run,e.assessmentName,S(e.filterValue),e.filterType].join("::"))}),t),{replace:t})},[n])]})(K.map(e=>e.assessmentInfo).filter(e=>void 0!==e)),G=(0,m.useMemo)(()=>""===V&&0===W.length?H:Co(H,W,V,s,a),[H,V,W,s,a]),{selectedColumns:J,toggleColumns:Q}=To(e,K,w,o),Z=(0,m.useMemo)(()=>it(J.filter(e=>e.type===P.$6.ASSESSMENT).map(e=>e.assessmentInfo)),[J]),X=K.find(e=>e.type===P.$6.ASSESSMENT&&e.id===A._1.OVERALL_ASSESSMENT),ee=(0,m.useMemo)(()=>g||(X?{key:X.id,type:P.$6.ASSESSMENT,asc:!0}:void 0),[g,X]),[te,se]=Y(),oe=(0,m.useMemo)(()=>{if(te){return J.some(e=>e.id===te.key)?te:ee}return ee},[te,J,ee]),re=(0,m.useCallback)(e=>{se(e,!1)},[se]),ae=(0,m.useCallback)((e,t)=>W.find(n=>n.assessmentName===e&&n.run===t),[W]),ie=(0,m.useCallback)((e,t)=>{q(W.filter(n=>n.assessmentName!==e||n.run!==t))},[W,q]),le=(0,m.useCallback)((e,t,n,s)=>{const o=W.find(t=>t.assessmentName===e&&t.run===n);q(void 0===o?[...W,{assessmentName:e,filterValue:t,filterType:s,run:n}]:W.map(n=>n.assessmentName===e?{...n,filterValue:t,filterType:s}:n))},[W,q]),de=(0,m.useCallback)((e,t,n,s)=>{const o=W.find(t=>t.assessmentName===e&&t.run===n);void 0===o?q([...W,{assessmentName:e,filterValue:t,filterType:s,run:n}]):o.filterValue===t&&o.filterType===s?q(W.filter(t=>t.assessmentName!==e||t.run!==n)):q(W.map(o=>o.assessmentName===e&&o.run===n?{assessmentName:e,filterValue:t,filterType:s,run:n}:o))},[W,q]),ce=(0,m.useCallback)(()=>{q([])},[q]),ue=W.length>0,[me,pe]=(0,m.useState)({}),ge=(0,m.useMemo)(()=>{const e=Object.keys(me).filter(e=>me[e]);return G.filter(t=>t.currentRunValue&&e.includes(t.currentRunValue.evaluationId)).map(e=>e.currentRunValue).filter(e=>void 0!==e)},[me,G]),fe={enableRunEvaluationWriteFeatures:p},ve=_.length;return i?(0,D.Y)(M.LegacySkeleton,{}):(0,D.Y)(Zs,{config:fe,children:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"row",gap:I.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flex:1,flexDirection:"column",gap:I.spacing.xs,overflow:"hidden"},""),children:[(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${I.spacing.xs}px 0px`},""),children:[(0,D.FD)(M.TableFilterLayout,{css:Eo,children:[(0,D.Y)(io,{searchQuery:V,setSearchQuery:B}),(0,D.FD)(M.DialogCombobox,{componentId:"mlflow.genai_traces_table.filter_dropdown",label:"Filters",value:Array.from(W).map(e=>e.assessmentName),multiSelect:!0,children:[(0,D.Y)(M.DialogComboboxCustomButtonTriggerWrapper,{children:(0,D.Y)(E.B,{endIcon:(0,D.Y)(M.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,C.AH)({border:ue?`1px solid ${I.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:ue?`${I.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:I.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.FilterIcon,{}),T.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:ue?` (${W.length})`:""}),W.length>0&&(0,D.Y)(N.X,{css:(0,C.AH)({fontSize:12,cursor:"pointer",color:I.colors.grey400,"&:hover":{color:I.colors.grey600}},""),onClick:e=>{ce(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,D.Y)(M.DialogComboboxContent,{children:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",padding:`${I.spacing.sm}px ${I.spacing.sm}px`,gap:I.spacing.md},""),children:Z.filter(e=>"numeric"!==e.dtype).map(e=>(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:I.spacing.sm},""),children:[(0,D.Y)("div",{css:Mo,children:e.displayName}),s&&(0,D.Y)(Do,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:ae(e.name,s),updateAssessmentFilter:le,removeAssessmentFilter:ie,run:s}),r&&a&&(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs},""),children:[(0,D.Y)(E.T.Hint,{children:a}),(0,D.Y)(Do,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:ae(e.name,a),updateAssessmentFilter:le,removeAssessmentFilter:ie,run:a})]})]},e.name))})})]}),(0,D.Y)(uo,{tableSort:oe,columns:K,onChange:(e,t)=>{re({key:e.key,type:e.type,asc:t})}}),(0,D.Y)(lo,{columns:K,selectedColumns:J,setSelectedColumnsWithHiddenColumns:Q}),(0,D.Y)(U,{experimentId:e,selectedTraces:ge,setRowSelection:pe,traceActions:x,traceInfos:void 0})]}),(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:I.spacing.sm},""),children:[(0,D.Y)(_o,{totalRowCount:ve,sampledInfo:l}),(0,D.Y)(E.T.Hint,{children:T.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:H.length,numFilteredEvals:G.length})})]})]}),(0,D.Y)("div",{css:(0,C.AH)({display:"flex",gap:I.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,D.Y)("div",{css:No,children:(0,D.Y)(ao,{experimentId:e,selectedColumns:J,allColumns:K,evaluations:G,selectedEvaluationId:O,selectedAssessmentInfos:Z,assessmentInfos:z,assessmentFilters:W,onChangeEvaluationId:L,tableSort:oe,runUuid:o,compareToRunUuid:r,runDisplayName:s,compareToRunDisplayName:a,enableRowSelection:F,rowSelection:F?me:void 0,setRowSelection:F?pe:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:de,saveAssessmentsQuery:u,disableAssessmentTooltips:f,onTraceTagsEdit:h})})})]})})})})},Oo=async({queryKey:[,{experimentId:e}]})=>pe("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),Lo=(e,t=!1)=>{var n;const{data:s,error:o,isLoading:r,isFetching:a}=(0,ae.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:Oo,enabled:!t,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:r,isFetching:a,runInfos:null===s||void 0===s||null===(n=s.runs)||void 0===n?void 0:n.map(e=>{var t,n;return{runUuid:null===(t=e.info)||void 0===t?void 0:t.run_uuid,runName:null===(n=e.info)||void 0===n?void 0:n.run_name}})}};var Ho=n(60062);const Vo=(e,t)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:t}],Bo=async({queryKey:[,{runUuid:e,artifactFile:t}]})=>{const n=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:t})].join("?");return pe(n,"GET").then(e=>({...e,filename:t}))},$o=[o.o8.Assessments,o.o8.Evaluations,o.o8.Metrics],Uo=({runUuid:e,artifacts:t=$o},{disabled:n=!1}={})=>{const i=!n&&$o.some(e=>t.includes(e)),l=(0,Ho.E)({queries:$o.map(s=>({queryFn:Bo,queryKey:Vo(e,s),enabled:!n&&t.includes(s),refetchOnWindowFocus:!1}))}),u=l.some(e=>e.isLoading),p=l.some(e=>e.isFetching),g=l.find(e=>e.error),[f,v,h]=l.map(e=>e.data),y=(0,m.useMemo)(()=>c(f),[f]),x=(0,m.useMemo)(()=>c(v),[v]),b=(0,m.useMemo)(()=>c(h),[h]),S=(0,m.useMemo)(()=>{if(x)return function(e,t,n){const i=(t||[]).reduce((e,t)=>{e[t.evaluation_id]||(e[t.evaluation_id]={});const{key:n,value:s,timestamp:o}=t;return e[t.evaluation_id][n]={key:n,value:s,timestamp:o},e},{}),l=(n||[]).reduce((e,t)=>{var n,o,r,a;return e[t.evaluation_id]||(e[t.evaluation_id]=[]),e[t.evaluation_id].push({booleanValue:(0,s.isNil)(t.boolean_value)?t.boolean_value:Boolean(t.boolean_value),numericValue:(0,s.isNil)(t.numeric_value)?t.numeric_value:Number(t.numeric_value),stringValue:(0,s.isNil)(t.string_value)?t.string_value:String(t.string_value),metadata:t.metadata||{},...t.error_code&&{errorCode:t.error_code},...t.error_message&&{errorMessage:t.error_message},name:t.name,rationale:t.rationale||null,source:{metadata:null!==(n=null===(o=t.source)||void 0===o?void 0:o.metadata)&&void 0!==n?n:{},sourceId:null===(r=t.source)||void 0===r?void 0:r.source_id,sourceType:null===(a=t.source)||void 0===a?void 0:a.source_type},timestamp:t.timestamp}),e},{});return e.map(e=>{var t,n;const c=(0,s.orderBy)(l[e.evaluation_id]||[],"timestamp","desc"),u=c.filter(r).map(e=>{var t,n,o,r;const a=null===(t=e.rationale)||void 0===t?void 0:t.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),i=a?null===(n=a[1])||void 0===n?void 0:n.trim():void 0,l=a?null===(o=a[2])||void 0===o?void 0:o.trim():void 0,d=a?null===(r=a[3])||void 0===r?void 0:r.trim():void 0;return e.rationale=l||e.rationale,{...e,rootCauseAssessment:(0,s.isNil)(i)?void 0:{assessmentName:i,suggestedActions:d}}});0===u.length&&u.push({name:o._1.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=c.filter(a),p=(0,s.difference)(c,u,m),g=(0,s.groupBy)(p,"name");return Object.keys(g).forEach(e=>{g[e]=(0,s.orderBy)(g[e],"timestamp","desc")}),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(t=e.outputs)&&void 0!==t?t:{},targets:null!==(n=e.targets)&&void 0!==n?n:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:u,responseAssessmentsByName:g,metrics:i[e.evaluation_id]||{},retrievalChunks:d(e.outputs,e.targets,m)}})}(x,b,y)},[y,x,b]);return{requestError:g,isLoading:u&&i,isFetching:p&&i,data:S}},zo="searchMlflowTraces",jo=({queryClient:e})=>{e.invalidateQueries({queryKey:[zo]})},Po={asc:!1,key:j.Te,type:P.$6.TRACE_INFO},Ko=({locations:e,runUuid:t,timeRange:n,otherRunUuid:s,filterByLoggedModelId:o,loggedModelId:r,sqlWarehouseId:a,disabled:i,networkFilters:l,filterByAssessmentSourceRun:d=!1})=>{const c=(0,R.tz)(),u=Jo(t,n,l,o),p=((null===e||void 0===e?void 0:e.some(e=>"UC_SCHEMA"===e.type))&&(0,B.F9)(),Qo(Po)),{data:g,isLoading:f,error:v}=Go({locations:e,filter:u,loggedModelId:r,sqlWarehouseId:a,enabled:!i,orderBy:p}),h=(0,m.useMemo)(()=>d?(0,$.p6)(g,t):g,[g,t,d]),y=Jo(s,n),{data:x,isLoading:b,error:S}=Go({locations:e,filter:y,enabled:!i&&Boolean(s),loggedModelId:r,sqlWarehouseId:a,orderBy:p}),A=(0,m.useMemo)(()=>d?(0,$.p6)(x,s):x,[x,s,d]),w=(0,m.useMemo)(()=>!h||f||v||!h.length?[]:h.map(e=>(0,$.ih)(e)),[h,f,v]),Y=(0,m.useMemo)(()=>{const e=b&&Boolean(s);return!A||e||S||!A.length?[]:A.map(e=>(0,$.ih)(e))},[A,b,S,s]),I=(0,m.useMemo)(()=>at(c,w||[],Y||[]),[c,w,Y]),T=(0,m.useMemo)(()=>{const e=new Map,t=new Map;return null===h||void 0===h||h.forEach(n=>{const s=n.trace_metadata;if(s){const t=s[he.A.sourceNameTag];t&&!e.has(t)&&e.set(t,{value:t,renderValue:()=>(0,D.Y)(_e,{traceInfo:n,isComparing:!1,disableLinks:!0})})}const o=n.tags;if(o&&o["mlflow.linkedPrompts"])try{const e=JSON.parse(o["mlflow.linkedPrompts"]);Array.isArray(e)&&e.forEach(e=>{const n=`${e.name}/${e.version}`;t.has(n)||t.set(n,{value:n,renderValue:()=>n})})}catch(r){}}),{source:Array.from(e.values()).sort((e,t)=>e.value.localeCompare(t.value)),prompt:Array.from(t.values()).sort((e,t)=>e.value.localeCompare(t.value))}},[h]),C=(0,j.XS)(c,w||[],I,t,void 0,!0);return(0,m.useMemo)(()=>({assessmentInfos:I,allColumns:C,totalCount:w.length,evaluatedTraces:w,otherEvaluatedTraces:Y,isLoading:f&&!i,error:v,isEmpty:0===w.length,tableFilterOptions:T}),[I,C,f,v,w,T,i,Y])},Wo=({locations:e,currentRunDisplayName:t,runUuid:n,timeRange:s,searchQuery:o,filters:r,disabled:a,pageSize:i,limit:l,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:p,filterByAssessmentSourceRun:g=!1})=>{const f=!1,{networkFilters:v,clientFilters:h}=(0,m.useMemo)(()=>((e,t=!0)=>e.reduce((e,n)=>(n.column===P.w8.ASSESSMENT&&(void 0===n.value||n.value===nt)||n.column===P.w8.ASSESSMENT&&t?e.clientFilters.push(n):e.networkFilters.push(n),e),{networkFilters:[],clientFilters:[]}))(r||[],f),[r,f]),y=Jo(n,s,v,d,o),x=Qo(c),{data:b,isLoading:S,isFetching:A,error:w,refetch:Y}=Go({locations:e,filter:y,enabled:!a,pageSize:i,limit:l,orderBy:x,loggedModelId:u,sqlWarehouseId:p}),I=(0,m.useMemo)(()=>{if(b)return b.map(e=>({currentRunValue:(0,$.ih)(e),otherRunValue:void 0}))},[b]),T=(0,m.useMemo)(()=>{if(!I)return;const e=void 0;if(!(h&&h.length>0))return I.reduce((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e},[]);const n=h.map(e=>({assessmentName:e.key||"",filterValue:e.value,run:t||""}));return Co(I,n||[],e,t,void 0).reduce((e,t)=>{var n;return null!==(n=t.currentRunValue)&&void 0!==n&&n.traceInfo&&e.push(t.currentRunValue.traceInfo),e},[])},[I,h,o,t,f]),C=(0,m.useMemo)(()=>g?(0,$.p6)(T,n):T,[T,n,g]);return a?{data:[],isLoading:!1,isFetching:!1}:{data:C,isLoading:S,isFetching:A,error:w||void 0,refetchMlflowTraces:Y}},qo=async({signal:e,locations:t,filter:n,pageSize:o,limit:r,orderBy:a,loggedModelId:i,sqlWarehouseId:l})=>{if((null===t||void 0===t?void 0:t.some(e=>"UC_SCHEMA"===e.type))&&(0,B.F9)())return k._A.searchTracesV4({signal:e,orderBy:a,locations:t,filter:n,pageSize:o});let d,c=[];const u=o||(0,B.Mq)(),m=r||(0,B.pR)();for(;c.length<m;){const o={locations:t,filter:n,max_results:u,order_by:a};i&&l&&(o.model_id=i,o.sql_warehouse_id=l),d&&(o.page_token=d);const r=await me(ge("ajax-api/3.0/mlflow/traces/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:e});if(!r.ok)throw(0,ue.Jg)(r);const m=await r.json(),p=m.traces;if((0,s.isNil)(p)||(c=c.concat(p)),d=m.next_page_token,!d)break}return c},Go=({locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:r,sqlWarehouseId:a,enabled:i,...l})=>{const d=(null===e||void 0===e?void 0:e.some(e=>"UC_SCHEMA"===e.type))&&(0,B.F9)(),c=(0,m.useMemo)(()=>d?{keepPreviousData:!0,refetchOnWindowFocus:!1}:{staleTime:1/0,cacheTime:1/0},[d]);return(0,ae.I)({...c,enabled:i,queryKey:[zo,{locations:e,filter:t,orderBy:o,loggedModelId:r,sqlWarehouseId:a,pageSize:n}],queryFn:({signal:i})=>qo({signal:i,locations:e,filter:t,pageSize:n,limit:s,orderBy:o,loggedModelId:r,sqlWarehouseId:a}),...l})},Jo=(e,t,n,s,o)=>{const r=[];if(e&&r.push(`attributes.run_id = '${e}'`),o&&r.push(`span.attributes.\`mlflow.spanInputs\` ILIKE '%${o}%'`),t){const e="attributes.timestamp_ms";t.startTime&&r.push(`${e} > ${t.startTime}`),t.endTime&&r.push(`${e} < ${t.endTime}`)}if(s&&r.push(`request_metadata."mlflow.modelId" = '${s}'`),n&&n.forEach(e=>{switch(e.column){case P.w8.TAG:if(e.key){const t="tags",n=e.key.includes(".")||e.key.includes(" ")?`${t}.\`${e.key}\``:`${t}.${e.key}`;r.push(`${n} ${e.operator} '${e.value}'`)}break;case j.tj:const t="attributes.execution_time_ms";r.push(`${t} ${e.operator} ${e.value}`);break;case j.$W:const n="attributes.status";r.push(`${n} = '${e.value}'`);break;case j.tP:r.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case j.li:r.push(`attributes.run_id = '${e.value}'`);break;case j.im:r.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case j.VC:r.push(`prompt = '${e.value}'`);break;case j.LV:r.push(`attributes.name ${e.operator} '${e.value}'`);break;case j.FW:r.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;case P.w8.ASSESSMENT:"undefined"!==e.value&&r.push(`feedback.\`${e.key}\` ${e.operator} '${e.value}'`);break;case P.w8.EXPECTATION:r.push(`expectation.\`${e.key}\` ${e.operator} '${e.value}'`);break;case j.Gq:"="===e.operator?r.push(`span.name ILIKE '${e.value}'`):"CONTAINS"===e.operator?r.push(`span.name ILIKE '%${e.value}%'`):r.push(`span.name ${e.operator} '${e.value}'`);break;case j.d6:case j.Rl:r.push(`${e.column} ${e.operator} '${e.value}'`);break;case j.Rb:"="===e.operator?r.push(`span.type ILIKE '${e.value}'`):"CONTAINS"===e.operator?r.push(`span.type ILIKE '%${e.value}%'`):r.push(`span.type ${e.operator} '${e.value}'`);break;case j.k0:"CONTAINS"===e.operator&&r.push(`span.content ILIKE '%${e.value}%'`);break;default:if(e.column.startsWith(j.rc)){const t=`request_metadata.${(0,$.v8)(e.column)}`;e.operator===P.dD.IS_NOT_NULL?r.push(`${t} IS NOT NULL`):e.operator===P.tl.CONTAINS?r.push(`${t} ILIKE '%${e.value}%'`):r.push(`${t} ${e.operator} '${e.value}'`)}}}),r.length>0)return r.join(" AND ")},Qo=e=>{if(e)switch(e.key){case j.tj:return["execution_time "+(e.asc?"ASC":"DESC")];case j.Te:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var Zo=n(884);var Xo={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},er={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const tr=({id:e,item:t,options:n,query:s,onChange:o,placeholder:r,width:a,canSearchCustomValue:i})=>{const{theme:l}=(0,E.u)(),[d,c]=(0,m.useState)(""),u=(0,m.useMemo)(()=>{var e,t;return null!==(e=null!==(t=null===s||void 0===s?void 0:s.data)&&void 0!==t?t:n)&&void 0!==e?e:[]},[null===s||void 0===s?void 0:s.data,n]),p=(0,m.useMemo)(()=>u.map(e=>e.value),[u]);return(0,D.FD)(M.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==t&&void 0!==t&&t.value?[t.value]:[],id:e,children:[(0,D.Y)(M.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:r,renderDisplayedValue:()=>{var e;return null!==(e=null===t||void 0===t?void 0:t.renderValue())&&void 0!==e?e:""},width:a,allowClear:!1}),(0,D.Y)(M.DialogComboboxContent,{width:a,style:{zIndex:l.options.zIndexBase+100},loading:null===s||void 0===s?void 0:s.isLoading,children:(0,D.Y)(M.DialogComboboxOptionList,{children:(0,D.FD)(M.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map(e=>(0,D.Y)(M.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===t||void 0===t?void 0:t.value),css:Xo,children:e.renderValue()},e.value)),i&&d&&!p.includes(d)?(0,D.FD)(M.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===t||void 0===t?void 0:t.value),css:er,children:['Use "',d,'"']},d):null]})})})]})};var nr={name:"833hqy",styles:"width:200px"};const sr=({index:e,tableFilter:t,assessmentInfos:n,onChange:s,experimentId:o,tableFilterOptions:r})=>{const a=(0,R.tz)(),{theme:i}=(0,E.u)(),l=`filter-value-${e}`,[d,c]=(0,m.useState)(t.value),u=(0,m.useCallback)(()=>{d!==t.value&&s({...t,value:d},e)},[t,e,s,d]),p=Lo(o),g=(0,m.useMemo)(()=>{var e,t;return{data:null===(e=p.runInfos)||void 0===e||null===(t=e.filter(e=>e.runUuid&&e.runName))||void 0===t?void 0:t.map(e=>({value:e.runUuid,renderValue:()=>e.runName})),isLoading:p.isLoading}},[p]),f=((e,t=!1)=>{const n=["EXPERIMENT_MODEL_VERSIONS",e],{data:s,isLoading:o,error:r}=(0,ae.I)({queryKey:n,queryFn:async()=>pe("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!t,refetchOnMount:!1,retry:!1});return{data:null===s||void 0===s?void 0:s.models,isLoading:o,error:r||void 0}})(o),v=(0,m.useMemo)(()=>{var e;return{data:null===(e=f.data)||void 0===e?void 0:e.map(e=>({value:e.info.model_id,renderValue:()=>e.info.name})),isLoading:f.isLoading}},[f]),h=[{value:"IN_PROGRESS",renderValue:()=>a.formatMessage(Re.IN_PROGRESS)},{value:"OK",renderValue:()=>a.formatMessage(Re.OK)},{value:"ERROR",renderValue:()=>a.formatMessage(Re.ERROR)}];var y,b;if(t.column===j.li)return(0,D.Y)(tr,{id:l,item:null===(y=g.data)||void 0===y?void 0:y.find(e=>e.value===t.value),query:g,onChange:n=>{s({...t,value:n},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(t.column===j.im)return(0,D.Y)(tr,{id:l,item:null===(b=v.data)||void 0===b?void 0:b.find(e=>e.value===t.value),query:v,onChange:n=>{s({...t,value:n},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(t.column===P.w8.ASSESSMENT){const o=n.find(e=>e.name===t.key);if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const n=Array.from(o.uniqueValues.values()).map(e=>({value:S(e),renderValue:()=>(0,A.uU)(a,i,o,e).content}));return o.containsErrors&&n.push({value:S(nt),renderValue:()=>(0,A.uU)(a,i,o,nt).content}),(0,D.Y)(tr,{id:l,item:n.find(e=>e.value===S(t.value)),options:n,onChange:n=>{s({...t,value:x(n)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(t.column===j.$W)return(0,D.Y)(tr,{id:l,item:h.find(e=>e.value===t.value),options:h,onChange:n=>{s({...t,value:n},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(t.column===j.FW){const n=r.source;return(0,D.Y)(tr,{id:l,item:n.find(e=>e.value===t.value),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}if(t.column===j.VC){const n=r.prompt||[];return(0,D.Y)(tr,{id:l,item:n.find(e=>e.value===t.value),options:n,onChange:n=>{s({...t,value:n},e)},placeholder:"Select prompt",width:200,canSearchCustomValue:!0})}return(0,D.Y)(N.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:l,placeholder:t.column===j.tj?"Time in milliseconds":"Value",type:t.column===j.tj?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:nr,disabled:t.column===P.w8.ASSESSMENT})};const or=(e,t)=>e===j.tj?[P.tl.EQUALS,P.tl.NOT_EQUALS,P.tl.GREATER_THAN,P.tl.LESS_THAN,P.tl.GREATER_THAN_OR_EQUALS,P.tl.LESS_THAN_OR_EQUALS]:e===j.Gq||e===j.Rb?[P.tl.EQUALS,P.tl.NOT_EQUALS,P.tl.CONTAINS]:e===j.k0?[P.tl.CONTAINS]:e===j.d6||e===j.Rl?[P.tl.RLIKE,P.tl.EQUALS]:[P.tl.EQUALS];var rr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ar={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ir={name:"1fttcpj",styles:"display:flex;flex-direction:column"},lr={name:"833hqy",styles:"width:200px"},dr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},cr={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ur={name:"1duj7gx",styles:"align-self:flex-end"};const mr=({tableFilter:e,index:t,onChange:n,onDelete:s,assessmentInfos:o,experimentId:r,tableFilterOptions:a,allColumns:i,usesV4APIs:l})=>{const{column:d,operator:c,key:u}=e,{theme:p}=(0,E.u)(),g=(0,m.useMemo)(()=>(e=>e?[j.tj,j.$W,j.LV,j.tP,j.li,j.im,j.FW,j.d6,j.Rl,j.VC]:[j.tj,j.$W,j.LV,j.tP,j.li,j.im,j.FW,j.VC])(l),[l]),f=(0,m.useMemo)(()=>o.filter(e=>"numeric"!==e.dtype).map(e=>({value:e.name,renderValue:()=>e.displayName})),[o]),v=(0,m.useMemo)(()=>{const e=i.slice().sort((e,t)=>{var n,s;return(null!==(n=e.filterOrder)&&void 0!==n?n:1)-(null!==(s=t.filterOrder)&&void 0!==s?s:1)}).filter(e=>g.includes(e.id)||e.id.startsWith(j.rc)).map(e=>({value:e.id,renderValue:()=>{var t;return null!==(t=e.filterLabel)&&void 0!==t?t:e.label}}));return e.push({value:P.w8.TAG,renderValue:()=>P.RF[P.w8.TAG]},{value:P.w8.ASSESSMENT,renderValue:()=>P.RF[P.w8.ASSESSMENT]}),l&&e.push({value:j.k0,renderValue:()=>"Span content"},{value:j.Gq,renderValue:()=>"Span name"},{value:j.Rb,renderValue:()=>"Span type"}),e},[i,l,g]);return(0,D.Y)(D.FK,{children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,D.FD)("div",{css:rr,children:[(0,D.Y)(M.FormUI.Label,{htmlFor:`filter-column-${t}`,children:(0,D.Y)(R.sA,{id:"OlytgO",defaultMessage:"Field"})}),(0,D.Y)(tr,{id:`filter-column-${t}`,item:v.find(e=>e.value===d),options:v,onChange:e=>{if(e!==d){const s=or(e)[0];n({column:e,operator:s,value:""},t)}},placeholder:"Select column",width:180,canSearchCustomValue:!1})]}),d===P.w8.ASSESSMENT&&(0,D.FD)("div",{css:ar,children:[(0,D.Y)(M.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,D.Y)(R.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,D.Y)(tr,{id:`filter-key-${t}`,item:f.find(e=>e.value===u),options:f,onChange:s=>{n({...e,key:s},t)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),d===P.w8.TAG&&(0,D.FD)("div",{css:ir,children:[(0,D.Y)(M.FormUI.Label,{htmlFor:`filter-key-${t}`,children:(0,D.Y)(R.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,D.Y)(N.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+t,type:"text",css:lr,placeholder:d===P.w8.TAG?"Key":"Name",value:u,onChange:s=>{n({...e,key:s.target.value},t)}})]}),(0,D.FD)("div",{css:dr,children:[(0,D.Y)(M.FormUI.Label,{htmlFor:`filter-operator-${t}`,children:(0,D.Y)(R.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(()=>{const s=""!==d&&1===or(d).length;return(0,D.Y)(M.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+t,placeholder:"Select",width:120,contentProps:{style:{zIndex:p.options.zIndexBase+100}},value:s?or(d)[0]:c,disabled:s,onChange:s=>{n({...e,operator:s.target.value},t)},children:or(d).map(e=>(0,D.Y)(M.SimpleSelectOption,{value:e,children:e},e))})})()]}),(0,D.FD)("div",{css:cr,children:[(0,D.Y)(M.FormUI.Label,{htmlFor:`filter-value-${t}`,children:(0,D.Y)(R.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,D.Y)(sr,{index:t,tableFilter:e,assessmentInfos:o,onChange:n,experimentId:r,tableFilterOptions:a})]}),(0,D.Y)("div",{css:ur,children:(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,D.Y)(M.CloseSmallIcon,{}),onClick:s})})]})})};const pr=({filters:e,setFilters:t,assessmentInfos:n,experimentId:s,tableFilterOptions:o,allColumns:r,isMetadataLoading:a,metadataError:i,usesV4APIs:l})=>{const d=(0,R.tz)(),{theme:c}=(0,E.u)(),u=e.length>0,p=(0,m.useCallback)(()=>{t([])},[t]);return(0,D.FD)(E.aw.Root,{componentId:"mlflow.genai_traces_table_filter.filter_dropdown",children:[(0,D.Y)(E.aw.Trigger,{asChild:!0,children:(0,D.Y)(E.B,{endIcon:(0,D.Y)(M.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,C.AH)({border:u?`1px solid ${c.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:u?`${c.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.FilterIcon,{}),d.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:u?` (${e.length})`:""}),u&&(0,D.Y)(N.X,{css:(0,C.AH)({fontSize:12,cursor:"pointer",color:c.colors.grey400,"&:hover":{color:c.colors.grey600}},""),onClick:()=>{p()}})]})})}),(0,D.Y)(E.aw.Content,{align:"start",css:(0,C.AH)({padding:c.spacing.md},""),children:i?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,D.Y)(E.k,{}),(0,D.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):a?(0,D.Y)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,D.Y)(E.S,{size:"small"})}):(0,D.Y)(vr,{filters:e,assessmentInfos:n,setFilters:t,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:l})})]})};var gr={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},fr={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const vr=({filters:e,assessmentInfos:t,setFilters:n,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:a})=>{const{theme:i}=(0,E.u)(),l=(e=>(0,Zo.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:P.tl.EQUALS,value:""}]}}))(e),{setValue:d,watch:c}=l,u=c("filters");return(0,D.Y)(Zo.Op,{...l,children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:i.spacing.lg,overflow:"auto"},""),children:[(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:u.map((e,n)=>(0,D.Y)(mr,{tableFilter:e,index:n,onChange:e=>{u[n]=e,d("filters",u)},onDelete:()=>{const e=[...u];e.splice(n,1),0===e.length&&e.push({column:"",operator:P.tl.EQUALS,value:""}),d("filters",e)},assessmentInfos:t,experimentId:s,tableFilterOptions:o,allColumns:r,usesV4APIs:a},e.column+e.operator+e.value+n))}),(0,D.Y)("div",{children:(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,D.Y)(M.PlusIcon,{}),onClick:()=>{d("filters",[...u,{column:"",operator:P.tl.EQUALS,value:""}])},children:(0,D.Y)(R.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,D.Y)("div",{css:gr,children:(0,D.Y)(E.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>n(u),css:fr,children:(0,D.Y)(R.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},hr=e=>e===P.w8.INFO?"Attributes":P.RF[e],yr=({columns:e=[],selectedColumns:t=[],toggleColumns:n,setSelectedColumns:s,isMetadataLoading:o=!1,metadataError:r})=>{const a=(0,R.tz)(),{theme:i}=(0,E.u)(),[l,d]=(0,m.useState)(""),c=(0,m.useMemo)(()=>{const t=Z(e),n={};return t.forEach(e=>{var t;const s=null!==(t=e.group)&&void 0!==t?t:P.w8.INFO;n[s]||(n[s]=[]),n[s].push(e)}),n},[e]),u=(0,m.useMemo)(()=>{if(!l.trim())return c;const e=l.trim().toLowerCase(),t={};return Object.entries(c).forEach(([n,s])=>{const o=hr(n).toLowerCase().includes(e),r=s.filter(t=>t.label.toLowerCase().includes(e));(o||r.length)&&(t[n]=o?s:r)}),t},[c,l]);return(0,D.FD)(M.DialogCombobox,{componentId:"mlflow.evaluations_overview_grouped.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,D.Y)(M.DialogComboboxCustomButtonTriggerWrapper,{children:(0,D.Y)(E.B,{endIcon:(0,D.Y)(M.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:i.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.ColumnsIcon,{}),a.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,D.Y)(M.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!r,children:r?(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:i.spacing.xs,padding:`${i.spacing.md}px`,color:i.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,D.Y)(E.k,{}),(0,D.Y)(R.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,D.Y)(M.DialogComboboxOptionList,{children:(0,D.Y)(M.DialogComboboxOptionListSearch,{controlledValue:l,setControlledValue:d,children:Object.entries(u).map(([e,o])=>(0,D.FD)(m.Fragment,{children:[(0,D.Y)(M.DialogComboboxSectionHeader,{children:hr(e)}),(0,D.Y)(M.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every(e=>t.some(t=>t.id===e.id)),onChange:()=>(e=>{if(e.every(e=>t.some(t=>t.id===e.id))){const n=t.filter(t=>!e.some(e=>e.id===t.id));s(n)}else{const n=[...t];e.forEach(e=>{n.some(t=>t.id===e.id)||n.push(e)}),s(n)}})(o),children:a.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:hr(e)})}),o.map(e=>(0,D.Y)(M.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:t.some(t=>t.id===e.id),onChange:()=>n([e]),children:e.label},e.id))]},e))})})})]})};var xr={name:"13qopiv",styles:"margin-bottom:0;flex:1"};const br=m.memo(e=>{const{searchQuery:t,setSearchQuery:n,filters:s,setFilters:o,tableSort:r,setTableSort:a,selectedColumns:i,toggleColumns:l,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:p,tableFilterOptions:g,traceActions:f,allColumns:v,countInfo:h,isMetadataLoading:y,usesV4APIs:x,metadataError:b,onRefresh:S,isRefreshing:A,addons:w}=e,{theme:Y}=(0,E.u)(),I=(0,R.tz)(),T=(0,m.useCallback)((e,t)=>{a({key:e.key,type:e.type,asc:t})},[a]);return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",width:"100%",alignItems:"flex-end",gap:Y.spacing.sm,paddingBottom:`${Y.spacing.xs}px`},""),children:[(0,D.FD)(M.TableFilterLayout,{css:xr,children:[(0,D.Y)(io,{searchQuery:t,setSearchQuery:n}),(0,D.Y)(pr,{filters:s,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:g,allColumns:v,isMetadataLoading:y,metadataError:b,usesV4APIs:x}),(0,D.Y)(uo,{tableSort:r,columns:i,onChange:T,enableGrouping:(0,B.ij)(),isMetadataLoading:y,metadataError:b}),(0,D.Y)(yr,{columns:v,selectedColumns:i,toggleColumns:l,setSelectedColumns:d,isMetadataLoading:y,metadataError:b}),f&&(0,D.Y)(U,{experimentId:u,traceActions:f,traceInfos:p}),S&&(0,D.Y)(_.T,{componentId:"mlflow.traces-table.refresh-button.tooltip",content:I.formatMessage({id:"kbWXwv",defaultMessage:"Refresh traces"}),children:(0,D.Y)(E.B,{componentId:"mlflow.traces-table.refresh-button",icon:(0,D.Y)(M.RefreshIcon,{}),onClick:S,loading:A,"aria-label":I.formatMessage({id:"0yvVF0",defaultMessage:"Refresh traces"})})}),w]}),(0,D.Y)(Sr,{countInfo:h})]})}),Sr=e=>{const{countInfo:t}=e,n=(0,R.tz)(),{theme:o}=(0,E.u)();return t.logCountLoading||(0,s.isNil)(t.currentCount)?(0,D.Y)(E.S,{size:"small"}):(0,D.FD)("div",{css:(0,C.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[t.currentCount>=t.maxAllowedCount&&(0,D.Y)(_.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:n.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:t.maxAllowedCount}),children:(0,D.Y)(E.W,{color:"warning"})}),(0,D.Y)(E.T.Hint,{children:n.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:t.currentCount>=t.maxAllowedCount?t.maxAllowedCount:t.currentCount,numEvals:t.totalCount>=t.maxAllowedCount?`${t.maxAllowedCount}+`:t.totalCount})})]})};var Ar=n(27763);var wr={name:"kj840c",styles:"flex:1;overflow-y:hidden;position:relative"};const Yr=m.memo(e=>{const{experimentId:t,currentTraceInfoV3:n,compareToTraceInfoV3:s,currentRunDisplayName:o,runUuid:r,compareToRunUuid:a,compareToRunDisplayName:i,setFilters:l,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:p,getTrace:g,onTraceTagsEdit:f,allColumns:v,getRunColor:h,enableRowSelection:y=!0,displayLoadingOverlay:x=!1}=e,{theme:b}=(0,E.u)(),S=(0,m.useMemo)(()=>(0,$.Co)(n.map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[n]),A=(0,m.useMemo)(()=>(0,$.Co)((s||[]).map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[s]),{rowSelection:w,setRowSelection:Y}=(0,Ar.F4)(),I=(0,m.useCallback)((e,t,n)=>{const s=d.find(t=>t.column===P.w8.ASSESSMENT&&t.key===e);void 0===s?l([...d,{column:P.w8.ASSESSMENT,key:e,operator:P.tl.EQUALS,value:t}]):s.value===t?l(d.filter(t=>!(t.column===P.w8.ASSESSMENT&&t.key===e))):l(d.map(n=>n.column===P.w8.ASSESSMENT&&n.key===e?{column:P.w8.ASSESSMENT,key:e,operator:P.tl.EQUALS,value:t}:n))},[d,l]),T=(0,m.useMemo)(()=>d.filter(e=>e.column===P.w8.ASSESSMENT).map(e=>({assessmentName:e.key||"",filterValue:e.value,run:o||$.kf})),[d,o]),[M,N]=xo(),_=(0,m.useMemo)(()=>it(c.filter(e=>e.type===P.$6.ASSESSMENT).map(e=>e.assessmentInfo)),[c]),R=(0,m.useMemo)(()=>ne(S,A),[S,A]),F=(0,m.useMemo)(()=>S.flatMap(e=>{var t,n;return null!==(t=null===e||void 0===e||null===(n=e.traceInfo)||void 0===n?void 0:n.assessments)&&void 0!==t?t:[]}),[S]);return(0,D.Y)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,D.Y)("div",{css:(0,C.AH)({display:"flex",gap:b.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,D.Y)("div",{css:wr,children:(0,D.Y)(k.Iw,{assessments:F,children:(0,D.Y)(ao,{experimentId:t,selectedColumns:c,allColumns:v,evaluations:R,selectedEvaluationId:M,selectedAssessmentInfos:_,assessmentInfos:p,assessmentFilters:T,onChangeEvaluationId:N,getRunColor:h,runUuid:r,compareToRunUuid:a,runDisplayName:o,compareToRunDisplayName:i,enableRowSelection:y,rowSelection:w,setRowSelection:Y,toggleAssessmentFilter:I,tableSort:u,getTrace:g,onTraceTagsEdit:f,enableGrouping:(0,B.ij)(),displayLoadingOverlay:x})})})})})}),Ir="filter",Tr=()=>{const[e,t]=v();return[(0,m.useMemo)(()=>{var t;return(null!==(t=e.getAll(Ir))&&void 0!==t?t:[]).reduce((e,t)=>{const[n,s,o,r]=t.split("::");if(!n||!s||!o)return e;const a=s;let i=o;return n===P.w8.ASSESSMENT&&(i=x(o)),e.push({column:n,key:r,operator:a,value:i}),e},[])},[e]),(0,m.useCallback)((e,n=!1)=>{t(t=>(t.delete(Ir),e&&e.forEach(e=>{let n=e.value;e.column===P.w8.ASSESSMENT&&(n=S(e.value)),t.append(Ir,[e.column,e.operator,n,e.key].join("::"))}),t),{replace:n})},[t])]};var Cr=n(19112);const Er='import mlflow\n\n@mlflow.trace\ndef chat_completion(message: str, user_id: str, session_id: str):\n    # Set these metadata keys to associate the trace to a user and session\n    mlflow.update_current_trace(\n        metadata={\n            "mlflow.trace.user": user_id,\n            "mlflow.trace.session": session_id,\n        }\n    )\n\n    # Replace with your chat logic\n    return "Your response here"\n\n# Depending on your setup, user and session IDs can be passed to your\n# server handler via the network request from your client applications,\n# or derived from some other request context. \nuser_id = "user-123"\nsession_id = "session-123"\n\nchat_completion("Hello, how are you?", user_id, session_id)';var Mr={name:"1blwlv5",styles:"flex:1;flex-direction:column;display:flex;align-items:center;justify-content:center"},Nr={name:"xvginl",styles:"max-width:600px"},_r={name:"bjn8wh",styles:"position:relative"};const Rr=()=>{const{theme:e}=(0,E.u)();return(0,D.FD)("div",{css:Mr,children:[(0,D.Y)(E.T.Title,{level:3,color:"secondary",children:(0,D.Y)(R.sA,{id:"Qsifda",defaultMessage:"Group traces from the same chat session together"})}),(0,D.FD)(E.T.Paragraph,{color:"secondary",css:Nr,children:[(0,D.Y)(R.sA,{id:"hkXDZn",defaultMessage:"MLflow allows you associate traces with users and chat sessions. This is useful for analyzing multi-turn conversations, enabling you to inspect what happened at each step. Copy the code snippet below to generate a sample trace, or visit the documentation for a more in-depth example."}),(0,D.Y)(E.T.Link,{componentId:"mlflow.chat_sessions.empty_state.learn_more_link",css:(0,C.AH)({marginLeft:e.spacing.xs},""),href:"https://mlflow.org/docs/latest/genai/tracing/track-users-sessions/",openInNewTab:!0,children:(0,D.Y)(R.sA,{id:"h2Ejm7",defaultMessage:"Learn more"})})]}),(0,D.FD)("div",{css:_r,children:[(0,D.Y)(Cr.VE,{componentId:"mlflow.chat_sessions.empty_state.example_code_copy",css:(0,C.AH)({position:"absolute",top:e.spacing.xs,right:e.spacing.xs},""),copyText:Er}),(0,D.Y)(Cr.z7,{language:"python",showLineNumbers:!0,children:Er})]})]})},kr=e=>{var t,n,s;const{experimentId:o,selectedSessions:r,traceActions:a,setRowSelection:i}=e,l=(0,R.tz)(),[d,c]=(0,m.useState)(!1),u=(0,m.useCallback)(()=>{c(!0)},[]),p=(0,m.useMemo)(()=>{const e=[];return r.forEach(t=>{e.push(...t.traces)}),e},[r]),g=(0,m.useMemo)(()=>(0,$.Co)(p.map(e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))),[p]),f=(0,m.useCallback)(async(e,t)=>{try{var n,s;await(null===a||void 0===a||null===(n=a.deleteTracesAction)||void 0===n||null===(s=n.deleteTraces)||void 0===s?void 0:s.call(n,e,t)),null===i||void 0===i||i({}),c(!1);const o=l.formatMessage({id:"KsYAUn",defaultMessage:"{count, plural, one {Session} other {{count} sessions}} deleted successfully"},{count:r.length}),d=l.formatMessage({id:"3vS6G9",defaultMessage:"{count, plural, one {# trace was} other {# traces were}} removed"},{count:t.length});(0,k.NH)(`${o}. ${d}.`)}catch(o){throw(0,k.ij)(l.formatMessage({id:"qmTNy1",defaultMessage:"Failed to delete sessions. Error: {error}"},{error:o instanceof Error?o.message:String(o)})),o}},[i,a,r.length,l]),v=Boolean(null===a||void 0===a?void 0:a.deleteTracesAction),h=Boolean(null===a||void 0===a?void 0:a.exportToEvals),y=0===r.length;if(!v&&!h)return null;const x=(0,D.Y)(E.B,{componentId:"mlflow.chat-sessions.actions-dropdown",endIcon:(0,D.Y)(M.ChevronDownIcon,{}),disabled:y,children:l.formatMessage({id:"MZNjYJ",defaultMessage:"Actions ({count})"},{count:r.length})});return(0,D.FD)(D.FK,{children:[(0,D.FD)(M.DropdownMenu.Root,{modal:!1,children:[(0,D.Y)(_.T,{componentId:"mlflow.chat-sessions.actions-dropdown-tooltip",content:y?l.formatMessage({id:"ogDiio",defaultMessage:"Select at least one session to enable actions"}):null===a||void 0===a||null===(t=a.deleteTracesAction)||void 0===t?void 0:t.disabledReason,children:(0,D.Y)(M.DropdownMenu.Trigger,{disabled:y,asChild:!0,children:x})}),(0,D.Y)(M.DropdownMenu.Content,{align:"end",children:v&&(0,D.FD)(D.FK,{children:[h&&(0,D.Y)(M.DropdownMenu.Separator,{}),(0,D.FD)(M.DropdownMenu.Group,{children:[(0,D.Y)(M.DropdownMenu.Label,{children:l.formatMessage({id:"kW6/lu",defaultMessage:"Edit"})}),(0,D.Y)(M.DropdownMenu.Item,{componentId:"mlflow.chat-sessions.delete-sessions",onClick:u,disabled:null===a||void 0===a||null===(n=a.deleteTracesAction)||void 0===n?void 0:n.isDisabled,disabledReason:null===a||void 0===a||null===(s=a.deleteTracesAction)||void 0===s?void 0:s.disabledReason,children:l.formatMessage({id:"SnPghu",defaultMessage:"Delete sessions"})})]})]})})]}),(0,D.Y)(V,{experimentIds:[o],visible:d,selectedTraces:g,handleClose:()=>c(!1),deleteTraces:f})]})},Dr=({columns:e,columnVisibility:t,setColumnVisibility:n,searchQuery:s,setSearchQuery:o,traceActions:r,experimentId:a,selectedSessions:i,setRowSelection:l,addons:d})=>{const{theme:c}=(0,E.u)(),u=(0,R.tz)();return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:c.spacing.sm},""),children:[(0,D.Y)(io,{searchQuery:s,setSearchQuery:o,placeholder:u.formatMessage({id:"W7HqWM",defaultMessage:"Search chat sessions by input"})}),(0,D.FD)(M.DialogCombobox,{componentId:"mlflow.chat-sessions.table-column-selector",label:(0,D.FD)("div",{css:(0,C.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,D.Y)(M.ColumnsIcon,{}),(0,D.Y)(R.sA,{id:"RWVGkL",defaultMessage:"Columns"})]}),multiSelect:!0,children:[(0,D.Y)(M.DialogComboboxTrigger,{}),(0,D.Y)(M.DialogComboboxContent,{children:(0,D.Y)(M.DialogComboboxOptionList,{children:Object.entries(t).map(([s,o])=>{var r;return(0,D.Y)(M.DialogComboboxOptionListCheckboxItem,{value:s,onChange:()=>{const e={...t};e[s]=!o,n(e)},checked:o,children:null===(r=e.find(e=>e.id===s))||void 0===r?void 0:r.header},s)})})})]}),r&&(0,D.Y)(kr,{experimentId:a,selectedSessions:i,traceActions:r,setRowSelection:l}),d]})};var Fr={name:"1bkbxg0",styles:"max-width:100%;overflow:hidden;cursor:pointer"};const Or=e=>{const{cell:t}=e,n=t.getValue();return(0,D.Y)(M.Tag,{componentId:"mlflow.genai-traces-table.session-tokens",children:n})};var Lr=n(42822);const Hr=[{id:"sessionId",header:"Session ID",accessorKey:"sessionId",cell:({row:e})=>{const t=e.original.sessionId;return(0,D.Y)(M.Tag,{componentId:"mlflow.chat-sessions.session-id-tag",color:"indigo",css:Fr,children:(0,D.Y)(E.T.Text,{ellipsis:!0,children:t})})},defaultVisibility:!0,enableSorting:!0,sortingFn:(e,t)=>e.original.sessionId.localeCompare(t.original.sessionId)},{id:"requestPreview",header:"Input",accessorKey:"requestPreview",defaultVisibility:!0},{id:"sessionStartTime",header:"Session start time",accessorKey:"sessionStartTime",defaultVisibility:!0,enableSorting:!0},{id:"sessionDuration",header:"Session duration",accessorKey:"sessionDuration",defaultVisibility:!0,enableSorting:!0},{id:"tokens",header:"Tokens",accessorKey:"tokens",defaultVisibility:!1,enableSorting:!0,cell:Or},{id:"turns",header:"Turns",accessorKey:"turns",defaultVisibility:!1,enableSorting:!0,cell:Or},{id:"source",header:"Source",cell:({row:e})=>{const t=e.original.firstTrace;return(0,D.Y)(_e,{traceInfo:t,isComparing:!1})},defaultVisibility:!1}];var Vr={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"},Br={name:"13ydc4a",styles:"display:flex;width:100%;height:100%;align-items:center;color:inherit !important;text-decoration:none"};const $r=m.memo(function({row:e,enableRowSelection:t,enableLinks:n=!0,openLinksInNewTab:s=!1}){const{search:o}=f(),{theme:r}=(0,E.u)();return(0,D.FD)(M.TableRow,{className:"eval-datasets-table-row",children:[t&&(0,D.Y)("div",{css:Vr,children:(0,D.Y)(M.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),onClick:e=>{e.stopPropagation()}})}),e.getVisibleCells().map(t=>(0,D.Y)(M.TableCell,{css:(0,C.AH)({flex:`calc(var(--col-${t.column.id}-size) / 100)`},""),children:n?(0,D.Y)(h,{to:{pathname:he.A.getExperimentChatSessionPageRoute(e.original.experimentId,e.original.sessionId),search:s?void 0:o},target:s?"_blank":void 0,rel:s?"noopener noreferrer":void 0,css:Br,children:(0,Cn.Kv)(t.column.columnDef.cell,t.getContext())}):(0,Cn.Kv)(t.column.columnDef.cell,t.getContext())},t.id))]},e.id)},function(){return!1});var Ur={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const zr=({experimentId:e,traces:t,isLoading:n,searchQuery:s,setSearchQuery:o,traceActions:r,enableRowSelection:a=!1,enableLinks:i=!0,openLinksInNewTab:l=!1,empty:d,toolbarAddons:c,onRowSelectionChange:u})=>{const{theme:p}=(0,E.u)(),g=(0,m.useMemo)(()=>(0,Lr.u)(e,t),[e,t]),[f,v]=(0,m.useState)([{id:"sessionStartTime",desc:!0}]),{rowSelection:h,setRowSelection:y}=(0,Ar.F4)();(0,m.useEffect)(()=>{null===u||void 0===u||u(h)},[h,u]);const{columnVisibility:x,setColumnVisibility:b}=(({experimentId:e,columns:t})=>{const n=(0,m.useMemo)(()=>t.reduce((e,t)=>(e[t.id]=t.defaultVisibility,e),{}),[t]),[s,o]=(0,So.Mj)({key:`experiment-chat-sessions-table-column-visibility-${e}`,version:1,initialValue:n});return{columnVisibility:s,setColumnVisibility:o}})({experimentId:e,columns:Hr}),S=a||Boolean(r),A=(0,re.S)({data:g,columns:Hr,getCoreRowModel:(0,se.HT)(),getSortedRowModel:(0,se.h5)(),onSortingChange:v,enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:S,onRowSelectionChange:y,getRowId:e=>e.sessionId,state:{sorting:f,columnVisibility:x,rowSelection:h}}),w=A.getState().columnSizingInfo,Y=m.useMemo(()=>{const e=A.getFlatHeaders(),t={};for(const n of e)t[`--col-${n.column.id}-size`]=n.column.getSize();return t},[w,A,x]),I=(0,m.useMemo)(()=>A.getSelectedRowModel().rows.map(e=>e.original),[h]),T=null!==d&&void 0!==d?d:(0,D.Y)(Rr,{});return(0,D.FD)("div",{css:(0,C.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,position:"relative",marginTop:p.spacing.sm},""),children:[(0,D.Y)(Dr,{columns:Hr,columnVisibility:x,setColumnVisibility:b,searchQuery:s,setSearchQuery:o,traceActions:r,experimentId:e,selectedSessions:I,setRowSelection:y,addons:c}),(0,D.FD)(M.Table,{style:{...Y},empty:n||0!==g.length?void 0:T,scrollable:!0,someRowsSelected:S?A.getIsAllRowsSelected()||A.getIsSomeRowsSelected():void 0,children:[(0,D.FD)(M.TableRow,{isHeader:!0,children:[S&&(0,D.Y)("div",{css:Ur,children:(0,D.Y)(M.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-header-checkbox",checked:A.getIsAllRowsSelected(),indeterminate:A.getIsSomeRowsSelected(),onChange:A.getToggleAllRowsSelectedHandler()})}),A.getLeafHeaders().map(e=>(0,D.Y)(M.TableHeader,{componentId:"mlflow.chat-sessions.table-header",header:e,column:e.column,sortable:e.column.getCanSort(),css:(0,C.AH)({cursor:e.column.getCanSort()?"pointer":"default",flex:`calc(var(--col-${e.id}-size) / 100)`},""),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),children:(0,Cn.Kv)(e.column.columnDef.header,e.getContext())},e.id))]}),!n&&A.getRowModel().rows.map(e=>(0,D.Y)($r,{row:e,enableRowSelection:S,enableLinks:i,openLinksInNewTab:l},e.id)),n&&(0,D.Y)(M.TableSkeletonRows,{table:A})]})]})};var jr=n(39595);const Pr="getTrace";function Kr(e,t){const n=(0,jr.jE)(),o=(0,Ho.E)({queries:(null!==t&&void 0!==t?t:[]).map(t=>{const n=function(e){var t;return(0,k.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""}(t);return{queryKey:[Pr,n],queryFn:async()=>null===e||void 0===e?void 0:e(n,t),enabled:!(0,s.isNil)(e)&&Boolean(n),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}})});return{data:(0,k.zk)((0,s.compact)(o.map(e=>e.data))),isLoading:o.some(e=>e.isLoading),invalidateSingleTraceQuery:(0,m.useCallback)(e=>{n.invalidateQueries({queryKey:[Pr,e]})},[n])}}},22558:function(e,t,n){n.d(t,{$:function(){return x}});var s=n(68248),o=n(46709),r=n(82716),a=n(27757),i=n(42747),l=n(83219),d=n(86125),c=n(21209),u=n(53915),m=n(94777),p=n(42401),g=n(81390),f=n(73408);var v={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},h={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},y={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const x=({node:e,renderMode:t})=>{const{theme:n}=(0,a.u)(),[x,b]=(0,o.useState)(!1),S=(0,o.useMemo)(()=>(0,d.g_)(e.inputs),[e]),A=(0,o.useMemo)(()=>(0,d.g_)(e.outputs),[e]),w=(0,d.bn)(e),Y=e.chatMessageFormat,I=w.length>0,T=S.length>0,C=A.length>0,{setSelectedNode:E,setActiveView:M,setShowTimelineTreeGantt:N}=(0,u.nJ)();return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,f.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,f.Y)(a.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:x?(0,f.Y)(r.ChevronDownIcon,{}):(0,f.Y)(a.o,{}),onClick:()=>b(!x),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,f.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:48,borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,f.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,f.FD)("div",{css:v,children:[(0,f.FD)("div",{css:h,children:[(0,f.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,f.Y)(i.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,f.Y)(m.o,{node:e})}})}),(0,f.Y)("span",{onClick:()=>{E(e),M("detail"),N(!0)},children:(0,f.Y)(a.T.Text,{css:y,color:"secondary",children:(0,g.X6)(e.end-e.start)})})]}),x&&(0,f.FD)("div",{children:[I&&(0,f.Y)(l.c,{node:e}),T&&(0,f.Y)(c.p,{sectionKey:"input",title:(0,f.Y)(i.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,f.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:S.map(({key:e,value:n},s)=>(0,f.Y)(p.B,{title:e,data:n,renderMode:t,chatMessageFormat:Y},e||s))})}),C&&(0,f.Y)(c.p,{sectionKey:"output",title:(0,f.Y)(i.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,f.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:A.map(({key:e,value:n})=>(0,f.Y)(p.B,{title:e,data:n,renderMode:t,chatMessageFormat:Y},e))})})]})]})]})}},25862:function(e,t,n){n.d(t,{q:function(){return a}});var s=n(82716),o=n(65072),r=n(73408);const a={Root:function({open:e,onOpenChange:t,modal:n=!1,children:o}){return(0,r.Y)(s.Drawer.Root,{modal:n,open:e,onOpenChange:t,children:o})},Content:function({children:e,title:t,width:n=320,componentId:a,footer:i,expandContentToFullHeight:l,useCustomScrollBehavior:d,disableOpenAutoFocus:c,hideClose:u,size:m,css:p}){const{isPanelOpen:g}=(0,o.w)(),f=g?"left":"right",v=g?"70vw":n;return(0,r.Y)(s.Drawer.Content,{componentId:a,width:v,title:t,position:f,footer:i,expandContentToFullHeight:l,useCustomScrollBehavior:d,disableOpenAutoFocus:c,hideClose:u,size:m,css:p,onInteractOutside:e=>{const t=e.target;(null===t||void 0===t?void 0:t.closest('[data-assistant-ui="true"]'))&&e.preventDefault()},children:e})}}},26059:function(e,t,n){var s=n(68248),o=n(76118),r=n(46709),a=n(25637),i=n(27556),l=n(27757),d=n(49633),c=n(73408);var u={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},m={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},p={name:"kjqqaz",styles:"width:0;position:relative"};const g=(0,r.forwardRef)((e,t)=>{var n;const{initialRatio:g,paneWidth:f,setPaneWidth:v,leftChild:h,leftMinWidth:y,rightChild:x,rightMinWidth:b,onRatioChange:S}=e,[A,w]=(0,r.useState)(!1),Y=(0,r.useRef)(null),I=null===(n=(0,d.wY)({ref:Y}))||void 0===n?void 0:n.width,T=(null!==I&&void 0!==I?I:1/0)-b,C=(0,r.useRef)(g),{theme:E}=(0,l.u)(),M=(0,r.useCallback)(e=>{I&&(C.current=e/I)},[I]),N=(0,i.YQ)(null!==S&&void 0!==S?S:()=>{},200),_=(0,r.useCallback)(()=>I,[I]);return(0,r.useImperativeHandle)(t,()=>({updateRatio:M,getContainerWidth:_})),(0,r.useLayoutEffect)(()=>{I&&v((0,o.clamp)(I*C.current,y,T))},[I,T,y,b,v]),(0,c.FD)("div",{ref:Y,css:m,children:[A&&(0,c.Y)(s.mL,{styles:u}),(0,c.Y)(a.ResizableBox,{axis:"x",width:f,css:(0,s.AH)({display:"flex",flex:`0 0 ${f}px`},""),handle:(0,c.Y)("div",{css:p,children:(0,c.Y)("div",{css:(0,s.AH)({position:"relative",width:E.spacing.sm,marginLeft:-E.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const n=(0,o.clamp)(t.width,y,T);v(n),I&&(C.current=n/I,N(C.current))},onResizeStart:()=>w(!0),onResizeStop:()=>w(!1),minConstraints:[y,1/0],maxConstraints:[T,1/0],children:h}),x]})});t.A=g},27763:function(e,t,n){n.d(t,{F4:function(){return a},Nf:function(){return l},Ss:function(){return i}});var s=n(46709),o=n(73408);const r=(0,s.createContext)(null),a=()=>{const e=(0,s.useContext)(r),[t,n]=(0,s.useState)({});return e||{rowSelection:t,setRowSelection:n}},i=()=>null!==(0,s.useContext)(r),l=({children:e,rowSelection:t,setRowSelection:n})=>(0,o.Y)(r.Provider,{value:{rowSelection:t,setRowSelection:n},children:e})},27882:function(e,t,n){n.d(t,{F9:function(){return r},GK:function(){return i},T9:function(){return o},Z9:function(){return l},aZ:function(){return a},eA:function(){return d},ny:function(){return s}});const s=()=>!1,o=()=>1e9,r=()=>!1,a=()=>!0,i=()=>!1,l=()=>!0,d=()=>!!l()},28993:function(e,t,n){n.d(t,{K:function(){return s}});const s=(0,n(24447).vt)(e=>({assessmentActions:{},resetCache:()=>e(()=>({assessmentActions:{}})),logAddedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"ADD",assessment:n}]}}:e),logRemovedAssessment:(t,n)=>e(e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"DELETE",assessment:n}]}}:e),reconstructAssessments:(e,t)=>{if(!t)return e;let n=[...e];return t.forEach(({action:e,assessment:t})=>{"ADD"===e&&t?n.unshift(t):"DELETE"===e&&t&&(n=n.filter(e=>e.assessment_id!==t.assessment_id))}),n}}))},31988:function(e,t,n){n.d(t,{u:function(){return a}});var s=n(82716),o=n(27757),r=n(73408);function a(e){return(0,r.Y)(o.B,{icon:(0,r.Y)(s.TrashIcon,{}),...e})}},33045:function(e,t,n){n.d(t,{u:function(){return l}});var s=n(76118),o=n(46709),r=n(86125),a=n(81390);const i=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},l=({treeNodes:e,selectedNode:t,setSelectedNode:n,setActiveTab:l,setExpandedKeys:d,modelTraceInfo:c})=>{var u;const[m,p]=(0,o.useState)(""),[g,f]=(0,o.useState)(()=>(e=>{const t={};e&&e.length>0&&(0,s.compact)((0,a.VC)(e).map(e=>e.type)).forEach(e=>{t[e]=!0});return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e)),[v,h]=(0,o.useState)(0),y=(0,o.useMemo)(()=>e.map(e=>e.key).join(","),[e]),{filteredTreeNodes:x,matches:b}=(0,o.useMemo)(()=>{if(!e||0===e.length)return{filteredTreeNodes:[],matches:[]};const t=e.map(e=>(0,r.vL)(e,m,g));return{filteredTreeNodes:t.flatMap(e=>e.filteredTreeNodes),matches:t.flatMap(e=>e.matches)}},[y,m,g,c]),S=(0,o.useMemo)(()=>(0,a.dM)(x),[x]),A=(0,o.useCallback)(e=>{if(e>=b.length||e<0)return;h(e);const t=b[e];n(t.span),l(i(t));const s=(0,a.NP)(t.span,S);d(e=>new Set([...e,...s]))},[b,n,l,S,d]),w=(0,o.useCallback)(()=>{A(v+1)},[v,A]),Y=(0,o.useCallback)(()=>{A(v-1)},[v,A]);return(0,o.useLayoutEffect)(()=>{if(0!==x.length){if(0===b.length){var e;const s=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(s in S)n(S[s]);else{const e=x[0];n(e),l(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}return}h(0),n(b[0].span),l(i(b[0]))}},[x,b,n]),{matchData:{match:null!==(u=b[v])&&void 0!==u?u:null,totalMatches:b.length,currentMatchIndex:v},searchFilter:m.toLowerCase().trim(),setSearchFilter:p,spanFilterState:g,setSpanFilterState:f,filteredTreeNodes:x,handleNextSearchMatch:w,handlePreviousSearchMatch:Y}}},33481:function(e,t,n){n.d(t,{_1:function(){return r},bz:function(){return o},o8:function(){return s}});let s=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),o=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),r=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({})},33669:function(e,t,n){n.d(t,{J:function(){return l}});var s=n(68248),o=n(76118),r=n(27757),a=n(93812),i=n(73408);function l({messages:e}){const{theme:t}=(0,r.u)();return(0,o.isNil)(e)?null:(0,i.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map((e,t)=>(0,i.Y)(a.X,{message:e},t))})}},41151:function(e,t,n){n.d(t,{M:function(){return i},e:function(){return a}});var s=n(46709),o=n(73408);const r=s.createContext({sqlWarehouseId:void 0,modelTraceInfo:void 0,invalidateTraceQuery:void 0,chatSessionId:void 0}),a=({sqlWarehouseId:e,modelTraceInfo:t,children:n,invalidateTraceQuery:a,chatSessionId:i})=>{const l=(0,s.useMemo)(()=>({sqlWarehouseId:e,modelTraceInfo:t,invalidateTraceQuery:a,chatSessionId:i}),[e,t,a,i]);return(0,o.Y)(r.Provider,{value:l,children:n})},i=()=>s.useContext(r)},42401:function(e,t,n){n.d(t,{s:function(){return b},B:function(){return S}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(42747),l=n(91461),d=n(73408);const c=({title:e,tools:t})=>{const{theme:n}=(0,a.u)();return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,d.Y)(a.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map(e=>(0,d.Y)(l.E,{tool:e},e.function.name))]})};var u=n(54625);const m=({title:e,documents:t})=>{const{theme:n}=(0,a.u)();return(0,d.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,d.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,d.Y)(a.T.Text,{bold:!0,children:e})}),t.map((e,o)=>(0,d.Y)("div",{css:(0,s.AH)({borderBottom:o!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,d.Y)(u.p,{text:e.page_content,metadata:e.metadata},o)},o))]})};var p=n(82716),g=n(73879);const f=({title:e,value:t})=>{const{theme:n}=(0,a.u)(),[o,l]=(0,r.useState)(!1),c=t.length>400,u=!o&&t.length>400?t.slice(0,400)+"...":t,m=c?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,d.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,d.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...m},""),onClick:()=>l(!o),children:[(0,d.Y)(a.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),c&&(o?(0,d.Y)(p.ChevronDownIcon,{}):(0,d.Y)(a.o,{}))]}),(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,d.Y)(g.V,{children:u}),c&&(0,d.Y)(a.T.Link,{onClick:()=>l(!o),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:o?(0,d.Y)(i.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,d.Y)(i.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})};var v=n(94664),h=n(86125),y=n(49425),x=n(33669);const b=3,S=({title:e,data:t,renderMode:n,chatMessageFormat:l,maxVisibleMessages:u=b})=>{const{theme:p}=(0,a.u)(),[g,S]=(0,r.useState)(!1),A=(0,r.useMemo)(()=>{try{return JSON.parse(t)}catch(e){return t}},[t]);(0,r.useEffect)(()=>{S(!1)},[t]);const w=(0,o.isString)(A)||(0,o.isNumber)(A)||(0,o.isBoolean)(A),Y=(0,h.Hq)(e?{[e]:A}:A,l),I=Array.isArray(A)&&A.length>0&&(0,o.every)(A,h.PC),T=Array.isArray(A)&&A.length>0&&(0,o.every)(A,h.W0);if(Y&&Y.length>0){const t=Y.length>u,n=g||!t?Y:Y.slice(-u),o=t?Y.length-n.length:0;return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:p.spacing.sm,padding:p.spacing.sm,border:`1px solid ${p.colors.border}`,borderRadius:p.borders.borderRadiusSm},""),children:[e&&(0,d.Y)(a.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,s.AH)({marginLeft:p.spacing.xs},""),children:e}),t&&(0,d.Y)(a.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:p.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>S(!g),children:g?(0,d.Y)(i.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,d.Y)(i.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:o}})}),(0,d.Y)(x.J,{messages:n})]})}return"json"===n?(0,d.Y)(y.C,{title:e,data:t,initialRenderMode:v.cC.JSON}):"text"===n?(0,d.Y)(y.C,{title:e,data:t,initialRenderMode:v.cC.TEXT}):w?(0,d.Y)(f,{title:e,value:String(A)}):I?(0,d.Y)(c,{title:e,tools:A}):T?(0,d.Y)(m,{title:e,documents:A}):(0,d.Y)(y.C,{title:e,data:t})}},42822:function(e,t,n){n.d(t,{j:function(){return a},u:function(){return i}});var s=n(76118),o=n(58663),r=n(19926);const a=e=>{const t={};return e.forEach(e=>{var n,s;const r=null===(n=e.trace_metadata)||void 0===n?void 0:n[o.n2];if(!r)return;const a=null!==(s=t[r])&&void 0!==s?s:[];t[r]=[...a,e]}),t},i=(e,t)=>{const n=a(t);return(0,s.compact)(Object.entries(n).map(([t,n])=>{if(0===n.length)return null;const a=(0,s.sortBy)(n,e=>new Date(e.request_time)),i=a[0],d=i.request_preview,c=a.reduce((e,t)=>{var n;return e+(null!==(n=(0,o.tI)(t))&&void 0!==n?n:0)},0);return{sessionId:t,requestPreview:d,firstTrace:i,experimentId:e,sessionStartTime:r.A.formatTimestamp(new Date(i.request_time)),sessionDuration:l(n),tokens:c,turns:a.length,traces:a}}))},l=e=>{const t=e.map(e=>e.execution_duration);if(t.some(e=>(0,s.isNil)(e)))return null;const n=t.map(e=>parseFloat(null!==e&&void 0!==e?e:"0"));if(n.some(e=>isNaN(e)))return null;const o=1e3*n.reduce((e,t)=>e+t,0);return r.A.formatDuration(o)}},45175:function(e,t,n){n.d(t,{V:function(){return a}});var s=n(68248),o=n(27757),r=n(73408);function a({children:e}){const{theme:t}=(0,o.u)();return(0,r.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e})}},45547:function(e,t,n){n.d(t,{w:function(){return b}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(82716),l=n(42747),d=n(94664),c=n(86125),u=n(21636),m=n(73408);const p=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:o})=>{const{theme:i}=(0,a.u)(),l=(0,r.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),d=(0,r.useMemo)(()=>e?(0,c.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:i.colors[u.kj],inactiveMatchBackgroundColor:i.colors[u.Bt],containsActiveMatch:o,activeMatch:n,scrollToActiveMatch:l}):[],[e,t,i,o,n,l]);return(0,m.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:i.colors.backgroundSecondary,padding:i.spacing.sm,fontSize:i.typography.fontSizeSm},""),children:d})};var g=n(73879),f=n(19112);const v=4,h=300;var y={name:"bjn8wh",styles:"position:relative"},x={name:"n31mhe",styles:"width:100%;padding:0"};function b({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:c=!1,renderMode:u=d.cC.JSON,initialExpanded:b=!1}){const S=Boolean(t)&&!(0,o.isNil)(n)&&e.toLowerCase().includes(t),{theme:A}=(0,a.u)(),[w,Y]=(0,r.useState)("json"===u),[I,T]=(0,r.useState)(b||S),C=(0,r.useRef)(null),E=(0,r.useMemo)(()=>{if("json"===u)return e;const t=JSON.parse(e);return(0,o.isString)(t)?t:e},[e,u]),M=w||E.split("\n").length>v||E.length>h,N=(0,r.useMemo)(()=>{if(M&&!I){const e=E.split("\n").slice(0,v).join("\n");return e.length>h?e.slice(0,h):e}return E},[E,M,I]);(0,r.useEffect)(()=>{C.current&&Y(C.current.scrollWidth>C.current.clientWidth)},[u,e]);const _=(0,r.useCallback)(e=>(0,m.Y)("pre",{...e,ref:C}),[]);return S?(0,m.Y)(p,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&c}):(0,m.FD)("div",{css:y,children:["markdown"===u?(0,m.Y)("div",{css:(0,s.AH)({padding:A.spacing.md,backgroundColor:A.colors.backgroundSecondary,marginBottom:-A.spacing.md},""),children:(0,m.Y)(g.V,{children:N})}):(0,m.FD)(m.FK,{children:[(0,m.Y)(f.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:A.spacing.xs,right:A.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,m.Y)(f.z7,{PreTag:_,showLineNumbers:!0,language:u,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:I,theme:A.isDarkMode?"duotoneDark":"light",style:{backgroundColor:A.colors.backgroundSecondary,padding:A.spacing.sm,paddingBottom:M?0:A.spacing.sm,paddingRight:2*A.spacing.md,overflow:I?"auto":"hidden",textOverflow:"ellipsis",fontSize:A.typography.fontSizeSm,lineHeight:A.typography.lineHeightBase},children:N})]}),M&&(0,m.Y)("div",{css:(0,s.AH)({backgroundColor:A.colors.backgroundSecondary},""),children:(0,m.Y)(a.B,{css:x,componentId:I?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:I?(0,m.Y)(i.ChevronUpIcon,{}):(0,m.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>T(!I),children:I?(0,m.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,m.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}},47784:function(e,t,n){n.d(t,{l:function(){return d}});var s=n(68248),o=n(46709),r=n(27757),a=n(21209),i=n(42401),l=n(73408);const d=({title:e,data:t,renderMode:n,sectionKey:d,maxVisibleItems:c=3,maxVisibleChatMessages:u=i.s,className:m,chatMessageFormat:p})=>{const{theme:g}=(0,r.u)(),[f,v]=(0,o.useState)(!1),h=t.length>c,y=h&&!f?t.slice(-c):t,x=h?t.length-y.length:0;return(0,l.Y)(a.p,{withBorder:!0,title:e,className:m,sectionKey:d,children:(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:g.spacing.sm},""),children:[h&&(0,l.Y)(r.T.Link,{css:(0,s.AH)({alignSelf:"flex-start",marginLeft:g.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>v(!f),children:f?"Show less":`Show ${x} more`}),y.map(({key:e,value:t},s)=>(0,l.Y)(i.B,{title:e,data:t,renderMode:n,chatMessageFormat:p,maxVisibleMessages:u},e||s))]})})}},49425:function(e,t,n){n.d(t,{C:function(){return x}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(82716),l=n(94664),d=n(45547),c=n(21636),u=n(73408);const m=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:o}=(0,a.u)(),i=(0,r.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),l=e.toLowerCase();if(!l.includes(t))return(0,u.Y)("div",{children:e});const d=l.indexOf(t),m=d+t.length,p=n?o.colors[c.kj]:o.colors[c.Bt];return(0,u.FD)("div",{children:[e.slice(0,d),(0,u.Y)("span",{ref:n?i:null,css:(0,s.AH)({backgroundColor:p,scrollMarginTop:50},""),children:e.slice(d,m)}),e.slice(m)]})};function p(e,t){return t||(e?l.cC.MARKDOWN:l.cC.JSON)}function g(e){switch(e){case l.cC.JSON:return"JSON";case l.cC.TEXT:return"Text";case l.cC.MARKDOWN:return"Markdown";case l.cC.PYTHON:return"Python"}}var f={name:"bjn8wh",styles:"position:relative"},v={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},h={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},y={name:"2fp7nl",styles:"height:min-content;margin:0"};function x({title:e,tokens:t,data:n,searchFilter:c="",activeMatch:x=null,containsActiveMatch:b=!1,initialRenderMode:S}){var A;const w=(0,r.useMemo)(()=>JSON.parse(n),[n]),Y=(0,o.isString)(w),{theme:I}=(0,a.u)(),[T,C]=(0,r.useState)(p(Y,S)),E=b&&null!==(A=null===x||void 0===x?void 0:x.isKeyMatch)&&void 0!==A&&A,M=Y&&!c;return(0,r.useEffect)(()=>{C(p(Y,S))},[Y,S]),(0,u.Y)("div",{css:f,children:(0,u.FD)("div",{css:(0,s.AH)({borderRadius:I.borders.borderRadiusSm,border:`1px solid ${I.colors.border}`,overflow:"hidden"},""),children:[(e||M)&&(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:I.spacing.sm},""),children:[(0,u.Y)(a.T.Title,{css:v,level:4,color:"secondary",withoutMargins:!0,children:(0,u.Y)(m,{title:e,searchFilter:c,isActiveMatch:E})}),(0,u.Y)("div",{css:h,children:M&&(0,u.FD)(i.DropdownMenu.Root,{children:[(0,u.Y)(i.DropdownMenu.Trigger,{asChild:!0,children:(0,u.Y)(i.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:y,children:(0,u.FD)("div",{css:(0,s.AH)({paddingLeft:I.spacing.xs,marginRight:I.spacing.xs,cursor:"pointer"},""),children:[(0,u.Y)(a.T.Text,{size:"sm",color:"secondary",children:g(T)}),(0,u.Y)(i.ChevronDownIcon,{})]})})}),(0,u.FD)(i.DropdownMenu.Content,{children:[(0,u.Y)(i.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:T,onValueChange:e=>C(e),children:Object.values(l.cC).map(e=>e===l.cC.PYTHON?null:(0,u.FD)(i.DropdownMenu.RadioItem,{value:e,children:[(0,u.Y)(i.DropdownMenu.ItemIndicator,{}),g(e)]},e))}),(0,u.Y)(i.DropdownMenu.Arrow,{})]})]})})]}),(0,u.Y)(d.w,{data:n,searchFilter:c,activeMatch:x,containsActiveMatch:b,renderMode:T})]})})}},49633:function(e,t,n){n.d(t,{Mj:function(){return i.Mj},Ub:function(){return r},wY:function(){return a.w}});var s=n(46709),o=n(69103);function r(e){return function(e){return(0,o.useSyncExternalStore)(s.useCallback(t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)}),[e]),()=>e.matches)}(s.useMemo(()=>window.matchMedia(e),[e]))}var a=n(27925),i=n(53637)},50103:function(e,t,n){n.d(t,{b:function(){return v}});var s=n(68248),o=n(46709),r=n(82716),a=n(27757),i=n(79081),l=n(42747),d=n(52489),c=n(97447),u=n(110),m=n(21636),p=n(73408);var g={name:"mqlsmr",styles:"font-size:12px;display:flex"},f={name:"rnnx2x",styles:"font-size:12px"};const v=({experimentId:e,sessionId:t,traceId:n,handleCopy:v,hideLabel:h=!1})=>{const{theme:y}=(0,a.u)(),x=(0,u.zy)(),b=t.length>10?`${t.slice(0,10)}...`:t,S=(0,o.useCallback)(e=>e.length>10?`${e.slice(0,10)}...`:e,[]),A=(0,d.e)(e,t),w=n?`${A}?${new URLSearchParams({[m.hb]:n}).toString()}`:A;return x.pathname.includes(`/chat-sessions/${t}`)?(0,p.Y)(c.f,{label:(0,p.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"}),icon:(0,p.Y)(r.SpeechBubbleIcon,{css:g}),value:t,color:"default",getTruncatedLabel:S,onCopy:v,hideLabel:h}):(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:h?"flex-start":"center",flexDirection:"row",gap:y.spacing.sm},""),children:[!h&&(0,p.Y)(a.T.Text,{size:"md",color:"secondary",children:(0,p.Y)(l.sA,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,p.Y)(i.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,p.Y)(l.sA,{id:"OUPWd8",defaultMessage:"View chat session"}),children:(0,p.Y)(u.N_,{to:w,children:(0,p.Y)(r.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,p.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:y.spacing.xs},""),children:[(0,p.Y)(r.SpeechBubbleIcon,{css:f}),(0,p.Y)("span",{children:b})]})})})})]})}},54625:function(e,t,n){n.d(t,{p:function(){return x}});var s=n(46709),o=n(68248),r=n(27757),a=n(82716),i=n(42747),l=n(73879),d=n(73880),c=n(73408);var u={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function m({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:m}=(0,r.u)();return(0,c.FD)("div",{css:u,children:[(0,c.Y)("div",{role:"button",onClick:()=>{n(!1),null===s||void 0===s||s("collapse")},css:(0,o.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${m.spacing.sm}px ${m.spacing.md}px`,height:m.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:m.colors.backgroundSecondary}},""),children:(0,c.Y)(a.FileDocumentIcon,{})}),(0,c.Y)("div",{css:(0,o.AH)({padding:m.spacing.md,paddingBottom:0},""),children:(0,c.Y)(l.V,{children:e})}),(0,c.Y)("div",{css:(0,o.AH)({padding:m.spacing.md,paddingTop:0},""),children:t.map(({key:e,value:t})=>(0,c.Y)(d.t,{itemKey:e,itemValue:t},e))}),(0,c.Y)(r.B,{css:(0,o.AH)({width:"100%",padding:m.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,c.Y)(a.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,c.Y)(i.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var p=n(79081);var g={name:"ti75j2",styles:"margin:0"},f={name:"1r5gb7q",styles:"display:inline-block"},v={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function h({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:i}=(0,r.u)();return(0,c.FD)("div",{role:"button",onClick:()=>{n(!0),null===s||void 0===s||s("expand")},css:(0,o.AH)({display:"flex",flexDirection:"row",padding:`${i.spacing.sm}px ${i.spacing.md}px`,gap:i.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:i.colors.backgroundSecondary}},""),children:[(0,c.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,c.Y)(a.FileDocumentIcon,{}),(0,c.Y)(r.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,c.FD)("div",{css:(0,o.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[t.length>0?(0,c.Y)(d.t,{css:g,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,c.Y)(p.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map(({key:e,value:t})=>(0,c.Y)("span",{css:f,children:`${e}: ${t}`},e)),children:(0,c.FD)(a.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:v,children:["+",t.length-1]})}):null]})]})}var y=n(86125);function x({text:e,metadata:t}){const[n,o]=(0,s.useState)(!1),r=(0,y.g_)(t);return n?(0,c.Y)(m,{text:e,metadataTags:r,setExpanded:o}):(0,c.Y)(h,{text:e,metadataTags:r,setExpanded:o})}},57248:function(e,t,n){n.d(t,{I:function(){return l},a:function(){return d}});var s=n(46709),o=n(76118),r=n(33145);var a=n(73408);const i=(0,s.createContext)({schemas:[]}),l=({children:e,assessments:t})=>{const n=(0,s.useMemo)(()=>(e=>{const t={},n={};for(const s of e){if(t[s.assessment_name])continue;const e=(0,r.e)(s);if((0,o.isNil)(e)){n[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:"boolean"};continue}const a="expectation"in s&&"serialized_value"in s.expectation;let i;switch(typeof e){case"string":i=a?"json":"string";break;case"boolean":default:i="boolean";break;case"number":i="number"}t[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:i}}for(const[s,o]of Object.entries(n))s in t||(t[s]=o);return Object.values(t)})(t),[t]),l=(0,s.useMemo)(()=>({schemas:n}),[n]);return(0,a.Y)(i.Provider,{value:l,children:e})},d=()=>(0,s.useContext)(i)},57819:function(e,t,n){n.d(t,{i:function(){return xe}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(79081),l=n(42747),d=n(82716),c=n(66916),u=n(44666),m=n(57248),p=n(73408);const g=({name:e,setName:t,nameError:n,setNameError:s,handleChangeSchema:o})=>{const{schemas:a}=(0,m.a)(),i=(0,l.tz)(),c=a.map(e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""}),[u,g]=(0,r.useState)(null),[f,v]=(0,r.useState)(a),h=(0,r.useMemo)(()=>{const t=[...f];if(e&&!c.includes(e)){const n=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(n)}return t},[e,f,c]),y=(0,r.useCallback)(e=>{g(e),o(e),s(null)},[o,s]),x=(0,d.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:a,items:h,setItems:v,multiSelect:!1,setInputValue:e=>{t(e),s(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(t.toLowerCase()))&&void 0!==n&&n},formValue:u,formOnChange:y,preventUnsetOnBlur:!0});return(0,p.FD)(d.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,p.Y)(d.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:i.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:n?"error":void 0,comboboxState:x,formOnChange:y,onPressEnter:()=>{h.length>0&&y(h[0])},allowClear:!0,showComboboxToggleButton:!0}),n&&(0,p.Y)(d.FormUI.Message,{type:"error",message:n}),(0,p.Y)(d.TypeaheadComboboxMenu,{comboboxState:x,children:h.map((e,t)=>{var n,s,o;return(0,p.Y)(d.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`,item:e,index:t,comboboxState:x,children:null!==(o=null===e||void 0===e?void 0:e.name)&&void 0!==o?o:""},`assessment-name-typeahead-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`)})})]})};var f=n(84612),v=n(52033),h=n(72143),y=n(89634),x=n(27094),b=n(39595),S=n(61060),A=n(59542),w=n(28993),Y=n(27882),I=n(86125),T=n(13433),C=n(21636),E=n(41151);const M={json:h.f,string:x.k,boolean:v.B,number:y.O},N=(0,r.forwardRef)(({assessmentName:e,spanId:t,traceId:n,setExpanded:i},v)=>{var h;const{theme:y}=(0,a.u)(),{schemas:x}=(0,m.a)(),[N,_]=(0,r.useState)(""),[R,k]=(0,r.useState)("feedback"),[D,F]=(0,r.useState)("boolean"),[O,L]=(0,r.useState)(!0),[H,V]=(0,r.useState)(""),[B,$]=(0,r.useState)(null),[U,z]=(0,r.useState)(null),j=!(0,o.isNil)(e),P=null!==(h=M[D])&&void 0!==h?h:M.string,{createAssessmentMutation:K,isLoading:W}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),a=(0,b.jE)(),i=(0,w.K)(e=>e.logAddedAssessment),d=(0,E.M)(),{mutate:c,isLoading:u}=(0,S.n)({mutationFn:e=>{const t=e;return(0,Y.aZ)()&&d.chatSessionId&&e.assessment&&(e.assessment.metadata={...e.assessment.metadata,[C.n2]:d.chatSessionId}),(0,Y.F9)()&&null!==d&&void 0!==d&&d.modelTraceInfo&&(0,I.gD)(d.modelTraceInfo)&&(0,I.ko)(null===d||void 0===d?void 0:d.modelTraceInfo)?T._A.createAssessmentV4({payload:t,traceLocation:d.modelTraceInfo.trace_location}):(0,T.bU)({payload:t})},onSuccess:n=>{var s;if((0,Y.F9)()&&(0,o.isObject)(n)){const t="assessment"in n?n.assessment:n;i(e,t)}null===(s=d.invalidateTraceQuery)||void 0===s||s.call(d,e),a.invalidateQueries({queryKey:[I.BS,e]}),(0,A.B)({queryClient:a}),null===t||void 0===t||t()},onError:e=>{(0,I.ij)(r.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSettled:()=>{null===s||void 0===s||s()}});return{createAssessmentMutation:c,isLoading:u}})({traceId:n,onSettled:()=>{i(!1)}}),q=(0,r.useCallback)(async()=>{var s;if("json"===D)try{JSON.parse(O)}catch(a){return void z((0,p.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!j&&""===N)return void $((0,p.Y)(l.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const o=(0,f.KN)({formValue:O,dataType:D,isFeedback:"feedback"===R}),r={assessment:{assessment_name:j?e:N,trace_id:n,source:{source_type:"HUMAN",source_id:null!==(s=(0,u.w)())&&void 0!==s?s:""},span_id:t,rationale:H,...o}};K(r)},[D,O,R,j,e,N,n,t,H,K]),G=(0,r.useCallback)(e=>{if(!e)return _(""),k("feedback"),F("boolean"),L(!0),V(""),void z(null);if(x.some(t=>t.name===e.name))switch(_(e.name),k(e.assessmentType),F(e.dataType),e.dataType){case"string":case"json":L("");break;case"number":L(0);break;case"boolean":L(!0)}else _(e.name)},[x]);return(0,p.FD)("div",{ref:v,css:(0,s.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs,marginTop:y.spacing.sm,border:`1px solid ${y.colors.border}`,padding:y.spacing.sm,borderRadius:y.borders.borderRadiusSm},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,p.FD)(d.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:R,disabled:W,onChange:e=>{k(e.target.value),"feedback"===e.target.value&&"json"===D&&F("string")},children:[(0,p.Y)(d.SimpleSelectOption,{value:"feedback",children:(0,p.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,p.Y)(d.SimpleSelectOption,{value:"expectation",children:(0,p.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),j?(0,p.Y)(a.T.Text,{children:e}):(0,p.Y)(g,{name:N,setName:_,handleChangeSchema:G,nameError:B,setNameError:$}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,p.FD)(d.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:D,disabled:W,onChange:e=>{F(e.target.value),z(null)},children:["expectation"===R&&(0,p.Y)(d.SimpleSelectOption,{value:"json",children:(0,p.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,p.Y)(d.SimpleSelectOption,{value:"string",children:(0,p.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,p.Y)(d.SimpleSelectOption,{value:"boolean",children:(0,p.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,p.Y)(d.SimpleSelectOption,{value:"number",children:(0,p.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,p.Y)(P,{value:O,valueError:U,setValue:L,setValueError:z,isSubmitting:W}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,p.Y)(c.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:H,autoSize:{minRows:1,maxRows:5},disabled:W,onKeyDown:e=>e.stopPropagation(),onChange:e=>V(e.target.value)}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:y.spacing.xs},""),children:[(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:W,onClick:()=>i(!1),children:(0,p.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,p.Y)(a.B,{css:(0,s.AH)({marginLeft:y.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:q,loading:W,children:(0,p.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})}),_=({title:e,assessmentName:t,spanId:n,traceId:s})=>{const[o,i]=(0,r.useState)(!1),l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{o&&l.current&&l.current.scrollIntoView({behavior:"smooth",block:"start"})},[o]),(0,p.FD)("div",{children:[(0,p.Y)(a.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,p.Y)(d.PlusIcon,{}),onClick:()=>i(!0),children:e}),o&&(0,p.Y)(N,{ref:l,assessmentName:t,spanId:n,traceId:s,setExpanded:i})]})},R=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const o="feedback"in e,r=((null!==(s=(0,u.w)())&&void 0!==s?s:"")===e.source.source_id||o&&"HUMAN"!==e.source.source_type)&&t;return(0,p.FD)(d.DropdownMenu.Root,{children:[(0,p.Y)(d.DropdownMenu.Trigger,{asChild:!0,children:(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,p.Y)(d.OverflowIcon,{}),size:"small"})}),(0,p.FD)(d.DropdownMenu.Content,{minWidth:100,children:[r&&(0,p.FD)(d.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,p.Y)(d.DropdownMenu.IconWrapper,{children:(0,p.Y)(d.PencilIcon,{})}),(0,p.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,p.FD)(d.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,p.Y)(d.DropdownMenu.IconWrapper,{children:(0,p.Y)(d.TrashIcon,{})}),(0,p.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},k=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const{deleteAssessmentMutation:s,isLoading:o}=(({assessment:e,onSuccess:t,onError:n,onSettled:s,skip:o})=>{const r=(0,l.tz)(),a=(0,b.jE)(),i=null===e||void 0===e?void 0:e.trace_id,d=null===e||void 0===e?void 0:e.assessment_id,c=(0,w.K)(e=>e.logRemovedAssessment),u=(0,w.K)(e=>e.logAddedAssessment),m=(0,E.M)(),p=o||!i||!d,{mutate:g,isLoading:f}=(0,S.n)({mutationFn:()=>p?Promise.reject(new Error("Mutation is skipped")):(0,Y.F9)()&&m.modelTraceInfo&&(0,I.gD)(m.modelTraceInfo)&&(0,I.ko)(m.modelTraceInfo)?T._A.deleteAssessmentV4({traceId:i,assessmentId:d,traceLocation:m.modelTraceInfo.trace_location}):(0,T.aG)({traceId:i,assessmentId:d}),onSuccess:()=>{var n;if((0,Y.F9)()&&!p){if(e.overriddenAssessment){const t={...e.overriddenAssessment,valid:!0};u(i,t)}c(i,e)}a.invalidateQueries({queryKey:[I.BS,i]}),null===(n=m.invalidateTraceQuery)||void 0===n||n.call(m,i),(0,A.B)({queryClient:a}),null===t||void 0===t||t()},onError:e=>{e instanceof Error&&p||((0,I.ij)(r.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e))},onSettled:()=>{null===s||void 0===s||s()}});return{deleteAssessmentMutation:g,isLoading:f}})({assessment:e,onSettled:()=>{n(!1)}}),a=(0,r.useCallback)(()=>{s()},[s]);return(0,p.Y)(i.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:a,okButtonProps:{danger:!0,loading:o},okText:(0,p.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,p.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:o,title:(0,p.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,p.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})};var D=n(33145);const F=({assessment:e,onSuccess:t,onSettled:n,onCancel:i})=>{var m;const g="feedback"in e,v=(0,D.e)(e),h=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(v,g),y=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(v),x=null!==(m=(0,u.w)())&&void 0!==m?m:"",{theme:C}=(0,a.u)(),[M,N]=(0,r.useState)(h),[_,R]=(0,r.useState)(y),[k,F]=(0,r.useState)(e.rationale),[O,L]=(0,r.useState)(null),{updateAssessmentMutation:H,isLoading:V}=(({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),a=(0,b.jE)(),i=(0,w.K)(e=>e.logAddedAssessment),d=(0,E.M)(),{mutate:c,isLoading:u}=(0,S.n)({mutationFn:t=>(0,Y.F9)()&&null!==d&&void 0!==d&&d.modelTraceInfo&&(0,I.gD)(d.modelTraceInfo)&&(0,I.ko)(null===d||void 0===d?void 0:d.modelTraceInfo)?(t.assessment.assessment_name=e.assessment_name,T._A.updateAssessmentV4({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t,traceLocation:d.modelTraceInfo.trace_location})):(0,T.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,I.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:n=>{var s;if((0,Y.F9)()&&(0,o.isObject)(n)){const e="assessment"in n?n.assessment:n;i(e.trace_id,e)}a.invalidateQueries({queryKey:[I.BS,e.trace_id]}),null===(s=d.invalidateTraceQuery)||void 0===s||s.call(d,e.trace_id),(0,A.B)({queryClient:a}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:c,isLoading:u}})({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:B,isLoading:$}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),a=(0,b.jE)(),i=(0,w.K)(e=>e.logAddedAssessment),d=(0,w.K)(e=>e.logRemovedAssessment),c=(0,E.M)(),{mutate:m,isLoading:p}=(0,S.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const r={...e,...t,rationale:n,source:{source_id:null!==(s=(0,u.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},a={assessment:(0,o.omit)(r,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,Y.F9)()&&c.modelTraceInfo&&(0,I.gD)(c.modelTraceInfo)&&(0,I.ko)(c.modelTraceInfo)?T._A.createAssessmentV4({payload:a,traceLocation:c.modelTraceInfo.trace_location}):(0,T.bU)({payload:a})},onError:e=>{(0,I.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:(n,s)=>{var r;if((0,Y.F9)()&&(0,o.isObject)(n)){const t="assessment"in n?n.assessment:n;t.overriddenAssessment=s.oldAssessment,i(e,t),d(e,s.oldAssessment)}a.invalidateQueries({queryKey:[I.BS,e]}),null===(r=c.invalidateTraceQuery)||void 0===r||r.call(c,e),(0,A.B)({queryClient:a}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:m,isLoading:p}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),U=V||$,z=(0,r.useCallback)(async()=>{if("json"===M)try{JSON.parse(_)}catch(n){return void L((0,p.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=(0,f.KN)({formValue:_,dataType:M,isFeedback:g});if(x!==e.source.source_id&&g)B({oldAssessment:e,value:t,...k?{rationale:k}:{}});else{const e={assessment:{...t,rationale:k},update_mask:(g?"feedback":"expectation")+",rationale"};H(e)}},[M,_,g,x,e,k,H,B]);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:C.spacing.xs,marginTop:C.spacing.sm,border:`1px solid ${C.colors.border}`,padding:C.spacing.sm,borderRadius:C.borders.borderRadiusSm},""),children:[(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,p.FD)(d.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:M,disabled:U,onChange:e=>{N(e.target.value),L(null)},children:[!g&&(0,p.Y)(d.SimpleSelectOption,{value:"json",children:(0,p.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,p.Y)(d.SimpleSelectOption,{value:"string",children:(0,p.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,p.Y)(d.SimpleSelectOption,{value:"boolean",children:(0,p.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,p.Y)(d.SimpleSelectOption,{value:"number",children:(0,p.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===M&&(0,p.FD)(p.FK,{children:[(0,p.Y)(c.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(_),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value),L(null)},validationState:O?"error":void 0,disabled:U}),O&&(0,p.Y)(d.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:O,type:"error"})]}),"string"===M&&(0,p.Y)(c.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(_),onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value),L(null)},disabled:U,allowClear:!0}),"boolean"===M&&(0,p.FD)(d.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:_,disabled:U,onChange:e=>{R(e.target.value),L(null)},children:[(0,p.Y)(d.SegmentedControlButton,{value:!0,children:"True"}),(0,p.Y)(d.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===M&&(0,p.Y)(c.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(_),onKeyDown:e=>e.stopPropagation(),onChange:e=>{R(e.target.value?Number(e.target.value):""),L(null)},type:"number",disabled:U,allowClear:!0}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginTop:C.spacing.xs},""),size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,p.Y)(c.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:k,autoSize:{minRows:1,maxRows:5},disabled:U,onKeyDown:e=>e.stopPropagation(),onChange:e=>F(e.target.value)}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:C.spacing.xs},""),children:[(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:U,onClick:i,children:(0,p.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,p.Y)(a.B,{css:(0,s.AH)({marginLeft:C.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:z,loading:U,children:(0,p.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var O=n(4564),L=n(777),H=n(94777),V=n(53915),B=n(50103),$=n(110);var U={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},z={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},j={name:"s5xdrg",styles:"display:flex;align-items:center"},P={name:"fxp7t8",styles:"flex:1;min-width:0"};const K=({expectation:e})=>{var t;const{theme:n}=(0,a.u)(),[i,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[g,v]=(0,r.useState)(!1),{nodeMap:h,activeView:y}=(0,V.nJ)(),{experimentId:x}=(0,$.g)(),b=e.span_id?h[e.span_id]:null,S=null===(t=e.metadata)||void 0===t?void 0:t[C.K6],A="summary"===y&&!(0,o.isEmpty)(S),w="summary"===y&&b&&!A,Y=(0,f.jf)(e.expectation),I=(0,D.R)(e.source);return(0,p.FD)("div",{css:(0,s.AH)({padding:n.spacing.sm+n.spacing.xs,paddingTop:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,p.FD)("div",{css:U,children:[(0,p.Y)(a.T.Text,{bold:!0,css:z,children:e.assessment_name}),(0,p.Y)(R,{assessment:e,setIsEditing:c,setShowDeleteModal:m}),(0,p.Y)(k,{assessment:e,isModalVisible:u,setIsModalVisible:m})]}),i?(0,p.Y)(F,{assessment:e,onSuccess:()=>c(!1),onCancel:()=>c(!1)}):(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,p.FD)("div",{css:j,children:[(0,p.Y)(I,{size:n.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:n.colors.actionIconBackgroundHover,borderRadius:n.borders.borderRadiusFull},"")}),(0,p.Y)(O.V,{source:e.source})]}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:g?"flex-start":"center",gap:n.spacing.xs},""),children:[(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:g?(0,p.Y)(d.ChevronDownIcon,{}):(0,p.Y)(a.o,{}),onClick:()=>v(!g)}),(0,p.Y)("div",{css:P,children:g?(0,p.Y)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundSecondary,padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderRadius:n.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,p.Y)(a.T.Text,{children:"string"===typeof Y?Y:JSON.stringify(Y,null,2)})}):(0,p.Y)(L.S,{parsedValue:Y,singleLine:!0})})]})]}),w&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,p.Y)(H.o,{node:b})]}),A&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,p.Y)(B.b,{experimentId:null!==x&&void 0!==x?x:"",sessionId:null!==S&&void 0!==S?S:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]})]})};var W=n(5075);var q={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const G=({renderConnector:e=!0,assessment:t,setIsEditing:n,hideOverflowMenu:o=!1})=>{const{theme:i}=(0,a.u)(),[l,d]=(0,r.useState)(!1),c=(0,D.R)(t.source);return(0,p.FD)("div",{css:q,children:[e&&(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:i.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:i.borders.borderRadiusMd,borderBottom:`1px solid ${i.colors.border}`,borderLeft:`1px solid ${i.colors.border}`},"")}),(0,p.Y)(c,{size:i.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:i.colors.actionIconBackgroundHover,borderRadius:i.borders.borderRadiusFull},"")}),(0,p.Y)(O.V,{source:t.source}),(0,p.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:i.spacing.xs},""),children:[t.last_update_time&&(0,p.Y)(a.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:i.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:(0,f.Pt)(new Date(t.last_update_time))}),!o&&(0,p.Y)(R,{assessment:t,setIsEditing:n,setShowDeleteModal:d}),(0,p.Y)(k,{assessment:t,isModalVisible:l,setIsModalVisible:d})]})]})};var J=n(73879),Q=n(96586);var Z={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const X=({feedback:e})=>{const{theme:t}=(0,a.u)(),n=e.feedback.value;return(0,p.FD)("div",{css:Z,children:[(0,p.Y)(G,{renderConnector:!1,assessment:e}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,o.isNil)(e.feedback.error)?(0,p.FD)(p.FK,{children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,p.Y)("div",{children:(0,p.Y)(W.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})})]}):(0,p.Y)(Q.B,{error:e.feedback.error}),e.rationale&&(0,p.FD)(p.FK,{children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,p.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,p.Y)(J.V,{children:e.rationale})]})]})]})},ee=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,r.useMemo)(()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n),[n]);return(0,p.Y)(i.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,p.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map(e=>"feedback"in e?(0,p.Y)(X,{feedback:e},e.assessment_id):null)})};var te=n(69291);var ne={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},se={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},oe={name:"rnnx2x",styles:"font-size:12px"};const re=({feedback:e})=>{var t,n,i;const[d,c]=(0,r.useState)(!1),{theme:u}=(0,a.u)(),{nodeMap:m,activeView:g}=(0,V.nJ)(),{experimentId:f}=(0,$.g)(),v=e.feedback.value,h=e.span_id?m[e.span_id]:null,y=null===(t=e.metadata)||void 0===t?void 0:t[C.K6],x="summary"===g&&!(0,o.isEmpty)(y),b="summary"===g&&h&&!x,S=null===(n=e.metadata)||void 0===n?void 0:n[C.gK],A=S&&f?ae(f,S):void 0,w=null===(i=e.metadata)||void 0===i?void 0:i[C.zZ],Y=(()=>{if(null===w)return;const e=Number(w);return Number.isFinite(e)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:6}).format(e):void 0})(),I=Boolean(Y);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginLeft:u.spacing.lg},""),children:[!(0,o.isNil)(e.feedback.error)&&(0,p.Y)(Q.B,{error:e.feedback.error}),b&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,p.Y)(H.o,{node:h})]}),x&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"451ETc",defaultMessage:"Session"})}),(0,p.Y)(B.b,{experimentId:null!==f&&void 0!==f?f:"",sessionId:null!==y&&void 0!==y?y:"",traceId:e.trace_id,handleCopy:()=>{},hideLabel:!0})]}),(0,o.isNil)(e.feedback.error)&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",gap:u.spacing.xs},""),children:[(0,p.Y)(W.Q,{jsonValue:JSON.stringify(v),assessmentName:e.assessment_name}),e.overriddenAssessment&&(0,p.FD)(p.FK,{children:[(0,p.Y)("span",{onClick:()=>c(!0),children:(0,p.Y)(a.T.Text,{css:ne,color:"secondary",children:(0,p.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,p.Y)(ee,{isModalVisible:d,setIsModalVisible:c,feedback:e})]})]})]}),e.rationale&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,p.Y)("div",{css:se,children:(0,p.Y)(J.V,{children:e.rationale})})]}),I&&(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.xs},""),children:[(0,p.Y)(a.T.Text,{size:"sm",color:"secondary",children:(0,p.Y)(l.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,p.Y)(a.T.Text,{style:{color:u.colors.textSecondary},children:Y})]}),A&&(0,p.Y)($.N_,{to:A,target:"_blank",rel:"noreferrer",children:(0,p.FD)("span",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs},""),children:[(0,p.Y)(l.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,p.Y)(a.au,{css:oe})]})})]})},ae=(e,t)=>`${(0,te.p)(e)}?selectedEvaluationId=${t}`,ie=({feedback:e})=>{const{theme:t}=(0,a.u)(),[n,o]=(0,r.useState)(!1);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,p.Y)(G,{assessment:e,setIsEditing:o}),n?(0,p.Y)(F,{assessment:e,onSuccess:()=>o(!1),onCancel:()=>o(!1)}):(0,p.Y)(re,{feedback:e})]})};const le=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,p.Y)(d.UserIcon,{css:t});case"LLM_JUDGE":return(0,p.Y)(d.SparkleIcon,{css:t});case"CODE":return(0,p.Y)(d.CodeIcon,{css:t});default:return null}};var de={name:"ti75j2",styles:"margin:0"};const ce=({feedbacks:e})=>{const{theme:t}=(0,a.u)();if(e.length<2)return null;const n=(0,o.countBy)(e,e=>e.source.source_type);return(0,p.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map(([e,n])=>(0,p.Y)(d.Tag,{componentId:"shared.model-trace-explorer.feedback-source-count",css:de,children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[le(e),(0,p.Y)(a.T.Text,{children:n})]})},e))})};var ue={name:"1fttcpj",styles:"display:flex;flex-direction:column"},me={name:"ozd7xs",styles:"flex-shrink:0"},pe={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ge=({jsonValue:e,feedbacks:t})=>{var n;const{theme:o}=(0,a.u)(),[i,l]=(0,r.useState)(!1),c=null===(n=t[0])||void 0===n?void 0:n.assessment_name;return(0,p.FD)("div",{css:ue,children:[(0,p.FD)("div",{css:(0,s.AH)({display:"flex",gap:o.spacing.xs,alignItems:"center"},""),children:[(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:me,size:"small",icon:i?(0,p.Y)(d.ChevronDownIcon,{}):(0,p.Y)(a.o,{}),onClick:()=>l(!i)}),(0,p.Y)(W.Q,{jsonValue:e,assessmentName:c}),(0,p.Y)(ce,{feedbacks:t})]}),i&&(0,p.Y)("div",{css:pe,children:t.map(e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,p.Y)(ie,{feedback:e},e.assessment_id))})]})};var fe={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},ve={name:"ozd7xs",styles:"flex-shrink:0"};const he=({name:e,valuesMap:t,traceId:n,activeSpanId:l})=>{const{theme:c}=(0,a.u)(),u=(0,f.se)(e),[m,g]=(0,r.useState)(!1),v=Object.values(t).flat().some(e=>!(0,o.isNil)(e.feedback.error));return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:c.spacing.sm,border:`1px solid ${c.colors.border}`,borderRadius:c.borders.borderRadiusMd,padding:c.spacing.sm+c.spacing.xs,paddingTop:c.spacing.sm,gap:c.spacing.sm},""),children:[(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:c.spacing.sm,flex:1,minWidth:0},""),children:[(0,p.Y)(a.T.Text,{bold:!0,css:fe,children:u}),v&&(0,p.Y)(a.k,{css:ve,color:"danger"})]}),(0,p.Y)(i.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,p.Y)(a.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-c.spacing.xs},""),size:"small",icon:(0,p.Y)(d.PlusIcon,{}),onClick:()=>g(!0)})})]}),Object.entries(t).map(([e,t])=>(0,p.Y)(ge,{jsonValue:e,feedbacks:t},e)),m&&(0,p.Y)(N,{assessmentName:e,spanId:l,traceId:n,setExpanded:g})]})};var ye={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const xe=({assessments:e,traceId:t,activeSpanId:n,className:d,assessmentsTitleOverride:c,disableCloseButton:u})=>{const m=(0,w.K)(e=>e.reconstructAssessments),g=(0,w.K)(e=>e.assessmentActions[t]),v=(0,r.useMemo)(()=>{if(!(0,Y.F9)())return e;const t=m(e,g);return(0,o.uniqBy)(t,({assessment_id:e})=>e)},[e,m,g]),{theme:h}=(0,a.u)(),{setAssessmentsPaneExpanded:y,assessmentsPaneExpanded:x,isInComparisonView:b}=(0,V.nJ)(),[S,A]=(0,r.useMemo)(()=>(0,o.partition)(v,e=>"feedback"in e),[v]),I=(0,r.useMemo)(()=>(e=>{const t={};return e.forEach(e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const r=t[s];(0,o.isNil)(n)||(r[n]||(r[n]=[]),r[n].push(e))}),Object.entries(t).toSorted(([e],[t])=>e.localeCompare(t))})(S),[S]),T=A.toSorted((e,t)=>e.assessment_name.localeCompare(t.assessment_name));return(0,p.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",...b?{padding:`${h.spacing.sm} 0`,maxHeight:10*h.spacing.lg}:{padding:h.spacing.sm,paddingTop:h.spacing.xs,height:"100%"},...b?{}:{borderLeft:`1px solid ${h.colors.border}`},overflowY:"auto",minWidth:f.uZ,width:"100%",boxSizing:"border-box"},""),className:d,children:[(0,p.FD)("div",{css:ye,children:[!b&&(c?c():(0,p.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})),!b&&y&&!u&&(0,p.Y)(i.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,p.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,p.Y)(a.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,p.Y)(a.C,{}),onClick:()=>y(!1)})})]}),I.map(([e,s])=>(0,p.Y)(he,{name:e,valuesMap:s,traceId:t,activeSpanId:n},e)),T.length>0&&(0,p.FD)(p.FK,{children:[(0,p.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({marginBottom:h.spacing.sm},""),children:(0,p.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:h.spacing.sm,marginBottom:h.spacing.sm},""),children:T.map(e=>(0,p.Y)(K,{expectation:e},e.assessment_id))})]}),(0,p.Y)(_,{title:(0,p.Y)(l.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:n,traceId:t})]})}},58663:function(e,t,n){n.d(t,{DF:function(){return ke},gV:function(){return Ie},mg:function(){return Ae},cs:function(){return Se},Iw:function(){return ue.I},AN:function(){return we},iX:function(){return W.i},rH:function(){return rt},SH:function(){return ce.S},mW:function(){return Re},a8:function(){return oe},Xb:function(){return $e.X},gm:function(){return dt},RI:function(){return mt},l5:function(){return K.A},Fn:function(){return m.F},ei:function(){return z.e},VZ:function(){return g.VZ},a9:function(){return pe},CX:function(){return ge},Jq:function(){return fe},hb:function(){return F.hb},n2:function(){return F.n2},U2:function(){return de},r_:function(){return qe},y8:function(){return ze},it:function(){return _e},Mm:function(){return Ce},Ub:function(){return Te},Fp:function(){return Me},du:function(){return Ee},Ad:function(){return he},Uu:function(){return F.Uu},PA:function(){return ye},po:function(){return me},uI:function(){return xe},TJ:function(){return U.TJ},_A:function(){return U._A},$L:function(){return Ye},jm:function(){return Ne},iK:function(){return be},vX:function(){return a.vX},ij:function(){return a.ij},NH:function(){return a.NH},ed:function(){return De.e},MF:function(){return a.MF},cp:function(){return a.cp},re:function(){return ve},tI:function(){return a.tI},m4:function(){return a.m4},rX:function(){return a.rX},gD:function(){return a.gD},UZ:function(){return a.UZ},$f:function(){return a.$f},ho:function(){return a.ho},Hq:function(){return a.Hq},aZ:function(){return r.aZ},Z9:function(){return r.Z9},F9:function(){return r.F9},eA:function(){return r.eA},xD:function(){return a.xD},zk:function(){return Be},y5:function(){return it},SO:function(){return ct},M5:function(){return z.M},BR:function(){return Ve}});var s=n(46709),o=n(89949),r=n(27882),a=n(86125),i=n(82716),l=n(27757),d=n(42747),c=n(73408);const u=()=>(0,c.Y)(i.Empty,{title:(0,c.Y)(d.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,c.Y)(d.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,c.Y)(l.k,{})});var m=n(15929),p=n(68248),g=n(94664),f=n(45547);const v=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var h={name:"b9l38d",styles:"width:min-content"};const y=({traceId:e,setForceDisplay:t})=>{const{theme:n}=(0,l.u)();return(0,c.Y)(i.Empty,{image:(0,c.Y)(l.W,{}),title:(0,c.Y)(d.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md,alignItems:"center"},""),children:[(0,c.Y)(d.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:h,onClick:()=>t(!0),children:(0,c.Y)(d.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,c.Y)("span",{children:(0,c.Y)(d.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,c.Y)(l.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,c.Y)(l.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,c.Y)(d.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,c.Y)(f.w,{data:v(e),renderMode:g.cC.PYTHON,initialExpanded:!0})]})})};var x=n(53915),b=n(66916),S=n(79081),A=n(97447),w=n(76118),Y=n(90828);var I={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"},T={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const C=({tokenUsage:e})=>{const{theme:t}=(0,l.u)(),n=(0,s.useMemo)(()=>e.total_tokens.toString(),[e]),o=(0,s.useMemo)(()=>e.input_tokens.toString(),[e]),r=(0,s.useMemo)(()=>e.output_tokens.toString(),[e]);return(0,c.Y)(i.HoverCard,{trigger:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:t.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zp4MBw",defaultMessage:"Token count"})}),(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:t.spacing.xs},""),children:[(0,c.Y)("span",{children:(0,c.Y)(i.TokenIcon,{})}),(0,c.Y)("span",{children:(0,Y.Y7)(n,40)})]})})]}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,padding:t.spacing.sm,maxWidth:400},""),children:[(0,c.Y)(l.T.Title,{level:3,withoutMargins:!0,children:(0,c.Y)(d.sA,{id:"aFk+k/",defaultMessage:"Usage breakdown"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:I,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"XEcsei",defaultMessage:"Input tokens"})}),(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.input-tokens.tag",children:(0,c.Y)("span",{children:o})})]}),(0,c.FD)("div",{css:T,children:[(0,c.Y)(l.T.Text,{size:"md",children:(0,c.Y)(d.sA,{id:"2IGC5w",defaultMessage:"Output tokens"})}),(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.output-tokens.tag",children:(0,c.Y)("span",{children:r})})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:t.spacing.sm,borderTop:`1px solid ${t.colors.borderDecorative}`},""),children:[(0,c.Y)(l.T.Text,{size:"md",bold:!0,children:(0,c.Y)(d.sA,{id:"QK/Qyx",defaultMessage:"Total"})}),(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.token-usage-hovercard.total-tokens.tag",children:(0,c.Y)("span",{children:n})})]})]})]}),side:"bottom",align:"start"})};var E={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},M={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},N={name:"1sdjnkx",styles:"word-break:break-word"};const _=({traceMetadata:e,getTruncatedLabel:t=e=>(0,Y.Y7)(e,40)})=>{const{theme:n}=(0,l.u)(),o=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=(0,Y.pt)(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},r=(0,s.useMemo)(()=>Object.entries(e||{}).filter(([e,t])=>null!==t&&""!==t&&!e.startsWith(Y.nt)).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({key:e,value:t,displayValue:o(t)})),[e]);return 0===r.length?null:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,c.Y)(i.Overflow,{noMargin:!0,children:(0,c.Y)(i.HoverCard,{trigger:(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-metadata-pill",color:"default",css:E,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:n.spacing.xs},""),children:[(0,c.Y)(S.L,{css:(0,p.AH)({fontSize:12,color:n.colors.textSecondary},"")}),(0,c.Y)("span",{children:r.length})]})}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[r.slice(0,100).map(({key:e,displayValue:s,value:o})=>(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:n.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{css:M,children:t(e)}),(0,c.Y)(l.T.Text,{color:"secondary",css:N,children:s})]},`${e}:${o}`)),r.length>100&&(0,c.FD)(l.T.Text,{color:"secondary",children:["+",r.length-100," more"]})]})})})]})};var R=n(50103);const k=({statusState:e,getTruncatedLabel:t})=>{const n=(0,d.tz)(),{theme:s}=(0,l.u)(),o=((e,t,n)=>({IN_PROGRESS:{label:t.formatMessage({id:"Y1eg9D",defaultMessage:"In progress"}),icon:(0,c.Y)(b.C,{css:(0,p.AH)({color:n.colors.textValidationWarning},"")}),color:"lemon"},OK:{label:t.formatMessage({id:"hUfxmd",defaultMessage:"OK"}),icon:(0,c.Y)(i.CheckCircleIcon,{css:(0,p.AH)({color:n.colors.textValidationSuccess},"")}),color:"teal"},ERROR:{label:t.formatMessage({id:"ho2T6B",defaultMessage:"Error"}),icon:(0,c.Y)(i.XCircleIcon,{css:(0,p.AH)({color:n.colors.textValidationDanger},"")}),color:"coral"},STATE_UNSPECIFIED:null}[e]))(e,n,s);return o?(0,c.Y)(A.f,{label:(0,c.Y)(d.sA,{id:"HNQ9dM",defaultMessage:"Status"}),value:o.label,color:o.color,icon:o.icon,getTruncatedLabel:t,onCopy:()=>{}}):null};var D=n(110),F=n(21636),O=n(81390);var L={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},H={name:"mqlsmr",styles:"font-size:12px;display:flex"},V={name:"e0dnmk",styles:"cursor:pointer"};const B=({modelTraceInfo:e})=>{var t;const{theme:n}=(0,l.u)(),[o,r]=(0,s.useState)(!1),{rootNode:u}=(0,x.nJ)(),{experimentId:m}=(0,D.g)(),g=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).filter(([e])=>(0,Y.oD)(e)),[f,v]=(0,s.useMemo)(()=>{var t;return(0,a.ko)(e)&&(0,a.gD)(e)?[(0,a.vX)(e),e.trace_id]:[(0,a.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""]},[e]),h=(0,s.useMemo)(()=>(0,a.m4)(e),[e]),y=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[F.n2]},[e]),I=(0,s.useMemo)(()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[F.E3]},[e]),T=(0,s.useMemo)(()=>(0,a.gD)(e)?e.state:void 0,[e]),E=(0,s.useMemo)(()=>{if(u)return(0,O.X6)(u.end-u.start)},[u]),M=e=>(0,Y.Y7)(e,40),N=(0,s.useCallback)(()=>{r(!0),setTimeout(()=>r(!1),2e3)},[]);return(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:n.spacing.md,paddingBottom:n.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,rowGap:n.spacing.sm,flexWrap:"wrap"},""),children:[T&&(0,c.Y)(k,{statusState:T,getTruncatedLabel:M}),f&&(0,c.Y)(A.f,{label:(0,c.Y)(d.sA,{id:"imKpxw",defaultMessage:"ID"}),value:f,displayValue:v,color:"purple",getTruncatedLabel:M,onCopy:N}),(B=h,void 0!==B&&(0,w.isObject)(B)&&"input_tokens"in B&&"output_tokens"in B&&"total_tokens"in B&&(0,c.Y)(C,{tokenUsage:h})),E&&(0,c.Y)(A.f,{label:(0,c.Y)(d.sA,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,c.Y)(b.C,{css:L}),value:E,getTruncatedLabel:M,onCopy:N}),y&&m&&(0,c.Y)(R.b,{handleCopy:N,experimentId:m,sessionId:y,traceId:f}),I&&(0,c.Y)(A.f,{label:(0,c.Y)(d.sA,{id:"128VYg",defaultMessage:"User"}),icon:(0,c.Y)(i.UserIcon,{css:H}),value:I,color:"default",getTruncatedLabel:M,onCopy:N}),(0,c.Y)(_,{traceMetadata:null===e||void 0===e?void 0:e.trace_metadata,getTruncatedLabel:M}),g.length>0&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"7KPJii",defaultMessage:"Tags"})}),(0,c.Y)(i.Overflow,{noMargin:!0,children:g.map(([e,t])=>{const n=`${e}: ${t}`;return(0,c.Y)(S.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:n,children:(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),N()},css:V,children:M(`${e}: ${t}`)})},e)})})]})]}),o&&(0,c.FD)(i.Notification.Provider,{children:[(0,c.Y)(i.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,c.Y)(i.Notification.Title,{children:(0,c.Y)(d.sA,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,c.Y)(i.Notification.Viewport,{})]})]});var B};var $=n(49708),U=n(13433),z=n(41151);var j=n(28993),P=n(45218),K=n(26059),W=n(57819),q=n(84612);const G=()=>{const{theme:e}=(0,l.u)(),[t,n]=(0,s.useState)(500),{rootNode:o,nodeMap:r,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m,isInComparisonView:g,updatePaneSizeRatios:f,getPaneSizeRatios:v}=(0,x.nJ)(),h=(0,s.useMemo)(()=>Object.values(r).flatMap(e=>e.assessments),[r]),y=(0,s.useCallback)(e=>{f({summarySidebar:e})},[f]),b=(0,a.yt)(o);if(!o)return(0,c.Y)("div",{css:(0,p.AH)({marginTop:e.spacing.lg},""),children:(0,c.Y)(i.Empty,{description:(0,c.Y)(d.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});const S=(0,c.Y)(W.i,{assessments:h,traceId:o.traceId,activeSpanId:void 0});return!g&&u&&m?(0,c.Y)(K.A,{initialRatio:v().summarySidebar,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(P.n,{rootNode:o,intermediateNodes:b}),rightChild:S,leftMinWidth:P.F+2*e.spacing.md,rightMinWidth:q.uZ+2*e.spacing.sm,onRatioChange:y}):(0,c.Y)(P.n,{rootNode:o,intermediateNodes:b})};var J=n(3448);var Q={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},Z={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},X={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ee=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:o})=>{const{theme:r}=(0,l.u)(),{activeView:a,setActiveView:u,rootNode:m}=(0,x.nJ)(),g=(0,s.useCallback)(e=>{u(e)},[u]);return(0,c.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:a,onValueChange:g,css:Q,children:[(0,c.FD)(i.Tabs.List,{css:(0,p.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[m&&(0,c.Y)(i.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(i.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(i.Tabs.Content,{value:"summary",css:Z,children:(0,c.Y)(G,{})}),(0,c.Y)(i.Tabs.Content,{value:"detail",css:X,children:(0,c.Y)(J._,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:o})})]})};var te={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const ne=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})=>{var o,r,a;const{theme:u}=(0,l.u)(),{assessmentsPaneEnabled:m,assessmentsPaneExpanded:g,setAssessmentsPaneExpanded:f,rootNode:v,selectedNode:h}=(0,x.nJ)();return(0,c.FD)("div",{css:te,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs,padding:`0px ${u.spacing.sm}px`,marginBottom:u.spacing.xs},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.toggle-assessments-pane",icon:g?(0,c.Y)(i.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>f(!g)}),(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})]}),m&&g&&(0,c.Y)("div",{css:(0,p.AH)({marginBottom:u.spacing.sm,padding:u.spacing.sm,paddingTop:0},""),children:(0,c.Y)(W.i,{assessments:null!==(o=null===v||void 0===v?void 0:v.assessments)&&void 0!==o?o:[],traceId:null!==(r=null===v||void 0===v?void 0:v.traceId)&&void 0!==r?r:"",activeSpanId:null!==(a=null===h||void 0===h?void 0:h.key)&&void 0!==a?a:""})}),(0,c.Y)(ee,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})]})},se=({children:e})=>(0,c.Y)(o.tH,{fallbackRender:u,children:e}),oe=({modelTrace:e,className:t,initialActiveView:n,selectedSpanId:o,onSelectSpan:i,collapseAssessmentPane:l,isInComparisonView:d,showLoadingState:u})=>{var p,g,f,v;const[h,b]=(0,s.useState)(e),[S,A]=(0,s.useState)(!1),w=(0,a.MF)(e),Y=null!==(p=(0,a.ob)(e))&&void 0!==p?p:0,I=!(0,r.ny)()||Y<(0,r.T9)(),T=null!==(g=null===(f=e.data)||void 0===f||null===(v=f.spans)||void 0===v?void 0:v.length)&&void 0!==g?g:0,[C,E]=(0,s.useState)(w.startsWith("tr-")),[M,N]=(0,s.useState)(!0),{isFetching:_}=(({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n,enabled:o=!0})=>{const i=[a.BS,e],l=(0,z.M)(),d=(0,s.useMemo)(()=>(0,r.F9)()&&!e.startsWith("tr-")?o&&l.modelTraceInfo&&(0,a.gD)(l.modelTraceInfo):o&&e.startsWith("tr-"),[o,e,l.modelTraceInfo]);return(0,$.I)({queryKey:i,queryFn:()=>{var t;return(0,r.F9)()&&l.modelTraceInfo&&(0,a.gD)(l.modelTraceInfo)&&!e.startsWith("tr-")?U._A.getTraceInfoV4({traceId:e,traceLocation:null===(t=l.modelTraceInfo)||void 0===t?void 0:t.trace_location}):(0,U.N5)({traceId:e})},onSuccess:e=>{var s;const o=(0,a.gD)(e)?e:null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info;t(e=>({data:e.data,info:null!==o&&void 0!==o?o:{}})),n(!0)},onError:()=>{n(!1)},enabled:d,refetchOnWindowFocus:!1,refetchOnMount:"always"})})({traceId:w,setModelTrace:b,setAssessmentsPaneEnabled:E,enabled:I}),R=M&&_;(0,s.useEffect)(()=>{b(e),N(!0)},[w,T]),(0,s.useEffect)(()=>{M&&!_&&N(!1)},[M,_]);const k=(0,j.K)(e=>e.resetCache);return(0,s.useEffect)(()=>{k()},[k]),I||S?(0,c.Y)(se,{traceId:w,children:(0,c.Y)(x.DK,{modelTrace:h,initialActiveView:n,selectedSpanIdOnRender:o,assessmentsPaneEnabled:C,isInComparisonView:d,initialAssessmentsPaneCollapsed:l,isTraceInitialLoading:R,children:u?(0,c.Y)(m.F,{}):(0,c.FD)(c.FK,{children:[(0,c.Y)(B,{modelTraceInfo:h.info}),d?(0,c.Y)(ne,{modelTraceInfo:h.info}):(0,c.Y)(ee,{modelTraceInfo:h.info,className:t,selectedSpanId:o,onSelectSpan:i})]})})}):(0,c.Y)(y,{traceId:w,setForceDisplay:A})};var re=n(68364);var ae={name:"13y2nry",styles:"display:flex;flex-direction:column;height:100%;overflow:hidden"};const ie=({assessments:e})=>{const[t,n]=(0,s.useState)(500),{rootNode:o}=(0,x.nJ)(),r=(0,a.yt)(o);return o?(0,c.Y)("div",{css:ae,children:(0,c.Y)(K.A,{initialRatio:.5,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(P.n,{rootNode:o,intermediateNodes:r,hideRenderModeSelector:!0}),rightChild:(0,c.Y)(re.Y,{assessments:e}),leftMinWidth:P.F,rightMinWidth:re.W})}):null},le=({children:e})=>(0,c.Y)(o.tH,{fallbackRender:u,children:e}),de=({modelTrace:e,assessments:t})=>{const n=(0,a.MF)(e);return(0,c.Y)(le,{traceId:n,children:(0,c.Y)(x.DK,{modelTrace:e,assessmentsPaneEnabled:!0,children:(0,c.Y)(ie,{assessments:t})})})};var ce=n(777);var ue=n(57248);let me=function(e){return e.TRACE_COUNT="trace_count",e.LATENCY="latency",e.INPUT_TOKENS="input_tokens",e.OUTPUT_TOKENS="output_tokens",e.TOTAL_TOKENS="total_tokens",e}({});const pe=50,ge=90,fe=99,ve=e=>`P${e.toFixed(1)}`,he="time_bucket";let ye=function(e){return e.STATUS="status",e.TAG="tag",e.METADATA="metadata",e}({}),xe=function(e){return e.OK="OK",e.ERROR="ERROR",e}({});const be=(e,t)=>`trace.${e} = "${t}"`;let Se=function(e){return e.ASSESSMENT_COUNT="assessment_count",e.ASSESSMENT_VALUE="assessment_value",e}({});let Ae=function(e){return e.NAME="name",e.TYPE="type",e}({}),we=function(e){return e.FEEDBACK="feedback",e.EXPECTATION="expectation",e}({});const Ye=(e,t)=>`assessment.${e} = "${t}"`;let Ie=function(e){return e.ASSESSMENT_NAME="assessment_name",e.ASSESSMENT_VALUE="assessment_value",e}({}),Te=function(e){return e.SPAN_COUNT="span_count",e.LATENCY="latency",e}({});let Ce=function(e){return e.NAME="name",e.STATUS="status",e.TYPE="type",e}({}),Ee=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e.WORKFLOW="WORKFLOW",e.TASK="TASK",e.GUARDRAIL="GUARDRAIL",e.EVALUATOR="EVALUATOR",e}({}),Me=function(e){return e.OK="OK",e.ERROR="ERROR",e.UNSET="UNSET",e}({});const Ne=(e,t)=>`span.${e} = "${t}"`;let _e=function(e){return e.SPAN_NAME="span_name",e.SPAN_TYPE="span_type",e.SPAN_STATUS="span_status",e}({}),Re=function(e){return e.TRACES="TRACES",e.SPANS="SPANS",e.ASSESSMENTS="ASSESSMENTS",e}({}),ke=function(e){return e.COUNT="COUNT",e.SUM="SUM",e.AVG="AVG",e.PERCENTILE="PERCENTILE",e.MIN="MIN",e.MAX="MAX",e}({});n(33120);var De=n(33145),Fe=n(884),Oe=n(97407),Le=n(61060);const He={key:"",value:""},Ve=({componentIdPrefix:e,onSuccess:t,onClose:n})=>{const o=(0,d.tz)(),[u,m]=(0,s.useState)(void 0),g=(0,s.useMemo)(()=>u?(0,w.isArray)(u.tags)?u.tags.filter(({key:e})=>!e.startsWith(Y.nt)):(0,w.isObject)(u.tags)?Object.entries(u.tags).map(([e,t])=>({key:e,value:String(t)})).filter(({key:e})=>!e.startsWith(Y.nt)):[]:[],[u]),[f,v]=(0,s.useState)(!1),{theme:h}=(0,l.u)(),y=(0,Fe.mN)({mode:"onChange"}),x=(0,Oe.$W)({name:"tags",emptyValue:{key:"",value:""},keyProperty:"key",valueProperty:"value",form:y,defaultValues:g}),b=()=>{v(!1),m(void 0),y.reset({tags:[He]}),null===n||void 0===n||n()},{mutate:A,isLoading:I,error:T}=(({onSuccess:e})=>(0,Le.n)({mutationFn:async({deletedTags:e,modelTraceInfo:t,newTags:n})=>{var s;if((0,r.F9)()&&(0,a.gD)(t)&&t.trace_location&&(0,a.ko)(t)){const s=n.map(e=>U._A.setTraceTagV4({tag:e,traceLocation:t.trace_location,traceId:t.trace_id})),o=e.map(e=>U._A.deleteTraceTagV4({tagKey:e.key,traceLocation:t.trace_location,traceId:t.trace_id}));return Promise.all([...s,...o])}const o=(0,a.gD)(t)?t.trace_id:null!==(s=t.request_id)&&void 0!==s?s:"",i=n.map(e=>U.TJ.setTraceTagV3({tag:e,traceId:o})),l=e.map(e=>U.TJ.deleteTraceTagV3({tagKey:e.key,traceId:o}));return Promise.all([...i,...l])},onSuccess:e}))({onSuccess:()=>{b(),null===t||void 0===t||t()}});return{TagAssignmentModal:(0,c.FD)(S.d,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_121",title:(0,c.Y)(d.sA,{id:"xyEaut",defaultMessage:"Add tags"}),visible:f,destroyOnClose:!0,onCancel:b,footer:(0,c.FD)(c.FK,{children:[(0,c.Y)(l.B,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_130",onClick:b,disabled:I,children:(0,c.Y)(d.sA,{id:"Uf0z53",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_141",type:"primary",onClick:y.handleSubmit(async({tags:e})=>{var t,n;if(!u)return;const s=e.filter(({key:e})=>Boolean(e)),o=null!==(t=s.filter(e=>!(null!==g&&void 0!==g&&g.some(t=>t.key===e.key&&t.value===e.value))))&&void 0!==t?t:[],r=null!==(n=null===g||void 0===g?void 0:g.filter(e=>!s.some(t=>t.key===e.key)))&&void 0!==n?n:[];A({newTags:o,deletedTags:r,modelTraceInfo:u})}),loading:I,disabled:I,children:(0,c.Y)(d.sA,{id:"r7aGM3",defaultMessage:"Save"})})]}),children:[T&&(0,c.Y)(i.Alert,{type:"error",message:T instanceof Error?T.message:String(T),componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_157",closable:!1,css:(0,p.AH)({marginBottom:h.spacing.sm},"")}),(0,c.FD)(Oe.Es,{...x,children:[(0,c.FD)(Oe.qd,{children:[(0,c.Y)(Oe.C2,{children:(0,c.Y)(d.sA,{id:"eLgTRT",defaultMessage:"Key"})}),(0,c.Y)(Oe.C2,{children:(0,c.Y)(d.sA,{id:"sBsRzu",defaultMessage:"Value"})})]}),x.fields.map((e,t)=>(0,c.FD)(Oe.qd,{children:[(0,c.Y)(Oe.R0,{index:t,rules:{validate:{unique:e=>{const n=x.getTagsValues();return(null===n||void 0===n?void 0:n.findIndex(t=>t.key===e))===t||o.formatMessage({id:"JPd7WA",defaultMessage:"Key must be unique"})},required:e=>{var n;const s=x.getTagsValues();return!(null!==s&&void 0!==s&&null!==(n=s.at(t))&&void 0!==n&&n.value&&!e)||o.formatMessage({id:"XG8dcL",defaultMessage:"Key is required if value is present"})}}}}),(0,c.Y)(Oe.tP,{index:t}),(0,c.Y)(Oe.ki,{index:t,componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_hooks_useunifiedtracetagsmodal_207"})]},e.id))]})]}),showTagAssignmentModal:e=>{m(e),v(!0)},hideTagAssignmentModal:b}};function Be(e){const t=(0,s.useRef)(),n=!(!t.current||e.length!==t.current.length)&&e.every((e,n)=>{var s;return e===(null===(s=t.current)||void 0===s?void 0:s[n])});return n||(t.current=e),n&&t.current?t.current:e}var $e=n(93812),Ue=n(47784);const ze=({trace:e})=>{var t;const{theme:n}=(0,l.u)(),o=(0,s.useMemo)(()=>{var t;return null!==(t=e.data)&&void 0!==t&&t.spans?(0,a.jW)(e):null},[e]);if(!o)return null;const r=o.chatMessages,i=null!==(t=null===r||void 0===r?void 0:r.slice(null===r||void 0===r?void 0:r.findLastIndex(e=>"user"===e.role)))&&void 0!==t?t:[];if(0!==i.length)return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:null===i||void 0===i?void 0:i.map((e,t)=>(0,c.Y)($e.X,{message:e,css:(0,p.AH)({maxWidth:"80%",alignSelf:"user"===e.role?"flex-start":"flex-end",borderWidth:2,borderRadius:n.borders.borderRadiusMd},"")},t))});const u=(0,a.g_)(o.inputs).filter(e=>"null"!==e.value).reverse(),m=(0,a.g_)(o.outputs).filter(e=>"null"!==e.value).reverse();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-start",borderRadius:n.borders.borderRadiusMd,backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(Ue.l,{title:(0,c.Y)(d.sA,{id:"nJxDSh",defaultMessage:"Inputs"}),data:u,renderMode:"default",sectionKey:"summary-inputs",maxVisibleItems:1,maxVisibleChatMessages:1})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-end",backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(Ue.l,{title:(0,c.Y)(d.sA,{id:"adVHxN",defaultMessage:"Outputs"}),data:m,renderMode:"default",sectionKey:"summary-outputs",maxVisibleItems:1,maxVisibleChatMessages:1})})]})};var je=n(5075);const Pe=e=>"expectation"in e;var Ke={name:"idfvfs",styles:"display:flex;justify-content:flex-start"},We={name:"92hyw0",styles:"max-width:150px"};const qe=({trace:e,getAssessmentTitle:t,onAddAssessmentsClick:n})=>{const{theme:o}=(0,l.u)(),r=(0,a.gD)(e.info)?e.info:null,u=(0,s.useMemo)(()=>{const e=((null===r||void 0===r?void 0:r.assessments)||[]).filter(e=>!(0,a.rX)(e)).filter(e=>!1!==e.valid),t=(0,w.groupBy)(e,e=>e.assessment_name);return(0,w.mapValues)(t,e=>(0,w.orderBy)(e,["create_time"],["desc"]))},[null===r||void 0===r?void 0:r.assessments]);if((0,w.isEmpty)(u))return n?(0,c.Y)("div",{css:Ke,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.session-view.single-chart-turn-assessments.add-assessment",icon:(0,c.Y)(i.PlusIcon,{}),size:"small",onClick:n,css:[{marginTop:o.spacing.sm},(0,l.i)({backgroundColor:o.colors.backgroundPrimary}),""],children:(0,c.Y)(d.sA,{id:"HTQZeI",defaultMessage:"Evaluate trace"})})}):null;const m=Object.values(u);return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",gap:o.spacing.sm,flexWrap:"wrap",width:"100%",minWidth:0,overflow:"hidden"},""),children:(0,c.Y)(i.Overflow,{noMargin:!0,css:(0,p.AH)({gap:o.spacing.sm,width:"100%",minWidth:0,maxWidth:"100%"},""),visibleItemsCount:5,children:m.map(e=>{var n,s;const o=(0,w.first)(e);if(!o)return null;const r=t(o.assessment_name),a=null!==(n=null===(s=(0,De.e)(o))||void 0===s?void 0:s.toString())&&void 0!==n?n:"";return(0,c.Y)("div",{children:(0,c.Y)(je.Q,{prefix:(0,c.FD)(c.FK,{children:[r,": "]}),jsonValue:a,css:We,skipIcons:Pe(o),overrideColor:Pe(o)?"default":void 0})},o.assessment_id)})})})},Ge=({modelTraces:e})=>{const t=(0,x.nJ)(),{theme:n}=(0,l.u)();return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",overflow:"hidden",flex:1,"&>div":{flex:1,overflow:"hidden"},"&>div:not(:first-child)":{borderLeft:`1px solid ${n.colors.border}`}},""),children:null===e||void 0===e?void 0:e.map((e,n)=>{const s=e.info;return(0,a.gD)(s)?(0,p.n)(x.DK,{...t,readOnly:!0,modelTrace:e,key:s.trace_id},(0,c.Y)(J._,{modelTraceInfo:s},s.trace_id)):null})})},Je=({modelTraces:e})=>{const t=(0,x.nJ)(),{theme:n}=(0,l.u)();return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flex:1,overflow:"hidden","&>div:not(:first-child)":{borderLeft:`1px solid ${n.colors.border}`}},""),children:e.map(e=>(0,p.n)(x.DK,{...t,readOnly:!0,modelTrace:e,key:(0,a.MF)(e)},(0,c.Y)(Qe,{})))})},Qe=()=>{const{rootNode:e}=(0,x.nJ)(),t=(0,a.yt)(e);return e?(0,c.Y)(P.n,{rootNode:e,intermediateNodes:t}):null};var Ze=n(12998);var Xe={name:"1wcfv52",styles:"margin-right:0"};const et=({modelTrace:e})=>{const[t,n]=(0,s.useMemo)(()=>{var t;const n=e.info;return(0,a.ko)(n)&&(0,a.gD)(n)?[(0,a.vX)(n),n.trace_id]:[(0,a.gD)(n)?n.trace_id:null!==(t=n.request_id)&&void 0!==t?t:""]},[e]),{copy:o,tooltipMessage:r}=(0,Ze.Ld)(t,t),{theme:d}=(0,l.u)();return(0,c.Y)(S.T,{content:r,componentId:"shared.model-trace-explorer.compare-modal.trace-id-tag-tooltip",children:(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.compare-modal.trace-id-tag",onClick:o,css:Xe,color:"purple",children:(0,c.Y)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:d.spacing.xs},""),children:(0,c.Y)("span",{children:null!==n&&void 0!==n?n:t})})})})};var tt={name:"1y6fne2",styles:"overflow:hidden;height:100%;display:flex;flex-direction:column"},nt={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},st={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ot={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const rt=({modelTraces:e,className:t})=>{const[n,o]=(0,s.useState)("summary"),{theme:r}=(0,l.u)(),u=(0,s.useCallback)(e=>{o(e)},[]);return(0,c.FD)("div",{css:tt,className:t,children:[(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:r.spacing.md,paddingBottom:r.spacing.sm,display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,c.Y)(l.T.Hint,{children:(0,c.Y)(d.sA,{id:"07nYAU",defaultMessage:"Compared IDs:"})}),e.map(e=>(0,c.Y)(et,{modelTrace:e},(0,a.MF)(e)))]}),(0,c.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:n,onValueChange:u,css:nt,children:[(0,c.FD)(i.Tabs.List,{css:(0,p.AH)({paddingLeft:r.spacing.md,flexShrink:0},""),children:[(0,c.Y)(i.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(i.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(i.Tabs.Content,{value:"summary",css:st,children:(0,c.Y)(Je,{modelTraces:e})}),(0,c.Y)(i.Tabs.Content,{value:"detail",css:ot,children:(0,c.Y)(Ge,{modelTraces:e})})]})]})};var at=n(60062);const it=(e,t={})=>{const n=(0,at.E)({queries:e.map(e=>({queryKey:["GET_TRACE_BY_ID",e],queryFn:async()=>{var t;const n=(0,a.Y5)(e);return U.TJ.getTraceV3(null!==(t=null===n||void 0===n?void 0:n.trace_id)&&void 0!==t?t:e)},enabled:Boolean(e),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}))});return{data:Be((0,w.compact)(n.map(e=>e.data))),isFetching:n.some(e=>e.isFetching),isLoading:n.some(e=>e.isLoading)}},lt=(0,s.createContext)({renderExportTracesToDatasetsModal:()=>null,DrawerComponent:i.Drawer}),dt=({children:e,renderExportTracesToDatasetsModal:t,DrawerComponent:n=i.Drawer})=>{const o=(0,s.useMemo)(()=>({renderExportTracesToDatasetsModal:t,DrawerComponent:n}),[t,n]);return(0,c.Y)(lt.Provider,{value:o,children:e})},ct=()=>(0,s.useContext)(lt);var ut={name:"inxa61",styles:"flex:1;overflow:hidden"};const mt=({selectPreviousEval:e,selectNextEval:t,isPreviousAvailable:n,isNextAvailable:o,renderModalTitle:r,handleClose:a,children:u,isLoading:g,experimentId:f,traceInfo:v})=>{const{theme:h}=(0,l.u)(),[y,x]=(0,s.useState)(!1),{renderExportTracesToDatasetsModal:b,DrawerComponent:S}=ct(),A=(0,s.useCallback)(s=>{if(s.target instanceof HTMLElement){var r,a;if("tab"===s.target.role)return;const e=null===(r=s.target)||void 0===r||null===(a=r.tagName)||void 0===a?void 0:a.toLowerCase();if("input"===e||"textarea"===e||s.target.isContentEditable)return}"ArrowLeft"===s.key&&n?(s.stopPropagation(),e()):"ArrowRight"===s.key&&o&&(s.stopPropagation(),t())},[n,o,e,t]);(0,s.useEffect)(()=>(window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}),[A]);const w=Boolean(b&&f&&v);return(0,c.Y)(S.Root,{open:!0,onOpenChange:e=>{e||a()},children:(0,c.FD)(S.Content,{componentId:"mlflow.evaluations_review.modal",width:"90vw",title:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:h.spacing.sm,alignItems:"center"},""),children:[(0,c.Y)(l.B,{componentId:"mlflow.evaluations_review.modal.previous_eval",disabled:!n,onClick:()=>e(),children:(0,c.Y)(l.n,{})}),(0,c.Y)(l.B,{componentId:"mlflow.evaluations_review.modal.next_eval",disabled:!o,onClick:()=>t(),children:(0,c.Y)(l.o,{})}),(0,c.Y)("div",{css:ut,children:r()}),w&&(0,c.Y)(l.B,{componentId:"mlflow.evaluations_review.modal.add_to_evaluation_dataset",onClick:()=>x(!0),icon:(0,c.Y)(i.PlusIcon,{}),children:(0,c.Y)(d.sA,{id:"ZmiY49",defaultMessage:"Add to dataset"})})]}),expandContentToFullHeight:!0,css:[{"&>div":{overflow:"hidden"},"&>div:first-child":{paddingLeft:h.spacing.md,paddingTop:1,paddingBottom:1,"&>button":{flexShrink:0}}},""],children:[(0,c.Y)(l.a8,{zIndexBase:2*h.options.zIndexBase,children:g?(0,c.Y)(m.F,{}):(0,c.Y)(c.FK,{children:u})}),null===b||void 0===b?void 0:b({selectedTraceInfos:v?[v]:[],experimentId:null!==f&&void 0!==f?f:"",visible:y,setVisible:x})]})})}},64667:function(e,t,n){n.d(t,{$6:function(){return r},RF:function(){return i},dD:function(){return o},tl:function(){return s},w8:function(){return a}});let s=function(e){return e.EQUALS="=",e.NOT_EQUALS="!=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e.CONTAINS="CONTAINS",e.RLIKE="RLIKE",e}({}),o=function(e){return e.IS_NOT_NULL="IS NOT NULL",e}({}),r=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),a=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const i={[a.ASSESSMENT]:"Assessments",[a.EXPECTATION]:"Expectations",[a.TAG]:"Tags",[a.INFO]:"\xa0"}},68364:function(e,t,n){n.d(t,{W:function(){return g},Y:function(){return A}});var s=n(68248),o=n(76118),r=n(46709),a=n(82716),i=n(27757),l=n(79081),d=n(42747),c=n(5075),u=n(96586),m=n(33145),p=n(73408);const g=300;var f={name:"11qaxcx",styles:"display:inline-flex;max-width:100%"},v={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const h=({metadata:e})=>{const{theme:t}=(0,i.u)(),n=(0,d.tz)(),o=null===e||void 0===e?void 0:e.span_name;if(!e||!o)return null;const r=n.formatMessage({id:"S3YY1P",defaultMessage:"Span: {spanName}"},{spanName:o});return(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexWrap:"wrap",gap:t.spacing.xs},""),children:(0,p.Y)(l.T,{componentId:"shared.model-trace-explorer.span-name-tooltip",content:r,children:(0,p.Y)(a.Tag,{css:f,componentId:"shared.model-trace-explorer.span-name-tag",color:"default",children:(0,p.Y)("span",{css:v,children:r})})})})};var y={name:"ozd7xs",styles:"flex-shrink:0"},x={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},b={name:"s5xdrg",styles:"display:flex;align-items:center"};const S=({assessment:e})=>{const{theme:t}=(0,i.u)(),n=(0,m.e)(e),r=e.rationale,l=!(0,o.isNil)(e.feedback.error),d=!l&&(0,o.isNil)(n);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.md,gap:t.spacing.sm},""),children:[(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:t.spacing.sm},""),children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,flex:1,minWidth:0},""),children:[(0,p.Y)(a.GavelIcon,{css:y}),(0,p.Y)(i.T.Text,{bold:!0,css:x,children:e.assessment_name})]})}),l&&(0,p.Y)(u.B,{error:e.feedback.error}),d&&(0,p.Y)(u.B,{error:{error_code:"NO_RESULT",error_message:"The scorer did not return a result for this trace."}}),!l&&!d&&(0,p.Y)("div",{css:b,children:(0,p.Y)(c.Q,{jsonValue:JSON.stringify(n),assessmentName:e.assessment_name})}),(0,p.Y)(h,{metadata:e.metadata}),r&&(0,p.Y)(i.T.Text,{css:(0,s.AH)({color:t.colors.textSecondary,lineHeight:t.typography.lineHeightBase},""),children:r})]})},A=({assessments:e,className:t})=>{const{theme:n}=(0,i.u)(),o=(0,r.useMemo)(()=>e.filter(e=>"feedback"in e&&!1!==e.valid),[e]);return 0===o.length?(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,minWidth:g,height:"100%",borderLeft:`1px solid ${n.colors.border}`},""),className:t,children:(0,p.Y)(i.T.Text,{color:"secondary",children:(0,p.Y)(d.sA,{id:"PKwacx",defaultMessage:"No assessments available"})})}):(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",padding:n.spacing.md,paddingTop:n.spacing.sm,gap:n.spacing.md,minWidth:g,height:"100%",borderLeft:`1px solid ${n.colors.border}`,overflowY:"auto"},""),className:t,children:o.map(e=>(0,p.Y)(S,{assessment:e},e.assessment_id))})}},71540:function(e,t,n){n.d(t,{Cf:function(){return g},Co:function(){return _},Mq:function(){return T},On:function(){return f},PO:function(){return h},ZS:function(){return w},ZZ:function(){return C},c7:function(){return b},d9:function(){return S},h:function(){return I},h2:function(){return v},ih:function(){return N},kQ:function(){return c},kZ:function(){return x},kf:function(){return m},mF:function(){return F},nr:function(){return R},nt:function(){return u},p6:function(){return A},v8:function(){return y},zl:function(){return D}});var s=n(76118),o=n(58663),r=n(12129),a=n(21636),i=n(90448),l=n(33481),d=n(4947);const c="mlflow.sourceRun",u="mlflow.",m="monitor",p="mlflow.trace.spansLocation",g="TRACKING_STORE",f=e=>(null===e||void 0===e?void 0:e.evaluationId)||"",v=e=>(null===e||void 0===e?void 0:e.trace_id)||"",h=e=>e.split(":").pop(),y=e=>e.split(":").pop(),x=e=>`${d.Pn}:${e}`,b=e=>`${d.rc}:${e}`,S=e=>(0,s.uniq)(e.map(e=>Object.keys(e.tags||{}).filter(e=>e&&!e.startsWith(u))).flat()),A=(e,t)=>e&&t?e.reduce((e,n)=>{var s;const o=n.assessments||[],r=o.filter(e=>{var n;const s=null===(n=e.metadata)||void 0===n?void 0:n[a.Vg];return!s||s===t});return(null===(s=n.tags)||void 0===s?void 0:s[a.Ex])?e:r.length===o.length?(e.push(n),e):(e.push({...n,assessments:r}),e)},[]):e,w=e=>e.length>0&&Boolean(e[0].traceInfo),Y=e=>{try{return JSON.parse(e)}catch{return e}},I=e=>{var t;return e.request_preview||e.request||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceInputs"])||""},T=e=>{var t;return e.response_preview||e.response||(null===(t=e.trace_metadata)||void 0===t?void 0:t["mlflow.traceOutputs"])||""};function C(e){var t;return(null===e||void 0===e||null===(t=e.tags)||void 0===t?void 0:t[p])||void 0}const E=["agent/latency_seconds"];const M=e=>{var t,n,s,o,r;const a=null===(t=e.feedback)||void 0===t?void 0:t.value,i=e.assessment_name===l._1.OVERALL_ASSESSMENT,d=(e=>{var t,n,s;if(null===(t=e.source)||void 0===t||!t.source_type)return;const o=null===(n=e.source)||void 0===n?void 0:n.source_type;let r;return r="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:r,sourceId:(null===(s=e.source)||void 0===s?void 0:s.source_id)||"",metadata:{}}})(e),c=(null===(n=e.feedback)||void 0===n?void 0:n.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof a?a:void 0,booleanValue:"boolean"===typeof a?a:void 0,numericValue:"number"===typeof a?a:void 0,errorCode:null===c||void 0===c?void 0:c.error_code,errorMessage:null===c||void 0===c?void 0:c.error_message,rationale:(null===(s=e.metadata)||void 0===s?void 0:s.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:i?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(r=e.metadata)||void 0===r?void 0:r.suggested_action}:void 0,metadata:e.metadata}},N=e=>{var t;const n=v(e),r=[],a={},d={};null===(t=e.assessments)||void 0===t||t.forEach(e=>{const t=e.assessment_name;E.includes(t)||!1!==e.valid&&((e=>Boolean("expectation"in e&&e.expectation))(e)?function(e,t){const n=e.assessment_name,s=(0,o.ed)(e);Array.isArray(s)?t[n]=s.map(e=>"string"===typeof e?Y(e):e):t[n]="string"===typeof s?Y(s):s}(e,d):function(e,t,n){const s=e.assessment_name,o=M(e);s===l._1.OVERALL_ASSESSMENT&&t.push(o),n[s]||(n[s]=[]),n[s].push(o)}(e,r,a))});const c=I(e),u=T(e);let m=c,p={},g={};try{var f;p=JSON.parse(c);const e=p.messages;if(Array.isArray(e)&&!(0,s.isNil)(null===(f=e[0])||void 0===f?void 0:f.content)){var h;m=null===(h=e[e.length-1])||void 0===h?void 0:h.content}else{const e=(0,i.c1)(p);m=null!==e&&void 0!==e?e:(0,i.ng)(p)}}catch{p={request:c}}try{g={response:JSON.parse(u)}}catch{g={response:u}}return{evaluationId:n,requestId:e.client_request_id||n,inputsId:n,inputsTitle:m,inputs:p,outputs:g,targets:d,overallAssessments:r,responseAssessmentsByName:a,metrics:{},traceInfo:e,fullTraceId:(0,o.vX)(e)}},_=e=>w(e)?e.map(e=>{if(!e.traceInfo)return e;const t=N(e.traceInfo);return{...e,...t}}):e;function R(e,t){var n;if((0,s.isNil)(t))return;let r="doc_uri";const a=t.info.tags;if(null!==a&&void 0!==a&&a.retrievers){const e=Y(a.retrievers);"object"===typeof e&&e.length>0&&(r=e[0].doc_uri)}const i=t.data.spans.filter(e=>D(e.attributes,"mlflow.spanType")&&Y(D(e.attributes,"mlflow.spanType"))===o.VZ.RETRIEVER);if(0===i.length)return[];const l=D(null===(n=i.at(-1))||void 0===n?void 0:n.attributes,"mlflow.spanOutputs");if(!l)return[];const d=Y(l);if(!Array.isArray(d))return[];return d.map((t,n)=>{var s;return{docUrl:null===(s=t.metadata)||void 0===s?void 0:s[r],content:t.page_content,retrievalAssessmentsByName:k(e,n)}})}const k=(e,t)=>Object.fromEntries(Object.entries(e).map(([e,n])=>[e,n.filter(e=>{var n;return Number(null===e||void 0===e||null===(n=e.metadata)||void 0===n?void 0:n.span_output_key)===t})]).filter(([e,t])=>t.length>0)),D=(e,t)=>{var n,s;if(!e)return;if(!Array.isArray(e))return e[t];const o=e.find(e=>e.key===t);return null!==o&&void 0!==o&&o.value?null!==(n=null!==(s=o.value.string_value)&&void 0!==s?s:o.value.int_value)&&void 0!==n?n:o.value.bool_value:void 0},F=(e,t)=>{const n=(null===e||void 0===e?void 0:e.trace_id)||t;return e&&(0,r.ko)(e)?(0,o.vX)(e):n||""}},72125:function(e,t,n){n.d(t,{aW:function(){return B},gr:function(){return L}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(82716),l=n(42747),d=n(49425),c=n(73408);function u({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,a.u)(),{attributes:u}=e,m=(0,o.keys)(u).length>0,p=!(0,o.isNil)(n)&&n.span.key===e.key;return!m||(0,o.isNil)(u)?(0,c.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,c.Y)(i.Empty,{description:(0,c.Y)(l.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm,padding:r.spacing.md},""),children:Object.entries(u).map(([e,s])=>(0,c.Y)(d.C,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:p&&"attributes"===n.section&&n.key===e},e))})}var m=n(91461),p=n(33669),g=n(21209);function f({chatMessages:e,chatTools:t}){const{theme:n}=(0,a.u)();return(0,c.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,c.Y)(g.p,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,c.Y)(l.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map(e=>(0,c.Y)(m.E,{tool:e},e.function.name))})}),(0,c.Y)(g.p,{title:(0,c.Y)(l.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,c.Y)(p.J,{messages:e})})]})}var v=n(86125);var h={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},y={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function x({activeSpan:e,className:t,searchFilter:n,activeMatch:i}){const{theme:u}=(0,a.u)(),m=(0,r.useMemo)(()=>(0,v.g_)(null===e||void 0===e?void 0:e.inputs),[e]),p=(0,r.useMemo)(()=>(0,v.g_)(null===e||void 0===e?void 0:e.outputs),[e]);if((0,o.isNil)(e))return null;const f=m.length>0,x=p.length>0,b=!(0,o.isNil)(i)&&i.span.key===e.key;return(0,c.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[f&&(0,c.Y)(g.p,{withBorder:!0,css:(0,s.AH)({marginBottom:u.spacing.sm},""),sectionKey:"input",title:(0,c.Y)("div",{css:h,children:(0,c.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:m.map(({key:e,value:t},s)=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:i,containsActiveMatch:b&&"inputs"===i.section&&i.key===e},e||s))})}),x&&(0,c.Y)(g.p,{withBorder:!0,sectionKey:"output",title:(0,c.Y)("div",{css:y,children:(0,c.Y)(l.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:p.map(({key:e,value:t})=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:i,containsActiveMatch:b&&"outputs"===i.section&&i.key===e},e))})})]})}var b=n(54625),S=n(79081);var A={name:"s5xdrg",styles:"display:flex;align-items:center"},w={name:"s5xdrg",styles:"display:flex;align-items:center"};function Y({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,a.u)();return(0,c.FD)(i.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:"codegen_no_dynamic_js_packages_web_shared_src_model_trace_explorer_modeltraceexplorerrendermodetoggle_25",value:e,onChange:e=>{t(e.target.value)},children:[(0,c.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,c.Y)(S.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,c.Y)(l.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,c.Y)("div",{css:A,children:(0,c.Y)(i.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,c.Y)(i.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,c.Y)(S.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,c.Y)(l.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,c.Y)("div",{css:w,children:(0,c.Y)(i.MarkdownIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var I={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function T({activeSpan:e,className:t,searchFilter:n,activeMatch:u}){const{theme:m}=(0,a.u)(),[p,f]=(0,r.useState)(!0),h=(0,r.useMemo)(()=>(0,v.g_)(e.inputs),[e]),y=e.outputs,x=h.length>0,S=!(0,o.isNil)(u)&&u.span.key===e.key,A=S&&"outputs"===u.section;return(0,c.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[x&&(0,c.Y)(g.p,{sectionKey:"input",css:(0,s.AH)({marginBottom:m.spacing.sm},""),title:(0,c.Y)(l.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:m.spacing.sm},""),children:h.map(({key:e,value:t},s)=>(0,c.Y)(d.C,{title:e,data:t,searchFilter:n,activeMatch:u,containsActiveMatch:S&&"inputs"===u.section&&u.key===e},e||s))})}),(0,c.Y)(g.p,{sectionKey:"output",title:(0,c.FD)("div",{css:I,children:[(0,c.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:m.spacing.sm},""),children:[(0,c.Y)(l.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,c.Y)(i.Tag,{componentId:"shared.model-trace-explorer.document-count",children:y.length})]}),!A&&(0,c.Y)(Y,{shouldRenderMarkdown:p,setShouldRenderMarkdown:f})]}),children:p&&!A?(0,c.Y)("div",{css:(0,s.AH)({border:`1px solid ${m.colors.border}`,borderRadius:m.legacyBorders.borderRadiusMd},""),children:y.map((e,t)=>(0,c.Y)("div",{css:(0,s.AH)({borderBottom:t!==y.length-1?`1px solid ${m.colors.border}`:""},""),children:(0,c.Y)(b.p,{text:e.page_content,metadata:e.metadata},t)},t))}):(0,c.Y)("div",{css:(0,s.AH)({border:`1px solid ${m.colors.border}`,borderRadius:m.legacyBorders.borderRadiusMd,padding:m.spacing.md},""),children:(0,c.Y)(d.C,{title:"",data:JSON.stringify(y,null,2),searchFilter:n,activeMatch:u,containsActiveMatch:S&&"outputs"===u.section})})})]})}function C({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:i}=(0,a.u)();return!(0,o.isNil)(e)&&(0,v.vl)(e)?(0,c.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(T,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})}):(0,c.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:i.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(x,{activeSpan:e,className:t,searchFilter:n,activeMatch:r})})}var E=n(94664);function M({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:r}=(0,a.u)(),{events:u}=e,m=!(0,o.isNil)(n)&&n.span.key===e.key;return Array.isArray(u)&&0!==u.length?(0,c.Y)("div",{css:(0,s.AH)({padding:r.spacing.md},""),children:u.map((e,o)=>{const l=e.attributes,u="exception"===e.name?(0,c.FD)(c.FK,{children:[(0,c.Y)(i.XCircleIcon,{css:(0,s.AH)({marginRight:r.spacing.sm},""),color:"danger"}),(0,c.Y)(a.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return l?(0,c.Y)(g.p,{sectionKey:e.name,title:u,withBorder:!0,children:(0,c.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:Object.keys(l).map(s=>{const r=(0,v.Q0)(e.name,o,s);return(0,c.Y)(d.C,{title:s,data:JSON.stringify(l[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:m&&"events"===n.section&&n.key===r,initialRenderMode:E.cC.TEXT},r)})})},`${e.name}-${o}`):null})}):(0,c.Y)("div",{css:(0,s.AH)({marginTop:r.spacing.md},""),children:(0,c.Y)(i.Empty,{description:(0,c.Y)(l.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}var N=n(68364),_=n(76127),R=n(26059),k=n(53915),D=n(85060),F=n(57819),O=n(84612);const L=250+O.uZ;var H={name:"1y44vlr",styles:"height:auto;border-left:0"};function V({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:d,setActiveTab:m,onPaneResize:p}){const{theme:g}=(0,a.u)(),{assessmentsPaneExpanded:h,assessmentsPaneEnabled:y,isInComparisonView:x,updatePaneSizeRatios:b,getPaneSizeRatios:S,readOnly:A}=(0,k.nJ)(),[w,Y]=(0,r.useState)(500),I={flex:1,marginTop:-g.spacing.md,overflowY:"auto"},T=(0,r.useMemo)(()=>(0,v.bN)(null===e||void 0===e?void 0:e.assessments),[null===e||void 0===e?void 0:e.assessments]),E=(0,r.useCallback)(e=>{b({detailsSidebar:e})},[b]);if((0,o.isNil)(e))return(0,c.Y)(i.Empty,{description:"Please select a span to view more information"});const L=(0,v.N7)(e),V=L>0,B=!(0,o.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,o.isNil)(null===e||void 0===e?void 0:e.outputs),$=(0,c.FD)(i.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${g.colors.border}`,minWidth:200,position:"relative"},""),value:d,onValueChange:e=>m(e),children:[!A&&(0,c.Y)("div",{css:(0,s.AH)({position:"absolute",right:h?g.spacing.xs:g.spacing.md,top:g.spacing.xs,zIndex:1,backgroundColor:g.colors.backgroundPrimary},""),children:(0,c.Y)(D.N,{})}),(0,c.FD)(i.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:g.spacing.md,paddingRight:g.spacing.sm,boxSizing:"border-box",width:"100%"},""),dangerouslyAppendEmotionCSS:{"&>div":{flex:1}},children:[e.chatMessages&&(0,c.Y)(i.Tabs.Trigger,{value:"chat",children:(0,c.Y)(l.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),B&&(0,c.Y)(i.Tabs.Trigger,{value:"content",children:(0,c.Y)(l.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,c.Y)(i.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,c.FD)(i.Tabs.Trigger,{value:"events",children:["Events ",V&&(0,c.Y)(_.X,{count:L})]}),A&&(0,c.Y)(i.Tabs.Trigger,{value:"assessments",children:(0,c.Y)(l.sA,{id:"KdsrPi",defaultMessage:"Assessments"})})]}),e.chatMessages&&(0,c.Y)(i.Tabs.Content,{css:I,value:"chat",children:(0,c.Y)(f,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,c.Y)(i.Tabs.Content,{css:I,value:"content",children:(0,c.Y)(C,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(i.Tabs.Content,{css:I,value:"attributes",children:(0,c.Y)(u,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(i.Tabs.Content,{css:I,value:"events",children:(0,c.Y)(M,{activeSpan:e,searchFilter:t,activeMatch:n})}),A&&(0,c.Y)(i.Tabs.Content,{css:I,value:"assessments",children:(0,c.Y)(N.Y,{assessments:(0,v.bN)(e.assessments),css:H})})]}),U=(0,c.Y)(F.i,{assessments:T,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0});return!x&&y&&h?(0,c.Y)(R.A,{initialRatio:S().detailsSidebar,paneWidth:w,setPaneWidth:Y,leftChild:$,leftMinWidth:250,rightChild:U,rightMinWidth:O.uZ+2*g.spacing.sm,onRatioChange:E}):$}const B=r.memo(V)},76256:function(e,t,n){n.d(t,{L:function(){return o},S:function(){return r}});var s=n(43617);function o(e,t){return(0,s.N4)(t)}const r=s.N4},81390:function(e,t,n){n.d(t,{B$:function(){return g},De:function(){return l},EA:function(){return h},NP:function(){return y},QJ:function(){return d},VC:function(){return m},VD:function(){return v},X6:function(){return f},dM:function(){return p},fJ:function(){return x},os:function(){return u},u4:function(){return c},vf:function(){return i}});var s=n(76118),o=n(46709),r=n(94664),a=n(86125);const i=1/0,l=16,d=32,c={HIGH:5,NORMAL:3,LOW:1},u=(e,t)=>{const n=[],s=e=>{var o;e&&(n.push(e),t.has(e.key)&&(null===(o=e.children)||void 0===o||o.forEach(s)))};return e.forEach(s),n},m=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},p=(e,t=1/0)=>{const n={},s=(e,o)=>{var r;!e||o>t||(n[e.key]=e,null===(r=e.children)||void 0===r||r.forEach(e=>s(e,o+1)))};return e.forEach(s,0),n},g=(e={})=>{const[t,n]=(0,o.useState)(()=>{if(e.rootNodes){const t=(0,s.values)(p(e.rootNodes,e.initialExpandDepth)).map(e=>e.key);return new Set(t)}return new Set});return{expandedKeys:t,setExpandedKeys:n}},f=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},v=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex(e=>v(e,t)>-1)},h=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(h);return Math.max(...n)+1},y=(e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n},x=e=>{var t;return!!e.parentId&&([r.UG.AGENT,r.UG.RETRIEVER,r.UG.CHAT_MODEL,r.UG.TOOL,r.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:r.UG.UNKNOWN)||(0,a.N7)(e)>0)}},83219:function(e,t,n){n.d(t,{c:function(){return g}});var s=n(68248),o=n(82716),r=n(27757),a=n(86125),i=n(21209),l=n(42401),d=n(73408);const c=new Set(["exception.type","exception.message","exception.stacktrace"]),u=e=>{var t;const n=null!==(t=null===e||void 0===e?void 0:e.attributes)&&void 0!==t?t:{},s=n["exception.stacktrace"],o=Object.entries(n).filter(([e])=>!c.has(e)).map(([e,t])=>({key:e,value:t}));return s?[{key:"exception.stacktrace",value:s,renderMode:"text"},...o]:o};var m={name:"ozd7xs",styles:"flex-shrink:0"},p={name:"17a6bm5",styles:"min-width:0;flex:1"};const g=({node:e})=>{const{theme:t}=(0,r.u)(),n=(0,a.bn)(e),c=!e.parentId,g=n[0];if(!g||!(0,a.gq)(g))return null;const f=g.attributes["exception.type"],v=g.attributes["exception.message"];return(0,d.Y)(i.p,{withBorder:!0,isExceptionSection:!0,sectionKey:g.name,css:(0,s.AH)({marginBottom:c?t.spacing.sm:0},""),title:(0,d.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,minWidth:0,flex:1},""),children:[(0,d.Y)(o.XCircleIcon,{color:"danger",css:m}),(0,d.Y)("div",{css:p,children:(0,d.FD)(r.T.Text,{color:"error",bold:!0,css:(0,s.AH)({display:"block",width:`calc(100% - ${t.spacing.lg}px)`},""),children:[f,": ",v]})})]}),children:(0,d.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm,paddingBottom:t.spacing.sm,paddingLeft:c?0:t.spacing.lg},""),children:u(g).map(({key:e,value:t,renderMode:n})=>(0,d.Y)(l.B,{title:e,data:JSON.stringify(t,null,2),renderMode:null!==n&&void 0!==n?n:"text"},e))})},g.name)}},84612:function(e,t,n){n.d(t,{KN:function(){return d},Pt:function(){return i},jf:function(){return l},se:function(){return a},uZ:function(){return r}});var s=n(42747),o=n(73408);const r=250,a=e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")},i=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let r=Math.floor(n/31536e3);return r>=1?(0,o.Y)(s.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:r}}):(r=Math.floor(n/2592e3),r>=1?(0,o.Y)(s.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:r}}):(r=Math.floor(n/86400),r>=1?(0,o.Y)(s.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:r}}):(r=Math.floor(n/3600),r>=1?(0,o.Y)(s.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:r}}):(r=Math.floor(n/60),r>=1?(0,o.Y)(s.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:r}}):(0,o.Y)(s.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},l=e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}},d=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}}},85060:function(e,t,n){n.d(t,{N:function(){return d}});var s=n(82716),o=n(42747),r=n(53915),a=n(73408);var i={name:"4zleql",styles:"display:block"},l={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const d=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n,isInComparisonView:d}=(0,r.nJ)();return d?null:(0,a.Y)(s.SegmentedControlGroup,{css:i,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,a.Y)(s.SegmentedControlButton,{value:!0,disabled:!n,icon:(0,a.Y)(s.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:l,children:!e&&(0,a.Y)(o.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})}},86125:function(e,t,n){n.d(t,{$f:function(){return C},BS:function(){return f},CL:function(){return ee},Hq:function(){return X},I$:function(){return J},LS:function(){return x},M2:function(){return le},MF:function(){return k},N7:function(){return P},NH:function(){return h},OS:function(){return B},PC:function(){return W},Q0:function(){return z},UZ:function(){return E},W0:function(){return $},Y5:function(){return ue},ZI:function(){return ne},bN:function(){return ve},bn:function(){return j},cp:function(){return N},f7:function(){return w},gD:function(){return T},g_:function(){return V},gq:function(){return he},h8:function(){return q},ho:function(){return me},iZ:function(){return ce},ij:function(){return v},in:function(){return Z},jW:function(){return F},ko:function(){return ae},m4:function(){return ge},nr:function(){return ie},ob:function(){return D},pQ:function(){return se},rX:function(){return fe},tC:function(){return y},tI:function(){return pe},uM:function(){return O},vL:function(){return A},vX:function(){return de},vl:function(){return U},x0:function(){return Q},xD:function(){return b},yt:function(){return re}});var s=n(68248),o=n(76118),r=n(46709),a=n(94664),i=n(51847),l=n(90828),d=n(9773),c=n(69660),u=n(21636),m=n(81390),p=n(71540),g=n(73408);const f="model-trace-info-v3",v=e=>{},h=e=>{};function y(e){switch(e){case a.UG.LLM:return a.Dy.MODELS;case a.UG.CHAIN:return a.Dy.CHAIN;case a.UG.AGENT:return a.Dy.AGENT;case a.UG.TOOL:return a.Dy.WRENCH;case a.UG.CHAT_MODEL:return a.Dy.MODELS;case a.UG.RETRIEVER:return a.Dy.SEARCH;case a.UG.PARSER:return a.Dy.CODE;case a.UG.EMBEDDING:return a.Dy.NUMBERS;case a.UG.RERANKER:return a.Dy.SORT;case a.UG.MEMORY:return a.Dy.SAVE;case a.UG.FUNCTION:return a.Dy.FUNCTION;case a.UG.UNKNOWN:return a.Dy.UNKNOWN;default:return a.Dy.FUNCTION}}function x(e){switch(e){case a.UG.LLM:return"LLM";case a.UG.CHAIN:return"Chain";case a.UG.AGENT:return"Agent";case a.UG.TOOL:return"Tool";case a.UG.CHAT_MODEL:return"Chat model";case a.UG.RETRIEVER:return"Retriever";case a.UG.PARSER:return"Parser";case a.UG.EMBEDDING:return"Embedding";case a.UG.RERANKER:return"Reranker";case a.UG.MEMORY:return"Memory";case a.UG.FUNCTION:return"Function";case a.UG.UNKNOWN:return"Unknown";default:return e}}function b(e){try{return JSON.parse(e)}catch(t){return e}}const S=(e,t)=>{if(!t)return[];const n=[],s={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,o.map)(s,(s,o)=>{if("events"===o)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const s=[];return n.forEach((n,o)=>{const r=n.attributes;r&&Object.keys(r).forEach(a=>{const i=a.toLowerCase().includes(t),l=z(n.name,o,a);i&&s.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const d=JSON.stringify(r[a]).toLowerCase().split(t).length-1;for(let t=0;t<d;t++)s.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})})}),s})(e,t));V(s).forEach(s=>{s.key.toLowerCase().includes(t)&&n.push({span:e,section:o,key:s.key,isKeyMatch:!0,matchIndex:0});const r=s.value.toLowerCase().split(t).length-1;for(let t=0;t<r;t++)n.push({span:e,section:o,key:s.key,isKeyMatch:!1,matchIndex:t})})}),n};function A(e,t,n){var s,o;const r=t.toLowerCase().trim(),a=Object.values(n.spanTypeDisplayState).every(e=>e);if(""===r&&a)return{filteredTreeNodes:[e],matches:[]};const i=null!==(s=e.children)&&void 0!==s?s:[],l=[],d=[];i.forEach(e=>{const{filteredTreeNodes:t,matches:s}=A(e,r,n);l.push(...t),d.push(...s)});const c=(null!==(o=e.title)&&void 0!==o?o:"").toLowerCase(),u=S(e,r),m=u.length>0||c.includes(r),p=!e.type||n.spanTypeDisplayState[e.type],g=m&&p,f=l.length>0,v=P(e)>0;return g||n.showParents&&f||n.showExceptions&&v?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(d)}:{filteredTreeNodes:l,matches:d}}function w(e,t){var n;if((0,o.isNil)(t)||(0,o.isNil)(e))return;if(e.key===t)return e;const s=null!==(n=e.children)&&void 0!==n?n:[];for(const o of s){const e=w(o,t);if(e)return e}}const Y=(e,t,n,s,r,a)=>{var l,c;const u=b((0,p.zl)(e.attributes,"mlflow.spanType")),m=b((0,p.zl)(e.attributes,"mlflow.spanInputs")),f=b((0,p.zl)(e.attributes,"mlflow.spanOutputs")),v=N(e),h=M(e),x=null!==(l=r[h])&&void 0!==l?l:[];var S;v||x.push(...null!==(S=r[""])&&void 0!==S?S:[]);const A=b((0,p.zl)(e.attributes,"mlflow.chat.messages")),w=b((0,p.zl)(e.attributes,"mlflow.message.format")),Y=((e,t,n,s,r)=>{var a,i;if(Array.isArray(e)&&e.every(J))return(0,o.compact)(e.map(ne));const l=null!==(a=X(t,s))&&void 0!==a?a:[],c=null!==(i=X(n,s))&&void 0!==i?i:[];if("pydantic_ai"===s&&c.length>0)return l.length>0?l.concat(c):c;if("voltagent"===s&&r&&r.length>0){const e=(0,d.Nw)(t,n,r);if(e&&e.length>0)return e}return 0!==l.length&&0!==c.length?l.concat(c):void 0})(A,m,f,w,s),I=((e,t)=>{var n;return Array.isArray(e)&&e.every(W)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(W)?t.tools:void 0})(b((0,p.zl)(e.attributes,"mlflow.chat.tools")),m),T=(0,o.mapValues)((0,o.omitBy)(e.attributes,(e,t)=>t.startsWith("mlflow.")),e=>b(e)),C=e.events,E=(Number(_(e))-t)/1e3,k=(Number(null!==(c=R(e))&&void 0!==c?c:n)-t)/1e3;return{title:e.name,icon:(0,g.Y)(i.P,{type:y(u),hasException:P(e)>0,isRootSpan:!v}),type:u,key:h,start:E,end:k,children:s.slice().sort((e,t)=>e.start-t.start),inputs:m,outputs:f,attributes:T,events:C,chatMessageFormat:w,chatMessages:Y,chatTools:I,parentId:v,assessments:x,traceId:a}},I=(e,t)=>{if(!e)return"";if(t&&e.length<16)try{return(e=>{const t=atob(e),n=t.length;let s="";for(let o=0;o<n;o++)s+=t.charCodeAt(o).toString(16).padStart(2,"0");return s})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function T(e){return!!e&&"trace_location"in e}function C(e){return"start_time_unix_nano"in e&&Array.isArray(e.attributes)}function E(e){return"start_time_unix_nano"in e}function M(e){var t,n,s;return E(e)||C(e)?I(null!==(t=e.span_id)&&void 0!==t?t:"",!0):I(null!==(n=null===(s=e.context)||void 0===s?void 0:s.span_id)&&void 0!==n?n:"",!1)}function N(e){var t,n;return E(e)||C(e)?I(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):I(null!==(n=e.parent_id)&&void 0!==n?n:"",!1)}function _(e){return E(e)||C(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function R(e){return E(e)||C(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function k(e){var t;return T(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function D(e){var t,n;if(!T(e.info))return null;const s=Number(null===(t=e.info)||void 0===t||null===(n=t.trace_metadata)||void 0===n?void 0:n["mlflow.trace.sizeBytes"]);return(0,o.isNil)(s)||isNaN(s)?null:s}function F(e){const t=O(e);return t&&1===t.length?t[0]:null}function O(e){var t,n;const s=k(e),o=(null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans).map(oe),r={},l={};if(!o||0===o.length)return[];o.forEach(e=>{const t=M(e);r[t]=e,l[t]=[]}),o.forEach(e=>{var t;const n=M(e),s=N(e);null===(t=l[s])||void 0===t||t.push(n)});const d=Math.min(...o.map(e=>_(e))),c=Math.max(...o.map(e=>R(e))),u=L(e.info);function m(e){var t,n,o;const p=r[e],f=l[e].map(m);if(E(p)||C(p)||"parent_id"in p)return Y(p,d,c,f,u,s);const v=null!==(t=p.span_type)&&void 0!==t?t:a.UG.UNKNOWN;return{title:p.name,icon:(0,g.Y)(i.P,{type:y(v)}),type:v,key:p.context.span_id,start:Number(p.start_time)-d,end:Number(null!==(n=p.end_time)&&void 0!==n?n:c)-d,children:f.slice().sort((e,t)=>e.start-t.start),inputs:p.inputs,outputs:p.outputs,attributes:p.attributes,events:p.events,parentId:null!==(o=p.parent_id)&&void 0!==o?o:p.parent_span_id,assessments:[],traceId:s}}const p=new Array;return o.forEach(e=>{const t=N(e);t&&r[t]||p.push(m(M(e)))}),p}const L=e=>{let t=[];var n;T(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=H(e.tags);const s=(0,o.keyBy)(t,"assessment_id");Object.values(s).forEach(e=>{if(e.overrides){const t=s[e.overrides];e.overriddenAssessment=t}}),t=Object.values(s);const r=t.reduce((e,t)=>{var n;const s=null!==(n=t.span_id)&&void 0!==n?n:"";return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(r).forEach(e=>{r[e].sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())}),r},H=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map(([e,t])=>({key:e,value:t}))).filter(({key:e})=>e.startsWith("mlflow.assessment.")).map(({value:e})=>JSON.parse(e))};const V=e=>(0,o.isNil)(e)?[]:Array.isArray(e)||(0,o.isString)(e)||(0,o.isNumber)(e)||(0,o.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map(([e,t])=>({key:e,value:JSON.stringify(t,null,2)})),B=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:r,containsActiveMatch:a,activeMatch:i,scrollToActiveMatch:l})=>{const d=new RegExp(`(${(0,o.escapeRegExp)(e.trim())})`,"gi"),c=t.split(d),u=[];let m=0;for(let o=0;o<c.length;o++)if(c[o].toLowerCase().includes(e.toLowerCase().trim())){const e=a&&i.matchIndex===m,t=e?n:r,d=(0,g.Y)("span",{ref:e?l:null,css:(0,s.AH)({backgroundColor:t,scrollMarginTop:50},""),children:c[o]},o);m++,u.push(d)}else u.push(c[o]);return u},$=e=>(0,o.has)(e,"page_content"),U=e=>e.type===a.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,o.every)(e.outputs,$),z=(e,t,n)=>`${e}-${t}-${n}`,j=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter(e=>"exception"===e.name)},P=e=>j(e).length,K=e=>!(0,o.isNil)(e)&&(!(!(0,o.isNil)(e.type)&&!(0,o.isString)(e.type))&&(!(!(0,o.isNil)(e.description)&&!(0,o.isString)(e.description))&&!(!(0,o.isNil)(e.enum)&&!Array.isArray(e.enum)))),W=e=>{var t;if((0,o.isNil)(e)||"function"!==e.type||!(0,o.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,o.isNil)(n)){const e=n.required;if(!(0,o.isNil)(e)&&(!Array.isArray(e)||!e.every(o.isString)))return!1;const t=n.properties;if(!(0,o.isNil)(t)&&!Object.values(t).every(K))return!1}return!0},q=e=>{var t,n;return e&&(0,o.isString)(e.id)&&(0,o.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,o.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},G=e=>!(!(0,o.isNil)(e)&&!(0,o.isString)(e))||!!(0,o.isArray)(e)&&e.every(e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,o.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,o.isNil)(t)&&(0,o.isString)(t.url)&&((0,o.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,o.isNil)(n)&&(0,o.isString)(n.data)&&((0,o.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e)),J=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(q))return!1}return(!e.parts||!(0,o.isNil)(e.content))&&("reasoning"===e.type||!!G(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role))},Q=e=>Array.isArray(e)&&e.length>0&&e.every(e=>{return(0,o.has)(e,"message")&&(t=e.message,!!J(t)&&((0,o.isNil)(t.content)||(0,o.isString)(t.content)));var t}),Z=e=>e&&Q(e.choices),X=(e,t)=>{var n,s,r,a,i,l,u,m,p,g,f,v,h,y,x,b;try{if(Array.isArray(e)&&e.length>0&&e.every(J))return(0,o.compact)(e.map(ne));switch(t){case"langchain":const t=null!==(n=(0,d.HD)(e))&&void 0!==n?n:(0,d.oI)(e);if(t)return t;break;case"llamaindex":const o=null!==(s=(0,d.Hy)(e))&&void 0!==s?s:(0,d.W3)(e);if(o)return o;break;case"openai":const S=null!==(r=null!==(a=null!==(i=null!==(l=(0,d.a8)(e))&&void 0!==l?l:(0,d.bS)(e))&&void 0!==i?i:(0,d.n_)(e))&&void 0!==a?a:(0,d.AG)(e))&&void 0!==r?r:(0,c.x1)(e);if(S)return S;break;case"dspy":const A=null!==(u=(0,d.iU)(e))&&void 0!==u?u:(0,d.Pn)(e);if(A)return A;break;case"gemini":const w=null!==(m=(0,d.DE)(e))&&void 0!==m?m:(0,d.Sy)(e);if(w)return w;break;case"anthropic":const Y=null!==(p=(0,d.KF)(e))&&void 0!==p?p:(0,d.pL)(e);if(Y)return Y;break;case"openai-agent":const I=null!==(g=(0,d.xW)(e))&&void 0!==g?g:(0,d.m$)(e);if(I)return I;break;case"autogen":const T=null!==(f=(0,d.nW)(e))&&void 0!==f?f:(0,d.u6)(e);if(T)return T;break;case"bedrock":const C=null!==(v=(0,d.Yv)(e))&&void 0!==v?v:(0,d.f1)(e);if(C)return C;break;case"vercel_ai":const E=null!==(h=(0,d.fJ)(e))&&void 0!==h?h:(0,d.QA)(e);if(E)return E;break;case"pydantic_ai":const M=null!==(y=(0,d.Ii)(e))&&void 0!==y?y:(0,d.TY)(e);if(M)return M;break;case"voltagent":const N=null!==(x=(0,d.o0)(e))&&void 0!==x?x:(0,d.LO)(e);if(N)return N;break;default:const _=null!==(b=(0,d.a8)(e))&&void 0!==b?b:(0,d.bS)(e);if(_)return _}return Array.isArray(e)&&e.length>0&&e.every(d.oi)?(0,o.compact)(e.map(d.pN)):null}catch(S){return null}},ee=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(s){}return{id:e.id,function:{arguments:n,name:e.function.name}}},te=e=>{if((0,o.isNil)(e)||(0,o.isString)(e))return e;return e.map(e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}}).filter(e=>void 0!==e).join("\n\n")},ne=e=>{var t;return"reasoning"===e.type?null:{...e,content:te(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(ee)}},se=e=>{if((0,o.isNil)(e))return"content";if(P(e)>0)return"events";if(e.chatMessages)return"chat";return!(0,o.isNil)(e.inputs)||!(0,o.isNil)(e.outputs)?"content":"attributes"},oe=e=>{var t;const n=e=>Array.isArray(e)?e.reduce((e,t)=>{return t.key&&t.value?{...e,[t.key]:(n=t.value,(0,o.isObject)(n)?"string_value"in n?n.string_value:"bool_value"in n?n.bool_value:"int_value"in n?n.int_value:"double_value"in n?n.double_value:n:n)}:e;var n},{}):e;return{...e,...e.attributes&&{attributes:n(e.attributes)},...e.events&&{events:null===(t=e.events)||void 0===t?void 0:t.map(e=>({...e,attributes:n(e.attributes)}))}}},re=e=>(0,r.useMemo)(()=>{if(!e)return[];return(0,m.VC)([e]).filter(m.fJ)},[e]),ae=e=>{var t;return Boolean(e&&T(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))},ie=e=>{var t,n,s,o;return"MLFLOW_EXPERIMENT"===e.type?null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id:"INFERENCE_TABLE"===e.type?null===(n=e.inference_table)||void 0===n?void 0:n.full_table_name:"UC_SCHEMA"===e.type?`${null===(s=e.uc_schema)||void 0===s?void 0:s.catalog_name}.${null===(o=e.uc_schema)||void 0===o?void 0:o.schema_name}`:void 0},le=e=>{const[t,n]=e.split(".");return t&&n?{type:"UC_SCHEMA",uc_schema:{catalog_name:t,schema_name:n}}:{type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}}},de=e=>{if(!e.trace_location)return e.trace_id;const t=ie(e.trace_location);return t?`trace:/${t}/${e.trace_id}`:e.trace_id},ce=e=>{if(!me(e))return;const[,t,n]=e.split("/");return{trace_id:n,trace_location:t}},ue=e=>{const t=ce(e);if(t)return{trace_id:t.trace_id,trace_location:le(t.trace_location)}},me=e=>e.startsWith("trace:/"),pe=e=>{var t;const n=null===(t=e.trace_metadata)||void 0===t?void 0:t[u.Uu];if(!n)return null;try{var s;const e=JSON.parse(n);return null!==(s=null===e||void 0===e?void 0:e.total_tokens)&&void 0!==s?s:null}catch{return null}},ge=e=>{var t,n;return(0,l.pt)(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[u.Uu])&&void 0!==t?t:"{}")},fe=e=>{var t;return!(0,o.isEmpty)(null===(t=e.metadata)||void 0===t?void 0:t[u.K6])},ve=e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.filter(e=>!fe(e)))&&void 0!==t?t:[]},he=e=>{var t;const n=(null===e||void 0===e?void 0:e.attributes)&&"exception.stacktrace"in e.attributes,s="string"===typeof(null===(t=e.attributes)||void 0===t?void 0:t["exception.stacktrace"]);return Boolean((null===e||void 0===e?void 0:e.attributes)&&"string"===typeof e.attributes["exception.type"]&&"string"===typeof e.attributes["exception.message"]&&(!n||s))}},89602:function(e,t,n){n.d(t,{C:function(){return r}});var s=n(27757),o=n(73408);function r({children:e}){return(0,o.Y)(s.T.Text,{bold:!0,children:e})}},90448:function(e,t,n){n.d(t,{Au:function(){return I},CH:function(){return U},ER:function(){return H},FN:function(){return y},II:function(){return D},PB:function(){return L},Pp:function(){return K},Qq:function(){return R},UN:function(){return Y},Wp:function(){return J},Xe:function(){return z},YZ:function(){return $},Zh:function(){return F},_1:function(){return v},aj:function(){return V},bz:function(){return A},c1:function(){return g},c9:function(){return T},eB:function(){return w},fu:function(){return O},gZ:function(){return b},hG:function(){return k},ik:function(){return B},jr:function(){return C},kp:function(){return h},mS:function(){return E},ng:function(){return W},pZ:function(){return x},rU:function(){return q},sw:function(){return _},uU:function(){return S},vP:function(){return j},w_:function(){return P},xO:function(){return G},yQ:function(){return M}});var s=n(68248),o=n(76118),r=n(82716),a=n(27757),i=n(42747),l=n(44666),d=n(58663),c=n(9858),u=n(73408);const m="Error",p=["openai","langchain","anthropic"],g=e=>{if(!(0,o.isNil)(e)&&"object"===typeof e)try{for(const t of p){const n=(0,d.Hq)(e,t);if(n&&n.length>0){const e=[...n].reverse().find(e=>"user"===e.role);if(null!==e&&void 0!==e&&e.content)return e.content}}}catch{}},f="messages";let v=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.CONVERSATIONAL_GUIDELINES="conversational_guidelines",e}({});const h=[v.OVERALL_ASSESSMENT,v.CORRECTNESS,v.GLOBAL_GUIDELINE_ADHERENCE,v.GUIDELINE_ADHERENCE,v.GUIDELINES,v.CONVERSATIONAL_GUIDELINES,v.RELEVANCE_TO_QUERY,v.CONTEXT_SUFFICIENCY,v.RETRIEVAL_SUFFICIENCY,v.CHUNK_RELEVANCE,v.RETRIEVAL_RELEVANCE,v.GROUNDEDNESS,v.RETRIEVAL_GROUNDEDNESS,v.SAFETY],y=e=>"https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/",x={[v.OVERALL_ASSESSMENT]:{basePath:"/generative-ai/agent-evaluation/llm-judge-metrics",hash:"how-quality-is-assessed-by-llm-judges"},[v.CORRECTNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"correctness"},[v.GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[v.RETRIEVAL_GROUNDEDNESS]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"groundedness"},[v.RELEVANCE_TO_QUERY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"answer-relevance"},[v.SAFETY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"safety"},[v.CHUNK_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[v.RETRIEVAL_RELEVANCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"chunk-relevance-precision"},[v.CONTEXT_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[v.RETRIEVAL_SUFFICIENCY]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"context-sufficiency"},[v.GUIDELINE_ADHERENCE]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"},[v.GUIDELINES]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"guideline-adherence"},[v.CONVERSATIONAL_GUIDELINES]:{basePath:"/generative-ai/agent-evaluation/llm-judge-reference",hash:"conversational-guidelines"}};let b=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});function S(e,t,n,o){return o===m?{content:e.formatMessage({id:"/DvT6Y",defaultMessage:"Error"})}:"pass-fail"===n.dtype?o===b.YES?{content:e.formatMessage({id:"pm1RNL",defaultMessage:"Pass"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.YES})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(r.CheckCircleIcon,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.YES}),borderRadius:"50%"},"")})})}:o===b.NO?{content:e.formatMessage({id:"9cTaBs",defaultMessage:"Fail"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.NO})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(r.XCircleIcon,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.NO}),borderRadius:"50%"},"")})})}:{content:e.formatMessage({id:"27XMby",defaultMessage:"Missing"}),icon:(0,u.Y)("span",{css:(0,s.AH)({color:`${(0,c.CY)(t,n,{stringValue:b.UNKNOWN})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,u.Y)(a.W,{css:(0,s.AH)({backgroundColor:(0,c.x2)(t,n,{stringValue:b.UNKNOWN}),borderRadius:"50%"},"")})})}:"boolean"===n.dtype?!0===o?{content:e.formatMessage({id:"1Ujhc3",defaultMessage:"True"})}:!1===o?{content:e.formatMessage({id:"nvjkTA",defaultMessage:"False"})}:{content:e.formatMessage({id:"keSIQ4",defaultMessage:"null"})}:{content:`${o}`}}let A=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({});const w={response:(0,i.zR)({id:"WiaEQ3",defaultMessage:"Model output"})},Y="expected_facts",I={expected_response:(0,i.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),[Y]:(0,i.zR)({id:"N1G2a5",defaultMessage:"Expected facts"})},T={[v.OVERALL_ASSESSMENT]:(0,i.zR)({id:"uoJWOm",defaultMessage:"Overall"}),[v.CORRECTNESS]:(0,i.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),[v.GROUNDEDNESS]:(0,i.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),[v.RETRIEVAL_GROUNDEDNESS]:(0,i.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),[v.CONTEXT_SUFFICIENCY]:(0,i.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),[v.RETRIEVAL_SUFFICIENCY]:(0,i.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),[v.RELEVANCE_TO_QUERY]:(0,i.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),[v.SAFETY]:(0,i.zR)({id:"jMUqD1",defaultMessage:"Safety"}),[v.CHUNK_RELEVANCE]:(0,i.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),[v.RETRIEVAL_RELEVANCE]:(0,i.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),[v.GUIDELINE_ADHERENCE]:(0,i.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),[v.GUIDELINES]:(0,i.zR)({id:"ls3868",defaultMessage:"Guidelines"}),[v.GLOBAL_GUIDELINE_ADHERENCE]:(0,i.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"}),[v.CONVERSATIONAL_GUIDELINES]:(0,i.zR)({id:"AeRhuI",defaultMessage:"Conversational guidelines"})},C={[v.CORRECTNESS]:(0,i.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),[v.GROUNDEDNESS]:(0,i.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[v.RETRIEVAL_GROUNDEDNESS]:(0,i.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[v.CONTEXT_SUFFICIENCY]:(0,i.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),[v.RETRIEVAL_SUFFICIENCY]:(0,i.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."})},E={[v.OVERALL_ASSESSMENT]:(0,i.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),[v.CORRECTNESS]:(0,i.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),[v.GROUNDEDNESS]:(0,i.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[v.RETRIEVAL_GROUNDEDNESS]:(0,i.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[v.RELEVANCE_TO_QUERY]:(0,i.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),[v.SAFETY]:(0,i.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),[v.CHUNK_RELEVANCE]:(0,i.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[v.RETRIEVAL_RELEVANCE]:(0,i.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[v.CONTEXT_SUFFICIENCY]:(0,i.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[v.RETRIEVAL_SUFFICIENCY]:(0,i.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[v.GUIDELINE_ADHERENCE]:(0,i.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),[v.GUIDELINES]:(0,i.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),[v.GLOBAL_GUIDELINE_ADHERENCE]:(0,i.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."}),[v.CONVERSATIONAL_GUIDELINES]:(0,i.zR)({id:"lDQtCN",defaultMessage:"The conversational guidelines LLM judge evaluates whether the assistant's responses throughout a conversation comply with the provided guidelines."})},M={[v.OVERALL_ASSESSMENT]:{[b.YES]:(0,i.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),[b.NO]:(0,i.zR)({id:"j77+aP",defaultMessage:"Fail"})},[v.CHUNK_RELEVANCE]:{[b.YES]:(0,i.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),[b.NO]:(0,i.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"})},[v.RETRIEVAL_RELEVANCE]:{[b.YES]:(0,i.zR)({id:"++039K",defaultMessage:"Relevant"}),[b.NO]:(0,i.zR)({id:"akmaST",defaultMessage:"Irrelevant"})},[v.CONTEXT_SUFFICIENCY]:{[b.YES]:(0,i.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),[b.NO]:(0,i.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"})},[v.RETRIEVAL_SUFFICIENCY]:{[b.YES]:(0,i.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),[b.NO]:(0,i.zR)({id:"lhFnAG",defaultMessage:"Insufficient"})},[v.RELEVANCE_TO_QUERY]:{[b.YES]:(0,i.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),[b.NO]:(0,i.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"})},[v.GROUNDEDNESS]:{[b.YES]:(0,i.zR)({id:"/2InJv",defaultMessage:"Grounded"}),[b.NO]:(0,i.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"})},[v.RETRIEVAL_GROUNDEDNESS]:{[b.YES]:(0,i.zR)({id:"e515YD",defaultMessage:"Grounded"}),[b.NO]:(0,i.zR)({id:"uSVfB9",defaultMessage:"Not grounded"})},[v.CORRECTNESS]:{[b.YES]:(0,i.zR)({id:"eSxQmg",defaultMessage:"Correct"}),[b.NO]:(0,i.zR)({id:"LhxSrc",defaultMessage:"Incorrect"})},[v.SAFETY]:{[b.YES]:(0,i.zR)({id:"DMOaoR",defaultMessage:"Safe"}),[b.NO]:(0,i.zR)({id:"CX/MSu",defaultMessage:"Unsafe"})},[v.GUIDELINE_ADHERENCE]:{[b.YES]:(0,i.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,i.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"})},[v.GUIDELINES]:{[b.YES]:(0,i.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,i.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"})},[v.GLOBAL_GUIDELINE_ADHERENCE]:{[b.YES]:(0,i.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),[b.NO]:(0,i.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"})},[v.CONVERSATIONAL_GUIDELINES]:{[b.YES]:(0,i.zR)({id:"iCdWsS",defaultMessage:"Adheres to guidelines"}),[b.NO]:(0,i.zR)({id:"MJILab",defaultMessage:"Violates guidelines"})}},N=e=>{var t;return"AI_JUDGE"===(null===e||void 0===e||null===(t=e.source)||void 0===t?void 0:t.sourceType)},_=e=>{let t=R(e,"request");return(0,o.isNil)(t)&&(t=R(e,f)),(0,o.isNil)(t)&&!(0,o.isNil)(e.inputs)&&Object.keys(e.inputs).length>0&&(t=W(e.inputs)),((0,o.isNil)(t)||""===t)&&(t=e.evaluationId),t},R=(e,t)=>{var n,s;if(!(0,o.isNil)(e.inputsTitle))return"string"===typeof e.inputsTitle?e.inputsTitle:JSON.stringify(e.inputsTitle);let r;const a=e.inputs[t];var i;if((0,o.isPlainObject)(a)&&!(0,o.isNil)(a[f])&&Array.isArray(a[f])&&!(0,o.isNil)(null===(n=a[f][0])||void 0===n?void 0:n.content))r=null===(i=a[f][a[f].length-1])||void 0===i?void 0:i.content;else if((0,o.isNil)(a)||!Array.isArray(a)||(0,o.isNil)(null===(s=a[0])||void 0===s?void 0:s.content)){if(a){const e=g(a);r=null!==e&&void 0!==e?e:W(a)}}else{var l;r=null===(l=a[a.length-1])||void 0===l?void 0:l.content}return r},k=e=>{var t;return!0===(null===(t=e.metadata)||void 0===t?void 0:t[A.IS_OVERALL_ASSESSMENT])},D=e=>{var t;return(0,o.isNumber)(null===(t=e.metadata)||void 0===t?void 0:t[A.CHUNK_INDEX])},F=e=>{var t,n;const s=null!==(t=null!==(n=e.stringValue)&&void 0!==n?n:e.numericValue)&&void 0!==t?t:e.booleanValue;if(!(0,o.isNil)(s))return s};function O(e,t){let n=e;const s=n.startsWith("#");s&&(n=e.slice(1));return`${s?"#":""}${n}${Math.round(255*Math.min(Math.max(t,0),1)).toString(16).toUpperCase()}`}const L=[v.GUIDELINE_ADHERENCE,v.GUIDELINES,v.GLOBAL_GUIDELINE_ADHERENCE,v.RELEVANCE_TO_QUERY,v.CONTEXT_SUFFICIENCY,v.RETRIEVAL_SUFFICIENCY,v.CORRECTNESS,v.GROUNDEDNESS,v.RETRIEVAL_GROUNDEDNESS,v.SAFETY],H=[v.CHUNK_RELEVANCE],V=({name:e,isOverallAssessment:t,value:n,rationale:s,metadata:o={}})=>{var r;const a=null!==(r=(0,l.w)())&&void 0!==r?r:"";return{booleanValue:"boolean"===typeof n?n:null,numericValue:null,stringValue:"boolean"!==typeof n?n:null,name:e,metadata:t?{...o,[A.IS_OVERALL_ASSESSMENT]:!0}:o,rationale:null!==s&&void 0!==s?s:null,source:{sourceId:a,sourceType:"HUMAN",metadata:{}},timestamp:Date.now(),isDraft:!0}},B=(e,t)=>e.overallAssessments.length>0&&e.overallAssessments.every(N)&&!t.some(k),$=e=>{var t;const n=e.overallAssessments.find(N);if(!n)return null;const s=null!==(t=(0,l.w)())&&void 0!==t?t:"";return{...n,timestamp:Date.now(),isDraft:!0,source:{sourceType:"HUMAN",sourceId:s,metadata:{}},metadata:{...n.metadata,[A.IS_COPIED_FROM_AI]:!0}}},U=e=>"isDraft"in e&&e.isDraft,z=e=>(0,o.orderBy)(Object.entries(e),([e,t],n)=>{const s=h.indexOf(e);return-1!==s?s:null!==(o=null===(r=t[t.length-1])||void 0===r?void 0:r.timestamp)&&void 0!==o?o:n;var o,r}),j=e=>{var t,n;return null!==(t=null===(n=e.overallAssessments)||void 0===n?void 0:n.filter(e=>!U(e)).some(e=>!N(e)))&&void 0!==t&&t},P=e=>{var t,n;return"HUMAN"===(null===(t=e.source)||void 0===t?void 0:t.sourceType)&&!(null!==(n=e.metadata)&&void 0!==n&&n[A.IS_COPIED_FROM_AI])},K=e=>{var t;return null===(t=e.metadata)||void 0===t?void 0:t[A.CHUNK_INDEX]},W=e=>(0,o.isPlainObject)(e)||Array.isArray(e)?JSON.stringify(e,void 0,2):e,q=(e,t,n,s)=>{if(t){const n=M[t.name];return n?Object.entries(n).map(([n,s])=>({key:n,label:e.formatMessage(s),rootAssessmentName:t.name})):[]}return(s||[]).filter(e=>"boolean"===e.dtype).map(e=>({key:e.name,label:e.name,rootAssessmentName:e.name,disabled:null===n||void 0===n?void 0:n.some(t=>t.name===e.name)}))},G=e=>{if(e){const t=Boolean(e.rationale),n=!(0,o.isNil)(F(e)),s=Boolean(e.errorMessage);return!(t||n||s)}return!1},J=e=>Array.isArray(e)&&e.every(e=>(0,o.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)},90828:function(e,t,n){n.d(t,{Y7:function(){return i},nt:function(){return o},oD:function(){return r},pt:function(){return a}});var s=n(76118);const o="mlflow.",r=e=>!e.startsWith(o)&&!e.startsWith("_mlflow_"),a=e=>{try{return JSON.parse(e)}catch(t){return}},i=(e,t)=>{const n=(0,s.truncate)(e,{length:t});return(0,s.takeWhile)(n,e=>"\n"!==e).join("")}},91461:function(e,t,n){n.d(t,{E:function(){return c}});var s=n(68248),o=n(46709),r=n(27757),a=n(82716),i=n(42747),l=n(73408);function d({paramName:e,paramProperties:t,isRequired:n}){const{theme:o}=(0,r.u)(),{type:a,description:d,enum:c}=t,u=a||d||c,m=u?{borderTopLeftRadius:o.borders.borderRadiusMd,borderTopRightRadius:o.borders.borderRadiusMd,borderBottom:`1px solid ${o.colors.border}`}:{borderRadius:o.borders.borderRadiusMd};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:o.borders.borderRadiusMd,border:`1px solid ${o.colors.border}`},""),children:[(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:o.colors.backgroundSecondary,padding:`${o.spacing.sm}px ${o.spacing.md}px`,gap:o.spacing.sm,...m},""),children:[(0,l.Y)(r.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,l.Y)(r.T.Text,{withoutMargins:!0,color:"error",children:(0,l.Y)(i.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,l.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:o.spacing.md,padding:`${o.spacing.sm}px ${o.spacing.md}px`},""),children:[a&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:a})]}),d&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,l.Y)(r.T.Text,{withoutMargins:!0,children:d})]}),c&&(0,l.FD)(l.FK,{children:[(0,l.Y)(r.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(i.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,flexWrap:"wrap"},""),children:c.map(e=>(0,l.Y)(r.T.Text,{withoutMargins:!0,code:!0,children:e},e))})]})]})]})}function c({tool:e}){var t,n,i;const{theme:c}=(0,r.u)(),[u,m]=(0,o.useState)(!1),p=e.function.description,g=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,f=null!==(n=null===(i=e.function.parameters)||void 0===i?void 0:i.required)&&void 0!==n?n:[],v=p||g,h=v?{":hover":{backgroundColor:c.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusMd,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,l.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:c.spacing.sm,alignItems:"center",borderBottom:v&&u?`1px solid ${c.colors.border}`:"none",padding:c.spacing.sm,...h},""),onClick:()=>m(!u),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[v&&(u?(0,l.Y)(a.ChevronDownIcon,{}):(0,l.Y)(r.o,{})),(0,l.Y)(r.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),v&&u&&(0,l.FD)("div",{css:(0,s.AH)({padding:c.spacing.sm},""),children:[p&&(0,l.Y)(r.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:c.spacing.sm,padding:`0px ${c.spacing.xs}px`},children:e.function.description}),g&&(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:Object.keys(g).map(e=>(0,l.Y)(d,{paramName:e,paramProperties:g[e],isRequired:f.includes(e)},e))})]})]})}},93241:function(e,t,n){n.d(t,{F9:function(){return i},Mq:function(){return r},UK:function(){return s},ij:function(){return o},pR:function(){return a}});const s=()=>!1,o=()=>!0,r=()=>500,a=()=>1e3,i=()=>!1},93812:function(e,t,n){n.d(t,{X:function(){return T}});var s=n(68248),o=n(76118),r=n(46709),a=n(27757),i=n(82716),l=n(42747),d=n(73879),c=n(79081),u=n(94664),m=n(51847),p=n(73408);const g=e=>{switch(e){case"system":return(0,p.Y)(m.P,{type:u.Dy.SYSTEM});case"user":return(0,p.Y)(m.P,{type:u.Dy.USER});case"tool":case"function":return(0,p.Y)(m.P,{type:u.Dy.WRENCH});default:return(0,p.Y)(m.P,{type:u.Dy.MODELS})}},f=e=>{switch(e.role){case"system":return(0,p.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,p.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,p.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,p.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,p.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var v={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},h={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const y=({isExpandable:e,expanded:t,setExpanded:n,message:o})=>{const{theme:r}=(0,a.u)(),d=e?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,p.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:r.spacing.sm,gap:r.spacing.sm,...d},""),onClick:()=>n(!t),children:[e&&(t?(0,p.Y)(i.ChevronDownIcon,{}):(0,p.Y)(a.o,{})),g(o.role),o.tool_call_id?(0,p.Y)(a.T.Text,{color:"secondary",css:v,children:(0,p.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,p.Y)(a.T.Text,{css:(0,s.AH)({marginRight:r.spacing.xs},""),bold:!0,children:f(o)}),toolCallId:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:o.tool_call_id,children:(0,p.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},""),children:(0,p.Y)(a.T.Text,{css:h,code:!0,children:o.tool_call_id})})})}})}):(0,p.Y)(a.T.Text,{bold:!0,children:f(o)})]})};var x=n(65854),b=n(45547);var S={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function A({toolCall:e}){const{theme:t}=(0,a.u)();return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,p.Y)(a.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,p.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,p.FD)(i.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,p.Y)(i.FunctionIcon,{}),(0,p.Y)(a.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,p.Y)(c.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:e.id,children:(0,p.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,p.Y)(a.T.Text,{css:S,code:!0,color:"secondary",children:e.id})})})}})}),(0,p.Y)(b.w,{data:e.function.arguments})]},e.id)}const w=e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}};function Y({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,a.u)();return e?t?(0,p.Y)(b.w,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:u.cC.JSON}):(0,p.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,p.Y)(d.V,{children:e})}):null}function I({reasoning:e}){const{theme:t}=(0,a.u)(),[n,o]=(0,r.useState)(!1);return(0,p.FD)("div",{css:(0,s.AH)({margin:t.spacing.sm,marginTop:0,border:`1px solid ${t.colors.borderDecorative}`,borderRadius:t.borders.borderRadiusMd,backgroundColor:t.colors.backgroundSecondary,overflow:"hidden"},""),children:[(0,p.FD)("button",{type:"button",onClick:()=>o(!n),css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs,width:"100%",padding:t.spacing.sm,backgroundColor:"transparent",border:"none",cursor:"pointer",textAlign:"left","&:hover":{backgroundColor:t.colors.actionDefaultBackgroundHover}},""),children:[n?(0,p.Y)(i.ChevronDownIcon,{css:(0,s.AH)({color:t.colors.textSecondary},"")}):(0,p.Y)(a.o,{css:(0,s.AH)({color:t.colors.textSecondary},"")}),(0,p.Y)(i.LightbulbIcon,{css:(0,s.AH)({color:t.colors.textValidationWarning},"")}),(0,p.Y)(a.T.Text,{bold:!0,css:(0,s.AH)({color:t.colors.textSecondary},""),children:(0,p.Y)(l.sA,{id:"x7NsCC",defaultMessage:"Reasoning"})})]}),n&&(0,p.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,paddingTop:0,borderTop:`1px solid ${t.colors.borderDecorative}`,marginBottom:-t.typography.fontSizeBase},""),children:(0,p.Y)(d.V,{children:e})})]})}function T({message:e,className:t}){var n;const{theme:d}=(0,a.u)(),[c,u]=(0,r.useState)(!1),{content:m,isJson:g}=w(null!==(n=e.content)&&void 0!==n?n:""),f=g&&("tool"===e.role||"function"===e.role),v=!f&&m.length>x.w,h=v&&!c?`${m.slice(0,x.w)}...`:m;return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:d.borders.borderRadiusSm,border:`1px solid ${d.colors.border}`,backgroundColor:d.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,p.Y)(y,{isExpandable:v,expanded:c,setExpanded:u,message:e}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:[e.reasoning&&(0,p.Y)(I,{reasoning:e.reasoning}),!(0,o.isNil)(e.tool_calls)&&e.tool_calls.map(e=>(0,p.Y)(A,{toolCall:e},e.id)),(0,p.Y)(Y,{content:h,shouldDisplayCodeSnippet:f})]}),v&&(0,p.Y)(a.B,{componentId:c?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:c?(0,p.Y)(i.ChevronUpIcon,{}):(0,p.Y)(i.ChevronDownIcon,{}),type:"tertiary",onClick:()=>u(!c),css:(0,s.AH)({display:"flex",width:"100%",padding:d.spacing.md,borderRadius:"0px !important"},""),children:c?(0,p.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,p.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}},94664:function(e,t,n){n.d(t,{Dy:function(){return o},UG:function(){return s},VZ:function(){return r},cC:function(){return a}});let s=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),o=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),r=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),a=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},94777:function(e,t,n){n.d(t,{o:function(){return c}});var s=n(68248),o=n(27757),r=n(94664),a=n(86125),i=n(51847),l=n(53915),d=n(73408);const c=({node:e})=>{var t;const{theme:n}=(0,o.u)(),{setSelectedNode:c,setActiveView:u,setShowTimelineTreeGantt:m}=(0,l.nJ)(),p=(0,a.N7)(e)>0;return(0,d.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:p?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{c(e),u("detail"),m(!1)},children:[(0,d.Y)(i.P,{hasException:p,type:(0,a.tC)(null!==(t=e.type)&&void 0!==t?t:r.UG.UNKNOWN)}),(0,d.Y)(o.T.Text,{color:p?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})}},96586:function(e,t,n){n.d(t,{B:function(){return m}});var s=n(68248),o=n(46709),r=n(82716),a=n(27757),i=n(79081),l=n(42747),d=n(94664),c=n(49425),u=n(73408);const m=({error:e})=>{const{theme:t}=(0,a.u)(),[n,m]=(0,o.useState)(!1);return(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)(r.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,u.Y)("span",{children:e.error_message}),e.stack_trace&&(0,u.Y)(a.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>m(!0),children:(0,u.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,u.Y)(i.d,{title:(0,u.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>m(!1),children:(0,u.Y)(c.C,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:d.cC.TEXT})})]})}},97407:function(e,t,n){n.d(t,{R0:function(){return S},C2:function(){return v.C},ki:function(){return Y},Es:function(){return m},qd:function(){return f},tP:function(){return A},$W:function(){return C}});var s=n(59930),o=n.n(s),r=n(884),a=n(45175),i=n(46709),l=n(73408);const d=(0,i.createContext)(null);function c({children:e,...t}){return(0,l.Y)(d.Provider,{value:t,children:e})}function u(){const e=(0,i.useContext)(d);return o()(e,"useTagAssignmentContext must be used within a TagAssignmentRoot"),e}function m({children:e,...t}){const n=(0,r.xW)(),s=(0,l.Y)(c,{...t,children:(0,l.Y)(a.V,{children:e})});return n?s:(o()(t.form,"Nest your component on a FormProvider or pass a form prop"),(0,l.Y)(r.Op,{...t.form,children:s}))}var p=n(68248),g=n(27757);function f({children:e}){const{theme:t}=(0,g.u)(),n=i.Children.toArray(e);o()(n.length<=3,"TagAssignmentRow must have 3 children or less");const s=Array(3).fill(null).map((e,s)=>{var o;return null!==(o=n[s])&&void 0!==o?o:(0,l.Y)("span",{style:{width:t.general.heightSm}},s)});return(0,l.Y)("div",{css:(0,p.AH)({display:"grid",gridTemplateColumns:"1fr 1fr min-content",gap:t.spacing.sm},""),children:s})}var v=n(89602),h=n(66916),y=n(82716);var x={name:"82a6rk",styles:"flex:1"};const b=(0,i.forwardRef)(({errorMessage:e,...t},n)=>(0,l.FD)("div",{css:x,children:[(0,l.Y)(h.I,{validationState:e?"error":"info",...t,ref:n}),e&&(0,l.Y)(y.FormUI.Message,{message:e,type:"error"})]}));function S({index:e,rules:t,render:n}){const{name:s,keyProperty:o,getTagsValues:a,emptyValue:i,appendIfPossible:d}=u();return(0,l.Y)(r.xI,{name:`${s}.${e}.${o}`,rules:t,render:({field:e,fieldState:t,formState:s})=>{var r;const c=e.onChange;return e.onChange=function(e){var t;c(e);const n=a();null!==n&&void 0!==n&&null!==(t=n.at(-1))&&void 0!==t&&t[o]&&d(i,{shouldFocus:!1})},n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentKey.Default.Input",errorMessage:null===(r=t.error)||void 0===r?void 0:r.message,...e})}})}function A({rules:e,index:t,render:n}){const{name:s,valueProperty:o}=u();return(0,l.Y)(r.xI,{rules:e,name:`${s}.${t}.${o}`,render:({field:e,fieldState:t,formState:s})=>{var o;return n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentValue.Default.Input",errorMessage:null===(o=t.error)||void 0===o?void 0:o.message,...e})}})}var w=n(31988);function Y({index:e,...t}){const{removeOrUpdate:n}=u();return(0,l.Y)(w.u,{onClick:()=>n(e),...t})}var I=n(7655);function T(e,t){if(void 0!==e)return 0===e&&o()(!1,"maxLength must be greater than 0"),{maxLength:{value:e,message:t.formatMessage({id:"JW0GbU",defaultMessage:"You can set a maximum of {maxLength} values"},{maxLength:e})}}}function C({name:e,maxLength:t,emptyValue:n,defaultValues:s,loading:a,form:l,keyProperty:d,valueProperty:c}){const[u]=(0,i.useState)(n),m=(0,r.xW)(),p=Boolean(m)&&!l,g=p?m:l;o()(g,"Nest your component on a FormProvider or pass a form prop"),o()(!(s&&p),"Define defaultValues at form context level");const{setValue:f}=g,v=function({name:e,maxLength:t,emptyValue:n,form:s,keyProperty:a}){const l=(0,I.A)(),d=(0,r.xW)(),c=Boolean(d)&&!s?d:s;o()(c,"Nest your component on a FormProvider or pass a form prop");const[u]=(0,i.useState)(n),{append:m,update:p,remove:g,...f}=(0,r.jz)({name:e,control:c.control,rules:T(t,l)}),{getValues:v}=c,h=(0,i.useCallback)(()=>v(e),[v,e]),y=(0,i.useCallback)((e,n)=>{const s=h();t&&s&&s.length>=t||m(e,n)},[h,t,m]),x=(0,i.useCallback)(e=>{const t=h();if(t&&e===t.length-1)return p(e,u);const n=null===t||void 0===t?void 0:t.at(-1);if(null!==n&&void 0!==n&&n[a])return g(e),void m(u,{shouldFocus:!1});g(e)},[u,h,a,m,g,p]);return{form:c,...f,originalAppend:m,update:p,originalRemove:g,appendIfPossible:y,removeOrUpdate:x,getTagsValues:h}}({name:e,maxLength:t,emptyValue:n,form:g,keyProperty:d}),h=v.getTagsValues;return(0,i.useEffect)(()=>{if(!a){if(s){const n=[...s];return(!t||t&&n.length<t)&&n.push(u),void f(e,n)}if(p){var n;const s=null!==(n=h())&&void 0!==n?n:[];return(!t||t&&s.length<t)&&s.push(u),void f(e,s)}f(e,[u])}},[s,f,a,t,e,u,p,h]),{...v,form:g,maxLength:t,emptyValue:n,name:e,keyProperty:d,valueProperty:c}}},97447:function(e,t,n){n.d(t,{f:function(){return d}});var s=n(68248),o=n(82716),r=n(27757),a=n(79081),i=n(73408);var l={name:"e0dnmk",styles:"cursor:pointer"};const d=({label:e,value:t,displayValue:n=t,icon:d,color:c,getTruncatedLabel:u,onCopy:m,hideLabel:p=!1})=>{const{theme:g}=(0,r.u)();return(0,i.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:p?"flex-start":"center",flexDirection:"row",gap:g.spacing.sm},""),children:[!p&&(0,i.Y)(r.T.Text,{size:"md",color:"secondary",children:e}),(0,i.Y)(a.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:t,maxWidth:400,children:(0,i.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",color:c,onClick:()=>{navigator.clipboard.writeText(t),m()},css:l,children:(0,i.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:g.spacing.xs},""),children:[d&&(0,i.Y)("span",{children:d}),(0,i.Y)("span",{children:u(n)})]})})})]})}}}]);