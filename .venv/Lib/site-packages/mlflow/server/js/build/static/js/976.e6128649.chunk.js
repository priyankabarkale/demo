"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[976],{70976:function(e,n,i){i.r(n),i.d(n,{default:function(){return re}});var o=i(91105),t=i(55570),d=i(91113),a=i(884),l=i(39595),r=i(46709),s=i(30431),c=i(49708),m=i(25117);var p=i(61060);var g=i(1422);var u=i(44341),f=i(85344),h=i(29447);function v(e){const n=(0,o.Zp)(),i=(0,l.jE)(),{data:t,isLoading:d,error:f}=(e=>(0,c.I)(["gateway_endpoint",e],{queryFn:()=>m.t.getEndpoint(e),retry:!1,enabled:Boolean(e)}))(e),v=null===t||void 0===t?void 0:t.endpoint,y=(0,a.mN)({defaultValues:{name:"",trafficSplitModels:[],fallbackModels:[]}});(0,r.useEffect)(()=>{if(v&&v.model_mappings){var e,n,i;const o=null!==(e=v.model_mappings.filter(e=>"PRIMARY"===e.linkage_type))&&void 0!==e?e:[],t=null!==(n=v.model_mappings.filter(e=>"FALLBACK"===e.linkage_type))&&void 0!==n?n:[],d=o.reduce((e,n)=>{var i;return e+(null!==(i=n.weight)&&void 0!==i?i:1)},0);y.reset({name:null!==(i=v.name)&&void 0!==i?i:"",trafficSplitModels:o.map(e=>{var n,i,t,a,l,r,s,c,m,p;return{modelDefinitionId:null===(n=e.model_definition)||void 0===n?void 0:n.model_definition_id,modelDefinitionName:null!==(i=null===(t=e.model_definition)||void 0===t?void 0:t.name)&&void 0!==i?i:"",provider:null!==(a=null===(l=e.model_definition)||void 0===l?void 0:l.provider)&&void 0!==a?a:"",modelName:null!==(r=null===(s=e.model_definition)||void 0===s?void 0:s.model_name)&&void 0!==r?r:"",secretMode:"existing",existingSecretId:null!==(c=null===(m=e.model_definition)||void 0===m?void 0:m.secret_id)&&void 0!==c?c:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},weight:d>0?(null!==(p=e.weight)&&void 0!==p?p:1)/d*100:100/o.length}}),fallbackModels:t.sort((e,n)=>{var i,o;return(null!==(i=e.fallback_order)&&void 0!==i?i:0)-(null!==(o=n.fallback_order)&&void 0!==o?o:0)}).map((e,n)=>{var i,o,t,d,a,l,r,s,c;return{modelDefinitionId:null===(i=e.model_definition)||void 0===i?void 0:i.model_definition_id,modelDefinitionName:null!==(o=null===(t=e.model_definition)||void 0===t?void 0:t.name)&&void 0!==o?o:"",provider:null!==(d=null===(a=e.model_definition)||void 0===a?void 0:a.provider)&&void 0!==d?d:"",modelName:null!==(l=null===(r=e.model_definition)||void 0===r?void 0:r.model_name)&&void 0!==l?l:"",secretMode:"existing",existingSecretId:null!==(s=null===(c=e.model_definition)||void 0===c?void 0:c.secret_id)&&void 0!==s?s:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},fallbackOrder:n+1}})})}},[v,y]);const{mutateAsync:x,error:w,isLoading:b}=(()=>{const e=(0,l.jE)();return(0,p.n)({mutationFn:e=>m.t.updateEndpoint({endpoint_id:e.endpointId,name:e.name,model_configs:e.model_configs,routing_strategy:e.routing_strategy,fallback_config:e.fallback_config}),onSuccess:()=>{e.invalidateQueries(["gateway_endpoints"]),e.invalidateQueries(["gateway_endpoint"])}})})(),{mutateAsync:A}=(0,u.w)(),{mutateAsync:M}=(0,g.H)(),{mutateAsync:S}=(()=>{const e=(0,l.jE)();return(0,p.n)({mutationFn:e=>m.t.updateModelDefinition({model_definition_id:e.modelDefinitionId,secret_id:e.secretId,provider:e.provider,model_name:e.modelName}),onSuccess:()=>{e.invalidateQueries(["gateway_endpoints"]),e.invalidateQueries(["gateway_endpoint"]),e.invalidateQueries(["gateway_model_definitions"])}})})(),Y=b,I=w,_=(0,r.useCallback)(async e=>{if(v)try{const i=async e=>{if("existing"===e.secretMode)return e.existingSecretId;return(await A({secret_name:e.newSecret.name,secret_value:e.newSecret.secretFields,provider:e.provider,auth_config:e.newSecret.configFields})).secret.secret_id},o=async n=>{if(n.modelDefinitionId){var o;const e=null===(o=v.model_mappings)||void 0===o?void 0:o.find(e=>{var i;return(null===(i=e.model_definition)||void 0===i?void 0:i.model_definition_id)===n.modelDefinitionId});if(null!==e&&void 0!==e&&e.model_definition){if(n.provider!==e.model_definition.provider||n.modelName!==e.model_definition.model_name||"existing"===n.secretMode&&n.existingSecretId!==e.model_definition.secret_id||"new"===n.secretMode){const e=await i(n);await S({modelDefinitionId:n.modelDefinitionId,secretId:e,provider:n.provider,modelName:n.modelName})}}return n.modelDefinitionId}const t=await i(n);if(!n.provider||!n.modelName)throw new Error("Provider and model name are required to create a model definition");const d=Date.now();let a=`${e.name||v.name}-${n.provider}-${n.modelName}-${d}`.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");a||(a=`model-definition-${d}`);return(await M({name:a,secret_id:t,provider:n.provider,model_name:n.modelName})).model_definition.model_definition_id},t=await Promise.all(e.trafficSplitModels.map(e=>o(e))),d=await Promise.all(e.fallbackModels.map(e=>o(e))),a=e.trafficSplitModels.reduce((e,n)=>e+n.weight,0),l=e.trafficSplitModels.length||1,r=[...e.trafficSplitModels.map((e,n)=>({model_definition_id:t[n],linkage_type:"PRIMARY",weight:a>0?e.weight/100:1/l})),...e.fallbackModels.map((e,n)=>({model_definition_id:d[n],linkage_type:"FALLBACK",fallback_order:e.fallbackOrder}))],s=e.trafficSplitModels.length>1?"REQUEST_BASED_TRAFFIC_SPLIT":void 0,c=e.fallbackModels.length>0?{strategy:"SEQUENTIAL",max_attempts:e.fallbackModels.length+1}:void 0;await x({endpointId:v.endpoint_id,name:e.name||void 0,model_configs:r,routing_strategy:s,fallback_config:c}),n(h.Ay.getEndpointDetailsRoute(v.endpoint_id))}catch{}},[v,x,n,A,M,S]),D=(0,r.useCallback)(()=>{n(h.Ay.gatewayPageRoute)},[n]),k=(0,r.useCallback)(async n=>{v&&(await x({endpointId:v.endpoint_id,name:n}),i.invalidateQueries({queryKey:["gateway","endpoint",e]}),i.invalidateQueries({queryKey:["gateway","endpoints"]}))},[v,x,i,e]),C=y.watch("trafficSplitModels"),F=y.watch("fallbackModels"),T=(0,r.useMemo)(()=>{if(0===C.length)return!1;const e=C.reduce((e,n)=>e+n.weight,0);if(Math.abs(e-100)>.01)return!1;const n=e=>{if(!e.provider||!e.modelName)return!1;if("existing"===e.secretMode)return Boolean(e.existingSecretId);{if(!e.newSecret)return!1;const n=Boolean(e.newSecret.name&&e.newSecret.authMode),i=!!e.newSecret.secretFields&&Object.values(e.newSecret.secretFields).some(e=>e);return n&&i}},i=C.every(n),o=F.every(n);return i&&o},[C,F]),H=y.watch("name"),$=(0,r.useMemo)(()=>{var e,n,i,o,t;if(!v)return!1;const d=null!==(e=v.name)&&void 0!==e?e:"";if(H!==d)return!0;const a=null!==(n=null===(i=v.model_mappings)||void 0===i?void 0:i.filter(e=>"PRIMARY"===e.linkage_type))&&void 0!==n?n:[],l=null!==(o=null===(t=v.model_mappings)||void 0===t?void 0:t.filter(e=>"FALLBACK"===e.linkage_type))&&void 0!==o?o:[];if(C.length!==a.length)return!0;if(F.length!==l.length)return!0;const r=a.reduce((e,n)=>{var i;return e+(null!==(i=n.weight)&&void 0!==i?i:1)},0),s=C.some((e,n)=>{var i;const o=a[n];if(!o||!o.model_definition)return!0;const t=r>0?(null!==(i=o.weight)&&void 0!==i?i:1)/r*100:100/a.length;if(e.modelDefinitionId&&e.modelDefinitionId!==o.model_definition.model_definition_id)return!0;if(e.modelDefinitionId&&e.modelDefinitionId===o.model_definition.model_definition_id){if(e.provider!==o.model_definition.provider||e.modelName!==o.model_definition.model_name||"existing"===e.secretMode&&e.existingSecretId!==o.model_definition.secret_id||"new"===e.secretMode)return!0}return e.provider!==o.model_definition.provider||e.modelName!==o.model_definition.model_name||"existing"!==e.secretMode||e.existingSecretId!==o.model_definition.secret_id||Math.abs(e.weight-t)>.01}),c=F.some(e=>{if(!e.modelDefinitionId)return!0;const n=l.find(n=>{var i;return(null===(i=n.model_definition)||void 0===i?void 0:i.model_definition_id)===e.modelDefinitionId});if(!n)return!0;if(n.model_definition){if(e.provider!==n.model_definition.provider||e.modelName!==n.model_definition.model_name||"existing"===e.secretMode&&e.existingSecretId!==n.model_definition.secret_id||"new"===e.secretMode)return!0}return n.fallback_order!==e.fallbackOrder});return s||c},[v,H,C,F]),{data:P}=(0,s.c)();return{form:y,isLoadingEndpoint:d,isSubmitting:Y,loadError:f,mutationError:I,endpoint:v,existingEndpoints:P,isFormComplete:T,hasChanges:$,handleSubmit:_,handleCancel:D,handleNameUpdate:k}}var y=i(68248),x=i(27757),w=i(82716),b=i(79081),A=i(7655),M=i(40724),S=i(6459),Y=i(98332),I=i(63420),_=i(35583),D=i(93422),k=i(73716),C=i(75329),F=i(73408);var T={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},H={name:"1hhxok4",styles:"margin:0;font-weight:bold"},$={name:"1u1zie3",styles:"width:120px"},P={name:"1d3w5wq",styles:"width:100%"};const N=({model:e,index:n,onModelChange:i,onWeightChange:o,onRemove:t,componentIdPrefix:d})=>{const{theme:a}=(0,x.u)(),l=(0,A.A)(),[s,c]=(0,r.useState)(!e.provider&&!e.modelName),[m,p]=(0,r.useState)(null),g=null!==m&&void 0!==m?m:0===e.weight?"":String(e.weight),{existingSecrets:u,isLoadingSecrets:f,authModes:h,defaultAuthMode:v,isLoadingProviderConfig:S}=(0,k.t)({provider:e.provider}),N={mode:e.secretMode,existingSecretId:e.existingSecretId,newSecret:e.newSecret},L=e.provider&&e.modelName;return(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:a.spacing.md,padding:a.spacing.md,border:`2px solid ${a.colors.border}`,borderRadius:a.borders.borderRadiusMd,backgroundColor:a.colors.backgroundPrimary},""),children:[(0,F.FD)("div",{css:T,children:[(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:a.spacing.sm,flex:1},""),children:[(0,F.Y)(x.B,{componentId:`${d}.expand.${n}`,icon:s?(0,F.Y)(w.ChevronDownIcon,{}):(0,F.Y)(x.o,{}),onClick:()=>c(!s),size:"small"}),(0,F.Y)(w.FormUI.Label,{css:H,children:(0,F.Y)(M.A,{id:"JNmxAa",defaultMessage:"Model {number}",values:{number:n+1}})}),!s&&L&&(0,F.FD)(x.T.Text,{css:(0,y.AH)({fontFamily:"monospace",color:a.colors.textSecondary},""),children:[(0,C.aU)(e.provider)," / ",e.modelName,(0,F.FD)("span",{css:(0,y.AH)({marginLeft:a.spacing.sm,color:a.colors.actionTertiaryTextDefault},""),children:["(",e.weight,"%)"]})]})]}),(0,F.Y)(b.T,{componentId:`${d}.remove-tooltip.${n}`,content:l.formatMessage({id:"eWm+AG",defaultMessage:"Remove model"}),children:(0,F.Y)(x.B,{componentId:`${d}.remove.${n}`,icon:(0,F.Y)(w.TrashIcon,{}),onClick:()=>t(n)})})]}),s&&(0,F.FD)(F.FK,{children:[(0,F.Y)(I.U,{value:e.provider,onChange:e=>{i(n,{provider:e,modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}}})},componentIdPrefix:`${d}.provider.${n}`}),(0,F.Y)(_.o,{provider:e.provider,value:e.modelName,onChange:e=>i(n,{modelName:e}),componentIdPrefix:`${d}.model.${n}`}),(0,F.Y)(D.$,{value:N,onChange:e=>{i(n,{secretMode:e.mode,existingSecretId:e.existingSecretId,newSecret:e.newSecret})},provider:e.provider,existingSecrets:u,isLoadingSecrets:f,authModes:h,defaultAuthMode:v,isLoadingProviderConfig:S,componentIdPrefix:`${d}.api-key.${n}`}),(0,F.FD)("div",{css:$,children:[(0,F.Y)(w.FormUI.Label,{htmlFor:`${d}.weight.${n}`,children:(0,F.Y)(M.A,{id:"pOqgMC",defaultMessage:"Weight"})}),(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs},""),children:[(0,F.Y)(Y.f,{componentId:`${d}.weight.${n}`,type:"number",min:0,max:100,value:g,onChange:e=>{p(e.target.value);const i=parseInt(e.target.value,10);o(n,Number.isNaN(i)?0:i)},css:P}),(0,F.Y)("span",{css:(0,y.AH)({color:a.colors.textSecondary},""),children:"%"})]})]})]})]})};var L={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"};const B=({value:e,onChange:n,componentIdPrefix:i="mlflow.gateway.traffic-split"})=>{const{theme:o}=(0,x.u)(),t=(0,r.useCallback)(()=>{n([...e,{modelDefinitionName:"",provider:"",modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},weight:0}])},[e,n]),d=(0,r.useCallback)(i=>{n(e.filter((e,n)=>n!==i))},[e,n]),a=(0,r.useCallback)((i,o)=>{const t=[...e];t[i]={...t[i],...o},n(t)},[e,n]),l=(0,r.useCallback)((i,o)=>{const t=[...e];t[i]={...t[i],weight:o},n(t)},[e,n]),s=e.reduce((e,n)=>e+n.weight,0),c=100===s;return(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:o.spacing.md},""),children:[e.map((e,n)=>(0,F.Y)(N,{model:e,index:n,onModelChange:a,onWeightChange:l,onRemove:d,componentIdPrefix:i},n)),(0,F.FD)("div",{css:L,children:[(0,F.Y)(x.B,{componentId:`${i}.add`,icon:(0,F.Y)(w.PlusIcon,{}),onClick:t,children:(0,F.Y)(M.A,{id:"MsSpWB",defaultMessage:"Add model for traffic split"})}),e.length>0&&(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:o.spacing.xs,color:c?o.colors.textSecondary:o.colors.textValidationDanger,fontSize:o.typography.fontSizeSm},""),children:[(0,F.Y)(M.A,{id:"6fV0+T",defaultMessage:"Total: {total}%",values:{total:s}}),!c&&(0,F.Y)(M.A,{id:"ftZaLl",defaultMessage:"(must equal 100%)"})]})]})]})};var R=i(17066),E=i(24014),z=i(72943),U=i(59126);const j="FALLBACK_MODEL";var O={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},q={name:"uaizzl",styles:"cursor:grab;display:flex;align-items:center;&:active{cursor:grabbing;}"},K={name:"1hhxok4",styles:"margin:0;font-weight:bold"};const Q=({model:e,index:n,onModelChange:i,onRemove:o,onMove:t,componentIdPrefix:d})=>{const{theme:a}=(0,x.u)(),l=(0,A.A)(),[s,c]=(0,r.useState)(!e.provider&&!e.modelName),m=(0,r.useRef)(null),[{isDragging:p},g,u]=(0,z.i)({type:j,item:{type:j,index:n},collect:e=>({isDragging:e.isDragging()})}),[{isOver:f},h]=(0,U.H)({accept:j,hover:e=>{if(!m.current)return;const i=e.index,o=n;i!==o&&(t(i,o),e.index=o)},collect:e=>({isOver:e.isOver()})});u(h(m));const{existingSecrets:v,isLoadingSecrets:S,authModes:Y,defaultAuthMode:T,isLoadingProviderConfig:H}=(0,k.t)({provider:e.provider}),$={mode:e.secretMode,existingSecretId:e.existingSecretId,newSecret:e.newSecret},P=e.provider&&e.modelName;return(0,F.FD)("div",{ref:m,css:(0,y.AH)({display:"flex",flexDirection:"column",gap:a.spacing.md,padding:a.spacing.md,border:`2px solid ${a.colors.border}`,borderRadius:a.borders.borderRadiusMd,backgroundColor:a.colors.backgroundPrimary,opacity:p?.5:1,borderColor:f?a.colors.actionPrimaryBackgroundDefault:a.colors.border},""),children:[(0,F.FD)("div",{css:O,children:[(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:a.spacing.sm,flex:1},""),children:[(0,F.Y)("div",{ref:g,css:q,children:(0,F.Y)(w.DragIcon,{css:(0,y.AH)({color:a.colors.textSecondary},"")})}),(0,F.Y)(x.B,{componentId:`${d}.expand.${n}`,icon:s?(0,F.Y)(w.ChevronDownIcon,{}):(0,F.Y)(x.o,{}),onClick:()=>c(!s),size:"small"}),(0,F.Y)(w.FormUI.Label,{css:K,children:(0,F.Y)(M.A,{id:"hDExYR",defaultMessage:"Fallback Model {order}",values:{order:n+1}})}),!s&&P&&(0,F.FD)(x.T.Text,{css:(0,y.AH)({fontFamily:"monospace",color:a.colors.textSecondary},""),children:[(0,C.aU)(e.provider)," / ",e.modelName]})]}),(0,F.Y)(b.T,{componentId:`${d}.remove-tooltip.${n}`,content:l.formatMessage({id:"XZlIAj",defaultMessage:"Remove fallback model"}),children:(0,F.Y)(x.B,{componentId:`${d}.remove.${n}`,icon:(0,F.Y)(w.TrashIcon,{}),onClick:()=>o(n)})})]}),s&&(0,F.FD)(F.FK,{children:[(0,F.Y)(I.U,{value:e.provider,onChange:e=>{i(n,{provider:e,modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}}})},componentIdPrefix:`${d}.provider.${n}`}),(0,F.Y)(_.o,{provider:e.provider,value:e.modelName,onChange:e=>i(n,{modelName:e}),componentIdPrefix:`${d}.model.${n}`}),(0,F.Y)(D.$,{value:$,onChange:e=>{i(n,{secretMode:e.mode,existingSecretId:e.existingSecretId,newSecret:e.newSecret})},provider:e.provider,existingSecrets:v,isLoadingSecrets:S,authModes:Y,defaultAuthMode:T,isLoadingProviderConfig:H,componentIdPrefix:`${d}.api-key.${n}`})]})]})},G=({value:e,onChange:n,componentIdPrefix:i="mlflow.gateway.fallback"})=>{const{theme:o}=(0,x.u)(),t=(0,r.useCallback)(()=>{const i=e.length>0?Math.max(...e.map(e=>e.fallbackOrder))+1:1;n([...e,{modelDefinitionName:"",provider:"",modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},fallbackOrder:i}])},[e,n]),d=(0,r.useCallback)(i=>{const o=e.filter((e,n)=>n!==i).map((e,n)=>({...e,fallbackOrder:n+1}));n(o)},[e,n]),a=(0,r.useCallback)((i,o)=>{const t=[...e];t[i]={...t[i],...o},n(t)},[e,n]),l=(0,r.useCallback)((i,o)=>{const t=[...e],[d]=t.splice(i,1);t.splice(o,0,d);const a=t.map((e,n)=>({...e,fallbackOrder:n+1}));n(a)},[e,n]);return(0,F.Y)(R.Q,{backend:E.t2,children:(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:o.spacing.md},""),children:[e.map((e,n)=>(0,F.Y)(Q,{model:e,index:n,onModelChange:a,onRemove:d,onMove:l,componentIdPrefix:i},n)),(0,F.Y)(x.B,{componentId:`${i}.add`,icon:(0,F.Y)(w.PlusIcon,{}),onClick:t,children:(0,F.Y)(M.A,{id:"NlwpVQ",defaultMessage:"Add fallback"})})]})})};var X=i(91701),W=i(19112);var V={name:"bjn8wh",styles:"position:relative"},Z={name:"1i9vogi",styles:"margin-top:0"};const J=({open:e,onClose:n,endpointName:i,baseUrl:o})=>{const{theme:t}=(0,x.u)(),[d,a]=(0,r.useState)("unified"),[l,s]=(0,r.useState)("openai"),[c,m]=(0,r.useState)("curl"),[p,g]=(0,r.useState)("curl"),u=(e=>e||("undefined"!==typeof window?window.location.origin:"http://localhost:5000"))(o),f=`curl -X POST ${u}/gateway/${i}/mlflow/invocations \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "messages": [\n    {"role": "user", "content": "Hello, how are you?"}\n  ]\n}'`,h=`import requests\n\nresponse = requests.post(\n    "${u}/gateway/${i}/mlflow/invocations",\n    json={\n        "messages": [\n            {"role": "user", "content": "Hello, how are you?"}\n        ]\n    }\n)\nprint(response.json())`,v=`curl -X POST ${u}/gateway/mlflow/v1/chat/completions \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${i}",\n  "messages": [\n    {"role": "user", "content": "How are you?"}\n  ]\n}'`,A=`from openai import OpenAI\n\nclient = OpenAI(\n    base_url="${u}/gateway/mlflow/v1",\n    api_key="",  # API key not needed, configured server-side\n)\n\nmessages = [{"role": "user", "content": "How are you?"}]\n\nresponse = client.chat.completions.create(\n    model="${i}",  # Endpoint name as model\n    messages=messages,\n)\nprint(response.choices[0].message)`,S=`curl -X POST ${u}/gateway/openai/v1/responses \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${i}",\n  "input": "How are you?"\n}'`,Y=`from openai import OpenAI\n\nclient = OpenAI(\n    base_url="${u}/gateway/openai/v1",\n    api_key="dummy",  # API key not needed, configured server-side\n)\n\nresponse = client.responses.create(\n    model="${i}",\n    input="How are you?",\n)\nprint(response.output_text)`,I=`curl -X POST ${u}/gateway/anthropic/v1/messages \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${i}",\n  "max_tokens": 1024,\n  "messages": [\n    {"role": "user", "content": "How are you?"}\n  ]\n}'`,_=`import anthropic\n\nclient = anthropic.Anthropic(\n    base_url="${u}/gateway/anthropic",\n    api_key="dummy",  # API key not needed, configured server-side\n)\n\nresponse = client.messages.create(\n    model="${i}",\n    max_tokens=1024,\n    messages=[{"role": "user", "content": "How are you?"}],\n)\nprint(response.content[0].text)`,D=`curl -X POST ${u}/gateway/gemini/v1beta/models/${i}:generateContent \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "contents": [{\n    "parts": [{"text": "How are you?"}]\n  }]\n}'`,k=`from google import genai\n\n# Configure with custom endpoint\nclient = genai.Client(\n    api_key='dummy',\n    http_options={\n        'base_url': "${u}/gateway/gemini",\n    }\n)\nresponse = client.models.generate_content(\n    model="${i}",\n    contents={'text': 'How are you?'},\n)\nclient.close()\nprint(response.candidates[0].content.parts[0].text)`,C=(e,n,i="text")=>(0,F.FD)("div",{css:(0,y.AH)({marginBottom:t.spacing.md},""),children:[(0,F.FD)("div",{css:(0,y.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing.xs},""),children:[(0,F.Y)(x.T.Text,{bold:!0,children:e}),(0,F.Y)(X.i,{componentId:`mlflow.gateway.usage-modal.copy-${e.toLowerCase().replace(/\s+/g,"-")}`,copyText:n,icon:(0,F.Y)(w.CopyIcon,{}),showLabel:!1})]}),(0,F.Y)("div",{css:V,children:(0,F.Y)(W.z7,{language:i,theme:t.isDarkMode?"duotoneDark":"light",style:{fontSize:t.typography.fontSizeSm,padding:`${t.spacing.sm}px ${t.spacing.md}px`},children:n})})]});return(0,F.Y)(b.d,{componentId:"mlflow.gateway.endpoint-usage-modal",visible:e,onCancel:n,title:(0,F.Y)(M.A,{id:"/Sa51w",defaultMessage:"Query endpoint"}),footer:null,size:"wide",children:(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,maxHeight:"70vh",overflowY:"auto"},""),children:[(0,F.Y)(x.T.Text,{color:"secondary",children:(0,F.Y)(M.A,{id:"+HgSTK",defaultMessage:"Use these code examples to call your endpoint. Choose between unified APIs for seamless model switching or passthrough APIs for provider-specific features."})}),(0,F.FD)("div",{css:(0,y.AH)({display:"flex",gap:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:[(0,F.Y)("div",{css:(0,y.AH)({padding:`${t.spacing.sm}px ${t.spacing.md}px`,cursor:"pointer",borderBottom:"unified"===d?`2px solid ${t.colors.actionPrimaryBackgroundDefault}`:"2px solid transparent",color:"unified"===d?t.colors.actionPrimaryBackgroundDefault:t.colors.textSecondary,fontWeight:"unified"===d?"bold":"normal"},""),onClick:()=>a("unified"),children:(0,F.Y)(M.A,{id:"vwD2zW",defaultMessage:"Unified APIs"})}),(0,F.Y)("div",{css:(0,y.AH)({padding:`${t.spacing.sm}px ${t.spacing.md}px`,cursor:"pointer",borderBottom:"passthrough"===d?`2px solid ${t.colors.actionPrimaryBackgroundDefault}`:"2px solid transparent",color:"passthrough"===d?t.colors.actionPrimaryBackgroundDefault:t.colors.textSecondary,fontWeight:"passthrough"===d?"bold":"normal"},""),onClick:()=>a("passthrough"),children:(0,F.Y)(M.A,{id:"dQawRm",defaultMessage:"Passthrough APIs"})})]}),"unified"===d&&(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:t.spacing.lg},""),children:[(0,F.FD)(w.SegmentedControlGroup,{name:"unified-language-selector",componentId:"mlflow.gateway.usage-modal.unified-language-selector",value:p,onChange:({target:{value:e}})=>g(e),children:[(0,F.Y)(w.SegmentedControlButton,{value:"curl",children:"cURL"}),(0,F.Y)(w.SegmentedControlButton,{value:"python",children:"Python"})]}),(0,F.FD)("div",{children:[(0,F.Y)(x.T.Title,{level:4,css:Z,children:(0,F.Y)(M.A,{id:"Y7AIKR",defaultMessage:"MLflow Invocations API"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(M.A,{id:"tv0qk9",defaultMessage:"Native MLflow API for model invocations. Supports seamless model switching and advanced routing."})}),"curl"===p&&C("cURL",f,"text"),"python"===p&&C("Python",h,"python")]}),(0,F.FD)("div",{children:[(0,F.Y)(x.T.Title,{level:4,children:(0,F.Y)(M.A,{id:"dsPsxG",defaultMessage:"OpenAI-Compatible Chat Completions API"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(M.A,{id:"hjAgZ8",defaultMessage:"Unified OpenAI compatible API for model invocations. Set the endpoint name as the model parameter."})}),"curl"===p&&C("cURL",v,"text"),"python"===p&&C("Python",A,"python")]})]}),"passthrough"===d&&(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:t.spacing.lg},""),children:[(0,F.FD)("div",{children:[(0,F.Y)(x.T.Text,{bold:!0,css:(0,y.AH)({display:"block",marginBottom:t.spacing.sm},""),children:(0,F.Y)(M.A,{id:"+li9YN",defaultMessage:"Provider"})}),(0,F.FD)(w.SegmentedControlGroup,{name:"provider-selector",componentId:"mlflow.gateway.usage-modal.provider-selector",value:l,onChange:({target:{value:e}})=>s(e),children:[(0,F.Y)(w.SegmentedControlButton,{value:"openai",children:"OpenAI"}),(0,F.Y)(w.SegmentedControlButton,{value:"anthropic",children:"Anthropic"}),(0,F.Y)(w.SegmentedControlButton,{value:"gemini",children:"Google Gemini"})]})]}),(0,F.FD)("div",{children:["openai"===l&&(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(M.A,{id:"cniMRT",defaultMessage:"Direct access to OpenAI's Responses API for multi-turn conversations with vision and audio capabilities."})}),"anthropic"===l&&(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(M.A,{id:"Xn0LxG",defaultMessage:"Direct access to Anthropic's Messages API with Claude-specific features."})}),"gemini"===l&&(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(M.A,{id:"7MWbDM",defaultMessage:"Direct access to Google's Gemini API. Note: endpoint name is part of the URL path."})}),(0,F.FD)(w.SegmentedControlGroup,{name:"language-selector",componentId:"mlflow.gateway.usage-modal.language-selector",value:c,onChange:({target:{value:e}})=>m(e),css:(0,y.AH)({marginBottom:t.spacing.md},""),children:[(0,F.Y)(w.SegmentedControlButton,{value:"curl",children:"cURL"}),(0,F.Y)(w.SegmentedControlButton,{value:"python",children:"Python"})]}),"openai"===l&&"curl"===c&&C("cURL",S,"text"),"openai"===l&&"python"===c&&C("Python",Y,"python"),"anthropic"===l&&"curl"===c&&C("cURL",I,"text"),"anthropic"===l&&"python"===c&&C("Python",_,"python"),"gemini"===l&&"curl"===c&&C("cURL",D,"text"),"gemini"===l&&"python"===c&&C("Python",k,"python")]})]})]})})};var ee=i(66916),ne=i(87032);const ie=({endpoint:e,existingEndpoints:n,onNameUpdate:i,isSubmitting:o=!1})=>{const{theme:t}=(0,x.u)(),d=(0,A.A)(),[a,l]=(0,r.useState)(!1),[s,c]=(0,r.useState)(""),[m,p]=(0,r.useState)(null),[g,u]=(0,r.useState)(!1),f=()=>{l(!1),c(""),p(null)};return(0,F.FD)(F.FK,{children:[(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[(0,F.Y)(x.T.Title,{level:2,withoutMargins:!0,children:null===e||void 0===e?void 0:e.name}),(0,F.Y)(b.T,{componentId:"mlflow.gateway.edit-endpoint.name-edit-tooltip",content:d.formatMessage({id:"nBKx6U",defaultMessage:"Edit endpoint name"}),children:(0,F.Y)(x.B,{componentId:"mlflow.gateway.edit-endpoint.name-edit-button",size:"small",type:"tertiary",icon:(0,F.Y)(w.PencilIcon,{}),onClick:()=>{var n;c(null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""),p(null),l(!0)},disabled:o,"aria-label":d.formatMessage({id:"5umyLP",defaultMessage:"Edit endpoint name"})})})]}),(0,F.Y)(b.d,{componentId:"mlflow.gateway.edit-endpoint-name-modal",title:d.formatMessage({id:"AawxF/",defaultMessage:"Edit Endpoint Name"}),visible:a,onCancel:f,onOk:async()=>{const o=(i=>{if(!i.trim())return d.formatMessage({id:"Y73UT6",defaultMessage:"Endpoint name is required"});if(!(0,ne.j8)(i))return d.formatMessage({id:"dzIz7c",defaultMessage:"Name can only contain letters, numbers, underscores, hyphens, and dots. Spaces and special characters are not allowed."});const o=null===n||void 0===n?void 0:n.filter(n=>n.endpoint_id!==(null===e||void 0===e?void 0:e.endpoint_id));return null!==o&&void 0!==o&&o.some(e=>e.name===i)?d.formatMessage({id:"gVz/1j",defaultMessage:"An endpoint with this name already exists"}):null})(s);if(o)p(o);else if(s!==(null===e||void 0===e?void 0:e.name)){u(!0);try{await i(s),f()}catch(t){p(t.message||"Failed to update endpoint name")}finally{u(!1)}}else f()},okText:d.formatMessage({id:"8DoNdT",defaultMessage:"Save"}),cancelText:d.formatMessage({id:"hHNj31",defaultMessage:"Cancel"}),confirmLoading:g,okButtonProps:{disabled:!s.trim()||s===(null===e||void 0===e?void 0:e.name)},size:"normal",children:(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md},""),children:[m&&(0,F.Y)(w.Alert,{componentId:"mlflow.gateway.edit-endpoint-name-modal.error",type:"error",message:m,closable:!1}),(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,F.Y)(x.T.Text,{bold:!0,children:(0,F.Y)(M.A,{id:"FHJ1NN",defaultMessage:"Endpoint Name"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({fontSize:t.typography.fontSizeSm},""),children:(0,F.Y)(M.A,{id:"iT2I8i",defaultMessage:"The name is used in the endpoint URL. Only letters, numbers, underscores, hyphens, and dots are allowed."})}),(0,F.Y)(ee.I,{componentId:"mlflow.gateway.edit-endpoint-name-modal.name-input",value:s,onChange:e=>{c(e.target.value),m&&p(null)},placeholder:d.formatMessage({id:"AanBxl",defaultMessage:"my-endpoint"}),validationState:m?"error":void 0,autoFocus:!0})]})]})})]})};var oe={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},te={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},de={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},ae={name:"1e1crzz",styles:"width:280px;flex-shrink:0;position:sticky;top:0;align-self:flex-start"};const le=({form:e,isLoadingEndpoint:n,isSubmitting:i,loadError:t,mutationError:d,errorMessage:l,endpoint:s,existingEndpoints:c,isFormComplete:m,hasChanges:p,onSubmit:g,onCancel:u,onNameUpdate:f})=>{const{theme:v}=(0,x.u)(),Y=(0,A.A)(),[I,_]=(0,r.useState)(!1),D=e.watch("trafficSplitModels"),k=e.watch("fallbackModels"),C=D.reduce((e,n)=>e+n.weight,0),T=Math.abs(C-100)<.01;return n?(0,F.Y)("div",{css:oe,children:(0,F.FD)("div",{css:(0,y.AH)({display:"flex",alignItems:"center",gap:v.spacing.sm,padding:v.spacing.md},""),children:[(0,F.Y)(x.S,{size:"small"}),(0,F.Y)(M.A,{id:"RyNXc+",defaultMessage:"Loading endpoint..."})]})}):t?(0,F.Y)("div",{css:te,children:(0,F.Y)("div",{css:(0,y.AH)({padding:v.spacing.md},""),children:(0,F.Y)(w.Alert,{componentId:"mlflow.gateway.edit-endpoint.error",type:"error",message:null!==(H=t.message)&&void 0!==H?H:"Endpoint not found"})})}):(0,F.FD)("div",{css:de,children:[(0,F.FD)("div",{css:(0,y.AH)({padding:v.spacing.md},""),children:[(0,F.FD)(w.Breadcrumb,{includeTrailingCaret:!0,children:[(0,F.Y)(w.Breadcrumb.Item,{children:(0,F.Y)(o.N_,{to:h.Ay.gatewayPageRoute,children:(0,F.Y)(M.A,{id:"uABFy0",defaultMessage:"AI Gateway"})})}),(0,F.Y)(w.Breadcrumb.Item,{children:(0,F.Y)(o.N_,{to:h.Ay.gatewayPageRoute,children:(0,F.Y)(M.A,{id:"eYZ/ZL",defaultMessage:"Endpoints"})})})]}),(0,F.FD)("div",{css:(0,y.AH)({marginTop:v.spacing.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},""),children:[(0,F.Y)(ie,{endpoint:s,existingEndpoints:c,onNameUpdate:f,isSubmitting:i}),(0,F.Y)(x.B,{componentId:"mlflow.gateway.edit-endpoint.use-button",onClick:()=>_(!0),children:(0,F.Y)(M.A,{id:"yLAJ6r",defaultMessage:"Use"})})]})]}),d&&(0,F.Y)("div",{css:(0,y.AH)({padding:`0 ${v.spacing.md}px`},""),children:(0,F.Y)(w.Alert,{componentId:"mlflow.gateway.edit-endpoint.mutation-error",closable:!1,message:l,type:"error",css:(0,y.AH)({marginBottom:v.spacing.md},"")})}),(0,F.FD)("div",{css:(0,y.AH)({flex:1,display:"flex",gap:v.spacing.md,padding:`${v.spacing.md}px`,overflow:"auto",backgroundColor:v.colors.backgroundPrimary},""),children:[(0,F.FD)("div",{css:(0,y.AH)({flex:1,display:"flex",flexDirection:"column",gap:v.spacing.lg},""),children:[(0,F.FD)("div",{css:(0,y.AH)({padding:v.spacing.md,border:`1px solid ${v.colors.border}`,borderRadius:v.borders.borderRadiusMd,backgroundColor:v.colors.backgroundSecondary},""),children:[(0,F.Y)(x.T.Title,{level:3,children:(0,F.Y)(M.A,{id:"t8zXLd",defaultMessage:"Priority 1 (Traffic Split)"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginTop:v.spacing.xs},""),children:(0,F.Y)(M.A,{id:"Lh4Pv4",defaultMessage:"Models in this priority will be tested first, with traffic split load balancing"})}),(0,F.Y)("div",{css:(0,y.AH)({marginTop:v.spacing.lg},""),children:(0,F.Y)(a.xI,{control:e.control,name:"trafficSplitModels",render:({field:e})=>(0,F.Y)(B,{value:e.value,onChange:e.onChange,componentIdPrefix:"mlflow.gateway.edit-endpoint.traffic-split"})})})]}),(0,F.FD)("div",{css:(0,y.AH)({padding:v.spacing.md,border:`1px solid ${v.colors.border}`,borderRadius:v.borders.borderRadiusMd,backgroundColor:v.colors.backgroundSecondary},""),children:[(0,F.Y)(x.T.Title,{level:3,children:(0,F.Y)(M.A,{id:"RMdf6R",defaultMessage:"Priority 2 (Fallback)"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({display:"block",marginTop:v.spacing.xs},""),children:(0,F.Y)(M.A,{id:"nF/4Eh",defaultMessage:"Models in this priority will be tested second, after models in Priority 1 have failed. Models will be attempted in order from top to bottom."})}),(0,F.Y)("div",{css:(0,y.AH)({marginTop:v.spacing.lg},""),children:(0,F.Y)(a.xI,{control:e.control,name:"fallbackModels",render:({field:e})=>(0,F.Y)(G,{value:e.value,onChange:e.onChange,componentIdPrefix:"mlflow.gateway.edit-endpoint.fallback"})})})]}),(0,F.FD)("div",{css:(0,y.AH)({display:"flex",gap:v.spacing.md},""),children:[(0,F.FD)("div",{css:(0,y.AH)({flex:1,padding:v.spacing.md,border:`2px dashed ${v.colors.actionDefaultBorderDefault}`,borderRadius:v.borders.borderRadiusMd,backgroundColor:v.colors.backgroundPrimary,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},""),children:[(0,F.Y)(x.T.Text,{bold:!0,children:(0,F.Y)(M.A,{id:"p8KS2c",defaultMessage:"Usage Tracking"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({fontSize:v.typography.fontSizeSm},""),children:(0,F.Y)(M.A,{id:"jLHxac",defaultMessage:"Coming Soon"})})]}),(0,F.FD)("div",{css:(0,y.AH)({flex:1,padding:v.spacing.md,border:`2px dashed ${v.colors.actionDefaultBorderDefault}`,borderRadius:v.borders.borderRadiusMd,backgroundColor:v.colors.backgroundPrimary,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},""),children:[(0,F.Y)(x.T.Text,{bold:!0,children:(0,F.Y)(M.A,{id:"oxHklW",defaultMessage:"Rate Limiting"})}),(0,F.Y)(x.T.Text,{color:"secondary",css:(0,y.AH)({fontSize:v.typography.fontSizeSm},""),children:(0,F.Y)(M.A,{id:"jLHxac",defaultMessage:"Coming Soon"})})]})]})]}),(0,F.Y)("div",{css:ae,children:(0,F.Y)(S.v,{title:Y.formatMessage({id:"mi7FdJ",defaultMessage:"Summary"}),children:(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:v.spacing.md},""),children:[D.length>0&&(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:v.spacing.xs},""),children:[(0,F.Y)(x.T.Text,{bold:!0,color:"secondary",children:(0,F.Y)(M.A,{id:"mz/gog",defaultMessage:"Traffic Split"})}),D.map((e,n)=>(0,F.Y)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:v.spacing.xs,fontSize:v.typography.fontSizeSm},""),children:(0,F.FD)(x.T.Text,{css:(0,y.AH)({fontSize:v.typography.fontSizeSm},""),children:[e.provider&&e.modelName?`${e.provider}/${e.modelName}`:`Model ${n+1}`," ","- ",e.weight,"%"]})},n))]}),k.length>0&&(0,F.FD)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:v.spacing.xs},""),children:[(0,F.Y)(x.T.Text,{bold:!0,color:"secondary",children:(0,F.Y)(M.A,{id:"b6hjrM",defaultMessage:"Fallback Models"})}),k.map((e,n)=>(0,F.Y)("div",{css:(0,y.AH)({display:"flex",flexDirection:"column",gap:v.spacing.xs,fontSize:v.typography.fontSizeSm},""),children:(0,F.FD)(x.T.Text,{css:(0,y.AH)({fontSize:v.typography.fontSizeSm},""),children:[n+1,"."," ",e.provider&&e.modelName?`${e.provider}/${e.modelName}`:`Model ${n+1}`]})},n))]})]})})})]}),(0,F.FD)("div",{css:(0,y.AH)({display:"flex",justifyContent:"flex-end",gap:v.spacing.sm,padding:v.spacing.md,borderTop:`1px solid ${v.colors.border}`,flexShrink:0},""),children:[(0,F.Y)(x.B,{componentId:"mlflow.gateway.edit-endpoint.cancel",onClick:u,children:(0,F.Y)(M.A,{id:"qz9XeG",defaultMessage:"Cancel"})}),(0,F.Y)(b.T,{componentId:"mlflow.gateway.edit-endpoint.save-tooltip",content:!m&&D.length>0&&!T?Y.formatMessage({id:"3YddwH",defaultMessage:"Traffic split percentages must total 100%"}):m?p?void 0:Y.formatMessage({id:"eANdPU",defaultMessage:"No changes to save"}):Y.formatMessage({id:"Lw+dTL",defaultMessage:"Please configure at least one model in traffic split"}),children:(0,F.Y)(x.B,{componentId:"mlflow.gateway.edit-endpoint.save",type:"primary",onClick:e.handleSubmit(g),loading:i,disabled:!m||!p,children:(0,F.Y)(M.A,{id:"NVDxng",defaultMessage:"Save changes"})})})]}),(0,F.Y)(J,{open:I,onClose:()=>_(!1),endpointName:(null===s||void 0===s?void 0:s.name)||""})]});var H};var re=(0,t.X)(d.A.mlflowServices.EXPERIMENTS,()=>{const{endpointId:e}=(0,o.g)(),{form:n,isLoadingEndpoint:i,isSubmitting:t,loadError:d,mutationError:l,endpoint:r,existingEndpoints:s,isFormComplete:c,hasChanges:m,handleSubmit:p,handleCancel:g,handleNameUpdate:u}=v(null!==e&&void 0!==e?e:"");return(0,F.Y)(a.Op,{...n,children:(0,F.Y)(le,{form:n,isLoadingEndpoint:i,isSubmitting:t,loadError:d,mutationError:l,errorMessage:(0,f.m)(l),endpoint:r,existingEndpoints:s,isFormComplete:c,hasChanges:m,onSubmit:p,onCancel:g,onNameUpdate:u})})})}}]);